var pUniqueId=[],melisCommerce=function(e){function t(e){$("li a.tab-element[data-id='"+e+"']").css("pointer-events","none").parent().css("cursor","not-allowed")}function s(e){$("li a.tab-element[data-id='"+e+"']").css("pointer-events","auto").parent().css("cursor","pointer")}return{pendingZoneStart:function(e){$("#"+e).append('<div id="loader" class="overlay-loader"><img class="loader-icon spinning-cog" src="/MelisCore/assets/images/cog12.svg" data-cog="cog12"></div>')},pendingZoneDone:function(e){$("#"+e+" .loader-icon").removeClass("spinning-cog").addClass("shrinking-cog"),setTimeout(function(){$("#"+e+" #loader").remove()},500)},initTooltipTable:function(){$(".tooltipTable").each(function(){$(this).qtip({content:{text:$(this).next(".tooltiptext")},overwrite:!1,style:{classes:"qtip-tipsy qtip-shadow",width:"auto"},hide:{fixed:!0,delay:300,event:"mouseleave"},position:{target:"mouse",adjust:{mouse:!1},my:"center center",at:"center center"}})})},initTooltipVarTable:function(){$(".tooltipTableVar").each(function(){$(this).qtip({content:{text:$(this).next(".tooltiptext")},overwrite:!1,style:{classes:"qtip-tipsy qtip-shadow",width:"auto"},hide:{fixed:!0,delay:300,event:"mouseleave"},position:{target:"mouse",adjust:{mouse:!1},my:"center center",at:"center center"}})})},initCommerceTable:function(e,t,i,s,o){$(e).DataTable({responsive:!0,paging:!0,ordering:!0,processing:!0,serverSide:!0,searching:!0,lengthMenu:[[5,10,25,50,100,-1],[5,10,25,50,100,"All"]],pageLength:10,ajax:{url:t,type:"POST"},order:[[1,"asc"]],columns:i,columnDefs:[{responsivePriority:1,targets:0},{responsivePriority:2,targets:-1}],language:{url:"/melis/MelisCore/Language/getDataTableTranslations"},dom:'<"bulk-action"><"filter-bar fl">rtip',drawCallback:function(e){$(this).css("width","100%")}}),$(".filter-bar").html(s),$(".bulk-action").html(o)},openProductPage:function(e,t,i,s){melisHelper.tabOpen(melisCore.escapeHtml(t),"icon-shippment",e+"_id_meliscommerce_products_page","meliscommerce_products_page",{productId:e},i),s&&"function"==typeof s&&s()},postSave:function(e,t,i,s){$.ajax({type:"POST",url:e,data:t,dataType:"json",encode:!0}).done(function(e){i(e)}).fail(function(){s()})},getCurrentProductId:function(){return activeTabId.split("_")[0]},closeCurrentProductPage:function(){melisHelper.tabClose(melisCommerce.getCurrentProductId()+"_id_meliscommerce_products_page")},reloadCurrentProdPage:function(e){var t=melisCommerce.getCurrentProductId();null!=e&&(t=e),melisCoreTool.clearForm("productTextTypeForm"),melisHelper.zoneReload(t+"_id_meliscommerce_products_page","meliscommerce_products_page",{productId:t})},initTinyMCE:function(){var e="";e="en_EN"==melisLangId?"en":melisLangId,setTimeout(function(){tinymce.init({mode:"specific_textareas",editor_selector:"mceEditor",language:e,height:200,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table paste template"],menubar:!1,toolbar:"undo redo | styleselect | bold italic | link image |  alignleft aligncenter alignright alignjustify | code"})},1e3)},getDocFormType:function(){return $("#"+activeTabId).find("div.ecom-doc-container").data("form-type")},setUniqueId:function(e){null==e?$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComDocument/setUniqueId",data:{id:e},dataType:"json",encode:!0}).done(function(e){pUniqueId[activeTabId]=e.id}).fail(function(){alert(translations.tr_meliscore_error_message)}):pUniqueId[activeTabId]=e},getUniqueId:function(){return pUniqueId[activeTabId]},enableTab:s,disableTab:t,disableAllTabs:function(){$.each($("#melis-id-nav-bar-tabs li a"),function(e,i){t($(i).data("id"))}),$.each($("ul.sideMenu"),function(e,t){$(t).css("pointer-events","none").parent().css("cursor","not-allowed")})},enableAllTabs:function(){$.each($("#melis-id-nav-bar-tabs li a"),function(e,t){s($(t).data("id"))}),$.each($("ul.sideMenu"),function(e,t){$(t).css("pointer-events","none").css("pointer-events","auto").parent().css("cursor","pointer")})},accordionToggle:function(e){var t=e.target,i=$(t).attr("href");$(i).collapse("toggle")},switchOrderTab:function(e){var t=$(e),i=$(e+"[data-toggle='tab']"),s=i.closest("li"),o=i.attr("href");$("#id_meliscommerce_order_checkout_content .tab-content").find(".tab-pane").siblings().removeClass("active"),t.removeClass("active"),$(o).tab("show"),s.siblings().removeClass("active"),s.addClass("active")},orderBasketPriceLogTooltip:function(){$(".order-basket-price-log").each(function(){var e=$(this);let t=$(this).find(".basket-price-log").text(),s="";if(""!=t)for(logs=JSON.parse(t),console.log(logs),i=0;i<logs.length;i++)s+="<li>"+logs[i]+"</li>";s=""==s?"N/A":s,e.qtip({content:{text:"<div class='price-log-container'><p>Price Log</p><ul>"+s+"</ul></div>"},overwrite:!1,style:{classes:"qtip-tipsy qtip-shadow",width:"auto"},hide:{fixed:!0,delay:300,event:"mouseleave"},position:{target:"mouse",adjust:{mouse:!1},my:"center center",at:"center center"}})})}}}(window);setInterval(function(){melisCommerce.enableAllTabs()},1e4),$(function(){var e=$("body");e.on("click",".accordion-toggle",melisCommerce.accordionToggle),e.on("click",".melis-commerce-checkbox input[type=checkbox]",function(){$(this).parent().find(".cbmask-inner").toggleClass("cb-active")})}),$(function(){var e=$.fn.checkbox,t=function(e,t){this.$element=$(e),this.options=$.extend({},$.fn.checkbox.defaults,t),this.$label=this.$element.parent(),this.$icon=this.$label.find("i"),this.$chk=this.$label.find("input[type=checkbox]"),this.setState(this.$chk),this.$chk.on("change",$.proxy(this.itemchecked,this))};t.prototype={constructor:t,setState:function(e){var t=(e=e||this.$chk).is(":checked"),i=!!e.prop("disabled");this.$icon.removeClass("checked disabled"),!0===t&&this.$icon.addClass("checked"),!0===i&&this.$icon.addClass("disabled")},enable:function(){this.$chk.attr("disabled",!1),this.$icon.removeClass("disabled")},disable:function(){this.$chk.attr("disabled",!0),this.$icon.addClass("disabled")},toggle:function(){this.$chk.click()},itemchecked:function(e){var t=$(e.target);this.setState(t)},check:function(){this.$chk.prop("checked",!0),this.setState(this.$chk)},uncheck:function(){this.$chk.prop("checked",!1),this.setState(this.$chk)},isChecked:function(){return this.$chk.is(":checked")}},$.fn.checkbox=function(e){var i,s=Array.prototype.slice.call(arguments,1),o=this.each(function(){var o=$(this),r=o.data("checkbox"),a="object"==typeof e&&e;r||o.data("checkbox",r=new t(this,a)),"string"==typeof e&&(i=r[e].apply(r,s))});return void 0===i?o:i},$.fn.checkbox.defaults={},$.fn.checkbox.Constructor=t,$.fn.checkbox.noConflict=function(){return $.fn.checkbox=e,this},$(function(){$(window).on("load",function(){$(".checkbox-custom > input[type=checkbox]").each(function(){var e=$(this);e.data("checkbox")||e.checkbox(e.data())})})})}),function(e,t,i){!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):jQuery&&!jQuery.fn.qtip&&e(jQuery)}(function(s){"use strict";function o(e,t,i,o){this.id=i,this.target=e,this.tooltip=S,this.elements={target:e},this._id=B+"-"+i,this.timers={img:{}},this.options=t,this.plugins={},this.cache={event:{},target:s(),disabled:M,attr:o,onTooltip:M,lastClass:""},this.rendered=this.destroyed=this.disabled=this.waiting=this.hiddenDuringWait=this.positioning=this.triggering=M}function r(e){return e===S||"object"!==s.type(e)}function a(e){return!(s.isFunction(e)||e&&e.attr||e.length||"object"===s.type(e)&&(e.jquery||e.then))}function n(e){var t,i,o,n;return r(e)?M:(r(e.metadata)&&(e.metadata={type:e.metadata}),"content"in e&&(r(t=e.content)||t.jquery||t.done?(i=a(t)?M:t,t=e.content={text:i}):i=t.text,"ajax"in t&&(o=t.ajax,n=o&&o.once!==M,delete t.ajax,t.text=function(e,t){var r=i||s(this).attr(t.options.content.attr)||"Loading...",a=s.ajax(s.extend({},o,{context:t})).then(o.success,S,o.error).then(function(e){return e&&n&&t.set("content.text",e),e},function(e,i,s){t.destroyed||0===e.status||t.set("content.text",i+": "+s)});return n?r:(t.set("content.text",r),a)}),"title"in t&&(s.isPlainObject(t.title)&&(t.button=t.title.button,t.title=t.title.text),a(t.title||M)&&(t.title=M))),"position"in e&&r(e.position)&&(e.position={my:e.position,at:e.position}),"show"in e&&r(e.show)&&(e.show=e.show.jquery?{target:e.show}:e.show===I?{ready:I}:{event:e.show}),"hide"in e&&r(e.hide)&&(e.hide=e.hide.jquery?{target:e.hide}:{event:e.hide}),"style"in e&&r(e.style)&&(e.style={classes:e.style}),s.each(F,function(){this.sanitize&&this.sanitize(e)}),e)}function l(e,t){for(var i,s=0,o=e,r=t.split(".");o=o[r[s++]];)s<r.length&&(i=o);return[i||e,r.pop()]}function c(e,t){var i,s,o;for(i in this.checks)if(this.checks.hasOwnProperty(i))for(s in this.checks[i])this.checks[i].hasOwnProperty(s)&&(o=new RegExp(s,"i").exec(e))&&(t.push(o),("builtin"===i||this.plugins[i])&&this.checks[i][s].apply(this.plugins[i]||this,t))}function d(e){return W.concat("").join(e?"-"+e+" ":" ")}function h(e,t){return t>0?setTimeout(s.proxy(e,this),t):void e.call(this)}function m(e){this.tooltip.hasClass(Z)||(clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this.timers.show=h.call(this,function(){this.toggle(I,e)},this.options.show.delay))}function u(e){if(!this.tooltip.hasClass(Z)&&!this.destroyed){var t=s(e.relatedTarget),i=t.closest(U)[0]===this.tooltip[0],o=t[0]===this.options.show.target[0];if(clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this!==t[0]&&"mouse"===this.options.position.target&&i||this.options.hide.fixed&&/mouse(out|leave|move)/.test(e.type)&&(i||o))try{e.preventDefault(),e.stopImmediatePropagation()}catch(e){}else this.timers.hide=h.call(this,function(){this.toggle(M,e)},this.options.hide.delay,this)}}function p(e){!this.tooltip.hasClass(Z)&&this.options.hide.inactive&&(clearTimeout(this.timers.inactive),this.timers.inactive=h.call(this,function(){this.hide(e)},this.options.hide.inactive))}function _(e){this.rendered&&this.tooltip[0].offsetWidth>0&&this.reposition(e)}function f(e,i,o){s(t.body).delegate(e,(i.split?i:i.join("."+B+" "))+"."+B,function(){var e=k.api[s.attr(this,K)];e&&!e.disabled&&o.apply(e,arguments)})}function g(e,i,r){var a,l,c,d,h,m=s(t.body),u=e[0]===t?m:e,p=e.metadata?e.metadata(r.metadata):S,_="html5"===r.metadata.type&&p?p[r.metadata.name]:S,f=e.data(r.metadata.name||"qtipopts");try{f="string"==typeof f?s.parseJSON(f):f}catch(e){}if(l=(d=s.extend(I,{},k.defaults,r,"object"==typeof f?n(f):S,n(_||p))).position,d.id=i,"boolean"==typeof d.content.text){if(c=e.attr(d.content.attr),d.content.attr===M||!c)return M;d.content.text=c}if(l.container.length||(l.container=m),l.target===M&&(l.target=u),d.show.target===M&&(d.show.target=u),d.show.solo===I&&(d.show.solo=l.container.closest("body")),d.hide.target===M&&(d.hide.target=u),d.position.viewport===I&&(d.position.viewport=l.container),l.container=l.container.eq(0),l.at=new $(l.at,I),l.my=new $(l.my),e.data(B))if(d.overwrite)e.qtip("destroy",!0);else if(d.overwrite===M)return M;return e.attr(V,i),d.suppress&&(h=e.attr("title"))&&e.removeAttr("title").attr(te,h).attr("title",""),a=new o(e,d,i,!!c),e.data(B,a),a}function v(e){return e.charAt(0).toUpperCase()+e.slice(1)}function b(e,t){return Math.ceil(parseFloat(function(e,t){var s,o,r=t.charAt(0).toUpperCase()+t.slice(1),a=(t+" "+ye.join(r+" ")+r).split(" "),n=0;if(be[t])return e.css(be[t]);for(;s=a[n++];)if((o=e.css(s))!==i)return be[t]=s,o}(e,t)))}function y(e,t){this._ns="tip",this.options=t,this.offset=t.offset,this.size=[t.width,t.height],this.qtip=e,this.init(e)}function C(e,t){this.options=t,this._ns="-modal",this.qtip=e,this.init(e)}function x(e){this._ns="ie6",this.qtip=e,this.init(e)}var k,w,$,j,T,I=!0,M=!1,S=null,O="x",A="y",P="width",D="height",H="top",z="left",L="bottom",E="right",N="center",q="flipinvert",R="shift",F={},B="qtip",V="data-hasqtip",K="data-qtip-id",W=["ui-widget","ui-tooltip"],U="."+B,Y="click dblclick mousedown mouseup mousemove mouseleave mouseenter".split(" "),G=B+"-fixed",Q=B+"-default",J=B+"-focus",X=B+"-hover",Z=B+"-disabled",ee="_replacedByqTip",te="oldtitle",ie={ie:function(){var e,i;for(e=4,i=t.createElement("div");(i.innerHTML="\x3c!--[if gt IE "+e+"]><i></i><![endif]--\x3e")&&i.getElementsByTagName("i")[0];e+=1);return e>4?e:NaN}(),iOS:parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||M};(w=o.prototype)._when=function(e){return s.when.apply(s,e)},w.render=function(e){if(this.rendered||this.destroyed)return this;var t=this,i=this.options,o=this.cache,r=this.elements,a=i.content.text,n=i.content.title,l=i.content.button,c=i.position,d=[];return s.attr(this.target[0],"aria-describedby",this._id),o.posClass=this._createPosClass((this.position={my:c.my,at:c.at}).my),this.tooltip=r.tooltip=s("<div/>",{id:this._id,class:[B,Q,i.style.classes,o.posClass].join(" "),width:i.style.width||"",height:i.style.height||"",tracking:"mouse"===c.target&&c.adjust.mouse,role:"alert","aria-live":"polite","aria-atomic":M,"aria-describedby":this._id+"-content","aria-hidden":I}).toggleClass(Z,this.disabled).attr(K,this.id).data(B,this).appendTo(c.container).append(r.content=s("<div />",{class:B+"-content",id:this._id+"-content","aria-atomic":I})),this.rendered=-1,this.positioning=I,n&&(this._createTitle(),s.isFunction(n)||d.push(this._updateTitle(n,M))),l&&this._createButton(),s.isFunction(a)||d.push(this._updateContent(a,M)),this.rendered=I,this._setWidget(),s.each(F,function(e){var i;"render"===this.initialize&&(i=this(t))&&(t.plugins[e]=i)}),this._unassignEvents(),this._assignEvents(),this._when(d).then(function(){t._trigger("render"),t.positioning=M,t.hiddenDuringWait||!i.show.ready&&!e||t.toggle(I,o.event,M),t.hiddenDuringWait=M}),k.api[this.id]=this,this},w.destroy=function(e){function t(){if(!this.destroyed){this.destroyed=I;var e,t=this.target,i=t.attr(te);for(e in this.rendered&&this.tooltip.stop(1,0).find("*").remove().end().remove(),s.each(this.plugins,function(){this.destroy&&this.destroy()}),this.timers)this.timers.hasOwnProperty(e)&&clearTimeout(this.timers[e]);t.removeData(B).removeAttr(K).removeAttr(V).removeAttr("aria-describedby"),this.options.suppress&&i&&t.attr("title",i).removeAttr(te),this._unassignEvents(),this.options=this.elements=this.cache=this.timers=this.plugins=this.mouse=S,delete k.api[this.id]}}return this.destroyed?this.target:(e===I&&"hide"!==this.triggering||!this.rendered?t.call(this):(this.tooltip.one("tooltiphidden",s.proxy(t,this)),!this.triggering&&this.hide()),this.target)},j=w.checks={builtin:{"^id$":function(e,t,i,o){var r=i===I?k.nextid:i,a=B+"-"+r;r!==M&&r.length>0&&!s("#"+a).length?(this._id=a,this.rendered&&(this.tooltip[0].id=this._id,this.elements.content[0].id=this._id+"-content",this.elements.title[0].id=this._id+"-title")):e[t]=o},"^prerender":function(e,t,i){i&&!this.rendered&&this.render(this.options.show.ready)},"^content.text$":function(e,t,i){this._updateContent(i)},"^content.attr$":function(e,t,i,s){this.options.content.text===this.target.attr(s)&&this._updateContent(this.target.attr(i))},"^content.title$":function(e,t,i){return i?(i&&!this.elements.title&&this._createTitle(),void this._updateTitle(i)):this._removeTitle()},"^content.button$":function(e,t,i){this._updateButton(i)},"^content.title.(text|button)$":function(e,t,i){this.set("content."+t,i)},"^position.(my|at)$":function(e,t,i){"string"==typeof i&&(this.position[t]=e[t]=new $(i,"at"===t))},"^position.container$":function(e,t,i){this.rendered&&this.tooltip.appendTo(i)},"^show.ready$":function(e,t,i){i&&(!this.rendered&&this.render(I)||this.toggle(I))},"^style.classes$":function(e,t,i,s){this.rendered&&this.tooltip.removeClass(s).addClass(i)},"^style.(width|height)":function(e,t,i){this.rendered&&this.tooltip.css(t,i)},"^style.widget|content.title":function(){this.rendered&&this._setWidget()},"^style.def":function(e,t,i){this.rendered&&this.tooltip.toggleClass(Q,!!i)},"^events.(render|show|move|hide|focus|blur)$":function(e,t,i){this.rendered&&this.tooltip[(s.isFunction(i)?"":"un")+"bind"]("tooltip"+t,i)},"^(show|hide|position).(event|target|fixed|inactive|leave|distance|viewport|adjust)":function(){if(this.rendered){var e=this.options.position;this.tooltip.attr("tracking","mouse"===e.target&&e.adjust.mouse),this._unassignEvents(),this._assignEvents()}}}},w.get=function(e){if(this.destroyed)return this;var t=l(this.options,e.toLowerCase()),i=t[0][t[1]];return i.precedance?i.string():i};var se=/^position\.(my|at|adjust|target|container|viewport)|style|content|show\.ready/i,oe=/^prerender|show\.ready/i;w.set=function(e,t){if(this.destroyed)return this;var i,o=this.rendered,r=M,a=this.options;return"string"==typeof e?(i=e,(e={})[i]=t):e=s.extend({},e),s.each(e,function(t,i){if(o&&oe.test(t))delete e[t];else{var n,c=l(a,t.toLowerCase());n=c[0][c[1]],c[0][c[1]]=i&&i.nodeType?s(i):i,r=se.test(t)||r,e[t]=[c[0],c[1],i,n]}}),n(a),this.positioning=I,s.each(e,s.proxy(c,this)),this.positioning=M,this.rendered&&this.tooltip[0].offsetWidth>0&&r&&this.reposition("mouse"===a.position.target?S:this.cache.event),this},w._update=function(e,t){var i=this,o=this.cache;return this.rendered&&e?(s.isFunction(e)&&(e=e.call(this.elements.target,o.event,this)||""),s.isFunction(e.then)?(o.waiting=I,e.then(function(e){return o.waiting=M,i._update(e,t)},S,function(e){return i._update(e,t)})):e===M||!e&&""!==e?M:(e.jquery&&e.length>0?t.empty().append(e.css({display:"block",visibility:"visible"})):t.html(e),this._waitForContent(t).then(function(e){i.rendered&&i.tooltip[0].offsetWidth>0&&i.reposition(o.event,!e.length)}))):M},w._waitForContent=function(e){var t=this.cache;return t.waiting=I,(s.fn.imagesLoaded?e.imagesLoaded():(new s.Deferred).resolve([])).done(function(){t.waiting=M}).promise()},w._updateContent=function(e,t){this._update(e,this.elements.content,t)},w._updateTitle=function(e,t){this._update(e,this.elements.title,t)===M&&this._removeTitle(M)},w._createTitle=function(){var e=this.elements,t=this._id+"-title";e.titlebar&&this._removeTitle(),e.titlebar=s("<div />",{class:B+"-titlebar "+(this.options.style.widget?d("header"):"")}).append(e.title=s("<div />",{id:t,class:B+"-title","aria-atomic":I})).insertBefore(e.content).delegate(".qtip-close","mousedown keydown mouseup keyup mouseout",function(e){s(this).toggleClass("ui-state-active ui-state-focus","down"===e.type.substr(-4))}).delegate(".qtip-close","mouseover mouseout",function(e){s(this).toggleClass("ui-state-hover","mouseover"===e.type)}),this.options.content.button&&this._createButton()},w._removeTitle=function(e){var t=this.elements;t.title&&(t.titlebar.remove(),t.titlebar=t.title=t.button=S,e!==M&&this.reposition())},w._createPosClass=function(e){return B+"-pos-"+(e||this.options.position.my).abbrev()},w.reposition=function(i,o){if(!this.rendered||this.positioning||this.destroyed)return this;this.positioning=I;var r,a,n,l,c=this.cache,d=this.tooltip,h=this.options.position,m=h.target,u=h.my,p=h.at,_=h.viewport,f=h.container,g=h.adjust,v=g.method.split(" "),b=d.outerWidth(M),y=d.outerHeight(M),C=0,x=0,k=d.css("position"),w={left:0,top:0},$=d[0].offsetWidth>0,j=i&&"scroll"===i.type,T=s(e),S=f[0].ownerDocument,O=this.mouse;if(s.isArray(m)&&2===m.length)p={x:z,y:H},w={left:m[0],top:m[1]};else if("mouse"===m)p={x:z,y:H},(!g.mouse||this.options.hide.distance)&&c.origin&&c.origin.pageX?i=c.origin:!i||i&&("resize"===i.type||"scroll"===i.type)?i=c.event:O&&O.pageX&&(i=O),"static"!==k&&(w=f.offset()),S.body.offsetWidth!==(e.innerWidth||S.documentElement.clientWidth)&&(a=s(t.body).offset()),w={left:i.pageX-w.left+(a&&a.left||0),top:i.pageY-w.top+(a&&a.top||0)},g.mouse&&j&&O&&(w.left-=(O.scrollX||0)-T.scrollLeft(),w.top-=(O.scrollY||0)-T.scrollTop());else{if("event"===m?i&&i.target&&"scroll"!==i.type&&"resize"!==i.type?c.target=s(i.target):i.target||(c.target=this.elements.target):"event"!==m&&(c.target=s(m.jquery?m:this.elements.target)),m=c.target,0===(m=s(m).eq(0)).length)return this;m[0]===t||m[0]===e?(C=ie.iOS?e.innerWidth:m.width(),x=ie.iOS?e.innerHeight:m.height(),m[0]===e&&(w={top:(_||m).scrollTop(),left:(_||m).scrollLeft()})):F.imagemap&&m.is("area")?r=F.imagemap(this,m,p,F.viewport?v:M):F.svg&&m&&m[0].ownerSVGElement?r=F.svg(this,m,p,F.viewport?v:M):(C=m.outerWidth(M),x=m.outerHeight(M),w=m.offset()),r&&(C=r.width,x=r.height,a=r.offset,w=r.position),w=this.reposition.offset(m,w,f),(ie.iOS>3.1&&ie.iOS<4.1||ie.iOS>=4.3&&ie.iOS<4.33||!ie.iOS&&"fixed"===k)&&(w.left-=T.scrollLeft(),w.top-=T.scrollTop()),(!r||r&&r.adjustable!==M)&&(w.left+=p.x===E?C:p.x===N?C/2:0,w.top+=p.y===L?x:p.y===N?x/2:0)}return w.left+=g.x+(u.x===E?-b:u.x===N?-b/2:0),w.top+=g.y+(u.y===L?-y:u.y===N?-y/2:0),F.viewport?(n=w.adjusted=F.viewport(this,w,h,C,x,b,y),a&&n.left&&(w.left+=a.left),a&&n.top&&(w.top+=a.top),n.my&&(this.position.my=n.my)):w.adjusted={left:0,top:0},c.posClass!==(l=this._createPosClass(this.position.my))&&(c.posClass=l,d.removeClass(c.posClass).addClass(l)),this._trigger("move",[w,_.elem||_],i)?(delete w.adjusted,o===M||!$||isNaN(w.left)||isNaN(w.top)||"mouse"===m||!s.isFunction(h.effect)?d.css(w):s.isFunction(h.effect)&&(h.effect.call(d,this,s.extend({},w)),d.queue(function(e){s(this).css({opacity:"",height:""}),ie.ie&&this.style.removeAttribute("filter"),e()})),this.positioning=M,this):this},w.reposition.offset=function(e,i,o){function r(e,t){i.left+=t*e.scrollLeft(),i.top+=t*e.scrollTop()}if(!o[0])return i;var a,n,l,c,d=s(e[0].ownerDocument),h=!!ie.ie&&"CSS1Compat"!==t.compatMode,m=o[0];do{"static"!==(n=s.css(m,"position"))&&("fixed"===n?(l=m.getBoundingClientRect(),r(d,-1)):((l=s(m).position()).left+=parseFloat(s.css(m,"borderLeftWidth"))||0,l.top+=parseFloat(s.css(m,"borderTopWidth"))||0),i.left-=l.left+(parseFloat(s.css(m,"marginLeft"))||0),i.top-=l.top+(parseFloat(s.css(m,"marginTop"))||0),a||"hidden"===(c=s.css(m,"overflow"))||"visible"===c||(a=s(m)))}while(m=m.offsetParent);return a&&(a[0]!==d[0]||h)&&r(a,1),i};var re=($=w.reposition.Corner=function(e,t){e=(""+e).replace(/([A-Z])/," $1").replace(/middle/gi,N).toLowerCase(),this.x=(e.match(/left|right/i)||e.match(/center/)||["inherit"])[0].toLowerCase(),this.y=(e.match(/top|bottom|center/i)||["inherit"])[0].toLowerCase(),this.forceY=!!t;var i=e.charAt(0);this.precedance="t"===i||"b"===i?A:O}).prototype;re.invert=function(e,t){this[e]=this[e]===z?E:this[e]===E?z:t||this[e]},re.string=function(e){var t=this.x,i=this.y,s=t!==i?"center"===t||"center"!==i&&(this.precedance===A||this.forceY)?[i,t]:[t,i]:[t];return!1!==e?s.join(" "):s},re.abbrev=function(){var e=this.string(!1);return e[0].charAt(0)+(e[1]&&e[1].charAt(0)||"")},re.clone=function(){return new $(this.string(),this.forceY)},w.toggle=function(e,i){var o=this.cache,r=this.options,a=this.tooltip;if(i){if(/over|enter/.test(i.type)&&o.event&&/out|leave/.test(o.event.type)&&r.show.target.add(i.target).length===r.show.target.length&&a.has(i.relatedTarget).length)return this;o.event=s.event.fix(i)}if(this.waiting&&!e&&(this.hiddenDuringWait=I),!this.rendered)return e?this.render(1):this;if(this.destroyed||this.disabled)return this;var n,l,c,d=e?"show":"hide",h=this.options[d],m=this.options.position,u=this.options.content,p=this.tooltip.css("width"),_=this.tooltip.is(":visible"),f=e||1===h.target.length,g=!i||h.target.length<2||o.target[0]===i.target;return(typeof e).search("boolean|number")&&(e=!_),l=(n=!a.is(":animated")&&_===e&&g)?S:!!this._trigger(d,[90]),this.destroyed?this:(l!==M&&e&&this.focus(i),!l||n?this:(s.attr(a[0],"aria-hidden",!e),e?(this.mouse&&(o.origin=s.event.fix(this.mouse)),s.isFunction(u.text)&&this._updateContent(u.text,M),s.isFunction(u.title)&&this._updateTitle(u.title,M),!T&&"mouse"===m.target&&m.adjust.mouse&&(s(t).bind("mousemove."+B,this._storeMouse),T=I),p||a.css("width",a.outerWidth(M)),this.reposition(i,arguments[2]),p||a.css("width",""),h.solo&&("string"==typeof h.solo?s(h.solo):s(U,h.solo)).not(a).not(h.target).qtip("hide",new s.Event("tooltipsolo"))):(clearTimeout(this.timers.show),delete o.origin,T&&!s(U+'[tracking="true"]:visible',h.solo).not(a).length&&(s(t).unbind("mousemove."+B),T=M),this.blur(i)),c=s.proxy(function(){e?(ie.ie&&a[0].style.removeAttribute("filter"),a.css("overflow",""),"string"==typeof h.autofocus&&s(this.options.show.autofocus,a).focus(),this.options.show.target.trigger("qtip-"+this.id+"-inactive")):a.css({display:"",visibility:"",opacity:"",left:"",top:""}),this._trigger(e?"visible":"hidden")},this),h.effect===M||f===M?(a[d](),c()):s.isFunction(h.effect)?(a.stop(1,1),h.effect.call(a,this),a.queue("fx",function(e){c(),e()})):a.fadeTo(90,e?1:0,c),e&&h.target.trigger("qtip-"+this.id+"-inactive"),this))},w.show=function(e){return this.toggle(I,e)},w.hide=function(e){return this.toggle(M,e)},w.focus=function(e){if(!this.rendered||this.destroyed)return this;var t=s(U),i=this.tooltip,o=parseInt(i[0].style.zIndex,10),r=k.zindex+t.length;return i.hasClass(J)||this._trigger("focus",[r],e)&&(o!==r&&(t.each(function(){this.style.zIndex>o&&(this.style.zIndex=this.style.zIndex-1)}),t.filter("."+J).qtip("blur",e)),i.addClass(J)[0].style.zIndex=r),this},w.blur=function(e){return!this.rendered||this.destroyed?this:(this.tooltip.removeClass(J),this._trigger("blur",[this.tooltip.css("zIndex")],e),this)},w.disable=function(e){return this.destroyed?this:("toggle"===e?e=!(this.rendered?this.tooltip.hasClass(Z):this.disabled):"boolean"!=typeof e&&(e=I),this.rendered&&this.tooltip.toggleClass(Z,e).attr("aria-disabled",e),this.disabled=!!e,this)},w.enable=function(){return this.disable(M)},w._createButton=function(){var e=this,t=this.elements,i=t.tooltip,o=this.options.content.button,r="string"==typeof o?o:"Close tooltip";t.button&&t.button.remove(),o.jquery?t.button=o:t.button=s("<a />",{class:"qtip-close "+(this.options.style.widget?"":B+"-icon"),title:r,"aria-label":r}).prepend(s("<span />",{class:"ui-icon ui-icon-close",html:"&times;"})),t.button.appendTo(t.titlebar||i).attr("role","button").click(function(t){return i.hasClass(Z)||e.hide(t),M})},w._updateButton=function(e){if(!this.rendered)return M;var t=this.elements.button;e?this._createButton():t.remove()},w._setWidget=function(){var e=this.options.style.widget,t=this.elements,i=t.tooltip,s=i.hasClass(Z);i.removeClass(Z),Z=e?"ui-state-disabled":"qtip-disabled",i.toggleClass(Z,s),i.toggleClass("ui-helper-reset "+d(),e).toggleClass(Q,this.options.style.def&&!e),t.content&&t.content.toggleClass(d("content"),e),t.titlebar&&t.titlebar.toggleClass(d("header"),e),t.button&&t.button.toggleClass(B+"-icon",!e)},w._storeMouse=function(e){return(this.mouse=s.event.fix(e)).type="mousemove",this},w._bind=function(e,t,i,o,r){if(e&&i&&t.length){var a="."+this._id+(o?"-"+o:"");return s(e).bind((t.split?t:t.join(a+" "))+a,s.proxy(i,r||this)),this}},w._unbind=function(e,t){return e&&s(e).unbind("."+this._id+(t?"-"+t:"")),this},w._trigger=function(e,t,i){var o=new s.Event("tooltip"+e);return o.originalEvent=i&&s.extend({},i)||this.cache.event||S,this.triggering=e,this.tooltip.trigger(o,[this].concat(t||[])),this.triggering=M,!o.isDefaultPrevented()},w._bindEvents=function(e,t,i,o,r,a){var n=i.filter(o).add(o.filter(i)),l=[];n.length&&(s.each(t,function(t,i){var o=s.inArray(i,e);o>-1&&l.push(e.splice(o,1)[0])}),l.length&&(this._bind(n,l,function(e){(!!this.rendered&&this.tooltip[0].offsetWidth>0?a:r).call(this,e)}),i=i.not(n),o=o.not(n))),this._bind(i,e,r),this._bind(o,t,a)},w._assignInitialEvents=function(e){function t(e){return this.disabled||this.destroyed?M:(this.cache.event=e&&s.event.fix(e),this.cache.target=e&&s(e.target),clearTimeout(this.timers.show),void(this.timers.show=h.call(this,function(){this.render("object"==typeof e||i.show.ready)},i.prerender?0:i.show.delay)))}var i=this.options,o=i.show.target,r=i.hide.target,a=i.show.event?s.trim(""+i.show.event).split(" "):[],n=i.hide.event?s.trim(""+i.hide.event).split(" "):[];this._bind(this.elements.target,["remove","removeqtip"],function(){this.destroy(!0)},"destroy"),/mouse(over|enter)/i.test(i.show.event)&&!/mouse(out|leave)/i.test(i.hide.event)&&n.push("mouseleave"),this._bind(o,"mousemove",function(e){this._storeMouse(e),this.cache.onTarget=I}),this._bindEvents(a,n,o,r,t,function(){return this.timers?void clearTimeout(this.timers.show):M}),(i.show.ready||i.prerender)&&t.call(this,e)},w._assignEvents=function(){var i=this,o=this.options,r=o.position,a=this.tooltip,n=o.show.target,l=o.hide.target,c=r.container,d=r.viewport,h=s(t),f=s(e),g=o.show.event?s.trim(""+o.show.event).split(" "):[],v=o.hide.event?s.trim(""+o.hide.event).split(" "):[];s.each(o.events,function(e,t){i._bind(a,"toggle"===e?["tooltipshow","tooltiphide"]:["tooltip"+e],t,null,a)}),/mouse(out|leave)/i.test(o.hide.event)&&"window"===o.hide.leave&&this._bind(h,["mouseout","blur"],function(e){/select|option/.test(e.target.nodeName)||e.relatedTarget||this.hide(e)}),o.hide.fixed?l=l.add(a.addClass(G)):/mouse(over|enter)/i.test(o.show.event)&&this._bind(l,"mouseleave",function(){clearTimeout(this.timers.show)}),(""+o.hide.event).indexOf("unfocus")>-1&&this._bind(c.closest("html"),["mousedown","touchstart"],function(e){var t=s(e.target),i=this.rendered&&!this.tooltip.hasClass(Z)&&this.tooltip[0].offsetWidth>0,o=t.parents(U).filter(this.tooltip[0]).length>0;t[0]===this.target[0]||t[0]===this.tooltip[0]||o||this.target.has(t[0]).length||!i||this.hide(e)}),"number"==typeof o.hide.inactive&&(this._bind(n,"qtip-"+this.id+"-inactive",p,"inactive"),this._bind(l.add(a),k.inactiveEvents,p)),this._bindEvents(g,v,n,l,m,u),this._bind(n.add(a),"mousemove",function(e){if("number"==typeof o.hide.distance){var t=this.cache.origin||{},i=this.options.hide.distance,s=Math.abs;(s(e.pageX-t.pageX)>=i||s(e.pageY-t.pageY)>=i)&&this.hide(e)}this._storeMouse(e)}),"mouse"===r.target&&r.adjust.mouse&&(o.hide.event&&this._bind(n,["mouseenter","mouseleave"],function(e){return this.cache?void(this.cache.onTarget="mouseenter"===e.type):M}),this._bind(h,"mousemove",function(e){this.rendered&&this.cache.onTarget&&!this.tooltip.hasClass(Z)&&this.tooltip[0].offsetWidth>0&&this.reposition(e)})),(r.adjust.resize||d.length)&&this._bind(s.event.special.resize?d:f,"resize",_),r.adjust.scroll&&this._bind(f.add(r.container),"scroll",_)},w._unassignEvents=function(){var i=this.options,o=i.show.target,r=i.hide.target,a=s.grep([this.elements.target[0],this.rendered&&this.tooltip[0],i.position.container[0],i.position.viewport[0],i.position.container.closest("html")[0],e,t],function(e){return"object"==typeof e});o&&o.toArray&&(a=a.concat(o.toArray())),r&&r.toArray&&(a=a.concat(r.toArray())),this._unbind(a)._unbind(a,"destroy")._unbind(a,"inactive")},s(function(){f(U,["mouseenter","mouseleave"],function(e){var t="mouseenter"===e.type,i=s(e.currentTarget),o=s(e.relatedTarget||e.target),r=this.options;t?(this.focus(e),i.hasClass(G)&&!i.hasClass(Z)&&clearTimeout(this.timers.hide)):"mouse"===r.position.target&&r.position.adjust.mouse&&r.hide.event&&r.show.target&&!o.closest(r.show.target[0]).length&&this.hide(e),i.toggleClass(X,t)}),f("["+K+"]",Y,p)}),k=s.fn.qtip=function(e,t,o){var r=(""+e).toLowerCase(),a=S,l=s.makeArray(arguments).slice(1),c=l[l.length-1],d=this[0]?s.data(this[0],B):S;return!arguments.length&&d||"api"===r?d:"string"==typeof e?(this.each(function(){var e=s.data(this,B);if(!e)return I;if(c&&c.timeStamp&&(e.cache.event=c),!t||"option"!==r&&"options"!==r)e[r]&&e[r].apply(e,l);else{if(o===i&&!s.isPlainObject(t))return a=e.get(t),M;e.set(t,o)}}),a!==S?a:this):"object"!=typeof e&&arguments.length?void 0:(d=n(s.extend(I,{},e)),this.each(function(e){var t,i;return i=!(i=s.isArray(d.id)?d.id[e]:d.id)||i===M||i.length<1||k.api[i]?k.nextid++:i,(t=g(s(this),i,d))===M?I:(k.api[i]=t,s.each(F,function(){"initialize"===this.initialize&&this(t)}),void t._assignInitialEvents(c))}))},s.qtip=o,k.api={},s.each({attr:function(e,t){if(this.length){var i=this[0],o="title",r=s.data(i,"qtip");if(e===o&&r&&r.options&&"object"==typeof r&&"object"==typeof r.options&&r.options.suppress)return arguments.length<2?s.attr(i,te):(r&&r.options.content.attr===o&&r.cache.attr&&r.set("content.text",t),this.attr(te,t))}return s.fn["attr"+ee].apply(this,arguments)},clone:function(e){var t=s.fn["clone"+ee].apply(this,arguments);return e||t.filter("["+te+"]").attr("title",function(){return s.attr(this,te)}).removeAttr(te),t}},function(e,t){if(!t||s.fn[e+ee])return I;var i=s.fn[e+ee]=s.fn[e];s.fn[e]=function(){return t.apply(this,arguments)||i.apply(this,arguments)}}),s.ui||(s["cleanData"+ee]=s.cleanData,s.cleanData=function(e){for(var t,i=0;(t=s(e[i])).length;i++)if(t.attr(V))try{t.triggerHandler("removeqtip")}catch(e){}s["cleanData"+ee].apply(this,arguments)}),k.version="3.0.3",k.nextid=0,k.inactiveEvents=Y,k.zindex=15e3,k.defaults={prerender:M,id:M,overwrite:I,suppress:I,content:{text:I,attr:"title",title:M,button:M},position:{my:"top left",at:"bottom right",target:M,container:M,viewport:M,adjust:{x:0,y:0,mouse:I,scroll:I,resize:I,method:"flipinvert flipinvert"},effect:function(e,t){s(this).animate(t,{duration:200,queue:M})}},show:{target:M,event:"mouseenter",effect:I,delay:90,solo:M,ready:M,autofocus:M},hide:{target:M,event:"mouseleave",effect:I,delay:0,fixed:M,inactive:M,leave:"window",distance:M},style:{classes:"",widget:M,width:M,height:M,def:I},events:{render:S,move:S,show:S,hide:S,toggle:S,visible:S,hidden:S,focus:S,blur:S}};var ae,ne,le,ce,de,he="margin",me="border",ue="color",pe="background-color",_e="transparent",fe=" !important",ge=!!t.createElement("canvas").getContext,ve=/rgba?\(0, 0, 0(, 0)?\)|transparent|#123456/i,be={},ye=["Webkit","O","Moz","ms"];ge?(ce=e.devicePixelRatio||1,de=function(){var e=t.createElement("canvas").getContext("2d");return e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||1}(),le=ce/de):ne=function(e,t,i){return"<qtipvml:"+e+' xmlns="urn:schemas-microsoft.com:vml" class="qtip-vml" '+(t||"")+' style="behavior: url(#default#VML); '+(i||"")+'" />'},s.extend(y.prototype,{init:function(e){var t,i;i=this.element=e.elements.tip=s("<div />",{class:B+"-tip"}).prependTo(e.tooltip),ge?((t=s("<canvas />").appendTo(this.element)[0].getContext("2d")).lineJoin="miter",t.miterLimit=1e5,t.save()):(t=ne("shape",'coordorigin="0,0"',"position:absolute;"),this.element.html(t+t),e._bind(s("*",i).add(i),["click","mousedown"],function(e){e.stopPropagation()},this._ns)),e._bind(e.tooltip,"tooltipmove",this.reposition,this._ns,this),this.create()},_swapDimensions:function(){this.size[0]=this.options.height,this.size[1]=this.options.width},_resetDimensions:function(){this.size[0]=this.options.width,this.size[1]=this.options.height},_useTitle:function(e){var t=this.qtip.elements.titlebar;return t&&(e.y===H||e.y===N&&this.element.position().top+this.size[1]/2+this.options.offset<t.outerHeight(I))},_parseCorner:function(e){var t=this.qtip.options.position.my;return e===M||t===M?e=M:e===I?e=new $(t.string()):e.string||((e=new $(e)).fixed=I),e},_parseWidth:function(e,t,i){var s=this.qtip.elements,o=me+v(t)+"Width";return(i?b(i,o):b(s.content,o)||b(this._useTitle(e)&&s.titlebar||s.content,o)||b(s.tooltip,o))||0},_parseRadius:function(e){var t=this.qtip.elements,i=me+v(e.y)+v(e.x)+"Radius";return ie.ie<9?0:b(this._useTitle(e)&&t.titlebar||t.content,i)||b(t.tooltip,i)||0},_invalidColour:function(e,t,i){var s=e.css(t);return!s||i&&s===e.css(i)||ve.test(s)?M:s},_parseColours:function(e){var t=this.qtip.elements,i=this.element.css("cssText",""),o=me+v(e[e.precedance])+v(ue),r=this._useTitle(e)&&t.titlebar||t.content,a=this._invalidColour,n=[];return n[0]=a(i,pe)||a(r,pe)||a(t.content,pe)||a(t.tooltip,pe)||i.css(pe),n[1]=a(i,o,ue)||a(r,o,ue)||a(t.content,o,ue)||a(t.tooltip,o,ue)||t.tooltip.css(o),s("*",i).add(i).css("cssText",pe+":"+_e+fe+";"+me+":0"+fe+";"),n},_calculateSize:function(e){var t,i,s=e.precedance===A,o=this.options.width,r=this.options.height,a="c"===e.abbrev(),n=(s?o:r)*(a?.5:1),l=Math.pow,c=Math.round,d=Math.sqrt(l(n,2)+l(r,2)),h=[this.border/n*d,this.border/r*d];return h[2]=Math.sqrt(l(h[0],2)-l(this.border,2)),h[3]=Math.sqrt(l(h[1],2)-l(this.border,2)),i=[c((t=(d+h[2]+h[3]+(a?0:h[0]))/d)*o),c(t*r)],s?i:i.reverse()},_calculateTip:function(e,t,i){i=i||1;var s=(t=t||this.size)[0]*i,o=t[1]*i,r=Math.ceil(s/2),a=Math.ceil(o/2),n={br:[0,0,s,o,s,0],bl:[0,0,s,0,0,o],tr:[0,o,s,0,s,o],tl:[0,0,0,o,s,o],tc:[0,o,r,0,s,o],bc:[0,0,s,0,r,o],rc:[0,0,s,a,0,o],lc:[s,0,s,o,0,a]};return n.lt=n.br,n.rt=n.bl,n.lb=n.tr,n.rb=n.tl,n[e.abbrev()]},_drawCoords:function(e,t){e.beginPath(),e.moveTo(t[0],t[1]),e.lineTo(t[2],t[3]),e.lineTo(t[4],t[5]),e.closePath()},create:function(){var e=this.corner=(ge||ie.ie)&&this._parseCorner(this.options.corner);return this.enabled=!!this.corner&&"c"!==this.corner.abbrev(),this.enabled&&(this.qtip.cache.corner=e.clone(),this.update()),this.element.toggle(this.enabled),this.corner},update:function(t,i){if(!this.enabled)return this;var o,r,a,n,l,c,d,h,m=this.qtip.elements,u=this.element,p=u.children(),_=this.options,f=this.size,g=_.mimic,v=Math.round;t||(t=this.qtip.cache.corner||this.corner),g===M?g=t:((g=new $(g)).precedance=t.precedance,"inherit"===g.x?g.x=t.x:"inherit"===g.y?g.y=t.y:g.x===g.y&&(g[t.precedance]=t[t.precedance])),r=g.precedance,t.precedance===O?this._swapDimensions():this._resetDimensions(),(o=this.color=this._parseColours(t))[1]!==_e?(h=this.border=this._parseWidth(t,t[t.precedance]),_.border&&1>h&&!ve.test(o[1])&&(o[0]=o[1]),this.border=h=_.border!==I?_.border:h):this.border=h=0,d=this.size=this._calculateSize(t),u.css({width:d[0],height:d[1],lineHeight:d[1]+"px"}),c=t.precedance===A?[v(g.x===z?h:g.x===E?d[0]-f[0]-h:(d[0]-f[0])/2),v(g.y===H?d[1]-f[1]:0)]:[v(g.x===z?d[0]-f[0]:0),v(g.y===H?h:g.y===L?d[1]-f[1]-h:(d[1]-f[1])/2)],ge?((a=p[0].getContext("2d")).restore(),a.save(),a.clearRect(0,0,6e3,6e3),n=this._calculateTip(g,f,le),l=this._calculateTip(g,this.size,le),p.attr(P,d[0]*le).attr(D,d[1]*le),p.css(P,d[0]).css(D,d[1]),this._drawCoords(a,l),a.fillStyle=o[1],a.fill(),a.translate(c[0]*le,c[1]*le),this._drawCoords(a,n),a.fillStyle=o[0],a.fill()):(n="m"+(n=this._calculateTip(g))[0]+","+n[1]+" l"+n[2]+","+n[3]+" "+n[4]+","+n[5]+" xe",c[2]=h&&/^(r|b)/i.test(t.string())?8===ie.ie?2:1:0,p.css({coordsize:d[0]+h+" "+d[1]+h,antialias:""+(g.string().indexOf(N)>-1),left:c[0]-c[2]*Number(r===O),top:c[1]-c[2]*Number(r===A),width:d[0]+h,height:d[1]+h}).each(function(e){var t=s(this);t[t.prop?"prop":"attr"]({coordsize:d[0]+h+" "+d[1]+h,path:n,fillcolor:o[0],filled:!!e,stroked:!e}).toggle(!(!h&&!e)),!e&&t.html(ne("stroke",'weight="'+2*h+'px" color="'+o[1]+'" miterlimit="1000" joinstyle="miter"'))})),e.opera&&setTimeout(function(){m.tip.css({display:"inline-block",visibility:"visible"})},1),i!==M&&this.calculate(t,d)},calculate:function(e,t){if(!this.enabled)return M;var i,o,r=this,a=this.qtip.elements,n=this.element,l=this.options.offset,c={};return e=e||this.corner,i=e.precedance,t=t||this._calculateSize(e),o=[e.x,e.y],i===O&&o.reverse(),s.each(o,function(s,o){var n,d,h;o===N?(c[n=i===A?z:H]="50%",c[he+"-"+n]=-Math.round(t[i===A?0:1]/2)+l):(n=r._parseWidth(e,o,a.tooltip),d=r._parseWidth(e,o,a.content),h=r._parseRadius(e),c[o]=Math.max(-r.border,s?d:l+(h>n?h:-n)))}),c[e[i]]-=t[i===O?0:1],n.css({margin:"",top:"",bottom:"",left:"",right:""}).css(c),c},reposition:function(e,t,s){function o(e,t,i,s,o){e===R&&c.precedance===t&&d[s]&&c[i]!==N?c.precedance=c.precedance===O?A:O:e!==R&&d[s]&&(c[t]=c[t]===N?d[s]>0?s:o:c[t]===s?o:s)}function r(e,t,o){c[e]===N?_[he+"-"+t]=p[e]=a[he+"-"+t]-d[t]:(n=a[o]!==i?[d[t],-a[t]]:[-d[t],a[t]],(p[e]=Math.max(n[0],n[1]))>n[0]&&(s[t]-=d[t],p[t]=M),_[a[o]!==i?o:t]=p[e])}if(this.enabled){var a,n,l=t.cache,c=this.corner.clone(),d=s.adjusted,h=t.options.position.adjust.method.split(" "),m=h[0],u=h[1]||h[0],p={left:M,top:M,x:0,y:0},_={};this.corner.fixed!==I&&(o(m,O,A,z,E),o(u,A,O,H,L),c.string()===l.corner.string()&&l.cornerTop===d.top&&l.cornerLeft===d.left||this.update(c,M)),(a=this.calculate(c)).right!==i&&(a.left=-a.right),a.bottom!==i&&(a.top=-a.bottom),a.user=this.offset,p.left=m===R&&!!d.left,p.left&&r(O,z,E),p.top=u===R&&!!d.top,p.top&&r(A,H,L),this.element.css(_).toggle(!(p.x&&p.y||c.x===N&&p.y||c.y===N&&p.x)),s.left-=a.left.charAt?a.user:m!==R||p.top||!p.left&&!p.top?a.left+this.border:0,s.top-=a.top.charAt?a.user:u!==R||p.left||!p.left&&!p.top?a.top+this.border:0,l.cornerLeft=d.left,l.cornerTop=d.top,l.corner=c.clone()}},destroy:function(){this.qtip._unbind(this.qtip.tooltip,this._ns),this.qtip.elements.tip&&this.qtip.elements.tip.find("*").remove().end().remove()}}),(ae=F.tip=function(e){return new y(e,e.options.style.tip)}).initialize="render",ae.sanitize=function(e){if(e.style&&"tip"in e.style){var t=e.style.tip;"object"!=typeof t&&(t=e.style.tip={corner:t}),/string|boolean/i.test(typeof t.corner)||(t.corner=I)}},j.tip={"^position.my|style.tip.(corner|mimic|border)$":function(){this.create(),this.qtip.reposition()},"^style.tip.(height|width)$":function(e){this.size=[e.width,e.height],this.update(),this.qtip.reposition()},"^content.title|style.(classes|widget)$":function(){this.update()}},s.extend(I,k.defaults,{style:{tip:{corner:I,mimic:M,width:6,height:6,border:I,offset:0}}});var Ce,xe,ke="qtip-modal",we="."+ke;xe=new(xe=function(){function e(e){l.length<1&&e.length?e.not("body").blur():l.first().focus()}function i(t){if(a.is(":visible")){var i=s(t.target),r=o.tooltip,n=i.closest(U);(n.length<1?M:parseInt(n[0].style.zIndex,10)>parseInt(r[0].style.zIndex,10))||i.closest(U)[0]===r[0]||e(i)}}var o,r,a,n=this,l={};s.extend(n,{init:function(){return a=n.elem=s("<div />",{id:"qtip-overlay",html:"<div></div>",mousedown:function(){return M}}).hide(),s(t.body).bind("focusin"+we,i),s(t).bind("keydown"+we,function(e){o&&o.options.show.modal.escape&&27===e.keyCode&&o.hide(e)}),a.bind("click"+we,function(e){o&&o.options.show.modal.blur&&o.hide(e)}),n},update:function(e){o=e,l=e.options.show.modal.stealfocus!==M?e.tooltip.find("*").filter(function(){return function(e){if(s.expr[":"].focusable)return s.expr[":"].focusable;var t,i,o,r=!isNaN(s.attr(e,"tabindex")),a=e.nodeName&&e.nodeName.toLowerCase();return"area"===a?(i=(t=e.parentNode).name,!(!e.href||!i||"map"!==t.nodeName.toLowerCase())&&!!(o=s("img[usemap=#"+i+"]")[0])&&o.is(":visible")):/input|select|textarea|button|object/.test(a)?!e.disabled:"a"===a&&e.href||r}(this)}):[]},toggle:function(i,l,c){var d=i.tooltip,h=i.options.show.modal,m=h.effect,u=l?"show":"hide",p=a.is(":visible"),_=s(we).filter(":visible:not(:animated)").not(d);return n.update(i),l&&h.stealfocus!==M&&e(s(":focus")),a.toggleClass("blurs",h.blur),l&&a.appendTo(t.body),a.is(":animated")&&p===l&&r!==M||!l&&_.length?n:(a.stop(I,M),s.isFunction(m)?m.call(a,l):m===M?a[u]():a.fadeTo(parseInt(c,10)||90,l?1:0,function(){l||a.hide()}),l||a.queue(function(e){a.css({left:"",top:""}),s(we).length||a.detach(),e()}),r=l,o.destroyed&&(o=S),n)}}),n.init()}),s.extend(C.prototype,{init:function(e){var t=e.tooltip;return this.options.on?(e.elements.overlay=xe.elem,t.addClass(ke).css("z-index",k.modal_zindex+s(we).length),e._bind(t,["tooltipshow","tooltiphide"],function(e,i,o){var r=e.originalEvent;if(e.target===t[0])if(r&&"tooltiphide"===e.type&&/mouse(leave|enter)/.test(r.type)&&s(r.relatedTarget).closest(xe.elem[0]).length)try{e.preventDefault()}catch(e){}else(!r||r&&"tooltipsolo"!==r.type)&&this.toggle(e,"tooltipshow"===e.type,o)},this._ns,this),e._bind(t,"tooltipfocus",function(e,i){if(!e.isDefaultPrevented()&&e.target===t[0]){var o=s(we),r=k.modal_zindex+o.length,a=parseInt(t[0].style.zIndex,10);xe.elem[0].style.zIndex=r-1,o.each(function(){this.style.zIndex>a&&(this.style.zIndex-=1)}),o.filter("."+J).qtip("blur",e.originalEvent),t.addClass(J)[0].style.zIndex=r,xe.update(i);try{e.preventDefault()}catch(e){}}},this._ns,this),void e._bind(t,"tooltiphide",function(e){e.target===t[0]&&s(we).filter(":visible").not(t).last().qtip("focus",e)},this._ns,this)):this},toggle:function(e,t,i){return e&&e.isDefaultPrevented()?this:void xe.toggle(this.qtip,!!t,i)},destroy:function(){this.qtip.tooltip.removeClass(ke),this.qtip._unbind(this.qtip.tooltip,this._ns),xe.toggle(this.qtip,M),delete this.qtip.elements.overlay}}),(Ce=F.modal=function(e){return new C(e,e.options.show.modal)}).sanitize=function(e){e.show&&("object"!=typeof e.show.modal?e.show.modal={on:!!e.show.modal}:void 0===e.show.modal.on&&(e.show.modal.on=I))},k.modal_zindex=k.zindex-200,Ce.initialize="render",j.modal={"^show.modal.(on|blur)$":function(){this.destroy(),this.init(),this.qtip.elems.overlay.toggle(this.qtip.tooltip[0].offsetWidth>0)}},s.extend(I,k.defaults,{show:{modal:{on:M,effect:I,blur:I,stealfocus:I,escape:I}}}),F.viewport=function(i,s,o,r,a,n,l){function c(e,t,i,o,r,a,n,l,c){var d=s[r],v=y[e],b=C[e],x=i===R,k=v===r?c:v===a?-c:-c/2,w=b===r?l:b===a?-l:-l/2,$=f[r]+g[r]-(u?0:m[r]),j=$-d,T=d+c-(n===P?p:_)-$,I=k-(y.precedance===e||v===y[t]?w:0)-(b===N?l/2:0);return x?(I=(v===r?1:-1)*k,s[r]+=j>0?j:T>0?-T:0,s[r]=Math.max(-m[r]+g[r],d-I,Math.min(Math.max(-m[r]+g[r]+(n===P?p:_),d+I),s[r],"center"===v?d-k:1e9))):(o*=i===q?2:0,j>0&&(v!==r||T>0)?(s[r]-=I+o,h.invert(e,r)):T>0&&(v!==a||j>0)&&(s[r]-=(v===N?-I:I)+o,h.invert(e,a)),s[r]<f[r]&&-s[r]>T&&(s[r]=d,h=y.clone())),s[r]-d}var d,h,m,u,p,_,f,g,v=o.target,b=i.elements.tooltip,y=o.my,C=o.at,x=o.adjust,k=x.method.split(" "),w=k[0],$=k[1]||k[0],j=o.viewport,T=o.container,I={left:0,top:0};return j.jquery&&v[0]!==e&&v[0]!==t.body&&"none"!==x.method?(m=T.offset()||I,u="static"===T.css("position"),d="fixed"===b.css("position"),p=j[0]===e?j.width():j.outerWidth(M),_=j[0]===e?j.height():j.outerHeight(M),f={left:d?0:j.scrollLeft(),top:d?0:j.scrollTop()},g=j.offset()||I,"shift"===w&&"shift"===$||(h=y.clone()),I={left:"none"!==w?c(O,A,w,x.x,z,E,P,r,n):0,top:"none"!==$?c(A,O,$,x.y,H,L,D,a,l):0,my:h}):I},F.polys={polygon:function(e,t){var i,s,o,r={width:0,height:0,position:{top:1e10,right:0,bottom:0,left:1e10},adjustable:M},a=0,n=[],l=1,c=1,d=0,h=0;for(a=e.length;a--;)(i=[parseInt(e[--a],10),parseInt(e[a+1],10)])[0]>r.position.right&&(r.position.right=i[0]),i[0]<r.position.left&&(r.position.left=i[0]),i[1]>r.position.bottom&&(r.position.bottom=i[1]),i[1]<r.position.top&&(r.position.top=i[1]),n.push(i);if(s=r.width=Math.abs(r.position.right-r.position.left),o=r.height=Math.abs(r.position.bottom-r.position.top),"c"===t.abbrev())r.position={left:r.position.left+r.width/2,top:r.position.top+r.height/2};else{for(;s>0&&o>0&&l>0&&c>0;)for(s=Math.floor(s/2),o=Math.floor(o/2),t.x===z?l=s:t.x===E?l=r.width-s:l+=Math.floor(s/2),t.y===H?c=o:t.y===L?c=r.height-o:c+=Math.floor(o/2),a=n.length;a--&&!(n.length<2);)d=n[a][0]-r.position.left,h=n[a][1]-r.position.top,(t.x===z&&d>=l||t.x===E&&l>=d||t.x===N&&(l>d||d>r.width-l)||t.y===H&&h>=c||t.y===L&&c>=h||t.y===N&&(c>h||h>r.height-c))&&n.splice(a,1);r.position={left:n[0][0],top:n[0][1]}}return r},rect:function(e,t,i,s){return{width:Math.abs(i-e),height:Math.abs(s-t),position:{left:Math.min(e,i),top:Math.min(t,s)}}},_angles:{tc:1.5,tr:7/4,tl:5/4,bc:.5,br:.25,bl:.75,rc:2,lc:1,c:0},ellipse:function(e,t,i,s,o){var r=F.polys._angles[o.abbrev()],a=0===r?0:i*Math.cos(r*Math.PI),n=s*Math.sin(r*Math.PI);return{width:2*i-Math.abs(a),height:2*s-Math.abs(n),position:{left:e+a,top:t+n},adjustable:M}},circle:function(e,t,i,s){return F.polys.ellipse(e,t,i,i,s)}},F.svg=function(e,i,o){for(var r,a,n,l,c,d,h,m,u,p=i[0],_=s(p.ownerSVGElement),f=p.ownerDocument,g=(parseInt(i.css("stroke-width"),10)||0)/2;!p.getBBox;)p=p.parentNode;if(!p.getBBox||!p.parentNode)return M;switch(p.nodeName){case"ellipse":case"circle":m=F.polys.ellipse(p.cx.baseVal.value,p.cy.baseVal.value,(p.rx||p.r).baseVal.value+g,(p.ry||p.r).baseVal.value+g,o);break;case"line":case"polygon":case"polyline":for(m=[],d=-1,l=(h=p.points||[{x:p.x1.baseVal.value,y:p.y1.baseVal.value},{x:p.x2.baseVal.value,y:p.y2.baseVal.value}]).numberOfItems||h.length;++d<l;)c=h.getItem?h.getItem(d):h[d],m.push.apply(m,[c.x,c.y]);m=F.polys.polygon(m,o);break;default:m={width:(m=p.getBBox()).width,height:m.height,position:{left:m.x,top:m.y}}}return u=m.position,(_=_[0]).createSVGPoint&&(a=p.getScreenCTM(),(h=_.createSVGPoint()).x=u.left,h.y=u.top,n=h.matrixTransform(a),u.left=n.x,u.top=n.y),f!==t&&"mouse"!==e.position.target&&((r=s((f.defaultView||f.parentWindow).frameElement).offset())&&(u.left+=r.left,u.top+=r.top)),f=s(f),u.left+=f.scrollLeft(),u.top+=f.scrollTop(),m},F.imagemap=function(e,t,i){t.jquery||(t=s(t));var o,r,a,n,l,c=(t.attr("shape")||"rect").toLowerCase().replace("poly","polygon"),d=s('img[usemap="#'+t.parent("map").attr("name")+'"]'),h=s.trim(t.attr("coords")).replace(/,$/,"").split(",");if(!d.length)return M;if("polygon"===c)n=F.polys.polygon(h,i);else{if(!F.polys[c])return M;for(a=-1,l=h.length,r=[];++a<l;)r.push(parseInt(h[a],10));n=F.polys[c].apply(this,r.concat(i))}return(o=d.offset()).left+=Math.ceil((d.outerWidth(M)-d.width())/2),o.top+=Math.ceil((d.outerHeight(M)-d.height())/2),n.position.left+=o.left,n.position.top+=o.top,n};s.extend(x.prototype,{_scroll:function(){var t=this.qtip.elements.overlay;t&&(t[0].style.top=s(e).scrollTop()+"px")},init:function(i){var o=i.tooltip;s("select, object").length<1&&(this.bgiframe=i.elements.bgiframe=s('<iframe class="qtip-bgiframe" frameborder="0" tabindex="-1" src="javascript:\'\';"  style="display:block; position:absolute; z-index:-1; filter:alpha(opacity=0); -ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";"></iframe>').appendTo(o),i._bind(o,"tooltipmove",this.adjustBGIFrame,this._ns,this)),this.redrawContainer=s("<div/>",{id:B+"-rcontainer"}).appendTo(t.body),i.elements.overlay&&i.elements.overlay.addClass("qtipmodal-ie6fix")&&(i._bind(e,["scroll","resize"],this._scroll,this._ns,this),i._bind(o,["tooltipshow"],this._scroll,this._ns,this)),this.redraw()},adjustBGIFrame:function(){var e,t,i=this.qtip.tooltip,s={height:i.outerHeight(M),width:i.outerWidth(M)},o=this.qtip.plugins.tip,r=this.qtip.elements.tip;t={left:-(t=parseInt(i.css("borderLeftWidth"),10)||0),top:-t},o&&r&&(t[(e="x"===o.corner.precedance?[P,z]:[D,H])[1]]-=r[e[0]]()),this.bgiframe.css(t).css(s)},redraw:function(){if(this.qtip.rendered<1||this.drawing)return this;var e,t,i,s,o=this.qtip.tooltip,r=this.qtip.options.style,a=this.qtip.options.position.container;return this.qtip.drawing=1,r.height&&o.css(D,r.height),r.width?o.css(P,r.width):(o.css(P,"").appendTo(this.redrawContainer),1>(t=o.width())%2&&(t+=1),e=((i=o.css("maxWidth")||"")+(s=o.css("minWidth")||"")).indexOf("%")>-1?a.width()/100:0,t=(i=(i.indexOf("%")>-1?e:1*parseInt(i,10))||t)+(s=(s.indexOf("%")>-1?e:1*parseInt(s,10))||0)?Math.min(Math.max(t,s),i):t,o.css(P,Math.round(t)).appendTo(a)),this.drawing=0,this},destroy:function(){this.bgiframe&&this.bgiframe.remove(),this.qtip._unbind([e,this.qtip.tooltip],this._ns)}}),(F.ie6=function(e){return 6===ie.ie?new x(e):M}).initialize="render",j.ie6={"^content|style$":function(){this.redraw()}}})}(window,document),function(e,t){"use strict";"undefined"!=typeof module&&module.exports?module.exports=t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],function(e){return t(e)}):t(e.jQuery)}(this,function(e){"use strict";var t=function(t,i){this.$element=e(t),this.options=e.extend({},e.fn.typeahead.defaults,i),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.select=this.options.select||this.select,this.autoSelect="boolean"!=typeof this.options.autoSelect||this.options.autoSelect,this.highlighter=this.options.highlighter||this.highlighter,this.render=this.options.render||this.render,this.updater=this.options.updater||this.updater,this.displayText=this.options.displayText||this.displayText,this.source=this.options.source,this.delay=this.options.delay,this.$menu=e(this.options.menu),this.$appendTo=this.options.appendTo?e(this.options.appendTo):null,this.fitToElement="boolean"==typeof this.options.fitToElement&&this.options.fitToElement,this.shown=!1,this.listen(),this.showHintOnFocus=("boolean"==typeof this.options.showHintOnFocus||"all"===this.options.showHintOnFocus)&&this.options.showHintOnFocus,this.afterSelect=this.options.afterSelect,this.addItem=!1,this.value=this.$element.val()||this.$element.text()};t.prototype={constructor:t,select:function(){var e=this.$menu.find(".active").data("value");if(this.$element.data("active",e),this.autoSelect||e){var t=this.updater(e);t||(t=""),this.$element.val(this.displayText(t)||t).text(this.displayText(t)||t).change(),this.afterSelect(t)}return this.hide()},updater:function(e){return e},setSource:function(e){this.source=e},show:function(){var t,i=e.extend({},this.$element.position(),{height:this.$element[0].offsetHeight}),s="function"==typeof this.options.scrollHeight?this.options.scrollHeight.call():this.options.scrollHeight;if(this.shown?t=this.$menu:this.$appendTo?(t=this.$menu.appendTo(this.$appendTo),this.hasSameParent=this.$appendTo.is(this.$element.parent())):(t=this.$menu.insertAfter(this.$element),this.hasSameParent=!0),!this.hasSameParent){t.css("position","fixed");var o=this.$element.offset();i.top=o.top,i.left=o.left}var r=e(t).parent().hasClass("dropup")?"auto":i.top+i.height+s,a=e(t).hasClass("dropdown-menu-right")?"auto":i.left;return t.css({top:r,left:a}).show(),!0===this.options.fitToElement&&t.css("width",this.$element.outerWidth()+"px"),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(t){if(this.query=null!=t?t:this.$element.val()||this.$element.text()||"",this.query.length<this.options.minLength&&!this.options.showHintOnFocus)return this.shown?this.hide():this;var i=e.proxy(function(){e.isFunction(this.source)?this.source(this.query,e.proxy(this.process,this)):this.source&&this.process(this.source)},this);clearTimeout(this.lookupWorker),this.lookupWorker=setTimeout(i,this.delay)},process:function(t){var i=this;return t=e.grep(t,function(e){return i.matcher(e)}),(t=this.sorter(t)).length||this.options.addItem?(t.length>0?this.$element.data("active",t[0]):this.$element.data("active",null),this.options.addItem&&t.push(this.options.addItem),"all"==this.options.items?this.render(t).show():this.render(t.slice(0,this.options.items)).show()):this.shown?this.hide():this},matcher:function(e){return~this.displayText(e).indexOf(this.query.toLowerCase())},sorter:function(e){for(var t,i=[],s=[],o=[];t=e.shift();){var r=this.displayText(t);r.toLowerCase().indexOf(this.query.toLowerCase())?~r.indexOf(this.query)?s.push(t):o.push(t):i.push(t)}return i.concat(s,o)},highlighter:function(t){var i,s,o,r,a=e("<div></div>"),n=this.query,l=t.toLowerCase().indexOf(n.toLowerCase()),c=n.length;if(0===c)return a.text(t).html();for(;l>-1;)i=t.substr(0,l),s=t.substr(l,c),o=t.substr(l+c),r=e("<strong></strong>").text(s),a.append(document.createTextNode(i)).append(r),l=(t=o).toLowerCase().indexOf(n.toLowerCase());return a.append(document.createTextNode(t)).html()},render:function(t){var i=this,s=this,o=!1,r=[],a=i.options.separator;return e.each(t,function(e,i){e>0&&i[a]!==t[e-1][a]&&r.push({__type:"divider"}),!i[a]||0!==e&&i[a]===t[e-1][a]||r.push({__type:"category",name:i[a]}),r.push(i)}),t=e(r).map(function(t,r){if("category"==(r.__type||!1))return e(i.options.headerHtml).text(r.name)[0];if("divider"==(r.__type||!1))return e(i.options.headerDivider)[0];var a=s.displayText(r);return(t=e(i.options.item).data("value",r)).find("a").html(i.highlighter(a,r)),a==s.$element.val()&&(t.addClass("active"),s.$element.data("active",r),o=!0),t[0]}),this.autoSelect&&!o&&(t.filter(":not(.dropdown-header)").first().addClass("active"),this.$element.data("active",t.first().data("value"))),this.$menu.html(t),this},displayText:function(e){return void 0!==e&&void 0!==e.name&&e.name||e},next:function(t){var i=this.$menu.find(".active").removeClass("active").next();i.length||(i=e(this.$menu.find("li")[0])),i.addClass("active")},prev:function(e){var t=this.$menu.find(".active").removeClass("active").prev();t.length||(t=this.$menu.find("li").last()),t.addClass("active")},listen:function(){this.$element.on("focus",e.proxy(this.focus,this)).on("blur",e.proxy(this.blur,this)).on("keypress",e.proxy(this.keypress,this)).on("input",e.proxy(this.input,this)).on("keyup",e.proxy(this.keyup,this)),this.eventSupported("keydown")&&this.$element.on("keydown",e.proxy(this.keydown,this)),this.$menu.on("click",e.proxy(this.click,this)).on("mouseenter","li",e.proxy(this.mouseenter,this)).on("mouseleave","li",e.proxy(this.mouseleave,this)).on("mousedown",e.proxy(this.mousedown,this))},destroy:function(){this.$element.data("typeahead",null),this.$element.data("active",null),this.$element.off("focus").off("blur").off("keypress").off("input").off("keyup"),this.eventSupported("keydown")&&this.$element.off("keydown"),this.$menu.remove(),this.destroyed=!0},eventSupported:function(e){var t=e in this.$element;return t||(this.$element.setAttribute(e,"return;"),t="function"==typeof this.$element[e]),t},move:function(e){if(this.shown)switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:if(e.shiftKey)return;e.preventDefault(),this.prev();break;case 40:if(e.shiftKey)return;e.preventDefault(),this.next()}},keydown:function(t){this.suppressKeyPressRepeat=~e.inArray(t.keyCode,[40,38,9,13,27]),this.shown||40!=t.keyCode?this.move(t):this.lookup()},keypress:function(e){this.suppressKeyPressRepeat||this.move(e)},input:function(e){var t=this.$element.val()||this.$element.text();this.value!==t&&(this.value=t,this.lookup())},keyup:function(e){if(!this.destroyed)switch(e.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide()}},focus:function(e){this.focused||(this.focused=!0,this.options.showHintOnFocus&&!0!==this.skipShowHintOnFocus&&("all"===this.options.showHintOnFocus?this.lookup(""):this.lookup())),this.skipShowHintOnFocus&&(this.skipShowHintOnFocus=!1)},blur:function(e){this.mousedover||this.mouseddown||!this.shown?this.mouseddown&&(this.skipShowHintOnFocus=!0,this.$element.focus(),this.mouseddown=!1):(this.hide(),this.focused=!1)},click:function(e){e.preventDefault(),this.skipShowHintOnFocus=!0,this.select(),this.$element.focus(),this.hide()},mouseenter:function(t){this.mousedover=!0,this.$menu.find(".active").removeClass("active"),e(t.currentTarget).addClass("active")},mouseleave:function(e){this.mousedover=!1,!this.focused&&this.shown&&this.hide()},mousedown:function(e){this.mouseddown=!0,this.$menu.one("mouseup",function(e){this.mouseddown=!1}.bind(this))}};var i=e.fn.typeahead;e.fn.typeahead=function(i){var s=arguments;return"string"==typeof i&&"getActive"==i?this.data("active"):this.each(function(){var o=e(this),r=o.data("typeahead"),a="object"==typeof i&&i;r||o.data("typeahead",r=new t(this,a)),"string"==typeof i&&r[i]&&(s.length>1?r[i].apply(r,Array.prototype.slice.call(s,1)):r[i]())})},e.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu" role="listbox"></ul>',item:'<li><a class="dropdown-item" href="#" role="option"></a></li>',minLength:1,scrollHeight:0,autoSelect:!0,afterSelect:e.noop,addItem:!1,delay:0,separator:"category",headerHtml:'<li class="dropdown-header"></li>',headerDivider:'<li class="divider" role="separator"></li>'},e.fn.typeahead.Constructor=t,e.fn.typeahead.noConflict=function(){return e.fn.typeahead=i,this},e(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(t){var i=e(this);i.data("typeahead")||i.typeahead(i.data())})}),function(){function e(e){var t=Array.isArray(e)?{label:e[0],value:e[1]}:"object"==typeof e&&"label"in e&&"value"in e?e:{label:e,value:e};this.label=t.label||t.value,this.value=t.value}function t(e,t){return"string"==typeof e?(t||document).querySelector(e):e||null}function i(e,t){return r.call((t||document).querySelectorAll(e))}function s(){i("input.awesomplete").forEach(function(e){new o(e)})}var o=function(e,i){var s=this;this.isOpened=!1,this.input=t(e),this.input.setAttribute("autocomplete","off"),this.input.setAttribute("aria-autocomplete","list"),i=i||{},function(e,t,i){for(var s in t){var o=t[s],r=e.input.getAttribute("data-"+s.toLowerCase());"number"==typeof o?e[s]=parseInt(r):!1===o?e[s]=null!==r:o instanceof Function?e[s]=null:e[s]=r,e[s]||0===e[s]||(e[s]=s in i?i[s]:o)}}(this,{minChars:2,maxItems:10,autoFirst:!1,data:o.DATA,filter:o.FILTER_CONTAINS,sort:o.SORT_BYLENGTH,item:o.ITEM,replace:o.REPLACE},i),this.index=-1,this.container=t.create("div",{className:"awesomplete",around:e}),this.ul=t.create("ul",{hidden:"hidden",inside:this.container}),this.status=t.create("span",{className:"visually-hidden",role:"status","aria-live":"assertive","aria-relevant":"additions",inside:this.container}),t.bind(this.input,{input:this.evaluate.bind(this),blur:this.close.bind(this,{reason:"blur"}),keydown:function(e){var t=e.keyCode;s.opened&&(13===t&&s.selected?(e.preventDefault(),s.select()):27===t?s.close({reason:"esc"}):38!==t&&40!==t||(e.preventDefault(),s[38===t?"previous":"next"]()))}}),t.bind(this.input.form,{submit:this.close.bind(this,{reason:"submit"})}),t.bind(this.ul,{mousedown:function(e){var t=e.target;if(t!==this){for(;t&&!/li/i.test(t.nodeName);)t=t.parentNode;t&&0===e.button&&(e.preventDefault(),s.select(t,e.target))}}}),this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||i.list||[],o.all.push(this)};o.prototype={set list(e){if(Array.isArray(e))this._list=e;else if("string"==typeof e&&e.indexOf(",")>-1)this._list=e.split(/\s*,\s*/);else if((e=t(e))&&e.children){var i=[];r.apply(e.children).forEach(function(e){if(!e.disabled){var t=e.textContent.trim(),s=e.value||t,o=e.label||t;""!==s&&i.push({label:o,value:s})}}),this._list=i}document.activeElement===this.input&&this.evaluate()},get selected(){return this.index>-1},get opened(){return this.isOpened},close:function(e){this.opened&&(this.ul.setAttribute("hidden",""),this.isOpened=!1,this.index=-1,t.fire(this.input,"awesomplete-close",e||{}))},open:function(){this.ul.removeAttribute("hidden"),this.isOpened=!0,this.autoFirst&&-1===this.index&&this.goto(0),t.fire(this.input,"awesomplete-open")},next:function(){var e=this.ul.children.length;this.goto(this.index<e-1?this.index+1:e?0:-1)},previous:function(){var e=this.ul.children.length,t=this.index-1;this.goto(this.selected&&-1!==t?t:e-1)},goto:function(e){var i=this.ul.children;this.selected&&i[this.index].setAttribute("aria-selected","false"),this.index=e,e>-1&&i.length>0&&(i[e].setAttribute("aria-selected","true"),this.status.textContent=i[e].textContent,t.fire(this.input,"awesomplete-highlight",{text:this.suggestions[this.index]}))},select:function(e,i){if(e?this.index=t.siblingIndex(e):e=this.ul.children[this.index],e){var s=this.suggestions[this.index];t.fire(this.input,"awesomplete-select",{text:s,origin:i||e})&&(this.replace(s),this.close({reason:"select"}),t.fire(this.input,"awesomplete-selectcomplete",{text:s}))}},evaluate:function(){var t=this,i=this.input.value;i.length>=this.minChars&&this._list.length>0?(this.index=-1,this.ul.innerHTML="",this.suggestions=this._list.map(function(s){return new e(t.data(s,i))}).filter(function(e){return t.filter(e,i)}).sort(this.sort).slice(0,this.maxItems),this.suggestions.forEach(function(e){t.ul.appendChild(t.item(e,i))}),0===this.ul.children.length?this.close({reason:"nomatches"}):this.open()):this.close({reason:"nomatches"})}},o.all=[],o.FILTER_CONTAINS=function(e,i){return RegExp(t.regExpEscape(i.trim()),"i").test(e)},o.FILTER_STARTSWITH=function(e,i){return RegExp("^"+t.regExpEscape(i.trim()),"i").test(e)},o.SORT_BYLENGTH=function(e,t){return e.length!==t.length?e.length-t.length:e<t?-1:1},o.ITEM=function(e,i){var s=""===i?e:e.replace(RegExp(t.regExpEscape(i.trim()),"gi"),"<mark>$&</mark>");return t.create("li",{innerHTML:s,"aria-selected":"false"})},o.REPLACE=function(e){this.input.value=e.value},o.DATA=function(e){return e},Object.defineProperty(e.prototype=Object.create(String.prototype),"length",{get:function(){return this.label.length}}),e.prototype.toString=e.prototype.valueOf=function(){return""+this.label};var r=Array.prototype.slice;t.create=function(e,i){var s=document.createElement(e);for(var o in i){var r=i[o];if("inside"===o)t(r).appendChild(s);else if("around"===o){var a=t(r);a.parentNode.insertBefore(s,a),s.appendChild(a)}else o in s?s[o]=r:s.setAttribute(o,r)}return s},t.bind=function(e,t){if(e)for(var i in t){var s=t[i];i.split(/\s+/).forEach(function(t){e.addEventListener(t,s)})}},t.fire=function(e,t,i){var s=document.createEvent("HTMLEvents");for(var o in s.initEvent(t,!0,!0),i)s[o]=i[o];return e.dispatchEvent(s)},t.regExpEscape=function(e){return e.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")},t.siblingIndex=function(e){for(var t=0;e=e.previousElementSibling;t++);return t},"undefined"!=typeof Document&&("loading"!==document.readyState?s():document.addEventListener("DOMContentLoaded",s)),o.$=t,o.$$=i,"undefined"!=typeof self&&(self.Awesomplete=o),"object"==typeof module&&module.exports&&(module.exports=o)}();var commerceCategoryTree=function(){function e(e){$("form#"+e+"_form input[name='m_category_ids[]']").each(function(){var e=$(this);$("#"+e.val()+"_categoryId_anchor").addClass("jstree-checked")})}function t(e){$("#"+e+".jstree li.jstree-node .jstree-anchor").each(function(){var e=$(this),t=e.data("textlang"),i='<span title="'+translations.tr_meliscommerce_categories_list_tree_view_product_num+'"></span>';t&&(i=" "+t+i),e.hasClass("updatedText")||(e.append(i),e.addClass("updatedText"))})}function i(e){var t=$("#"+e),i=new Array;return i.push({name:"langlocale",value:t.data("langlocale")}),i.push({name:"idAndNameOnly",value:!0}),$("form#"+e+"_form input[name='m_category_ids[]']").each(function(){i.push({name:"categoriesChecked[]",value:$(this).val()})}),i}return{initCategoryTree:function(s,o){o=null==o?null:o;var r=$("#"+s);r.jstree({core:{multiple:!1,check_callback:!0,animation:500,themes:{name:"proton",responsive:!1,icons:!1},dblclick_toggle:!1,data:{cache:!1,data:i(s),url:"/melis/MelisCommerce/MelisComCategoryList/getCategoryTreeView"}},types:{default:{icon:"fa fa-circle text-success"},selected:{select_node:!1}},checkbox:{three_state:!1,whole_node:!1,tie_selection:!1},plugins:["search","types","checkbox"]}).on("check_node.jstree uncheck_node.jstree",function(e,t){var i=$("#"+s+"_form").data("input-field-selected");t.node.state.checked?$("#"+s+"_form").append('<input type="hidden" name="'+i+'[]" value="'+t.node.original.cat_id+'">'):$("#"+s+"_form input[name='"+i+"[]'][value='"+t.node.original.cat_id+"']").remove()}).on("select_node.jstree deselect_node.jstree ",function(e,t){var i=$("#"+s+"_form").data("input-field-root");t.node.state.selected&&$("#"+s+"_form input[name='"+i+"']").val(t.node.original.cat_id)}).on("after_open.jstree",function(i,o){e(s),t(s)}).on("loaded.jstree",function(e,t){!function(e){var t=$("#"+e);$("#catPrdSliderPluginSearch").on("keyup",function(i){var s=$(this),o=s.val().trim(),r=t.jstree("search",o);setTimeout(function(){0==$(r).find(".jstree-search").length&&""!=o?($("#"+e).prev("div.alert").removeClass("hidden"),$("#"+e).prev("div.alert").find("strong").text(o)):$("#"+e).prev("div.alert").addClass("hidden")},1500)}),$("#catPrdSliderPluginClearBtn").on("click",function(i){$("#catPrdSliderPluginSearch").val(""),t.jstree("search",""),$("#"+e+"SearchNoResult").addClass("hidden")}),$("#catPrdSliderPluginExpandBtn").on("click",function(e){t.jstree("open_all")}),$("#catPrdSliderPluginCollapseBtn").on("click",function(e){t.jstree("close_all")}),$("#catPrdSliderPluginRefreshBtn").on("click",function(e){t.jstree("search",""),$("#catPrdSliderPluginSearch").val(""),t.jstree(!0).refresh()}),$(".category-tree-view-lang-plugin li a").on("click",function(){$(this);var s=$(this).text(),o=$(this).data("locale");$(".categoryLangTreePluginDropdown span.filter-key").text(s),t.data("langlocale",o),t.jstree(!0).settings.core.data.data=i(e),t.jstree(!0).refresh()})}(s),null!==o&&o(e,t,r)}).on("refresh.jstree",function(i,o){e(s),t(s)})}}}();function widgetCollapsibleInit(){var e;(e=jQuery)('.widget[data-toggle="collapse-widget"] .widget-body').on("show.bs.collapse",function(){e(this).parents(".widget:first").attr("data-collapse-closed","false")}).on("shown.bs.collapse",function(){setTimeout(function(){e(window).resize()},500)}).on("hidden.bs.collapse",function(){e(this).parents(".widget:first").attr("data-collapse-closed","true")}),e('.widget[data-toggle="collapse-widget"]').each(function(){e(this).find(".widget-head > .collapse-toggle").length||e('<span class="collapse-toggle"></span>').prependTo(e(this).find(".widget-head")),e(this).find(".widget-body").not(".collapse").addClass("collapse"),"true"!==e(this).attr("data-collapse-closed")&&e(this).find(".widget-body").addClass("in"),e(this).find(".accordionTitle").on("click",function(){var t=e(".prices-accordion.active");e.each(t,function(){e(this).find(".widget[data-collapse-closed=false]").find(".widget-body").collapse("toggle")}),e(this).parents(".widget:first").find(".widget-body").collapse("toggle")})})}!function(e,t){"use strict";"function"==typeof define&&define.amd?define("jquery-bridget/jquery-bridget",["jquery"],function(i){t(e,i)}):"object"==typeof module&&module.exports?module.exports=t(e,require("jquery")):e.jQueryBridget=t(e,e.jQuery)}(window,function(e,t){"use strict";function i(i,r,n){(n=n||t||e.jQuery)&&(r.prototype.option||(r.prototype.option=function(e){n.isPlainObject(e)&&(this.options=n.extend(!0,this.options,e))}),n.fn[i]=function(e){return"string"==typeof e?function(e,t,s){var o,r="$()."+i+'("'+t+'")';return e.each(function(e,l){var c=n.data(l,i);if(c){var d=c[t];if(d&&"_"!=t.charAt(0)){var h=d.apply(c,s);o=void 0===o?h:o}else a(r+" is not a valid method")}else a(i+" not initialized. Cannot call methods, i.e. "+r)}),void 0!==o?o:e}(this,e,o.call(arguments,1)):(function(e,t){e.each(function(e,s){var o=n.data(s,i);o?(o.option(t),o._init()):(o=new r(s,t),n.data(s,i,o))})}(this,e),this)},s(n))}function s(e){!e||e&&e.bridget||(e.bridget=i)}var o=Array.prototype.slice,r=e.console,a=void 0===r?function(){}:function(e){r.error(e)};return s(t||e.jQuery),i}),function(e,t){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",t):"object"==typeof module&&module.exports?module.exports=t():e.EvEmitter=t()}("undefined"!=typeof window?window:this,function(){function e(){}var t=e.prototype;return t.on=function(e,t){if(e&&t){var i=this._events=this._events||{},s=i[e]=i[e]||[];return-1==s.indexOf(t)&&s.push(t),this}},t.once=function(e,t){if(e&&t){this.on(e,t);var i=this._onceEvents=this._onceEvents||{};return(i[e]=i[e]||{})[t]=!0,this}},t.off=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){var s=i.indexOf(t);return-1!=s&&i.splice(s,1),this}},t.emitEvent=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){var s=0,o=i[s];t=t||[];for(var r=this._onceEvents&&this._onceEvents[e];o;){var a=r&&r[o];a&&(this.off(e,o),delete r[o]),o.apply(this,t),o=i[s+=a?0:1]}return this}},e}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("get-size/get-size",[],function(){return t()}):"object"==typeof module&&module.exports?module.exports=t():e.getSize=t()}(window,function(){"use strict";function e(e){var t=parseFloat(e);return-1==e.indexOf("%")&&!isNaN(t)&&t}function t(e){var t=getComputedStyle(e);return t||r("Style returned "+t+". Are you running this code in a hidden iframe on Firefox? See http://bit.ly/getsizebug1"),t}function i(){if(!l){l=!0;var i=document.createElement("div");i.style.width="200px",i.style.padding="1px 2px 3px 4px",i.style.borderStyle="solid",i.style.borderWidth="1px 2px 3px 4px",i.style.boxSizing="border-box";var r=document.body||document.documentElement;r.appendChild(i);var a=t(i);s.isBoxSizeOuter=o=200==e(a.width),r.removeChild(i)}}function s(s){if(i(),"string"==typeof s&&(s=document.querySelector(s)),s&&"object"==typeof s&&s.nodeType){var r=t(s);if("none"==r.display)return function(){for(var e={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},t=0;n>t;t++)e[a[t]]=0;return e}();var l={};l.width=s.offsetWidth,l.height=s.offsetHeight;for(var c=l.isBorderBox="border-box"==r.boxSizing,d=0;n>d;d++){var h=a[d],m=r[h],u=parseFloat(m);l[h]=isNaN(u)?0:u}var p=l.paddingLeft+l.paddingRight,_=l.paddingTop+l.paddingBottom,f=l.marginLeft+l.marginRight,g=l.marginTop+l.marginBottom,v=l.borderLeftWidth+l.borderRightWidth,b=l.borderTopWidth+l.borderBottomWidth,y=c&&o,C=e(r.width);!1!==C&&(l.width=C+(y?0:p+v));var x=e(r.height);return!1!==x&&(l.height=x+(y?0:_+b)),l.innerWidth=l.width-(p+v),l.innerHeight=l.height-(_+b),l.outerWidth=l.width+f,l.outerHeight=l.height+g,l}}var o,r="undefined"==typeof console?function(){}:function(e){console.error(e)},a=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],n=a.length,l=!1;return s}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("desandro-matches-selector/matches-selector",t):"object"==typeof module&&module.exports?module.exports=t():e.matchesSelector=t()}(window,function(){"use strict";var e=function(){var e=Element.prototype;if(e.matches)return"matches";if(e.matchesSelector)return"matchesSelector";for(var t=["webkit","moz","ms","o"],i=0;i<t.length;i++){var s=t[i]+"MatchesSelector";if(e[s])return s}}();return function(t,i){return t[e](i)}}),function(e,t){"function"==typeof define&&define.amd?define("fizzy-ui-utils/utils",["desandro-matches-selector/matches-selector"],function(i){return t(e,i)}):"object"==typeof module&&module.exports?module.exports=t(e,require("desandro-matches-selector")):e.fizzyUIUtils=t(e,e.matchesSelector)}(window,function(e,t){var i={extend:function(e,t){for(var i in t)e[i]=t[i];return e},modulo:function(e,t){return(e%t+t)%t},makeArray:function(e){var t=[];if(Array.isArray(e))t=e;else if(e&&"number"==typeof e.length)for(var i=0;i<e.length;i++)t.push(e[i]);else t.push(e);return t},removeFrom:function(e,t){var i=e.indexOf(t);-1!=i&&e.splice(i,1)},getParent:function(e,i){for(;e!=document.body;)if(e=e.parentNode,t(e,i))return e},getQueryElement:function(e){return"string"==typeof e?document.querySelector(e):e},handleEvent:function(e){var t="on"+e.type;this[t]&&this[t](e)},filterFindElements:function(e,s){e=i.makeArray(e);var o=[];return e.forEach(function(e){if(e instanceof HTMLElement){if(!s)return void o.push(e);t(e,s)&&o.push(e);for(var i=e.querySelectorAll(s),r=0;r<i.length;r++)o.push(i[r])}}),o},debounceMethod:function(e,t,i){var s=e.prototype[t],o=t+"Timeout";e.prototype[t]=function(){var e=this[o];e&&clearTimeout(e);var t=arguments,r=this;this[o]=setTimeout(function(){s.apply(r,t),delete r[o]},i||100)}},docReady:function(e){var t=document.readyState;"complete"==t||"interactive"==t?e():document.addEventListener("DOMContentLoaded",e)},toDashed:function(e){return e.replace(/(.)([A-Z])/g,function(e,t,i){return t+"-"+i}).toLowerCase()}},s=e.console;return i.htmlInit=function(t,o){i.docReady(function(){var r=i.toDashed(o),a="data-"+r,n=document.querySelectorAll("["+a+"]"),l=document.querySelectorAll(".js-"+r),c=i.makeArray(n).concat(i.makeArray(l)),d=a+"-options",h=e.jQuery;c.forEach(function(e){var i,r=e.getAttribute(a)||e.getAttribute(d);try{i=r&&JSON.parse(r)}catch(t){return void(s&&s.error("Error parsing "+a+" on "+e.className+": "+t))}var n=new t(e,i);h&&h.data(e,o,n)})})},i}),function(e,t){"function"==typeof define&&define.amd?define("outlayer/item",["ev-emitter/ev-emitter","get-size/get-size"],t):"object"==typeof module&&module.exports?module.exports=t(require("ev-emitter"),require("get-size")):(e.Outlayer={},e.Outlayer.Item=t(e.EvEmitter,e.getSize))}(window,function(e,t){"use strict";function i(e,t){e&&(this.element=e,this.layout=t,this.position={x:0,y:0},this._create())}var s=document.documentElement.style,o="string"==typeof s.transition?"transition":"WebkitTransition",r="string"==typeof s.transform?"transform":"WebkitTransform",a={WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[o],n={transform:r,transition:o,transitionDuration:o+"Duration",transitionProperty:o+"Property",transitionDelay:o+"Delay"},l=i.prototype=Object.create(e.prototype);l.constructor=i,l._create=function(){this._transn={ingProperties:{},clean:{},onEnd:{}},this.css({position:"absolute"})},l.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},l.getSize=function(){this.size=t(this.element)},l.css=function(e){var t=this.element.style;for(var i in e){t[n[i]||i]=e[i]}},l.getPosition=function(){var e=getComputedStyle(this.element),t=this.layout._getOption("originLeft"),i=this.layout._getOption("originTop"),s=e[t?"left":"right"],o=e[i?"top":"bottom"],r=this.layout.size,a=-1!=s.indexOf("%")?parseFloat(s)/100*r.width:parseInt(s,10),n=-1!=o.indexOf("%")?parseFloat(o)/100*r.height:parseInt(o,10);a=isNaN(a)?0:a,n=isNaN(n)?0:n,a-=t?r.paddingLeft:r.paddingRight,n-=i?r.paddingTop:r.paddingBottom,this.position.x=a,this.position.y=n},l.layoutPosition=function(){var e=this.layout.size,t={},i=this.layout._getOption("originLeft"),s=this.layout._getOption("originTop"),o=i?"paddingLeft":"paddingRight",r=i?"left":"right",a=i?"right":"left",n=this.position.x+e[o];t[r]=this.getXValue(n),t[a]="";var l=s?"paddingTop":"paddingBottom",c=s?"top":"bottom",d=s?"bottom":"top",h=this.position.y+e[l];t[c]=this.getYValue(h),t[d]="",this.css(t),this.emitEvent("layout",[this])},l.getXValue=function(e){var t=this.layout._getOption("horizontal");return this.layout.options.percentPosition&&!t?e/this.layout.size.width*100+"%":e+"px"},l.getYValue=function(e){var t=this.layout._getOption("horizontal");return this.layout.options.percentPosition&&t?e/this.layout.size.height*100+"%":e+"px"},l._transitionTo=function(e,t){this.getPosition();var i=this.position.x,s=this.position.y,o=parseInt(e,10),r=parseInt(t,10),a=o===this.position.x&&r===this.position.y;if(this.setPosition(e,t),!a||this.isTransitioning){var n=e-i,l=t-s,c={};c.transform=this.getTranslate(n,l),this.transition({to:c,onTransitionEnd:{transform:this.layoutPosition},isCleaning:!0})}else this.layoutPosition()},l.getTranslate=function(e,t){return"translate3d("+(e=this.layout._getOption("originLeft")?e:-e)+"px, "+(t=this.layout._getOption("originTop")?t:-t)+"px, 0)"},l.goTo=function(e,t){this.setPosition(e,t),this.layoutPosition()},l.moveTo=l._transitionTo,l.setPosition=function(e,t){this.position.x=parseInt(e,10),this.position.y=parseInt(t,10)},l._nonTransition=function(e){for(var t in this.css(e.to),e.isCleaning&&this._removeStyles(e.to),e.onTransitionEnd)e.onTransitionEnd[t].call(this)},l.transition=function(e){if(parseFloat(this.layout.options.transitionDuration)){var t=this._transn;for(var i in e.onTransitionEnd)t.onEnd[i]=e.onTransitionEnd[i];for(i in e.to)t.ingProperties[i]=!0,e.isCleaning&&(t.clean[i]=!0);if(e.from){this.css(e.from);this.element.offsetHeight;null}this.enableTransition(e.to),this.css(e.to),this.isTransitioning=!0}else this._nonTransition(e)};var c="opacity,"+function(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}(r);l.enableTransition=function(){if(!this.isTransitioning){var e=this.layout.options.transitionDuration;e="number"==typeof e?e+"ms":e,this.css({transitionProperty:c,transitionDuration:e,transitionDelay:this.staggerDelay||0}),this.element.addEventListener(a,this,!1)}},l.onwebkitTransitionEnd=function(e){this.ontransitionend(e)},l.onotransitionend=function(e){this.ontransitionend(e)};var d={"-webkit-transform":"transform"};l.ontransitionend=function(e){if(e.target===this.element){var t=this._transn,i=d[e.propertyName]||e.propertyName;if(delete t.ingProperties[i],function(e){for(var t in e)return!1;return!0}(t.ingProperties)&&this.disableTransition(),i in t.clean&&(this.element.style[e.propertyName]="",delete t.clean[i]),i in t.onEnd)t.onEnd[i].call(this),delete t.onEnd[i];this.emitEvent("transitionEnd",[this])}},l.disableTransition=function(){this.removeTransitionStyles(),this.element.removeEventListener(a,this,!1),this.isTransitioning=!1},l._removeStyles=function(e){var t={};for(var i in e)t[i]="";this.css(t)};var h={transitionProperty:"",transitionDuration:"",transitionDelay:""};return l.removeTransitionStyles=function(){this.css(h)},l.stagger=function(e){e=isNaN(e)?0:e,this.staggerDelay=e+"ms"},l.removeElem=function(){this.element.parentNode.removeChild(this.element),this.css({display:""}),this.emitEvent("remove",[this])},l.remove=function(){return o&&parseFloat(this.layout.options.transitionDuration)?(this.once("transitionEnd",function(){this.removeElem()}),void this.hide()):void this.removeElem()},l.reveal=function(){delete this.isHidden,this.css({display:""});var e=this.layout.options,t={};t[this.getHideRevealTransitionEndProperty("visibleStyle")]=this.onRevealTransitionEnd,this.transition({from:e.hiddenStyle,to:e.visibleStyle,isCleaning:!0,onTransitionEnd:t})},l.onRevealTransitionEnd=function(){this.isHidden||this.emitEvent("reveal")},l.getHideRevealTransitionEndProperty=function(e){var t=this.layout.options[e];if(t.opacity)return"opacity";for(var i in t)return i},l.hide=function(){this.isHidden=!0,this.css({display:""});var e=this.layout.options,t={};t[this.getHideRevealTransitionEndProperty("hiddenStyle")]=this.onHideTransitionEnd,this.transition({from:e.visibleStyle,to:e.hiddenStyle,isCleaning:!0,onTransitionEnd:t})},l.onHideTransitionEnd=function(){this.isHidden&&(this.css({display:"none"}),this.emitEvent("hide"))},l.destroy=function(){this.css({position:"",left:"",right:"",top:"",bottom:"",transition:"",transform:""})},i}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("outlayer/outlayer",["ev-emitter/ev-emitter","get-size/get-size","fizzy-ui-utils/utils","./item"],function(i,s,o,r){return t(e,i,s,o,r)}):"object"==typeof module&&module.exports?module.exports=t(e,require("ev-emitter"),require("get-size"),require("fizzy-ui-utils"),require("./item")):e.Outlayer=t(e,e.EvEmitter,e.getSize,e.fizzyUIUtils,e.Outlayer.Item)}(window,function(e,t,i,s,o){"use strict";function r(e,t){var i=s.getQueryElement(e);if(i){this.element=i,l&&(this.$element=l(this.element)),this.options=s.extend({},this.constructor.defaults),this.option(t);var o=++d;this.element.outlayerGUID=o,h[o]=this,this._create(),this._getOption("initLayout")&&this.layout()}else n&&n.error("Bad element for "+this.constructor.namespace+": "+(i||e))}function a(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}var n=e.console,l=e.jQuery,c=function(){},d=0,h={};r.namespace="outlayer",r.Item=o,r.defaults={containerStyle:{position:"relative"},initLayout:!0,originLeft:!0,originTop:!0,resize:!0,resizeContainer:!0,transitionDuration:"0.4s",hiddenStyle:{opacity:0,transform:"scale(0.001)"},visibleStyle:{opacity:1,transform:"scale(1)"}};var m=r.prototype;s.extend(m,t.prototype),m.option=function(e){s.extend(this.options,e)},m._getOption=function(e){var t=this.constructor.compatOptions[e];return t&&void 0!==this.options[t]?this.options[t]:this.options[e]},r.compatOptions={initLayout:"isInitLayout",horizontal:"isHorizontal",layoutInstant:"isLayoutInstant",originLeft:"isOriginLeft",originTop:"isOriginTop",resize:"isResizeBound",resizeContainer:"isResizingContainer"},m._create=function(){this.reloadItems(),this.stamps=[],this.stamp(this.options.stamp),s.extend(this.element.style,this.options.containerStyle),this._getOption("resize")&&this.bindResize()},m.reloadItems=function(){this.items=this._itemize(this.element.children)},m._itemize=function(e){for(var t=this._filterFindItemElements(e),i=this.constructor.Item,s=[],o=0;o<t.length;o++){var r=new i(t[o],this);s.push(r)}return s},m._filterFindItemElements=function(e){return s.filterFindElements(e,this.options.itemSelector)},m.getItemElements=function(){return this.items.map(function(e){return e.element})},m.layout=function(){this._resetLayout(),this._manageStamps();var e=this._getOption("layoutInstant"),t=void 0!==e?e:!this._isLayoutInited;this.layoutItems(this.items,t),this._isLayoutInited=!0},m._init=m.layout,m._resetLayout=function(){this.getSize()},m.getSize=function(){this.size=i(this.element)},m._getMeasurement=function(e,t){var s,o=this.options[e];o?("string"==typeof o?s=this.element.querySelector(o):o instanceof HTMLElement&&(s=o),this[e]=s?i(s)[t]:o):this[e]=0},m.layoutItems=function(e,t){e=this._getItemsForLayout(e),this._layoutItems(e,t),this._postLayout()},m._getItemsForLayout=function(e){return e.filter(function(e){return!e.isIgnored})},m._layoutItems=function(e,t){if(this._emitCompleteOnItems("layout",e),e&&e.length){var i=[];e.forEach(function(e){var s=this._getItemLayoutPosition(e);s.item=e,s.isInstant=t||e.isLayoutInstant,i.push(s)},this),this._processLayoutQueue(i)}},m._getItemLayoutPosition=function(){return{x:0,y:0}},m._processLayoutQueue=function(e){this.updateStagger(),e.forEach(function(e,t){this._positionItem(e.item,e.x,e.y,e.isInstant,t)},this)},m.updateStagger=function(){var e=this.options.stagger;return null==e?void(this.stagger=0):(this.stagger=function(e){if("number"==typeof e)return e;var t=e.match(/(^\d*\.?\d*)(\w*)/),i=t&&t[1],s=t&&t[2];return i.length?(i=parseFloat(i))*(u[s]||1):0}(e),this.stagger)},m._positionItem=function(e,t,i,s,o){s?e.goTo(t,i):(e.stagger(o*this.stagger),e.moveTo(t,i))},m._postLayout=function(){this.resizeContainer()},m.resizeContainer=function(){if(this._getOption("resizeContainer")){var e=this._getContainerSize();e&&(this._setContainerMeasure(e.width,!0),this._setContainerMeasure(e.height,!1))}},m._getContainerSize=c,m._setContainerMeasure=function(e,t){if(void 0!==e){var i=this.size;i.isBorderBox&&(e+=t?i.paddingLeft+i.paddingRight+i.borderLeftWidth+i.borderRightWidth:i.paddingBottom+i.paddingTop+i.borderTopWidth+i.borderBottomWidth),e=Math.max(e,0),this.element.style[t?"width":"height"]=e+"px"}},m._emitCompleteOnItems=function(e,t){function i(){o.dispatchEvent(e+"Complete",null,[t])}function s(){++a==r&&i()}var o=this,r=t.length;if(t&&r){var a=0;t.forEach(function(t){t.once(e,s)})}else i()},m.dispatchEvent=function(e,t,i){var s=t?[t].concat(i):i;if(this.emitEvent(e,s),l)if(this.$element=this.$element||l(this.element),t){var o=l.Event(t);o.type=e,this.$element.trigger(o,i)}else this.$element.trigger(e,i)},m.ignore=function(e){var t=this.getItem(e);t&&(t.isIgnored=!0)},m.unignore=function(e){var t=this.getItem(e);t&&delete t.isIgnored},m.stamp=function(e){(e=this._find(e))&&(this.stamps=this.stamps.concat(e),e.forEach(this.ignore,this))},m.unstamp=function(e){(e=this._find(e))&&e.forEach(function(e){s.removeFrom(this.stamps,e),this.unignore(e)},this)},m._find=function(e){return e?("string"==typeof e&&(e=this.element.querySelectorAll(e)),e=s.makeArray(e)):void 0},m._manageStamps=function(){this.stamps&&this.stamps.length&&(this._getBoundingRect(),this.stamps.forEach(this._manageStamp,this))},m._getBoundingRect=function(){var e=this.element.getBoundingClientRect(),t=this.size;this._boundingRect={left:e.left+t.paddingLeft+t.borderLeftWidth,top:e.top+t.paddingTop+t.borderTopWidth,right:e.right-(t.paddingRight+t.borderRightWidth),bottom:e.bottom-(t.paddingBottom+t.borderBottomWidth)}},m._manageStamp=c,m._getElementOffset=function(e){var t=e.getBoundingClientRect(),s=this._boundingRect,o=i(e);return{left:t.left-s.left-o.marginLeft,top:t.top-s.top-o.marginTop,right:s.right-t.right-o.marginRight,bottom:s.bottom-t.bottom-o.marginBottom}},m.handleEvent=s.handleEvent,m.bindResize=function(){e.addEventListener("resize",this),this.isResizeBound=!0},m.unbindResize=function(){e.removeEventListener("resize",this),this.isResizeBound=!1},m.onresize=function(){this.resize()},s.debounceMethod(r,"onresize",100),m.resize=function(){this.isResizeBound&&this.needsResizeLayout()&&this.layout()},m.needsResizeLayout=function(){var e=i(this.element);return this.size&&e&&e.innerWidth!==this.size.innerWidth},m.addItems=function(e){var t=this._itemize(e);return t.length&&(this.items=this.items.concat(t)),t},m.appended=function(e){var t=this.addItems(e);t.length&&(this.layoutItems(t,!0),this.reveal(t))},m.prepended=function(e){var t=this._itemize(e);if(t.length){var i=this.items.slice(0);this.items=t.concat(i),this._resetLayout(),this._manageStamps(),this.layoutItems(t,!0),this.reveal(t),this.layoutItems(i)}},m.reveal=function(e){if(this._emitCompleteOnItems("reveal",e),e&&e.length){var t=this.updateStagger();e.forEach(function(e,i){e.stagger(i*t),e.reveal()})}},m.hide=function(e){if(this._emitCompleteOnItems("hide",e),e&&e.length){var t=this.updateStagger();e.forEach(function(e,i){e.stagger(i*t),e.hide()})}},m.revealItemElements=function(e){var t=this.getItems(e);this.reveal(t)},m.hideItemElements=function(e){var t=this.getItems(e);this.hide(t)},m.getItem=function(e){for(var t=0;t<this.items.length;t++){var i=this.items[t];if(i.element==e)return i}},m.getItems=function(e){e=s.makeArray(e);var t=[];return e.forEach(function(e){var i=this.getItem(e);i&&t.push(i)},this),t},m.remove=function(e){var t=this.getItems(e);this._emitCompleteOnItems("remove",t),t&&t.length&&t.forEach(function(e){e.remove(),s.removeFrom(this.items,e)},this)},m.destroy=function(){var e=this.element.style;e.height="",e.position="",e.width="",this.items.forEach(function(e){e.destroy()}),this.unbindResize();var t=this.element.outlayerGUID;delete h[t],delete this.element.outlayerGUID,l&&l.removeData(this.element,this.constructor.namespace)},r.data=function(e){var t=(e=s.getQueryElement(e))&&e.outlayerGUID;return t&&h[t]},r.create=function(e,t){var i=a(r);return i.defaults=s.extend({},r.defaults),s.extend(i.defaults,t),i.compatOptions=s.extend({},r.compatOptions),i.namespace=e,i.data=r.data,i.Item=a(o),s.htmlInit(i,e),l&&l.bridget&&l.bridget(e,i),i};var u={ms:1,s:1e3};return r.Item=o,r}),function(e,t){"function"==typeof define&&define.amd?define("isotope/js/item",["outlayer/outlayer"],t):"object"==typeof module&&module.exports?module.exports=t(require("outlayer")):(e.Isotope=e.Isotope||{},e.Isotope.Item=t(e.Outlayer))}(window,function(e){"use strict";function t(){e.Item.apply(this,arguments)}var i=t.prototype=Object.create(e.Item.prototype),s=i._create;i._create=function(){this.id=this.layout.itemGUID++,s.call(this),this.sortData={}},i.updateSortData=function(){if(!this.isIgnored){this.sortData.id=this.id,this.sortData["original-order"]=this.id,this.sortData.random=Math.random();var e=this.layout.options.getSortData,t=this.layout._sorters;for(var i in e){var s=t[i];this.sortData[i]=s(this.element,this)}}};var o=i.destroy;return i.destroy=function(){o.apply(this,arguments),this.css({display:""})},t}),function(e,t){"function"==typeof define&&define.amd?define("isotope/js/layout-mode",["get-size/get-size","outlayer/outlayer"],t):"object"==typeof module&&module.exports?module.exports=t(require("get-size"),require("outlayer")):(e.Isotope=e.Isotope||{},e.Isotope.LayoutMode=t(e.getSize,e.Outlayer))}(window,function(e,t){"use strict";function i(e){this.isotope=e,e&&(this.options=e.options[this.namespace],this.element=e.element,this.items=e.filteredItems,this.size=e.size)}var s=i.prototype;return["_resetLayout","_getItemLayoutPosition","_manageStamp","_getContainerSize","_getElementOffset","needsResizeLayout","_getOption"].forEach(function(e){s[e]=function(){return t.prototype[e].apply(this.isotope,arguments)}}),s.needsVerticalResizeLayout=function(){var t=e(this.isotope.element);return this.isotope.size&&t&&t.innerHeight!=this.isotope.size.innerHeight},s._getMeasurement=function(){this.isotope._getMeasurement.apply(this,arguments)},s.getColumnWidth=function(){this.getSegmentSize("column","Width")},s.getRowHeight=function(){this.getSegmentSize("row","Height")},s.getSegmentSize=function(e,t){var i=e+t,s="outer"+t;if(this._getMeasurement(i,s),!this[i]){var o=this.getFirstItemSize();this[i]=o&&o[s]||this.isotope.size["inner"+t]}},s.getFirstItemSize=function(){var t=this.isotope.filteredItems[0];return t&&t.element&&e(t.element)},s.layout=function(){this.isotope.layout.apply(this.isotope,arguments)},s.getSize=function(){this.isotope.getSize(),this.size=this.isotope.size},i.modes={},i.create=function(e,t){function o(){i.apply(this,arguments)}return o.prototype=Object.create(s),o.prototype.constructor=o,t&&(o.options=t),o.prototype.namespace=e,i.modes[e]=o,o},i}),function(e,t){"function"==typeof define&&define.amd?define("masonry/masonry",["outlayer/outlayer","get-size/get-size"],t):"object"==typeof module&&module.exports?module.exports=t(require("outlayer"),require("get-size")):e.Masonry=t(e.Outlayer,e.getSize)}(window,function(e,t){var i=e.create("masonry");return i.compatOptions.fitWidth="isFitWidth",i.prototype._resetLayout=function(){this.getSize(),this._getMeasurement("columnWidth","outerWidth"),this._getMeasurement("gutter","outerWidth"),this.measureColumns(),this.colYs=[];for(var e=0;e<this.cols;e++)this.colYs.push(0);this.maxY=0},i.prototype.measureColumns=function(){if(this.getContainerWidth(),!this.columnWidth){var e=this.items[0],i=e&&e.element;this.columnWidth=i&&t(i).outerWidth||this.containerWidth}var s=this.columnWidth+=this.gutter,o=this.containerWidth+this.gutter,r=o/s,a=s-o%s;r=Math[a&&1>a?"round":"floor"](r),this.cols=Math.max(r,1)},i.prototype.getContainerWidth=function(){var e=this._getOption("fitWidth")?this.element.parentNode:this.element,i=t(e);this.containerWidth=i&&i.innerWidth},i.prototype._getItemLayoutPosition=function(e){e.getSize();var t=e.size.outerWidth%this.columnWidth,i=Math[t&&1>t?"round":"ceil"](e.size.outerWidth/this.columnWidth);i=Math.min(i,this.cols);for(var s=this._getColGroup(i),o=Math.min.apply(Math,s),r=s.indexOf(o),a={x:this.columnWidth*r,y:o},n=o+e.size.outerHeight,l=this.cols+1-s.length,c=0;l>c;c++)this.colYs[r+c]=n;return a},i.prototype._getColGroup=function(e){if(2>e)return this.colYs;for(var t=[],i=this.cols+1-e,s=0;i>s;s++){var o=this.colYs.slice(s,s+e);t[s]=Math.max.apply(Math,o)}return t},i.prototype._manageStamp=function(e){var i=t(e),s=this._getElementOffset(e),o=this._getOption("originLeft")?s.left:s.right,r=o+i.outerWidth,a=Math.floor(o/this.columnWidth);a=Math.max(0,a);var n=Math.floor(r/this.columnWidth);n-=r%this.columnWidth?0:1,n=Math.min(this.cols-1,n);for(var l=(this._getOption("originTop")?s.top:s.bottom)+i.outerHeight,c=a;n>=c;c++)this.colYs[c]=Math.max(l,this.colYs[c])},i.prototype._getContainerSize=function(){this.maxY=Math.max.apply(Math,this.colYs);var e={height:this.maxY};return this._getOption("fitWidth")&&(e.width=this._getContainerFitWidth()),e},i.prototype._getContainerFitWidth=function(){for(var e=0,t=this.cols;--t&&0===this.colYs[t];)e++;return(this.cols-e)*this.columnWidth-this.gutter},i.prototype.needsResizeLayout=function(){var e=this.containerWidth;return this.getContainerWidth(),e!=this.containerWidth},i}),function(e,t){"function"==typeof define&&define.amd?define("isotope/js/layout-modes/masonry",["../layout-mode","masonry/masonry"],t):"object"==typeof module&&module.exports?module.exports=t(require("../layout-mode"),require("masonry-layout")):t(e.Isotope.LayoutMode,e.Masonry)}(window,function(e,t){"use strict";var i=e.create("masonry"),s=i.prototype,o={_getElementOffset:!0,layout:!0,_getMeasurement:!0};for(var r in t.prototype)o[r]||(s[r]=t.prototype[r]);var a=s.measureColumns;s.measureColumns=function(){this.items=this.isotope.filteredItems,a.call(this)};var n=s._getOption;return s._getOption=function(e){return"fitWidth"==e?void 0!==this.options.isFitWidth?this.options.isFitWidth:this.options.fitWidth:n.apply(this.isotope,arguments)},i}),function(e,t){"function"==typeof define&&define.amd?define("isotope/js/layout-modes/fit-rows",["../layout-mode"],t):"object"==typeof exports?module.exports=t(require("../layout-mode")):t(e.Isotope.LayoutMode)}(window,function(e){"use strict";var t=e.create("fitRows"),i=t.prototype;return i._resetLayout=function(){this.x=0,this.y=0,this.maxY=0,this._getMeasurement("gutter","outerWidth")},i._getItemLayoutPosition=function(e){e.getSize();var t=e.size.outerWidth+this.gutter,i=this.isotope.size.innerWidth+this.gutter;0!==this.x&&t+this.x>i&&(this.x=0,this.y=this.maxY);var s={x:this.x,y:this.y};return this.maxY=Math.max(this.maxY,this.y+e.size.outerHeight),this.x+=t,s},i._getContainerSize=function(){return{height:this.maxY}},t}),function(e,t){"function"==typeof define&&define.amd?define("isotope/js/layout-modes/vertical",["../layout-mode"],t):"object"==typeof module&&module.exports?module.exports=t(require("../layout-mode")):t(e.Isotope.LayoutMode)}(window,function(e){"use strict";var t=e.create("vertical",{horizontalAlignment:0}),i=t.prototype;return i._resetLayout=function(){this.y=0},i._getItemLayoutPosition=function(e){e.getSize();var t=(this.isotope.size.innerWidth-e.size.outerWidth)*this.options.horizontalAlignment,i=this.y;return this.y+=e.size.outerHeight,{x:t,y:i}},i._getContainerSize=function(){return{height:this.y}},t}),function(e,t){"function"==typeof define&&define.amd?define(["outlayer/outlayer","get-size/get-size","desandro-matches-selector/matches-selector","fizzy-ui-utils/utils","isotope/js/item","isotope/js/layout-mode","isotope/js/layout-modes/masonry","isotope/js/layout-modes/fit-rows","isotope/js/layout-modes/vertical"],function(i,s,o,r,a,n){return t(e,i,s,o,r,a,n)}):"object"==typeof module&&module.exports?module.exports=t(e,require("outlayer"),require("get-size"),require("desandro-matches-selector"),require("fizzy-ui-utils"),require("isotope/js/item"),require("isotope/js/layout-mode"),require("isotope/js/layout-modes/masonry"),require("isotope/js/layout-modes/fit-rows"),require("isotope/js/layout-modes/vertical")):e.Isotope=t(e,e.Outlayer,e.getSize,e.matchesSelector,e.fizzyUIUtils,e.Isotope.Item,e.Isotope.LayoutMode)}(window,function(e,t,i,s,o,r,a){var n=e.jQuery,l=String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(/^\s+|\s+$/g,"")},c=t.create("isotope",{layoutMode:"masonry",isJQueryFiltering:!0,sortAscending:!0});c.Item=r,c.LayoutMode=a;var d=c.prototype;d._create=function(){for(var e in this.itemGUID=0,this._sorters={},this._getSorters(),t.prototype._create.call(this),this.modes={},this.filteredItems=this.items,this.sortHistory=["original-order"],a.modes)this._initLayoutMode(e)},d.reloadItems=function(){this.itemGUID=0,t.prototype.reloadItems.call(this)},d._itemize=function(){for(var e=t.prototype._itemize.apply(this,arguments),i=0;i<e.length;i++){e[i].id=this.itemGUID++}return this._updateItemsSortData(e),e},d._initLayoutMode=function(e){var t=a.modes[e],i=this.options[e]||{};this.options[e]=t.options?o.extend(t.options,i):i,this.modes[e]=new t(this)},d.layout=function(){return!this._isLayoutInited&&this._getOption("initLayout")?void this.arrange():void this._layout()},d._layout=function(){var e=this._getIsInstant();this._resetLayout(),this._manageStamps(),this.layoutItems(this.filteredItems,e),this._isLayoutInited=!0},d.arrange=function(e){this.option(e),this._getIsInstant();var t=this._filter(this.items);this.filteredItems=t.matches,this._bindArrangeComplete(),this._isInstant?this._noTransition(this._hideReveal,[t]):this._hideReveal(t),this._sort(),this._layout()},d._init=d.arrange,d._hideReveal=function(e){this.reveal(e.needReveal),this.hide(e.needHide)},d._getIsInstant=function(){var e=this._getOption("layoutInstant"),t=void 0!==e?e:!this._isLayoutInited;return this._isInstant=t,t},d._bindArrangeComplete=function(){function e(){t&&i&&s&&o.dispatchEvent("arrangeComplete",null,[o.filteredItems])}var t,i,s,o=this;this.once("layoutComplete",function(){t=!0,e()}),this.once("hideComplete",function(){i=!0,e()}),this.once("revealComplete",function(){s=!0,e()})},d._filter=function(e){var t=this.options.filter;t=t||"*";for(var i=[],s=[],o=[],r=this._getFilterTest(t),a=0;a<e.length;a++){var n=e[a];if(!n.isIgnored){var l=r(n);l&&i.push(n),l&&n.isHidden?s.push(n):l||n.isHidden||o.push(n)}}return{matches:i,needReveal:s,needHide:o}},d._getFilterTest=function(e){return n&&this.options.isJQueryFiltering?function(t){return n(t.element).is(e)}:"function"==typeof e?function(t){return e(t.element)}:function(t){return s(t.element,e)}},d.updateSortData=function(e){var t;e?(e=o.makeArray(e),t=this.getItems(e)):t=this.items,this._getSorters(),this._updateItemsSortData(t)},d._getSorters=function(){var e=this.options.getSortData;for(var t in e){var i=e[t];this._sorters[t]=h(i)}},d._updateItemsSortData=function(e){for(var t=e&&e.length,i=0;t&&t>i;i++){e[i].updateSortData()}};var h=function(){return function(e){if("string"!=typeof e)return e;var t=l(e).split(" "),i=t[0],s=i.match(/^\[(.+)\]$/),o=function(e,t){return e?function(t){return t.getAttribute(e)}:function(e){var i=e.querySelector(t);return i&&i.textContent}}(s&&s[1],i),r=c.sortDataParsers[t[1]];return r?function(e){return e&&r(o(e))}:function(e){return e&&o(e)}}}();c.sortDataParsers={parseInt:function(e){return parseInt(e,10)},parseFloat:function(e){return parseFloat(e)}},d._sort=function(){var e=this.options.sortBy;if(e){var t=function(e,t){return function(i,s){for(var o=0;o<e.length;o++){var r=e[o],a=i.sortData[r],n=s.sortData[r];if(a>n||n>a)return(a>n?1:-1)*((void 0!==t[r]?t[r]:t)?1:-1)}return 0}}([].concat.apply(e,this.sortHistory),this.options.sortAscending);this.filteredItems.sort(t),e!=this.sortHistory[0]&&this.sortHistory.unshift(e)}},d._mode=function(){var e=this.options.layoutMode,t=this.modes[e];if(!t)throw new Error("No layout mode: "+e);return t.options=this.options[e],t},d._resetLayout=function(){t.prototype._resetLayout.call(this),this._mode()._resetLayout()},d._getItemLayoutPosition=function(e){return this._mode()._getItemLayoutPosition(e)},d._manageStamp=function(e){this._mode()._manageStamp(e)},d._getContainerSize=function(){return this._mode()._getContainerSize()},d.needsResizeLayout=function(){return this._mode().needsResizeLayout()},d.appended=function(e){var t=this.addItems(e);if(t.length){var i=this._filterRevealAdded(t);this.filteredItems=this.filteredItems.concat(i)}},d.prepended=function(e){var t=this._itemize(e);if(t.length){this._resetLayout(),this._manageStamps();var i=this._filterRevealAdded(t);this.layoutItems(this.filteredItems),this.filteredItems=i.concat(this.filteredItems),this.items=t.concat(this.items)}},d._filterRevealAdded=function(e){var t=this._filter(e);return this.hide(t.needHide),this.reveal(t.matches),this.layoutItems(t.matches,!0),t.matches},d.insert=function(e){var t=this.addItems(e);if(t.length){var i,s,o=t.length;for(i=0;o>i;i++)s=t[i],this.element.appendChild(s.element);var r=this._filter(t).matches;for(i=0;o>i;i++)t[i].isLayoutInstant=!0;for(this.arrange(),i=0;o>i;i++)delete t[i].isLayoutInstant;this.reveal(r)}};var m=d.remove;return d.remove=function(e){e=o.makeArray(e);var t=this.getItems(e);m.call(this,e);for(var i=t&&t.length,s=0;i&&i>s;s++){var r=t[s];o.removeFrom(this.filteredItems,r)}},d.shuffle=function(){for(var e=0;e<this.items.length;e++){this.items[e].sortData.random=Math.random()}this.options.sortBy="random",this._sort(),this._layout()},d._noTransition=function(e,t){var i=this.options.transitionDuration;this.options.transitionDuration=0;var s=e.apply(this,t);return this.options.transitionDuration=i,s},d.getFilteredItemElements=function(){return this.filteredItems.map(function(e){return e.element})},c}),function(e,t){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",t):"object"==typeof module&&module.exports?module.exports=t():e.EvEmitter=t()}(this,function(){function e(){}var t=e.prototype;return t.on=function(e,t){if(e&&t){var i=this._events=this._events||{},s=i[e]=i[e]||[];return-1==s.indexOf(t)&&s.push(t),this}},t.once=function(e,t){if(e&&t){this.on(e,t);var i=this._onceEvents=this._onceEvents||{};return(i[e]=i[e]||[])[t]=!0,this}},t.off=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){var s=i.indexOf(t);return-1!=s&&i.splice(s,1),this}},t.emitEvent=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){var s=0,o=i[s];t=t||[];for(var r=this._onceEvents&&this._onceEvents[e];o;){var a=r&&r[o];a&&(this.off(e,o),delete r[o]),o.apply(this,t),o=i[s+=a?0:1]}return this}},e}),function(e,t){"use strict";"function"==typeof define&&define.amd?define(["ev-emitter/ev-emitter"],function(i){return t(e,i)}):"object"==typeof module&&module.exports?module.exports=t(e,require("ev-emitter")):e.imagesLoaded=t(e,e.EvEmitter)}(window,function(e,t){function i(e,t){for(var i in t)e[i]=t[i];return e}function s(e,t,o){return this instanceof s?("string"==typeof e&&(e=document.querySelectorAll(e)),this.elements=function(e){var t=[];if(Array.isArray(e))t=e;else if("number"==typeof e.length)for(var i=0;i<e.length;i++)t.push(e[i]);else t.push(e);return t}(e),this.options=i({},this.options),"function"==typeof t?o=t:i(this.options,t),o&&this.on("always",o),this.getImages(),a&&(this.jqDeferred=new a.Deferred),void setTimeout(function(){this.check()}.bind(this))):new s(e,t,o)}function o(e){this.img=e}function r(e,t){this.url=e,this.element=t,this.img=new Image}var a=e.jQuery,n=e.console;s.prototype=Object.create(t.prototype),s.prototype.options={},s.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)},s.prototype.addElementImages=function(e){"IMG"==e.nodeName&&this.addImage(e),!0===this.options.background&&this.addElementBackgroundImages(e);var t=e.nodeType;if(t&&l[t]){for(var i=e.querySelectorAll("img"),s=0;s<i.length;s++){var o=i[s];this.addImage(o)}if("string"==typeof this.options.background){var r=e.querySelectorAll(this.options.background);for(s=0;s<r.length;s++){var a=r[s];this.addElementBackgroundImages(a)}}}};var l={1:!0,9:!0,11:!0};return s.prototype.addElementBackgroundImages=function(e){var t=getComputedStyle(e);if(t)for(var i=/url\((['"])?(.*?)\1\)/gi,s=i.exec(t.backgroundImage);null!==s;){var o=s&&s[2];o&&this.addBackground(o,e),s=i.exec(t.backgroundImage)}},s.prototype.addImage=function(e){var t=new o(e);this.images.push(t)},s.prototype.addBackground=function(e,t){var i=new r(e,t);this.images.push(i)},s.prototype.check=function(){function e(e,i,s){setTimeout(function(){t.progress(e,i,s)})}var t=this;return this.progressedCount=0,this.hasAnyBroken=!1,this.images.length?void this.images.forEach(function(t){t.once("progress",e),t.check()}):void this.complete()},s.prototype.progress=function(e,t,i){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded,this.emitEvent("progress",[this,e,t]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,e),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&n&&n.log("progress: "+i,e,t)},s.prototype.complete=function(){var e=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(e,[this]),this.emitEvent("always",[this]),this.jqDeferred){var t=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[t](this)}},o.prototype=Object.create(t.prototype),o.prototype.check=function(){return this.getIsImageComplete()?void this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(this.proxyImage=new Image,this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),void(this.proxyImage.src=this.img.src))},o.prototype.getIsImageComplete=function(){return this.img.complete&&void 0!==this.img.naturalWidth},o.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.img,t])},o.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},o.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},o.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},o.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},r.prototype=Object.create(o.prototype),r.prototype.check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url,this.getIsImageComplete()&&(this.confirm(0!==this.img.naturalWidth,"naturalWidth"),this.unbindEvents())},r.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},r.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.element,t])},s.makeJQueryPlugin=function(t){(t=t||e.jQuery)&&((a=t).fn.imagesLoaded=function(e,t){return new s(this,e,t).jqDeferred.promise(a(this))})},s.makeJQueryPlugin(),s}),function(e,t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):e.lightbox=t(e.jQuery)}(this,function(e){function t(t){this.album=[],this.currentImageIndex=void 0,this.init(),this.options=e.extend({},this.constructor.defaults),this.option(t)}return t.defaults={albumLabel:"Image %1 of %2",alwaysShowNavOnTouchDevices:!1,fadeDuration:500,fitImagesInViewport:!0,positionFromTop:50,resizeDuration:700,showImageNumberLabel:!0,wrapAround:!1,disableScrolling:!1},t.prototype.option=function(t){e.extend(this.options,t)},t.prototype.imageCountLabel=function(e,t){return this.options.albumLabel.replace(/%1/g,e).replace(/%2/g,t)},t.prototype.init=function(){this.enable(),this.build()},t.prototype.enable=function(){var t=this;e("body").on("click","a[rel^=lightbox], area[rel^=lightbox], a[data-lightbox], area[data-lightbox]",function(i){return t.start(e(i.currentTarget)),!1})},t.prototype.build=function(){var t=this;e('<div id="lightboxOverlay" class="lightboxOverlay"></div><div id="lightbox" class="lightbox"><div class="lb-outerContainer"><div class="lb-container"><img class="lb-image" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" /><div class="lb-nav"><a class="lb-prev" href="" ></a><a class="lb-next" href="" ></a></div><div class="lb-loader"><a class="lb-cancel"></a></div></div></div><div class="lb-dataContainer"><div class="lb-data"><div class="lb-details"><span class="lb-caption"></span><span class="lb-number"></span></div><div class="lb-closeContainer"><a class="lb-close"></a></div></div></div></div>').appendTo(e("body")),this.$lightbox=e("#lightbox"),this.$overlay=e("#lightboxOverlay"),this.$outerContainer=this.$lightbox.find(".lb-outerContainer"),this.$container=this.$lightbox.find(".lb-container"),this.containerTopPadding=parseInt(this.$container.css("padding-top"),10),this.containerRightPadding=parseInt(this.$container.css("padding-right"),10),this.containerBottomPadding=parseInt(this.$container.css("padding-bottom"),10),this.containerLeftPadding=parseInt(this.$container.css("padding-left"),10),this.$overlay.hide().on("click",function(){return t.end(),!1}),this.$lightbox.hide().on("click",function(i){return"lightbox"===e(i.target).attr("id")&&t.end(),!1}),this.$outerContainer.on("click",function(i){return"lightbox"===e(i.target).attr("id")&&t.end(),!1}),this.$lightbox.find(".lb-prev").on("click",function(){return 0===t.currentImageIndex?t.changeImage(t.album.length-1):t.changeImage(t.currentImageIndex-1),!1}),this.$lightbox.find(".lb-next").on("click",function(){return t.currentImageIndex===t.album.length-1?t.changeImage(0):t.changeImage(t.currentImageIndex+1),!1}),this.$lightbox.find(".lb-loader, .lb-close").on("click",function(){return t.end(),!1})},t.prototype.start=function(t){var i=this,s=e(window);s.on("resize",e.proxy(this.sizeOverlay,this)),e("select, object, embed").css({visibility:"hidden"}),this.sizeOverlay(),this.album=[];var o=0;function r(e){i.album.push({link:e.attr("href"),title:e.attr("data-title")||e.attr("title")})}var a,n=t.attr("data-lightbox");if(n){a=e(t.prop("tagName")+'[data-lightbox="'+n+'"]');for(var l=0;l<a.length;l=++l)r(e(a[l])),a[l]===t[0]&&(o=l)}else if("lightbox"===t.attr("rel"))r(t);else{a=e(t.prop("tagName")+'[rel="'+t.attr("rel")+'"]');for(var c=0;c<a.length;c=++c)r(e(a[c])),a[c]===t[0]&&(o=c)}var d=s.scrollTop()+this.options.positionFromTop,h=s.scrollLeft();this.$lightbox.css({top:d+"px",left:h+"px"}).fadeIn(this.options.fadeDuration),this.options.disableScrolling&&e("body").addClass("lb-disable-scrolling"),this.changeImage(o)},t.prototype.changeImage=function(t){var i=this;this.disableKeyboardNav();var s=this.$lightbox.find(".lb-image");this.$overlay.fadeIn(this.options.fadeDuration),e(".lb-loader").fadeIn("slow"),this.$lightbox.find(".lb-image, .lb-nav, .lb-prev, .lb-next, .lb-dataContainer, .lb-numbers, .lb-caption").hide(),this.$outerContainer.addClass("animating");var o=new Image;o.onload=function(){var r,a,n,l,c,d;s.attr("src",i.album[t].link),e(o),s.width(o.width),s.height(o.height),i.options.fitImagesInViewport&&(d=e(window).width(),c=e(window).height(),l=d-i.containerLeftPadding-i.containerRightPadding-20,n=c-i.containerTopPadding-i.containerBottomPadding-120,i.options.maxWidth&&i.options.maxWidth<l&&(l=i.options.maxWidth),i.options.maxHeight&&i.options.maxHeight<l&&(n=i.options.maxHeight),(o.width>l||o.height>n)&&(o.width/l>o.height/n?(a=l,r=parseInt(o.height/(o.width/a),10),s.width(a),s.height(r)):(r=n,a=parseInt(o.width/(o.height/r),10),s.width(a),s.height(r)))),i.sizeContainer(s.width(),s.height())},o.src=this.album[t].link,this.currentImageIndex=t},t.prototype.sizeOverlay=function(){this.$overlay.width(e(document).width()).height(e(document).height())},t.prototype.sizeContainer=function(e,t){var i=this,s=this.$outerContainer.outerWidth(),o=this.$outerContainer.outerHeight(),r=e+this.containerLeftPadding+this.containerRightPadding,a=t+this.containerTopPadding+this.containerBottomPadding;function n(){i.$lightbox.find(".lb-dataContainer").width(r),i.$lightbox.find(".lb-prevLink").height(a),i.$lightbox.find(".lb-nextLink").height(a),i.showImage()}s!==r||o!==a?this.$outerContainer.animate({width:r,height:a},this.options.resizeDuration,"swing",function(){n()}):n()},t.prototype.showImage=function(){this.$lightbox.find(".lb-loader").stop(!0).hide(),this.$lightbox.find(".lb-image").fadeIn("slow"),this.updateNav(),this.updateDetails(),this.preloadNeighboringImages(),this.enableKeyboardNav()},t.prototype.updateNav=function(){var e=!1;try{document.createEvent("TouchEvent"),e=!!this.options.alwaysShowNavOnTouchDevices}catch(e){}this.$lightbox.find(".lb-nav").show(),this.album.length>1&&(this.options.wrapAround?(e&&this.$lightbox.find(".lb-prev, .lb-next").css("opacity","1"),this.$lightbox.find(".lb-prev, .lb-next").show()):(this.currentImageIndex>0&&(this.$lightbox.find(".lb-prev").show(),e&&this.$lightbox.find(".lb-prev").css("opacity","1")),this.currentImageIndex<this.album.length-1&&(this.$lightbox.find(".lb-next").show(),e&&this.$lightbox.find(".lb-next").css("opacity","1"))))},t.prototype.updateDetails=function(){var t=this;if(void 0!==this.album[this.currentImageIndex].title&&""!==this.album[this.currentImageIndex].title&&this.$lightbox.find(".lb-caption").html(this.album[this.currentImageIndex].title).fadeIn("fast").find("a").on("click",function(t){void 0!==e(this).attr("target")?window.open(e(this).attr("href"),e(this).attr("target")):location.href=e(this).attr("href")}),this.album.length>1&&this.options.showImageNumberLabel){var i=this.imageCountLabel(this.currentImageIndex+1,this.album.length);this.$lightbox.find(".lb-number").text(i).fadeIn("fast")}else this.$lightbox.find(".lb-number").hide();this.$outerContainer.removeClass("animating"),this.$lightbox.find(".lb-dataContainer").fadeIn(this.options.resizeDuration,function(){return t.sizeOverlay()})},t.prototype.preloadNeighboringImages=function(){this.album.length>this.currentImageIndex+1&&((new Image).src=this.album[this.currentImageIndex+1].link);this.currentImageIndex>0&&((new Image).src=this.album[this.currentImageIndex-1].link)},t.prototype.enableKeyboardNav=function(){e(document).on("keyup.keyboard",e.proxy(this.keyboardAction,this))},t.prototype.disableKeyboardNav=function(){e(document).off(".keyboard")},t.prototype.keyboardAction=function(e){var t=e.keyCode,i=String.fromCharCode(t).toLowerCase();27===t||i.match(/x|o|c/)?this.end():"p"===i||37===t?0!==this.currentImageIndex?this.changeImage(this.currentImageIndex-1):this.options.wrapAround&&this.album.length>1&&this.changeImage(this.album.length-1):"n"!==i&&39!==t||(this.currentImageIndex!==this.album.length-1?this.changeImage(this.currentImageIndex+1):this.options.wrapAround&&this.album.length>1&&this.changeImage(0))},t.prototype.end=function(){this.disableKeyboardNav(),e(window).off("resize",this.sizeOverlay),this.$lightbox.fadeOut(this.options.fadeDuration),this.$overlay.fadeOut(this.options.fadeDuration),e("select, object, embed").css({visibility:"visible"}),this.options.disableScrolling&&e("body").removeClass("lb-disable-scrolling")},new t}),$(function(){var e=$("body");function t(e){if($("div.progressContent").removeClass("hidden"),$("div.progressContent > div.progress > div.progress-bar").attr("aria-valuenow",0),$("div.progressContent > div.progress > div.progress-bar").css("width","0%"),$("div.progressContent > div.progress > span.status").html(""),e.lengthComputable){var t=e.total,i=100*e.loaded/t;$("div.progressContent > div.progress > div.progress-bar").attr("aria-valuenow",i),$("div.progressContent > div.progress > div.progress-bar").css("width",i+"%"),i>100?$("div.progressContent").addClass("hidden"):$("div.progressContent > div.progress > span.status").html(Math.round(i)+"%")}}e.on("submit","form.frmDocAddFile",function(e){var i=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-id"),s=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-type"),o="form#"+i+"_"+s+"_frmDocUpload",r=$(o).data("upload-type"),a=new FormData($(o)[0]);$(o).data("savetype");a.append("docRelationType",s),a.append("relationId",i),a.append("docType",r),melisCoreTool.pending(".btn"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComDocument/saveDocument",data:a,processData:!1,cache:!1,contentType:!1,dataType:"json",xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",t,!1),e}}).done(function(e){if(e&&e.success){var t=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-type"),o=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-id");$("div.modal").modal("hide"),"file"==e.type?melisHelper.zoneReload(activeTabId+" #id_meliscommerce_documents_file_attachments_lists","meliscommerce_documents_file_attachments_lists",{docRelationType:t,docRelationId:o}):"image"==e.type&&melisHelper.zoneReload(activeTabId+" #id_meliscommerce_documents_image_lists","meliscommerce_documents_image_lists",{docRelationType:t,docRelationId:o}),melisCommerce.setUniqueId(melisCommerce.getUniqueId()),melisHelper.melisOkNotification(e.textTitle,e.textMessage)}else melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,i+"_"+s+"_frmDocUpload"),$("div.progressContent").addClass("hidden");melisCoreTool.done(".btn"),melisCore.flashMessenger()}).fail(function(){melisCoreTool.done(".btn"),melisHelper.melisKoNotification(translations.tr_meliscommerce_documents_Documents,translations.tr_meliscommerce_documents_save_fail,[],"closeByButtonOnly"),""!==$(o).find(".filestyle").val()&&("file"==r?melisHelper.zoneReload(activeTabId+" #id_meliscommerce_documents_file_attachments_lists","meliscommerce_documents_file_attachments_lists"):"image"==r&&melisHelper.zoneReload(activeTabId+" #id_meliscommerce_documents_image_lists","meliscommerce_documents_image_lists")),melisCore.flashMessenger()}),e.preventDefault()}),e.on("click",".deleteFileImageDocument",function(e){var t=$(this),i=t.data("doc-id"),s=t.data("type"),o=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-id"),r=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-type");if("image"==s)var a=translations.tr_meliscommerce_documents_delete_image_title,n=translations.tr_meliscommerce_documents_delete_image_msg_confirm;else if("file"==s)a=translations.tr_meliscommerce_documents_delete_file_title,n=translations.tr_meliscommerce_documents_delete_file_msg_confirm;melisCoreTool.confirm(translations.tr_meliscommerce_documents_common_label_yes,translations.tr_meliscommerce_documents_common_label_no,a,n,function(){$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComDocument/delete",data:{id:i,docType:s,formType:r,uniqueId:o},dataType:"json",encode:!0}).done(function(e){melisCoreTool.pending(".btn"),e&&e.success?("file"==s?melisHelper.zoneReload(activeTabId+" #id_meliscommerce_documents_file_attachments_lists","meliscommerce_documents_file_attachments_lists",{docRelationType:r,docRelationId:o}):"image"==s&&melisHelper.zoneReload(activeTabId+" #id_meliscommerce_documents_image_lists","meliscommerce_documents_image_lists",{docRelationType:r,docRelationId:o}),melisCore.flashMessenger(),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.done(".btn")}).fail(function(){$("div.modal").modal("hide"),melisCoreTool.done(".btn"),"file"==s?melisHelper.zoneReload(activeTabId+" #id_meliscommerce_documents_file_attachments_lists","meliscommerce_documents_file_attachments_lists"):"image"==s&&melisHelper.zoneReload(activeTabId+" #id_meliscommerce_documents_image_lists","meliscommerce_documents_image_lists"),melisCore.flashMessenger()})})}),e.on("click",".collapseAddImageType",function(){var e=$("div.addImageType");$("form.frmDocAddFile");e.slideToggle(),$(".collapseAddImageType").find("i[data-class='iconAddImageType']").toggleClass("fa-angle-down")}),e.on("click",".btnDocAddImageType",function(){var e=$(this),t=$("form.frmDocAddImageType").serialize(),i=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-id"),s=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-type"),o=$("form.frmDocAddImageType").data("upload-type"),r=e.parent().prev().parent().find("form.frmDocAddFile").serialize(),a=e.parent().prev().parent().find("img.imgDocThumbnail").attr("src");melisCommerce.postSave("melis/MelisCommerce/MelisComDocument/addImageType?typeUpload="+o,t,function(e){e.success?(melisHelper.zoneReload("id_meliscommerce_documents_modal_form","meliscommerce_documents_modal_form",{typeUpload:"image",saveType:o,docRelationId:i,docRelationType:s}),melisHelper.melisOkNotification(e.textTitle,e.textMessage),setTimeout(function(){$(".btnDocAddImageType").parent().prev().parent().find("img.imgDocThumbnail").attr("src",a),$.each(r.split("&"),function(e,t){var i=t.split("=");$("[name='"+i[0]+"']").val(i[1])})},2e3)):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"frmDocAddImageType")),melisCore.flashMessenger()})}),e.on("click",".btnDocAddFileType",function(){var e=$(this),t=$("form.frmDocAddImageType").serialize(),i=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-id"),s=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-type"),o=$("form.frmDocAddImageType").data("upload-type"),r=e.parent().prev().parent().find("form.frmDocAddFile").serialize();melisCommerce.postSave("melis/MelisCommerce/MelisComDocument/addFileType?typeUpload="+o,t,function(e){e.success?(melisHelper.zoneReload("id_meliscommerce_documents_modal_form","meliscommerce_documents_modal_form",{typeUpload:"file",saveType:o,docRelationId:i,docRelationType:s}),melisHelper.melisOkNotification(e.textTitle,e.textMessage),setTimeout(function(){$.each(r.split("&"),function(e,t){var i=t.split("=");$("[name='"+i[0]+"']").val(i[1])})},2e3)):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"frmDocAddImageType")),melisCore.flashMessenger()})}),e.on("click",".updateFileDocument",function(){var e=$(this),t=e.data("doc-id"),i=(e.data("type"),$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-id")),s=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-type");melisHelper.createModal("id_meliscommerce_documents_modal_form","meliscommerce_documents_modal_form",!1,{typeUpload:"file",docId:t,saveType:"updatefile",docRelationId:i,docRelationType:s},"/melis/MelisCommerce/MelisComDocument/renderDocumentGenericModalContainer")}),e.on("click",".editImageDocumentModal",function(){var e=$(this).data("doc-id"),t=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-id"),i=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-type");melisHelper.createModal("id_meliscommerce_documents_modal_form","meliscommerce_documents_modal_form",!1,{typeUpload:"image",docId:e,saveType:"editimage",docRelationId:t,docRelationType:i},"/melis/MelisCommerce/MelisComDocument/renderDocumentGenericModalContainer")}),e.on("click",".addFileImageDocument",function(e){var t=$(this).data("type"),i=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-id"),s=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-type");melisCoreTool.pending(this),melisHelper.createModal("id_meliscommerce_documents_modal_form","meliscommerce_documents_modal_form",!1,{typeUpload:t,docRelationId:i,docRelationType:s},"/melis/MelisCommerce/MelisComDocument/renderDocumentGenericModalContainer",function(){melisCoreTool.done(".addFileImageDocument")})}),e.on("click","#btnDocFileAdd",function(e){var t="#"+$(this).attr("form");$(t).trigger("submit"),e.preventDefault()})}),window.initImageDocuments=function(e){var t=$.support.touch?"touchstart":"click",i=$(e).find("div.imageDocumentContainer");i.imagesLoaded(function(){i.isotope({itemSelector:".image"})}),filters={},$body.on(t,".filter-div-country .filter-key-values li a",function(){var e=$(this).data("text");$(".filter-div-country .filter-dropdown").attr("data-value",e),$(".filter-div-country span.filter-key").text(e)}),$body.on(t,".filter-div-file-type .filter-key-values li a",function(){var e=$(this).data("text");$(".filter-div-file-type .filter-dropdown").attr("data-value",e),$(".filter-div-file-type span.filter-key").text(e)}),$(".documentImageFilter a").on(t,function(){var e=$(this),t=e.parents(".documentImageFilter"),s=t.attr("data-filter-group"),o=[];for(var r in $(".documentImageFilter .current").removeClass("current"),e.addClass("current"),t.find(".selected").removeClass("selected"),e.addClass("selected"),filters[s]=e.attr("data-filter-value"),filters)o.push(filters[r]);var a=o.join("");$grid=i.isotope({filter:a,animationOptions:{duration:750,easing:"linear",queue:!1}}),$grid.on("arrangeComplete",function(e,t){$(".viewImageDocument").attr("data-lightbox","deselected-images"),$.each(t,function(){$selectedImgElem=$(this.element).find(".viewImageDocument"),$selectedImgElem.attr("data-lightbox","selected-images")})}),lightbox.option({resizeDuration:200,wrapAround:!0})}),$(".documentImageFilter a").on(t,function(){var e=$(this),t=e.parents(".documentImageFilter"),s=t.attr("data-filter-group"),o=[];for(var r in $(".documentImageFilter .current").removeClass("current"),e.addClass("current"),t.find(".selected").removeClass("selected"),e.addClass("selected"),filters[s]=e.attr("data-filter-value"),filters)o.push(filters[r]);var a=o.join("");$grid=i.isotope({filter:a,animationOptions:{duration:750,easing:"linear",queue:!1}}),$grid.on("arrangeComplete",function(e,t){$(".viewImageDocument").attr("data-lightbox","deselected-images"),$.each(t,function(){$selectedImgElem=$(this.element).find(".viewImageDocument"),$selectedImgElem.attr("data-lightbox","selected-images")})}),lightbox.option({resizeDuration:200,wrapAround:!0})}),lightbox.option({resizeDuration:200,wrapAround:!0})},window.updateFormId=function(){var e=$("form.frmDocAddFile");melisCommerce.getUniqueId()&&e.attr("id",melisCommerce.getUniqueId()+"_frmDocUpload")},window.imagePreview=function(e,t){if(t.files&&t.files[0]){var i=new FileReader;i.onload=function(t){$(e).attr("src",t.target.result)},i.readAsDataURL(t.files[0])}},function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof module&&module.exports?module.exports=e(require("jquery")):e(jQuery)}(function(e,t){"use strict";if(!e.jstree){var i,s,o=0,r=!1,a=!1,n=!1,l=[],c=e("script:last").attr("src"),d=window.document,h=d.createElement("LI");h.setAttribute("role","treeitem"),(i=d.createElement("I")).className="jstree-icon jstree-ocl",i.setAttribute("role","presentation"),h.appendChild(i),(i=d.createElement("A")).className="jstree-anchor",i.setAttribute("href","#"),i.setAttribute("tabindex","-1"),(s=d.createElement("I")).className="jstree-icon jstree-themeicon",s.setAttribute("role","presentation"),i.appendChild(s),h.appendChild(i),i=s=null,e.jstree={version:"3.3.2",defaults:{plugins:[]},plugins:{},path:c&&-1!==c.indexOf("/")?c.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g,root:"#"},e.jstree.create=function(t,i){var s=new e.jstree.core(++o),r=i;return i=e.extend(!0,{},e.jstree.defaults,i),r&&r.plugins&&(i.plugins=r.plugins),e.each(i.plugins,function(e,t){"core"!==e&&(s=s.plugin(t,i[t]))}),e(t).data("jstree",s),s.init(t,i),s},e.jstree.destroy=function(){e(".jstree:jstree").jstree("destroy"),e(d).off(".jstree")},e.jstree.core=function(e){this._id=e,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},e.jstree.reference=function(t){var i=null,s=null;if(!t||!t.id||t.tagName&&t.nodeType||(t=t.id),!s||!s.length)try{s=e(t)}catch(e){}if(!s||!s.length)try{s=e("#"+t.replace(e.jstree.idregex,"\\$&"))}catch(e){}return s&&s.length&&(s=s.closest(".jstree")).length&&(s=s.data("jstree"))?i=s:e(".jstree").each(function(){var s=e(this).data("jstree");return s&&s._model.data[t]?(i=s,!1):void 0}),i},e.fn.jstree=function(i){var s="string"==typeof i,o=Array.prototype.slice.call(arguments,1),r=null;return!(!0===i&&!this.length)&&(this.each(function(){var a=e.jstree.reference(this),n=s&&a?a[i]:null;return r=s&&n?n.apply(a,o):null,a||s||i!==t&&!e.isPlainObject(i)||e.jstree.create(this,i),(a&&!s||!0===i)&&(r=a||!1),(null===r||r===t)&&void 0}),null!==r&&r!==t?r:this)},e.expr.pseudos.jstree=e.expr.createPseudo(function(i){return function(i){return e(i).hasClass("jstree")&&e(i).data("jstree")!==t}}),e.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:e.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0},e.jstree.core.prototype={plugin:function(t,i){var s=e.jstree.plugins[t];return s?(this._data[t]={},s.prototype=this,new s(i,this)):this},init:function(t,i){this._model={data:{},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this.element=e(t).addClass("jstree jstree-"+this._id),this.settings=i,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0),this.element.attr("tabindex")||this.element.attr("tabindex","0"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"),this._data.core.li_height=this.get_container_ul().children("li").first().height()||24,this.trigger("loading"),this.load_node(e.jstree.root)},destroy:function(e){if(this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(e){}e||this.element.empty(),this.teardown()},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),this.element=null},bind:function(){var t="",i=null,s=0;this.element.on("dblclick.jstree",function(e){if(e.target.tagName&&"input"===e.target.tagName.toLowerCase())return!0;if(d.selection&&d.selection.empty)d.selection.empty();else if(window.getSelection){var t=window.getSelection();try{t.removeAllRanges(),t.collapse()}catch(e){}}}).on("mousedown.jstree",e.proxy(function(e){e.target===this.element[0]&&(e.preventDefault(),s=+new Date)},this)).on("mousedown.jstree",".jstree-ocl",function(e){e.preventDefault()}).on("click.jstree",".jstree-ocl",e.proxy(function(e){this.toggle_node(e.target)},this)).on("dblclick.jstree",".jstree-anchor",e.proxy(function(e){return!(!e.target.tagName||"input"!==e.target.tagName.toLowerCase())||void(this.settings.core.dblclick_toggle&&this.toggle_node(e.target))},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){t.preventDefault(),t.currentTarget!==d.activeElement&&e(t.currentTarget).focus(),this.activate_node(t.currentTarget,t)},this)).on("keydown.jstree",".jstree-anchor",e.proxy(function(t){if(t.target.tagName&&"input"===t.target.tagName.toLowerCase())return!0;if(32!==t.which&&13!==t.which&&(t.shiftKey||t.ctrlKey||t.altKey||t.metaKey))return!0;var i=null;switch(this._data.core.rtl&&(37===t.which?t.which=39:39===t.which&&(t.which=37)),t.which){case 32:t.ctrlKey&&(t.type="click",e(t.currentTarget).trigger(t));break;case 13:t.type="click",e(t.currentTarget).trigger(t);break;case 37:t.preventDefault(),this.is_open(t.currentTarget)?this.close_node(t.currentTarget):(i=this.get_parent(t.currentTarget))&&i.id!==e.jstree.root&&this.get_node(i,!0).children(".jstree-anchor").focus();break;case 38:t.preventDefault(),(i=this.get_prev_dom(t.currentTarget))&&i.length&&i.children(".jstree-anchor").focus();break;case 39:t.preventDefault(),this.is_closed(t.currentTarget)?this.open_node(t.currentTarget,function(e){this.get_node(e,!0).children(".jstree-anchor").focus()}):this.is_open(t.currentTarget)&&((i=this.get_node(t.currentTarget,!0).children(".jstree-children")[0])&&e(this._firstChild(i)).children(".jstree-anchor").focus());break;case 40:t.preventDefault(),(i=this.get_next_dom(t.currentTarget))&&i.length&&i.children(".jstree-anchor").focus();break;case 106:this.open_all();break;case 36:t.preventDefault(),(i=this._firstChild(this.get_container_ul()[0]))&&e(i).children(".jstree-anchor").filter(":visible").focus();break;case 35:t.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().focus();break;case 113:t.preventDefault(),this.edit(t.currentTarget)}},this)).on("load_node.jstree",e.proxy(function(t,i){i.status&&(i.node.id!==e.jstree.root||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(e.proxy(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var t,i,s=[];for(t=0,i=this._data.core.selected.length;i>t;t++)s=s.concat(this._model.data[this._data.core.selected[t]].parents);for(t=0,i=(s=e.vakata.array_unique(s)).length;i>t;t++)this.open_node(s[t],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}},this),0))},this)).on("keypress.jstree",e.proxy(function(s){if(s.target.tagName&&"input"===s.target.tagName.toLowerCase())return!0;i&&clearTimeout(i),i=setTimeout(function(){t=""},500);var o=String.fromCharCode(s.which).toLowerCase(),r=this.element.find(".jstree-anchor").filter(":visible"),a=r.index(d.activeElement)||0,n=!1;if((t+=o).length>1){if(r.slice(a).each(e.proxy(function(i,s){return 0===e(s).text().toLowerCase().indexOf(t)?(e(s).focus(),n=!0,!1):void 0},this)),n)return;if(r.slice(0,a).each(e.proxy(function(i,s){return 0===e(s).text().toLowerCase().indexOf(t)?(e(s).focus(),n=!0,!1):void 0},this)),n)return}if(new RegExp("^"+o.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"+$").test(t)){if(r.slice(a+1).each(e.proxy(function(t,i){return e(i).text().toLowerCase().charAt(0)===o?(e(i).focus(),n=!0,!1):void 0},this)),n)return;if(r.slice(0,a+1).each(e.proxy(function(t,i){return e(i).text().toLowerCase().charAt(0)===o?(e(i).focus(),n=!0,!1):void 0},this)),n)return}},this)).on("init.jstree",e.proxy(function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots,this._data.core.themes.stripes=e.stripes,this._data.core.themes.icons=e.icons,this.set_theme(e.name||"default",e.url),this.set_theme_variant(e.variant)},this)).on("loading.jstree",e.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",e.proxy(function(t){this._data.core.focused=null,e(t.currentTarget).filter(".jstree-hovered").mouseleave(),this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",e.proxy(function(t){var i=this.get_node(t.currentTarget);i&&i.id&&(this._data.core.focused=i.id),this.element.find(".jstree-hovered").not(t.currentTarget).mouseleave(),e(t.currentTarget).mouseenter(),this.element.attr("tabindex","-1")},this)).on("focus.jstree",e.proxy(function(){if(+new Date-s>500&&!this._data.core.focused){s=0;var e=this.get_node(this.element.attr("aria-activedescendant"),!0);e&&e.find("> .jstree-anchor").focus()}},this)).on("mouseenter.jstree",".jstree-anchor",e.proxy(function(e){this.hover_node(e.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},unbind:function(){this.element.off(".jstree"),e(d).off(".jstree-"+this._id)},trigger:function(e,t){t||(t={}),t.instance=this,this.element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(t){var i=this.settings.core.strings;return e.isFunction(i)?i.call(this,t):i&&i[t]?i[t]:t},_firstChild:function(e){for(e=e?e.firstChild:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_nextSibling:function(e){for(e=e?e.nextSibling:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_previousSibling:function(e){for(e=e?e.previousSibling:null;null!==e&&1!==e.nodeType;)e=e.previousSibling;return e},get_node:function(t,i){var s;t&&t.id&&(t=t.id);try{if(this._model.data[t])t=this._model.data[t];else if("string"==typeof t&&this._model.data[t.replace(/^#/,"")])t=this._model.data[t.replace(/^#/,"")];else if("string"==typeof t&&(s=e("#"+t.replace(e.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[s.closest(".jstree-node").attr("id")])t=this._model.data[s.closest(".jstree-node").attr("id")];else if((s=e(t,this.element)).length&&this._model.data[s.closest(".jstree-node").attr("id")])t=this._model.data[s.closest(".jstree-node").attr("id")];else{if(!(s=e(t,this.element)).length||!s.hasClass("jstree"))return!1;t=this._model.data[e.jstree.root]}return i&&(t=t.id===e.jstree.root?this.element:e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)),t}catch(e){return!1}},get_path:function(t,i,s){if(!(t=t.parents?t:this.get_node(t))||t.id===e.jstree.root||!t.parents)return!1;var o,r,a=[];for(a.push(s?t.id:t.text),o=0,r=t.parents.length;r>o;o++)a.push(s?t.parents[o]:this.get_text(t.parents[o]));return a=a.reverse().slice(1),i?a.join(i):a},get_next_dom:function(t,i){var s;if((t=this.get_node(t,!0))[0]===this.element[0]){for(s=this._firstChild(this.get_container_ul()[0]);s&&0===s.offsetHeight;)s=this._nextSibling(s);return!!s&&e(s)}if(!t||!t.length)return!1;if(i){s=t[0];do{s=this._nextSibling(s)}while(s&&0===s.offsetHeight);return!!s&&e(s)}if(t.hasClass("jstree-open")){for(s=this._firstChild(t.children(".jstree-children")[0]);s&&0===s.offsetHeight;)s=this._nextSibling(s);if(null!==s)return e(s)}s=t[0];do{s=this._nextSibling(s)}while(s&&0===s.offsetHeight);return null!==s?e(s):t.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(t,i){var s;if((t=this.get_node(t,!0))[0]===this.element[0]){for(s=this.get_container_ul()[0].lastChild;s&&0===s.offsetHeight;)s=this._previousSibling(s);return!!s&&e(s)}if(!t||!t.length)return!1;if(i){s=t[0];do{s=this._previousSibling(s)}while(s&&0===s.offsetHeight);return!!s&&e(s)}s=t[0];do{s=this._previousSibling(s)}while(s&&0===s.offsetHeight);if(null!==s){for(t=e(s);t.hasClass("jstree-open");)t=t.children(".jstree-children").first().children(".jstree-node:visible:last");return t}return!(!(s=t[0].parentNode.parentNode)||!s.className||-1===s.className.indexOf("jstree-node"))&&e(s)},get_parent:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.parent},get_children_dom:function(e){return(e=this.get_node(e,!0))[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):!(!e||!e.length)&&e.children(".jstree-children").children(".jstree-node")},is_parent:function(e){return(e=this.get_node(e))&&(!1===e.state.loaded||e.children.length>0)},is_loaded:function(e){return(e=this.get_node(e))&&e.state.loaded},is_loading:function(e){return(e=this.get_node(e))&&e.state&&e.state.loading},is_open:function(e){return(e=this.get_node(e))&&e.state.opened},is_closed:function(e){return(e=this.get_node(e))&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(t,i){var s,o,r,a,n;if(e.isArray(t))return this._load_nodes(t.slice(),i),!0;if(!(t=this.get_node(t)))return i&&i.call(this,t,!1),!1;if(t.state.loaded){for(t.state.loaded=!1,r=0,a=t.parents.length;a>r;r++)this._model.data[t.parents[r]].children_d=e.vakata.array_filter(this._model.data[t.parents[r]].children_d,function(i){return-1===e.inArray(i,t.children_d)});for(s=0,o=t.children_d.length;o>s;s++)this._model.data[t.children_d[s]].state.selected&&(n=!0),delete this._model.data[t.children_d[s]];n&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,function(i){return-1===e.inArray(i,t.children_d)})),t.children=[],t.children_d=[],n&&this.trigger("changed",{action:"load_node",node:t,selected:this._data.core.selected})}return t.state.failed=!1,t.state.loading=!0,this.get_node(t,!0).addClass("jstree-loading").attr("aria-busy",!0),this._load_node(t,e.proxy(function(e){(t=this._model.data[t.id]).state.loading=!1,t.state.loaded=e,t.state.failed=!t.state.loaded;var s,o=this.get_node(t,!0),r=0,a=this._model.data,n=!1;for(r=0,s=t.children.length;s>r;r++)if(a[t.children[r]]&&!a[t.children[r]].state.hidden){n=!0;break}t.state.loaded&&o&&o.length&&(o.removeClass("jstree-closed jstree-open jstree-leaf"),n?"#"!==t.id&&o.addClass(t.state.opened?"jstree-open":"jstree-closed"):o.addClass("jstree-leaf")),o.removeClass("jstree-loading").attr("aria-busy",!1),this.trigger("load_node",{node:t,status:e}),i&&i.call(this,t,e)},this)),!0},_load_nodes:function(e,t,i,s){var o,r,a=!0,n=function(){this._load_nodes(e,t,!0)},l=this._model.data,c=[];for(o=0,r=e.length;r>o;o++)l[e[o]]&&(!l[e[o]].state.loaded&&!l[e[o]].state.failed||!i&&s)&&(this.is_loading(e[o])||this.load_node(e[o],n),a=!1);if(a){for(o=0,r=e.length;r>o;o++)l[e[o]]&&l[e[o]].state.loaded&&c.push(e[o]);t&&!t.done&&(t.call(this,c),t.done=!0)}},load_all:function(t,i){if(t||(t=e.jstree.root),!(t=this.get_node(t)))return!1;var s,o,r=[],a=this._model.data,n=a[t.id].children_d;for(t.state&&!t.state.loaded&&r.push(t.id),s=0,o=n.length;o>s;s++)a[n[s]]&&a[n[s]].state&&!a[n[s]].state.loaded&&r.push(n[s]);r.length?this._load_nodes(r,function(){this.load_all(t,i)}):(i&&i.call(this,t),this.trigger("load_all",{node:t}))},_load_node:function(t,i){var s,o=this.settings.core.data,r=function(){return 3!==this.nodeType&&8!==this.nodeType};return o?e.isFunction(o)?o.call(this,t,e.proxy(function(s){!1===s?i.call(this,!1):this["string"==typeof s?"_append_html_data":"_append_json_data"](t,"string"==typeof s?e(e.parseHTML(s)).filter(r):s,function(e){i.call(this,e)})},this)):"object"==typeof o?o.url?(o=e.extend(!0,{},o),e.isFunction(o.url)&&(o.url=o.url.call(this,t)),e.isFunction(o.data)&&(o.data=o.data.call(this,t)),e.ajax(o).done(e.proxy(function(s,o,a){var n=a.getResponseHeader("Content-Type");return n&&-1!==n.indexOf("json")||"object"==typeof s?this._append_json_data(t,s,function(e){i.call(this,e)}):n&&-1!==n.indexOf("html")||"string"==typeof s?this._append_html_data(t,e(e.parseHTML(s)).filter(r),function(e){i.call(this,e)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:a})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))},this)).fail(e.proxy(function(e){i.call(this,!1),this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:e})},this.settings.core.error.call(this,this._data.core.last_error)},this))):(s=e.isArray(o)||e.isPlainObject(o)?JSON.parse(JSON.stringify(o)):o,t.id===e.jstree.root?this._append_json_data(t,s,function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))):"string"==typeof o?t.id===e.jstree.root?this._append_html_data(t,e(e.parseHTML(o)).filter(r),function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1)):i.call(this,!1):t.id===e.jstree.root?this._append_html_data(t,this._data.core.original_container_html.clone(!0),function(e){i.call(this,e)}):i.call(this,!1)},_node_changed:function(e){(e=this.get_node(e))&&this._model.changed.push(e.id)},_append_html_data:function(t,i,s){(t=this.get_node(t)).children=[],t.children_d=[];var o,r,a,n=i.is("ul")?i.children():i,l=t.id,c=[],d=[],h=this._model.data,m=h[l],u=this._data.core.selected.length;for(n.each(e.proxy(function(t,i){(o=this._parse_model_from_html(e(i),l,m.parents.concat()))&&(c.push(o),d.push(o),h[o].children_d.length&&(d=d.concat(h[o].children_d)))},this)),m.children=c,m.children_d=d,r=0,a=m.parents.length;a>r;r++)h[m.parents[r]].children_d=h[m.parents[r]].children_d.concat(d);this.trigger("model",{nodes:d,parent:l}),l!==e.jstree.root?(this._node_changed(l),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==u&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),s.call(this,!0)},_append_json_data:function(t,i,s,o){if(null!==this.element){(t=this.get_node(t)).children=[],t.children_d=[],i.d&&("string"==typeof(i=i.d)&&(i=JSON.parse(i))),e.isArray(i)||(i=[i]);var r=null,a={df:this._model.default_state,dat:i,par:t.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},n=function(e,t){e.data&&(e=e.data);var i,s,o,r,a=e.dat,n=e.par,l=[],c=[],d=[],h=e.df,m=e.t_id,u=e.t_cnt,p=e.m,_=p[n],f=e.sel,g=function(e,i,s){s=s?s.concat():[],i&&s.unshift(i);var o,r,a,n,l=e.id.toString(),c={id:l,text:e.text||"",icon:e.icon===t||e.icon,parent:i,parents:s,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(o in h)h.hasOwnProperty(o)&&(c.state[o]=h[o]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(c.icon=e.data.jstree.icon),(c.icon===t||null===c.icon||""===c.icon)&&(c.icon=!0),e&&e.data&&(c.data=e.data,e.data.jstree))for(o in e.data.jstree)e.data.jstree.hasOwnProperty(o)&&(c.state[o]=e.data.jstree[o]);if(e&&"object"==typeof e.state)for(o in e.state)e.state.hasOwnProperty(o)&&(c.state[o]=e.state[o]);if(e&&"object"==typeof e.li_attr)for(o in e.li_attr)e.li_attr.hasOwnProperty(o)&&(c.li_attr[o]=e.li_attr[o]);if(c.li_attr.id||(c.li_attr.id=l),e&&"object"==typeof e.a_attr)for(o in e.a_attr)e.a_attr.hasOwnProperty(o)&&(c.a_attr[o]=e.a_attr[o]);for(e&&e.children&&!0===e.children&&(c.state.loaded=!1,c.children=[],c.children_d=[]),p[c.id]=c,o=0,r=c.children.length;r>o;o++)a=g(p[c.children[o]],c.id,s),n=p[a],c.children_d.push(a),n.children_d.length&&(c.children_d=c.children_d.concat(n.children_d));return delete e.data,delete e.children,p[c.id].original=e,c.state.selected&&d.push(c.id),c.id},v=function(e,i,s){s=s?s.concat():[],i&&s.unshift(i);var o,r,a,n,l,c=!1;do{c="j"+m+"_"+ ++u}while(p[c]);for(o in l={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:i,parents:s,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},h)h.hasOwnProperty(o)&&(l.state[o]=h[o]);if(e&&e.id&&(l.id=e.id.toString()),e&&e.text&&(l.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),(l.icon===t||null===l.icon||""===l.icon)&&(l.icon=!0),e&&e.data&&(l.data=e.data,e.data.jstree))for(o in e.data.jstree)e.data.jstree.hasOwnProperty(o)&&(l.state[o]=e.data.jstree[o]);if(e&&"object"==typeof e.state)for(o in e.state)e.state.hasOwnProperty(o)&&(l.state[o]=e.state[o]);if(e&&"object"==typeof e.li_attr)for(o in e.li_attr)e.li_attr.hasOwnProperty(o)&&(l.li_attr[o]=e.li_attr[o]);if(l.li_attr.id&&!l.id&&(l.id=l.li_attr.id.toString()),l.id||(l.id=c),l.li_attr.id||(l.li_attr.id=l.id),e&&"object"==typeof e.a_attr)for(o in e.a_attr)e.a_attr.hasOwnProperty(o)&&(l.a_attr[o]=e.a_attr[o]);if(e&&e.children&&e.children.length){for(o=0,r=e.children.length;r>o;o++)a=v(e.children[o],l.id,s),n=p[a],l.children.push(a),n.children_d.length&&(l.children_d=l.children_d.concat(n.children_d));l.children_d=l.children_d.concat(l.children)}return e&&e.children&&!0===e.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),delete e.data,delete e.children,l.original=e,p[l.id]=l,l.state.selected&&d.push(l.id),l.id};if(a.length&&a[0].id!==t&&a[0].parent!==t){for(s=0,o=a.length;o>s;s++)a[s].children||(a[s].children=[]),p[a[s].id.toString()]=a[s];for(s=0,o=a.length;o>s;s++)p[a[s].parent.toString()].children.push(a[s].id.toString()),_.children_d.push(a[s].id.toString());for(s=0,o=_.children.length;o>s;s++)i=g(p[_.children[s]],n,_.parents.concat()),c.push(i),p[i].children_d.length&&(c=c.concat(p[i].children_d));for(s=0,o=_.parents.length;o>s;s++)p[_.parents[s]].children_d=p[_.parents[s]].children_d.concat(c);r={cnt:u,mod:p,sel:f,par:n,dpc:c,add:d}}else{for(s=0,o=a.length;o>s;s++)(i=v(a[s],n,_.parents.concat()))&&(l.push(i),c.push(i),p[i].children_d.length&&(c=c.concat(p[i].children_d)));for(_.children=l,_.children_d=c,s=0,o=_.parents.length;o>s;s++)p[_.parents[s]].children_d=p[_.parents[s]].children_d.concat(c);r={cnt:u,mod:p,sel:f,par:n,dpc:c,add:d}}return"undefined"!=typeof window&&void 0!==window.document?r:void postMessage(r)},l=function(t,i){if(null!==this.element){this._cnt=t.cnt;var o,r=this._model.data;for(o in r)r.hasOwnProperty(o)&&r[o].state&&r[o].state.loading&&t.mod[o]&&(t.mod[o].state.loading=!0);if(this._model.data=t.mod,i){var a,n=t.add,l=t.sel,c=this._data.core.selected.slice();if(r=this._model.data,l.length!==c.length||e.vakata.array_unique(l.concat(c)).length!==l.length){for(o=0,a=l.length;a>o;o++)-1===e.inArray(l[o],n)&&-1===e.inArray(l[o],c)&&(r[l[o]].state.selected=!1);for(o=0,a=c.length;a>o;o++)-1===e.inArray(c[o],l)&&(r[c[o]].state.selected=!0)}}t.add.length&&(this._data.core.selected=this._data.core.selected.concat(t.add)),this.trigger("model",{nodes:t.dpc,parent:t.par}),t.par!==e.jstree.root?(this._node_changed(t.par),this.redraw()):this.redraw(!0),t.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),s.call(this,!0)}};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+n.toString()],{type:"text/javascript"}))),!this._data.core.working||o?(this._data.core.working=!0,(r=new window.Worker(this._wrk)).onmessage=e.proxy(function(e){l.call(this,e.data,!0);try{r.terminate(),r=null}catch(e){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),a.par?r.postMessage(a):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([t,i,s,!0])}catch(e){l.call(this,n(a),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else l.call(this,n(a),!1)}},_parse_model_from_html:function(i,s,o){o=o?[].concat(o):[],s&&o.unshift(s);var r,a,n,l,c,d=this._model.data,h={id:!1,text:!1,icon:!0,parent:s,parents:o,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(n in this._model.default_state)this._model.default_state.hasOwnProperty(n)&&(h.state[n]=this._model.default_state[n]);if(l=e.vakata.attributes(i,!0),e.each(l,function(t,i){return!(i=e.trim(i)).length||(h.li_attr[t]=i,void("id"===t&&(h.id=i.toString())))}),(l=i.children("a").first()).length&&(l=e.vakata.attributes(l,!0),e.each(l,function(t,i){(i=e.trim(i)).length&&(h.a_attr[t]=i)})),(l=i.children("a").first().length?i.children("a").first().clone():i.clone()).children("ins, i, ul").remove(),l=l.html(),l=e("<div />").html(l),h.text=this.settings.core.force_text?l.text():l.html(),l=i.data(),h.data=l?e.extend(!0,{},l):null,h.state.opened=i.hasClass("jstree-open"),h.state.selected=i.children("a").hasClass("jstree-clicked"),h.state.disabled=i.children("a").hasClass("jstree-disabled"),h.data&&h.data.jstree)for(n in h.data.jstree)h.data.jstree.hasOwnProperty(n)&&(h.state[n]=h.data.jstree[n]);(l=i.children("a").children(".jstree-themeicon")).length&&(h.icon=!l.hasClass("jstree-themeicon-hidden")&&l.attr("rel")),h.state.icon!==t&&(h.icon=h.state.icon),(h.icon===t||null===h.icon||""===h.icon)&&(h.icon=!0),l=i.children("ul").children("li");do{c="j"+this._id+"_"+ ++this._cnt}while(d[c]);return h.id=h.li_attr.id?h.li_attr.id.toString():c,l.length?(l.each(e.proxy(function(t,i){r=this._parse_model_from_html(e(i),h.id,o),a=this._model.data[r],h.children.push(r),a.children_d.length&&(h.children_d=h.children_d.concat(a.children_d))},this)),h.children_d=h.children_d.concat(h.children)):i.hasClass("jstree-closed")&&(h.state.loaded=!1),h.li_attr.class&&(h.li_attr.class=h.li_attr.class.replace("jstree-closed","").replace("jstree-open","")),h.a_attr.class&&(h.a_attr.class=h.a_attr.class.replace("jstree-clicked","").replace("jstree-disabled","")),d[h.id]=h,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_flat_json:function(e,i,s){s=s?s.concat():[],i&&s.unshift(i);var o,r,a,n,l=e.id.toString(),c=this._model.data,d=this._model.default_state,h={id:l,text:e.text||"",icon:e.icon===t||e.icon,parent:i,parents:s,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(o in d)d.hasOwnProperty(o)&&(h.state[o]=d[o]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(h.icon=e.data.jstree.icon),(h.icon===t||null===h.icon||""===h.icon)&&(h.icon=!0),e&&e.data&&(h.data=e.data,e.data.jstree))for(o in e.data.jstree)e.data.jstree.hasOwnProperty(o)&&(h.state[o]=e.data.jstree[o]);if(e&&"object"==typeof e.state)for(o in e.state)e.state.hasOwnProperty(o)&&(h.state[o]=e.state[o]);if(e&&"object"==typeof e.li_attr)for(o in e.li_attr)e.li_attr.hasOwnProperty(o)&&(h.li_attr[o]=e.li_attr[o]);if(h.li_attr.id||(h.li_attr.id=l),e&&"object"==typeof e.a_attr)for(o in e.a_attr)e.a_attr.hasOwnProperty(o)&&(h.a_attr[o]=e.a_attr[o]);for(e&&e.children&&!0===e.children&&(h.state.loaded=!1,h.children=[],h.children_d=[]),c[h.id]=h,o=0,r=h.children.length;r>o;o++)n=c[a=this._parse_model_from_flat_json(c[h.children[o]],h.id,s)],h.children_d.push(a),n.children_d.length&&(h.children_d=h.children_d.concat(n.children_d));return delete e.data,delete e.children,c[h.id].original=e,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_json:function(e,i,s){s=s?s.concat():[],i&&s.unshift(i);var o,r,a,n,l,c=!1,d=this._model.data,h=this._model.default_state;do{c="j"+this._id+"_"+ ++this._cnt}while(d[c]);for(o in l={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:i,parents:s,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},h)h.hasOwnProperty(o)&&(l.state[o]=h[o]);if(e&&e.id&&(l.id=e.id.toString()),e&&e.text&&(l.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),(l.icon===t||null===l.icon||""===l.icon)&&(l.icon=!0),e&&e.data&&(l.data=e.data,e.data.jstree))for(o in e.data.jstree)e.data.jstree.hasOwnProperty(o)&&(l.state[o]=e.data.jstree[o]);if(e&&"object"==typeof e.state)for(o in e.state)e.state.hasOwnProperty(o)&&(l.state[o]=e.state[o]);if(e&&"object"==typeof e.li_attr)for(o in e.li_attr)e.li_attr.hasOwnProperty(o)&&(l.li_attr[o]=e.li_attr[o]);if(l.li_attr.id&&!l.id&&(l.id=l.li_attr.id.toString()),l.id||(l.id=c),l.li_attr.id||(l.li_attr.id=l.id),e&&"object"==typeof e.a_attr)for(o in e.a_attr)e.a_attr.hasOwnProperty(o)&&(l.a_attr[o]=e.a_attr[o]);if(e&&e.children&&e.children.length){for(o=0,r=e.children.length;r>o;o++)n=d[a=this._parse_model_from_json(e.children[o],l.id,s)],l.children.push(a),n.children_d.length&&(l.children_d=l.children_d.concat(n.children_d));l.children_d=l.children_d.concat(l.children)}return e&&e.children&&!0===e.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),delete e.data,delete e.children,l.original=e,d[l.id]=l,l.state.selected&&this._data.core.selected.push(l.id),l.id},_redraw:function(){var t,i,s,o=this._model.force_full_redraw?this._model.data[e.jstree.root].children.concat([]):this._model.changed.concat([]),r=d.createElement("UL"),a=this._data.core.focused;for(i=0,s=o.length;s>i;i++)(t=this.redraw_node(o[i],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&r.appendChild(t);this._model.force_full_redraw&&(r.className=this.get_container_ul()[0].className,r.setAttribute("role","group"),this.element.empty().append(r)),null!==a&&((t=this.get_node(a,!0))&&t.length&&t.children(".jstree-anchor")[0]!==d.activeElement?t.children(".jstree-anchor").focus():this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:o})},redraw:function(e){e&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(t){var i=this.get_node(t),s=!1,o=!1,r=!1,a=d;if(!i)return!1;if(i.id===e.jstree.root)return this.redraw(!0);if(!(t=this.get_node(t,!0))||!t.length)return!1;if(t.children(".jstree-children").remove(),t=t[0],i.children.length&&i.state.loaded){for((r=a.createElement("UL")).setAttribute("role","group"),r.className="jstree-children",s=0,o=i.children.length;o>s;s++)r.appendChild(this.redraw_node(i.children[s],!0,!0));t.appendChild(r)}},redraw_node:function(t,i,s,o){var r=this.get_node(t),a=!1,n=!1,l=!1,c=!1,m=!1,u=!1,p="",_=d,f=this._model.data,g=!1,v=null,b=0,y=0,C=!1,x=!1;if(!r)return!1;if(r.id===e.jstree.root)return this.redraw(!0);if(i=i||0===r.children.length,t=d.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(r.id[0])?"\\3"+r.id[0]+" "+r.id.substr(1).replace(e.jstree.idregex,"\\$&"):r.id.replace(e.jstree.idregex,"\\$&"))):d.getElementById(r.id))t=e(t),s||((a=t.parent().parent()[0])===this.element[0]&&(a=null),n=t.index()),i||!r.children.length||t.children(".jstree-children").length||(i=!0),i||(l=t.children(".jstree-children")[0]),g=t.children(".jstree-anchor")[0]===d.activeElement,t.remove();else if(i=!0,!s){if(!(null===(a=r.parent!==e.jstree.root?e("#"+r.parent.replace(e.jstree.idregex,"\\$&"),this.element)[0]:null)||a&&f[r.parent].state.opened))return!1;n=e.inArray(r.id,null===a?f[e.jstree.root].children:f[r.parent].children)}for(c in t=h.cloneNode(!0),p="jstree-node ",r.li_attr)if(r.li_attr.hasOwnProperty(c)){if("id"===c)continue;"class"!==c?t.setAttribute(c,r.li_attr[c]):p+=r.li_attr[c]}for(r.a_attr.id||(r.a_attr.id=r.id+"_anchor"),t.setAttribute("aria-selected",!!r.state.selected),t.setAttribute("aria-level",r.parents.length),t.setAttribute("aria-labelledby",r.a_attr.id),r.state.disabled&&t.setAttribute("aria-disabled",!0),c=0,m=r.children.length;m>c;c++)if(!f[r.children[c]].state.hidden){C=!0;break}if(null!==r.parent&&f[r.parent]&&!r.state.hidden&&(c=e.inArray(r.id,f[r.parent].children),x=r.id,-1!==c))for(c++,m=f[r.parent].children.length;m>c&&(f[f[r.parent].children[c]].state.hidden||(x=f[r.parent].children[c]),x===r.id);c++);for(m in r.state.hidden&&(p+=" jstree-hidden"),r.state.loaded&&!C?p+=" jstree-leaf":(p+=r.state.opened&&r.state.loaded?" jstree-open":" jstree-closed",t.setAttribute("aria-expanded",r.state.opened&&r.state.loaded)),x===r.id&&(p+=" jstree-last"),t.id=r.id,t.className=p,p=(r.state.selected?" jstree-clicked":"")+(r.state.disabled?" jstree-disabled":""),r.a_attr)if(r.a_attr.hasOwnProperty(m)){if("href"===m&&"#"===r.a_attr[m])continue;"class"!==m?t.childNodes[1].setAttribute(m,r.a_attr[m]):p+=" "+r.a_attr[m]}if(p.length&&(t.childNodes[1].className="jstree-anchor "+p),(r.icon&&!0!==r.icon||!1===r.icon)&&(!1===r.icon?t.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===r.icon.indexOf("/")&&-1===r.icon.indexOf(".")?t.childNodes[1].childNodes[0].className+=" "+r.icon+" jstree-themeicon-custom":(t.childNodes[1].childNodes[0].style.backgroundImage='url("'+r.icon+'")',t.childNodes[1].childNodes[0].style.backgroundPosition="center center",t.childNodes[1].childNodes[0].style.backgroundSize="auto",t.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?t.childNodes[1].appendChild(_.createTextNode(r.text)):t.childNodes[1].innerHTML+=r.text,i&&r.children.length&&(r.state.opened||o)&&r.state.loaded){for((u=_.createElement("UL")).setAttribute("role","group"),u.className="jstree-children",c=0,m=r.children.length;m>c;c++)u.appendChild(this.redraw_node(r.children[c],i,!0));t.appendChild(u)}if(l&&t.appendChild(l),!s){for(a||(a=this.element[0]),c=0,m=a.childNodes.length;m>c;c++)if(a.childNodes[c]&&a.childNodes[c].className&&-1!==a.childNodes[c].className.indexOf("jstree-children")){v=a.childNodes[c];break}v||((v=_.createElement("UL")).setAttribute("role","group"),v.className="jstree-children",a.appendChild(v)),n<(a=v).childNodes.length?a.insertBefore(t,a.childNodes[n]):a.appendChild(t),g&&(b=this.element[0].scrollTop,y=this.element[0].scrollLeft,t.childNodes[1].focus(),this.element[0].scrollTop=b,this.element[0].scrollLeft=y)}return r.state.opened&&!r.state.loaded&&(r.state.opened=!1,setTimeout(e.proxy(function(){this.open_node(r.id,!1,0)},this),0)),t},open_node:function(i,s,o){var r,a,n,l;if(e.isArray(i)){for(r=0,a=(i=i.slice()).length;a>r;r++)this.open_node(i[r],s,o);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root)&&(o=o===t?this.settings.core.animation:o,this.is_closed(i)?this.is_loaded(i)?(n=this.get_node(i,!0),l=this,n.length&&(o&&n.children(".jstree-children").length&&n.children(".jstree-children").stop(!0,!0),i.children.length&&!this._firstChild(n.children(".jstree-children")[0])&&this.draw_children(i),o?(this.trigger("before_open",{node:i}),n.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(o,function(){this.style.display="",l.element&&l.trigger("after_open",{node:i})})):(this.trigger("before_open",{node:i}),n[0].className=n[0].className.replace("jstree-closed","jstree-open"),n[0].setAttribute("aria-expanded",!0))),i.state.opened=!0,s&&s.call(this,i,!0),n.length||this.trigger("before_open",{node:i}),this.trigger("open_node",{node:i}),o&&n.length||this.trigger("after_open",{node:i}),!0):this.is_loading(i)?setTimeout(e.proxy(function(){this.open_node(i,s,o)},this),500):void this.load_node(i,function(e,t){return t?this.open_node(e,s,o):!!s&&s.call(this,e,!1)}):(s&&s.call(this,i,!1),!1))},_open_to:function(t){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;var i,s,o=t.parents;for(i=0,s=o.length;s>i;i+=1)i!==e.jstree.root&&this.open_node(o[i],!1,0);return e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)},close_node:function(i,s){var o,r,a,n;if(e.isArray(i)){for(o=0,r=(i=i.slice()).length;r>o;o++)this.close_node(i[o],s);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root)&&(!this.is_closed(i)&&(s=s===t?this.settings.core.animation:s,a=this,n=this.get_node(i,!0),i.state.opened=!1,this.trigger("close_node",{node:i}),void(n.length?s?n.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(s,function(){this.style.display="",n.children(".jstree-children").remove(),a.element&&a.trigger("after_close",{node:i})}):(n[0].className=n[0].className.replace("jstree-open","jstree-closed"),n.attr("aria-expanded",!1).children(".jstree-children").remove(),this.trigger("after_close",{node:i})):this.trigger("after_close",{node:i}))))},toggle_node:function(t){var i,s;if(e.isArray(t)){for(i=0,s=(t=t.slice()).length;s>i;i++)this.toggle_node(t[i]);return!0}return this.is_closed(t)?this.open_node(t):this.is_open(t)?this.close_node(t):void 0},open_all:function(t,i,s){if(t||(t=e.jstree.root),!(t=this.get_node(t)))return!1;var o,r,a,n=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0);if(!n.length){for(o=0,r=t.children_d.length;r>o;o++)this.is_closed(this._model.data[t.children_d[o]])&&(this._model.data[t.children_d[o]].state.opened=!0);return this.trigger("open_all",{node:t})}s=s||n,a=this,(n=this.is_closed(t)?n.find(".jstree-closed").addBack():n.find(".jstree-closed")).each(function(){a.open_node(this,function(e,t){t&&this.is_parent(e)&&this.open_all(e,i,s)},i||0)}),0===s.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(s)})},close_all:function(t,i){if(t||(t=e.jstree.root),!(t=this.get_node(t)))return!1;var s,o,r=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0),a=this;for(r.length&&(r=this.is_open(t)?r.find(".jstree-open").addBack():r.find(".jstree-open"),e(r.get().reverse()).each(function(){a.close_node(this,i||0)})),s=0,o=t.children_d.length;o>s;s++)this._model.data[t.children_d[s]].state.opened=!1;this.trigger("close_all",{node:t})},is_disabled:function(e){return(e=this.get_node(e))&&e.state&&e.state.disabled},enable_node:function(t){var i,s;if(e.isArray(t)){for(i=0,s=(t=t.slice()).length;s>i;i++)this.enable_node(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(t.state.disabled=!1,this.get_node(t,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1),void this.trigger("enable_node",{node:t}))},disable_node:function(t){var i,s;if(e.isArray(t)){for(i=0,s=(t=t.slice()).length;s>i;i++)this.disable_node(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(t.state.disabled=!0,this.get_node(t,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0),void this.trigger("disable_node",{node:t}))},is_hidden:function(e){return!0===(e=this.get_node(e)).state.hidden},hide_node:function(t,i){var s,o;if(e.isArray(t)){for(s=0,o=(t=t.slice()).length;o>s;s++)this.hide_node(t[s],!0);return i||this.redraw(),!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&void(t.state.hidden||(t.state.hidden=!0,this._node_changed(t.parent),i||this.redraw(),this.trigger("hide_node",{node:t})))},show_node:function(t,i){var s,o;if(e.isArray(t)){for(s=0,o=(t=t.slice()).length;o>s;s++)this.show_node(t[s],!0);return i||this.redraw(),!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&void(t.state.hidden&&(t.state.hidden=!1,this._node_changed(t.parent),i||this.redraw(),this.trigger("show_node",{node:t})))},hide_all:function(t){var i,s=this._model.data,o=[];for(i in s)s.hasOwnProperty(i)&&i!==e.jstree.root&&!s[i].state.hidden&&(s[i].state.hidden=!0,o.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("hide_all",{nodes:o}),o},show_all:function(t){var i,s=this._model.data,o=[];for(i in s)s.hasOwnProperty(i)&&i!==e.jstree.root&&s[i].state.hidden&&(s[i].state.hidden=!1,o.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("show_all",{nodes:o}),o},activate_node:function(e,i){if(this.is_disabled(e))return!1;if(i&&"object"==typeof i||(i={}),this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==t?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&(!i.shiftKey||this._data.core.last_clicked&&this.get_parent(e)&&this.get_parent(e)===this._data.core.last_clicked.parent))if(i.shiftKey){var s,o,r=this.get_node(e).id,a=this._data.core.last_clicked.id,n=this.get_node(this._data.core.last_clicked.parent).children,l=!1;for(s=0,o=n.length;o>s;s+=1)n[s]===r&&(l=!l),n[s]===a&&(l=!l),this.is_disabled(n[s])||!l&&n[s]!==r&&n[s]!==a?this.deselect_node(n[s],!0,i):this.is_hidden(n[s])||this.select_node(n[s],!0,!1,i);this.trigger("changed",{action:"select_node",node:this.get_node(e),selected:this._data.core.selected,event:i})}else this.is_selected(e)?this.deselect_node(e,!1,i):this.select_node(e,!1,!1,i);else!this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&this.is_selected(e)?this.deselect_node(e,!1,i):(this.deselect_all(!0),this.select_node(e,!1,!1,i),this._data.core.last_clicked=this.get_node(e));this.trigger("activate_node",{node:this.get_node(e),event:i})},hover_node:function(e){if(!(e=this.get_node(e,!0))||!e.length||e.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),i=this.element;t&&t.length&&this.dehover_node(t),e.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(e)}),setTimeout(function(){i.attr("aria-activedescendant",e[0].id)},0)},dehover_node:function(e){return!!((e=this.get_node(e,!0))&&e.length&&e.children(".jstree-hovered").length)&&(e.children(".jstree-anchor").removeClass("jstree-hovered"),void this.trigger("dehover_node",{node:this.get_node(e)}))},select_node:function(t,i,s,o){var r,a,n;if(e.isArray(t)){for(a=0,n=(t=t.slice()).length;n>a;a++)this.select_node(t[a],i,s,o);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(r=this.get_node(t,!0),void(t.state.selected||(t.state.selected=!0,this._data.core.selected.push(t.id),s||(r=this._open_to(t)),r&&r.length&&r.attr("aria-selected",!0).children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:t,selected:this._data.core.selected,event:o}),i||this.trigger("changed",{action:"select_node",node:t,selected:this._data.core.selected,event:o}))))},deselect_node:function(t,i,s){var o,r,a;if(e.isArray(t)){for(o=0,r=(t=t.slice()).length;r>o;o++)this.deselect_node(t[o],i,s);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(a=this.get_node(t,!0),void(t.state.selected&&(t.state.selected=!1,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.id),a.length&&a.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:t,selected:this._data.core.selected,event:s}),i||this.trigger("changed",{action:"deselect_node",node:t,selected:this._data.core.selected,event:s}))))},select_all:function(t){var i,s,o=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data[e.jstree.root].children_d.concat(),i=0,s=this._data.core.selected.length;s>i;i++)this._model.data[this._data.core.selected[i]]&&(this._model.data[this._data.core.selected[i]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),t||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:o})},deselect_all:function(e){var t,i,s=this._data.core.selected.concat([]);for(t=0,i=this._data.core.selected.length;i>t;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",!1),this.trigger("deselect_all",{selected:this._data.core.selected,node:s}),e||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:s})},is_selected:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.state.selected},get_selected:function(t){return t?e.map(this._data.core.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.core.selected.slice()},get_top_selected:function(t){var i,s,o,r,a=this.get_selected(!0),n={};for(i=0,s=a.length;s>i;i++)n[a[i].id]=a[i];for(i=0,s=a.length;s>i;i++)for(o=0,r=a[i].children_d.length;r>o;o++)n[a[i].children_d[o]]&&delete n[a[i].children_d[o]];for(i in a=[],n)n.hasOwnProperty(i)&&a.push(i);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},get_bottom_selected:function(t){var i,s,o=this.get_selected(!0),r=[];for(i=0,s=o.length;s>i;i++)o[i].children.length||r.push(o[i].id);return t?e.map(r,e.proxy(function(e){return this.get_node(e)},this)):r},get_state:function(){var t,i={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}};for(t in this._model.data)this._model.data.hasOwnProperty(t)&&t!==e.jstree.root&&(this._model.data[t].state.opened&&i.core.open.push(t),this._model.data[t].state.selected&&i.core.selected.push(t));return i},set_state:function(i,s){if(i){if(i.core){var o,r;if(i.core.open)return e.isArray(i.core.open)&&i.core.open.length?this._load_nodes(i.core.open,function(e){this.open_node(e,!1,0),delete i.core.open,this.set_state(i,s)}):(delete i.core.open,this.set_state(i,s)),!1;if(i.core.scroll)return i.core.scroll&&i.core.scroll.left!==t&&this.element.scrollLeft(i.core.scroll.left),i.core.scroll&&i.core.scroll.top!==t&&this.element.scrollTop(i.core.scroll.top),delete i.core.scroll,this.set_state(i,s),!1;if(i.core.selected)return o=this,this.deselect_all(),e.each(i.core.selected,function(e,t){o.select_node(t,!1,!0)}),delete i.core.selected,this.set_state(i,s),!1;for(r in i)i.hasOwnProperty(r)&&"core"!==r&&-1===e.inArray(r,this.settings.plugins)&&delete i[r];if(e.isEmptyObject(i.core))return delete i.core,this.set_state(i,s),!1}return!e.isEmptyObject(i)||(i=null,s&&s.call(this),this.trigger("set_state"),!1)}return!1},refresh:function(t,i){this._data.core.state=!0===i?{}:this.get_state(),i&&e.isFunction(i)&&(this._data.core.state=i.call(this,this._data.core.state)),this._cnt=0,this._model.data={},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this._data.core.selected=[],this._data.core.last_clicked=null,this._data.core.focused=null;var s=this.get_container_ul()[0].className;t||(this.element.html("<ul class='"+s+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading")),this.load_node(e.jstree.root,function(t,i){i&&(this.get_container_ul()[0].className=s,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(e.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(t){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;var i=[],s=[],o=this._data.core.selected.concat([]);s.push(t.id),!0===t.state.opened&&i.push(t.id),this.get_node(t,!0).find(".jstree-open").each(function(){s.push(this.id),i.push(this.id)}),this._load_nodes(s,e.proxy(function(e){this.open_node(i,!1,0),this.select_node(o),this.trigger("refresh_node",{node:t,nodes:e})},this),!1,!0)},set_id:function(t,i){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;var s,o,r=this._model.data,a=t.id;for(i=i.toString(),r[t.parent].children[e.inArray(t.id,r[t.parent].children)]=i,s=0,o=t.parents.length;o>s;s++)r[t.parents[s]].children_d[e.inArray(t.id,r[t.parents[s]].children_d)]=i;for(s=0,o=t.children.length;o>s;s++)r[t.children[s]].parent=i;for(s=0,o=t.children_d.length;o>s;s++)r[t.children_d[s]].parents[e.inArray(t.id,r[t.children_d[s]].parents)]=i;return-1!==(s=e.inArray(t.id,this._data.core.selected))&&(this._data.core.selected[s]=i),(s=this.get_node(t.id,!0))&&(s.attr("id",i),this.element.attr("aria-activedescendant")===t.id&&this.element.attr("aria-activedescendant",i)),delete r[t.id],t.id=i,t.li_attr.id=i,r[i]=t,this.trigger("set_id",{node:t,new:t.id,old:a}),!0},get_text:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.text},set_text:function(t,i){var s,o;if(e.isArray(t)){for(s=0,o=(t=t.slice()).length;o>s;s++)this.set_text(t[s],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(t.text=i,this.get_node(t,!0).length&&this.redraw_node(t.id),this.trigger("set_text",{obj:t,text:i}),!0)},get_json:function(t,i,s){if(!(t=this.get_node(t||e.jstree.root)))return!1;i&&i.flat&&!s&&(s=[]);var o,r,a={id:t.id,text:t.text,icon:this.get_icon(t),li_attr:e.extend(!0,{},t.li_attr),a_attr:e.extend(!0,{},t.a_attr),state:{},data:(!i||!i.no_data)&&e.extend(!0,{},t.data)};if(i&&i.flat?a.parent=t.parent:a.children=[],i&&i.no_state)delete a.state;else for(o in t.state)t.state.hasOwnProperty(o)&&(a.state[o]=t.state[o]);if(i&&i.no_li_attr&&delete a.li_attr,i&&i.no_a_attr&&delete a.a_attr,i&&i.no_id&&(delete a.id,a.li_attr&&a.li_attr.id&&delete a.li_attr.id,a.a_attr&&a.a_attr.id&&delete a.a_attr.id),i&&i.flat&&t.id!==e.jstree.root&&s.push(a),!i||!i.no_children)for(o=0,r=t.children.length;r>o;o++)i&&i.flat?this.get_json(t.children[o],i,s):a.children.push(this.get_json(t.children[o],i));return i&&i.flat?s:t.id===e.jstree.root?a.children:a},create_node:function(i,s,o,r,a){if(null===i&&(i=e.jstree.root),!(i=this.get_node(i)))return!1;if(!(o=o===t?"last":o).toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(i))return this.load_node(i,function(){this.create_node(i,s,o,r,!0)});var n,l,c,d;switch(s||(s={text:this.get_string("New node")}),"string"==typeof s&&(s={text:s}),s.text===t&&(s.text=this.get_string("New node")),i.id===e.jstree.root&&("before"===o&&(o="first"),"after"===o&&(o="last")),o){case"before":n=this.get_node(i.parent),o=e.inArray(i.id,n.children),i=n;break;case"after":n=this.get_node(i.parent),o=e.inArray(i.id,n.children)+1,i=n;break;case"inside":case"first":o=0;break;case"last":o=i.children.length;break;default:o||(o=0)}if(o>i.children.length&&(o=i.children.length),s.id||(s.id=!0),!this.check("create_node",s,i,o))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!0===s.id&&delete s.id,!(s=this._parse_model_from_json(s,i.id,i.parents.concat())))return!1;for(n=this.get_node(s),(l=[]).push(s),l=l.concat(n.children_d),this.trigger("model",{nodes:l,parent:i.id}),i.children_d=i.children_d.concat(l),c=0,d=i.parents.length;d>c;c++)this._model.data[i.parents[c]].children_d=this._model.data[i.parents[c]].children_d.concat(l);for(s=n,n=[],c=0,d=i.children.length;d>c;c++)n[c>=o?c+1:c]=i.children[c];return n[o]=s.id,i.children=n,this.redraw_node(i,!0),r&&r.call(this,this.get_node(s)),this.trigger("create_node",{node:this.get_node(s),parent:i.id,position:o}),s.id},rename_node:function(t,i){var s,o,r;if(e.isArray(t)){for(s=0,o=(t=t.slice()).length;o>s;s++)this.rename_node(t[s],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(r=t.text,this.check("rename_node",t,this.get_parent(t),i)?(this.set_text(t,i),this.trigger("rename_node",{node:t,text:i,old:r}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1))},delete_node:function(t){var i,s,o,r,a,n,l,c,d,h,m,u;if(e.isArray(t)){for(i=0,s=(t=t.slice()).length;s>i;i++)this.delete_node(t[i]);return!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;if(o=this.get_node(t.parent),r=e.inArray(t.id,o.children),h=!1,!this.check("delete_node",t,o,r))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==r&&(o.children=e.vakata.array_remove(o.children,r)),(a=t.children_d.concat([])).push(t.id),n=0,l=t.parents.length;l>n;n++)this._model.data[t.parents[n]].children_d=e.vakata.array_filter(this._model.data[t.parents[n]].children_d,function(t){return-1===e.inArray(t,a)});for(c=0,d=a.length;d>c;c++)if(this._model.data[a[c]].state.selected){h=!0;break}for(h&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,function(t){return-1===e.inArray(t,a)})),this.trigger("delete_node",{node:t,parent:o.id}),h&&this.trigger("changed",{action:"delete_node",node:t,selected:this._data.core.selected,parent:o.id}),c=0,d=a.length;d>c;c++)delete this._model.data[a[c]];return-1!==e.inArray(this._data.core.focused,a)&&(this._data.core.focused=null,m=this.element[0].scrollTop,u=this.element[0].scrollLeft,o.id===e.jstree.root?this._model.data[e.jstree.root].children[0]&&this.get_node(this._model.data[e.jstree.root].children[0],!0).children(".jstree-anchor").focus():this.get_node(o,!0).children(".jstree-anchor").focus(),this.element[0].scrollTop=m,this.element[0].scrollLeft=u),this.redraw_node(o,!0),!0},check:function(t,i,s,o,r){i=i&&i.id?i:this.get_node(i),s=s&&s.id?s:this.get_node(s);var a=t.match(/^move_node|copy_node|create_node$/i)?s:i,n=this.settings.core.check_callback;return"move_node"!==t&&"copy_node"!==t||r&&r.is_multi||i.id!==s.id&&("move_node"!==t||e.inArray(i.id,s.children)!==o)&&-1===e.inArray(s.id,i.children_d)?(a&&a.data&&(a=a.data),a&&a.functions&&(!1===a.functions[t]||!0===a.functions[t])?(!1===a.functions[t]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+t,data:JSON.stringify({chk:t,pos:o,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),a.functions[t]):!(!1===n||e.isFunction(n)&&!1===n.call(this,t,i,s,o,r)||n&&!1===n[t])||(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+t,data:JSON.stringify({chk:t,pos:o,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})},!1)):(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:t,pos:o,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(i,s,o,r,a,n,l){var c,d,h,m,u,p,_,f,g,v,b,y,C,x;if(s=this.get_node(s),o=o===t?0:o,!s)return!1;if(!o.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(s))return this.load_node(s,function(){this.move_node(i,s,o,r,!0,!1,l)});if(e.isArray(i)){if(1!==i.length){for(c=0,d=i.length;d>c;c++)(g=this.move_node(i[c],s,o,r,a,!1,l))&&(s=g,o="after");return this.redraw(),!0}i=i[0]}if(!(i=i&&i.id?i:this.get_node(i))||i.id===e.jstree.root)return!1;if(h=(i.parent||e.jstree.root).toString(),u=o.toString().match(/^(before|after)$/)&&s.id!==e.jstree.root?this.get_node(s.parent):s,_=!(p=l||(this._model.data[i.id]?this:e.jstree.reference(i.id)))||!p._id||this._id!==p._id,m=p&&p._id&&h&&p._model.data[h]&&p._model.data[h].children?e.inArray(i.id,p._model.data[h].children):-1,p&&p._id&&(i=p._model.data[i.id]),_)return!!(g=this.copy_node(i,s,o,r,a,!1,l))&&(p&&p.delete_node(i),g);switch(s.id===e.jstree.root&&("before"===o&&(o="first"),"after"===o&&(o="last")),o){case"before":o=e.inArray(s.id,u.children);break;case"after":o=e.inArray(s.id,u.children)+1;break;case"inside":case"first":o=0;break;case"last":o=u.children.length;break;default:o||(o=0)}if(o>u.children.length&&(o=u.children.length),!this.check("move_node",i,u,o,{core:!0,origin:l,is_multi:p&&p._id&&p._id!==this._id,is_foreign:!p||!p._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(i.parent===u.id){for(f=u.children.concat(),-1!==(g=e.inArray(i.id,f))&&(f=e.vakata.array_remove(f,g),o>g&&o--),g=[],v=0,b=f.length;b>v;v++)g[v>=o?v+1:v]=f[v];g[o]=i.id,u.children=g,this._node_changed(u.id),this.redraw(u.id===e.jstree.root)}else{for((g=i.children_d.concat()).push(i.id),v=0,b=i.parents.length;b>v;v++){for(f=[],y=0,C=(x=p._model.data[i.parents[v]].children_d).length;C>y;y++)-1===e.inArray(x[y],g)&&f.push(x[y]);p._model.data[i.parents[v]].children_d=f}for(p._model.data[h].children=e.vakata.array_remove_item(p._model.data[h].children,i.id),v=0,b=u.parents.length;b>v;v++)this._model.data[u.parents[v]].children_d=this._model.data[u.parents[v]].children_d.concat(g);for(f=[],v=0,b=u.children.length;b>v;v++)f[v>=o?v+1:v]=u.children[v];for(f[o]=i.id,u.children=f,u.children_d.push(i.id),u.children_d=u.children_d.concat(i.children_d),i.parent=u.id,(g=u.parents.concat()).unshift(u.id),x=i.parents.length,i.parents=g,g=g.concat(),v=0,b=i.children_d.length;b>v;v++)this._model.data[i.children_d[v]].parents=this._model.data[i.children_d[v]].parents.slice(0,-1*x),Array.prototype.push.apply(this._model.data[i.children_d[v]].parents,g);(h===e.jstree.root||u.id===e.jstree.root)&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(h),this._node_changed(u.id)),n||this.redraw()}return r&&r.call(this,i,u,o),this.trigger("move_node",{node:i,parent:u.id,position:o,old_parent:h,old_position:m,is_multi:p&&p._id&&p._id!==this._id,is_foreign:!p||!p._id,old_instance:p,new_instance:this}),i.id},copy_node:function(i,s,o,r,a,n,l){var c,d,h,m,u,p,_,f,g,v;if(s=this.get_node(s),o=o===t?0:o,!s)return!1;if(!o.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(s))return this.load_node(s,function(){this.copy_node(i,s,o,r,!0,!1,l)});if(e.isArray(i)){if(1!==i.length){for(c=0,d=i.length;d>c;c++)(m=this.copy_node(i[c],s,o,r,a,!0,l))&&(s=m,o="after");return this.redraw(),!0}i=i[0]}if(!(i=i&&i.id?i:this.get_node(i))||i.id===e.jstree.root)return!1;switch(f=(i.parent||e.jstree.root).toString(),g=o.toString().match(/^(before|after)$/)&&s.id!==e.jstree.root?this.get_node(s.parent):s,!(v=l||(this._model.data[i.id]?this:e.jstree.reference(i.id)))||!v._id||this._id!==v._id,v&&v._id&&(i=v._model.data[i.id]),s.id===e.jstree.root&&("before"===o&&(o="first"),"after"===o&&(o="last")),o){case"before":o=e.inArray(s.id,g.children);break;case"after":o=e.inArray(s.id,g.children)+1;break;case"inside":case"first":o=0;break;case"last":o=g.children.length;break;default:o||(o=0)}if(o>g.children.length&&(o=g.children.length),!this.check("copy_node",i,g,o,{core:!0,origin:l,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!(_=v?v.get_json(i,{no_id:!0,no_data:!0,no_state:!0}):i))return!1;if(!0===_.id&&delete _.id,!(_=this._parse_model_from_json(_,g.id,g.parents.concat())))return!1;for(m=this.get_node(_),i&&i.state&&!1===i.state.loaded&&(m.state.loaded=!1),(h=[]).push(_),h=h.concat(m.children_d),this.trigger("model",{nodes:h,parent:g.id}),u=0,p=g.parents.length;p>u;u++)this._model.data[g.parents[u]].children_d=this._model.data[g.parents[u]].children_d.concat(h);for(h=[],u=0,p=g.children.length;p>u;u++)h[u>=o?u+1:u]=g.children[u];return h[o]=m.id,g.children=h,g.children_d.push(m.id),g.children_d=g.children_d.concat(m.children_d),g.id===e.jstree.root&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(g.id),n||this.redraw(g.id===e.jstree.root),r&&r.call(this,m,g,o),this.trigger("copy_node",{node:m,original:i,parent:g.id,position:o,old_parent:f,old_position:v&&v._id&&f&&v._model.data[f]&&v._model.data[f].children?e.inArray(i.id,v._model.data[f].children):-1,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id,old_instance:v,new_instance:this}),m.id},cut:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,s,o,l=[];for(s=0,o=t.length;o>s;s++)(i=this.get_node(t[s]))&&i.id&&i.id!==e.jstree.root&&l.push(i);return!!l.length&&(r=l,n=this,a="move_node",void this.trigger("cut",{node:t}))},copy:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,s,o,l=[];for(s=0,o=t.length;o>s;s++)(i=this.get_node(t[s]))&&i.id&&i.id!==e.jstree.root&&l.push(i);return!!l.length&&(r=l,n=this,a="copy_node",void this.trigger("copy",{node:t}))},get_buffer:function(){return{mode:a,node:r,inst:n}},can_paste:function(){return!1!==a&&!1!==r},paste:function(e,t){return!!((e=this.get_node(e))&&a&&a.match(/^(copy_node|move_node)$/)&&r)&&(this[a](r,e,t,!1,!1,!1,n)&&this.trigger("paste",{parent:e.id,node:r,mode:a}),r=!1,a=!1,void(n=!1))},clear_buffer:function(){r=!1,a=!1,n=!1,this.trigger("clear_buffer")},edit:function(t,i,s){var o,r,a,n,l,c,h,m,u,p=!1;return!!(t=this.get_node(t))&&(!1===this.settings.core.check_callback?(this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1):(u=t,i="string"==typeof i?i:t.text,this.set_text(t,""),t=this._open_to(t),u.text=i,o=this._data.core.rtl,r=this.element.width(),this._data.core.focused=u.id,a=t.children(".jstree-anchor").focus(),n=e("<span>"),l=i,c=e("<div />",{css:{position:"absolute",top:"-200px",left:o?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),h=e("<input />",{value:l,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(i){i.stopImmediatePropagation(),i.preventDefault();var o,r=n.children(".jstree-rename-input").val(),d=this.settings.core.force_text;""===r&&(r=l),c.remove(),n.replaceWith(a),n.remove(),l=d?l:e("<div></div>").append(e.parseHTML(l)).html(),this.set_text(t,l),(o=!!this.rename_node(t,d?e("<div></div>").text(r).text():e("<div></div>").append(e.parseHTML(r)).html()))||this.set_text(t,l),this._data.core.focused=u.id,setTimeout(e.proxy(function(){var e=this.get_node(u.id,!0);e.length&&(this._data.core.focused=u.id,e.children(".jstree-anchor").focus())},this),0),s&&s.call(this,u,o,p),h=null},this),keydown:function(e){var t=e.which;27===t&&(p=!0,this.value=l),(27===t||13===t||37===t||38===t||39===t||40===t||32===t)&&e.stopImmediatePropagation(),(27===t||13===t)&&(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){h.width(Math.min(c.text("pW"+this.value).width(),r))},keypress:function(e){return 13!==e.which&&void 0}}),m={fontFamily:a.css("fontFamily")||"",fontSize:a.css("fontSize")||"",fontWeight:a.css("fontWeight")||"",fontStyle:a.css("fontStyle")||"",fontStretch:a.css("fontStretch")||"",fontVariant:a.css("fontVariant")||"",letterSpacing:a.css("letterSpacing")||"",wordSpacing:a.css("wordSpacing")||""},n.attr("class",a.attr("class")).append(a.contents().clone()).append(h),a.replaceWith(n),c.css(m),h.css(m).width(Math.min(c.text("pW"+h[0].value).width(),r))[0].select(),void e(d).one("mousedown.jstree touchstart.jstree dnd_start.vakata",function(t){h&&t.target!==h&&e(h).blur()})))},set_theme:function(t,i){if(!t)return!1;if(!0===i){var s=this.settings.core.themes.dir;s||(s=e.jstree.path+"/themes"),i=s+"/"+t+"/style.css"}i&&-1===e.inArray(i,l)&&(e("head").append('<link rel="stylesheet" href="'+i+'" type="text/css" />'),l.push(i)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=t,this.element.addClass("jstree-"+t),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+t+"-responsive"),this.trigger("set_theme",{theme:t})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),this._data.core.themes.variant=e,e&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(i,s){var o,r,a,n;if(e.isArray(i)){for(o=0,r=(i=i.slice()).length;r>o;o++)this.set_icon(i[o],s);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root)&&(n=i.icon,i.icon=!0===s||null===s||s===t||""===s||s,a=this.get_node(i,!0).children(".jstree-anchor").children(".jstree-themeicon"),!1===s?this.hide_icon(i):!0===s||null===s||s===t||""===s?(a.removeClass("jstree-themeicon-custom "+n).css("background","").removeAttr("rel"),!1===n&&this.show_icon(i)):-1===s.indexOf("/")&&-1===s.indexOf(".")?(a.removeClass(n).css("background",""),a.addClass(s+" jstree-themeicon-custom").attr("rel",s),!1===n&&this.show_icon(i)):(a.removeClass(n).css("background",""),a.addClass("jstree-themeicon-custom").css("background","url('"+s+"') center center no-repeat").attr("rel",s),!1===n&&this.show_icon(i)),!0)},get_icon:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.icon},hide_icon:function(t){var i,s;if(e.isArray(t)){for(i=0,s=(t=t.slice()).length;s>i;i++)this.hide_icon(t[i]);return!0}return!(!(t=this.get_node(t))||t===e.jstree.root)&&(t.icon=!1,this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0)},show_icon:function(t){var i,s,o;if(e.isArray(t)){for(i=0,s=(t=t.slice()).length;s>i;i++)this.show_icon(t[i]);return!0}return!(!(t=this.get_node(t))||t===e.jstree.root)&&(o=this.get_node(t,!0),t.icon=!o.length||o.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"),t.icon||(t.icon=!0),o.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0)}},e.vakata={},e.vakata.attributes=function(t,i){t=e(t)[0];var s=i?{}:[];return t&&t.attributes&&e.each(t.attributes,function(t,o){-1===e.inArray(o.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==o.value&&""!==e.trim(o.value)&&(i?s[o.name]=o.value:s.push(o.name))}),s},e.vakata.array_unique=function(e){var i,s,o=[],r={};for(i=0,s=e.length;s>i;i++)r[e[i]]===t&&(o.push(e[i]),r[e[i]]=!0);return o},e.vakata.array_remove=function(e,t){return e.splice(t,1),e},e.vakata.array_remove_item=function(t,i){var s=e.inArray(i,t);return-1!==s?e.vakata.array_remove(t,s):t},e.vakata.array_filter=function(e,t,i,s,o){if(e.filter)return e.filter(t,i);for(o in s=[],e)~~o+""==o+""&&o>=0&&t.call(i,e[o],+o,e)&&s.push(e[o]);return s},e.jstree.plugins.changed=function(e,t){var i=[];this.trigger=function(e,s){var o,r;if(s||(s={}),"changed"===e.replace(".jstree","")){s.changed={selected:[],deselected:[]};var a={};for(o=0,r=i.length;r>o;o++)a[i[o]]=1;for(o=0,r=s.selected.length;r>o;o++)a[s.selected[o]]?a[s.selected[o]]=2:s.changed.selected.push(s.selected[o]);for(o=0,r=i.length;r>o;o++)1===a[i[o]]&&s.changed.deselected.push(i[o]);i=s.selected.slice()}t.trigger.call(this,e,s)},this.refresh=function(e,s){return i=[],t.refresh.apply(this,arguments)}};var m,u,p=d.createElement("I");p.className="jstree-icon jstree-checkbox",p.setAttribute("role","presentation"),e.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0},e.jstree.plugins.checkbox=function(i,s){this.bind=function(){s.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",e.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",e.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",e.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)},this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",e.proxy(function(e,t){var i,s,o=this._model.data,r=(o[t.parent],t.nodes);for(i=0,s=r.length;s>i;i++)o[r[i]].state.checked=o[r[i]].state.checked||o[r[i]].original&&o[r[i]].original.state&&o[r[i]].original.state.checked,o[r[i]].state.checked&&this._data.checkbox.selected.push(r[i])},this)),(-1!==this.settings.checkbox.cascade.indexOf("up")||-1!==this.settings.checkbox.cascade.indexOf("down"))&&this.element.on("model.jstree",e.proxy(function(t,i){var s,o,r,a,n,l,c=this._model.data,d=c[i.parent],h=i.nodes,m=[],u=this.settings.checkbox.cascade,p=this.settings.checkbox.tie_selection;if(-1!==u.indexOf("down"))if(d.state[p?"selected":"checked"]){for(o=0,r=h.length;r>o;o++)c[h[o]].state[p?"selected":"checked"]=!0;this._data[p?"core":"checkbox"].selected=this._data[p?"core":"checkbox"].selected.concat(h)}else for(o=0,r=h.length;r>o;o++)if(c[h[o]].state[p?"selected":"checked"]){for(a=0,n=c[h[o]].children_d.length;n>a;a++)c[c[h[o]].children_d[a]].state[p?"selected":"checked"]=!0;this._data[p?"core":"checkbox"].selected=this._data[p?"core":"checkbox"].selected.concat(c[h[o]].children_d)}if(-1!==u.indexOf("up")){for(o=0,r=d.children_d.length;r>o;o++)c[d.children_d[o]].children.length||m.push(c[d.children_d[o]].parent);for(a=0,n=(m=e.vakata.array_unique(m)).length;n>a;a++)for(d=c[m[a]];d&&d.id!==e.jstree.root;){for(s=0,o=0,r=d.children.length;r>o;o++)s+=c[d.children[o]].state[p?"selected":"checked"];if(s!==r)break;d.state[p?"selected":"checked"]=!0,this._data[p?"core":"checkbox"].selected.push(d.id),(l=this.get_node(d,!0))&&l.length&&l.attr("aria-selected",!0).children(".jstree-anchor").addClass(p?"jstree-clicked":"jstree-checked"),d=this.get_node(d.parent)}}this._data[p?"core":"checkbox"].selected=e.vakata.array_unique(this._data[p?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",e.proxy(function(t,i){var s,o,r,a,n=i.node,l=this._model.data,c=this.get_node(n.parent),d=this.get_node(n,!0),h=this.settings.checkbox.cascade,m=this.settings.checkbox.tie_selection,u={},p=this._data[m?"core":"checkbox"].selected;for(s=0,o=p.length;o>s;s++)u[p[s]]=!0;if(-1!==h.indexOf("down"))for(s=0,o=n.children_d.length;o>s;s++)u[n.children_d[s]]=!0,(a=l[n.children_d[s]]).state[m?"selected":"checked"]=!0,a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1);if(-1!==h.indexOf("up"))for(;c&&c.id!==e.jstree.root;){for(r=0,s=0,o=c.children.length;o>s;s++)r+=l[c.children[s]].state[m?"selected":"checked"];if(r!==o)break;c.state[m?"selected":"checked"]=!0,u[c.id]=!0,(a=this.get_node(c,!0))&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(m?"jstree-clicked":"jstree-checked"),c=this.get_node(c.parent)}for(s in p=[],u)u.hasOwnProperty(s)&&p.push(s);this._data[m?"core":"checkbox"].selected=p,-1!==h.indexOf("down")&&d.length&&d.find(".jstree-anchor").addClass(m?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!0)},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",e.proxy(function(t,i){var s,o,r,a=this.get_node(e.jstree.root),n=this._model.data;for(s=0,o=a.children_d.length;o>s;s++)(r=n[a.children_d[s]])&&r.original&&r.original.state&&r.original.state.undetermined&&(r.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",e.proxy(function(t,i){var s,o,r,a=i.node,n=this.get_node(a,!0),l=this.settings.checkbox.cascade,c=this.settings.checkbox.tie_selection,d=this._data[c?"core":"checkbox"].selected,h={};if(a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1),-1!==l.indexOf("down"))for(s=0,o=a.children_d.length;o>s;s++)(r=this._model.data[a.children_d[s]]).state[c?"selected":"checked"]=!1,r&&r.original&&r.original.state&&r.original.state.undetermined&&(r.original.state.undetermined=!1);if(-1!==l.indexOf("up"))for(s=0,o=a.parents.length;o>s;s++)(r=this._model.data[a.parents[s]]).state[c?"selected":"checked"]=!1,r&&r.original&&r.original.state&&r.original.state.undetermined&&(r.original.state.undetermined=!1),(r=this.get_node(a.parents[s],!0))&&r.length&&r.attr("aria-selected",!1).children(".jstree-anchor").removeClass(c?"jstree-clicked":"jstree-checked");for(h={},s=0,o=d.length;o>s;s++)-1!==l.indexOf("down")&&-1!==e.inArray(d[s],a.children_d)||-1!==l.indexOf("up")&&-1!==e.inArray(d[s],a.parents)||(h[d[s]]=!0);for(s in d=[],h)h.hasOwnProperty(s)&&d.push(s);this._data[c?"core":"checkbox"].selected=d,-1!==l.indexOf("down")&&n.length&&n.find(".jstree-anchor").removeClass(c?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!1)},this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",e.proxy(function(t,i){for(var s,o,r,a,n=this.get_node(i.parent),l=this._model.data,c=this.settings.checkbox.tie_selection;n&&n.id!==e.jstree.root&&!n.state[c?"selected":"checked"];){for(r=0,s=0,o=n.children.length;o>s;s++)r+=l[n.children[s]].state[c?"selected":"checked"];if(!(o>0&&r===o))break;n.state[c?"selected":"checked"]=!0,this._data[c?"core":"checkbox"].selected.push(n.id),(a=this.get_node(n,!0))&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(c?"jstree-clicked":"jstree-checked"),n=this.get_node(n.parent)}},this)).on("move_node.jstree",e.proxy(function(t,i){var s,o,r,a,n,l=i.is_multi,c=i.old_parent,d=this.get_node(i.parent),h=this._model.data,m=this.settings.checkbox.tie_selection;if(!l)for(s=this.get_node(c);s&&s.id!==e.jstree.root&&!s.state[m?"selected":"checked"];){for(o=0,r=0,a=s.children.length;a>r;r++)o+=h[s.children[r]].state[m?"selected":"checked"];if(!(a>0&&o===a))break;s.state[m?"selected":"checked"]=!0,this._data[m?"core":"checkbox"].selected.push(s.id),(n=this.get_node(s,!0))&&n.length&&n.attr("aria-selected",!0).children(".jstree-anchor").addClass(m?"jstree-clicked":"jstree-checked"),s=this.get_node(s.parent)}for(s=d;s&&s.id!==e.jstree.root;){for(o=0,r=0,a=s.children.length;a>r;r++)o+=h[s.children[r]].state[m?"selected":"checked"];if(o===a)s.state[m?"selected":"checked"]||(s.state[m?"selected":"checked"]=!0,this._data[m?"core":"checkbox"].selected.push(s.id),(n=this.get_node(s,!0))&&n.length&&n.attr("aria-selected",!0).children(".jstree-anchor").addClass(m?"jstree-clicked":"jstree-checked"));else{if(!s.state[m?"selected":"checked"])break;s.state[m?"selected":"checked"]=!1,this._data[m?"core":"checkbox"].selected=e.vakata.array_remove_item(this._data[m?"core":"checkbox"].selected,s.id),(n=this.get_node(s,!0))&&n.length&&n.attr("aria-selected",!1).children(".jstree-anchor").removeClass(m?"jstree-clicked":"jstree-checked")}s=this.get_node(s.parent)}},this))},this._undetermined=function(){if(null!==this.element){var i,s,o,r,a={},n=this._model.data,l=this.settings.checkbox.tie_selection,c=this._data[l?"core":"checkbox"].selected,d=[],h=this;for(i=0,s=c.length;s>i;i++)if(n[c[i]]&&n[c[i]].parents)for(o=0,r=n[c[i]].parents.length;r>o&&a[n[c[i]].parents[o]]===t;o++)n[c[i]].parents[o]!==e.jstree.root&&(a[n[c[i]].parents[o]]=!0,d.push(n[c[i]].parents[o]));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var l,c=h.get_node(this);if(c.state.loaded){for(i=0,s=c.children_d.length;s>i;i++)if(!(l=n[c.children_d[i]]).state.loaded&&l.original&&l.original.state&&l.original.state.undetermined&&!0===l.original.state.undetermined)for(a[l.id]===t&&l.id!==e.jstree.root&&(a[l.id]=!0,d.push(l.id)),o=0,r=l.parents.length;r>o;o++)a[l.parents[o]]===t&&l.parents[o]!==e.jstree.root&&(a[l.parents[o]]=!0,d.push(l.parents[o]))}else if(c.original&&c.original.state&&c.original.state.undetermined&&!0===c.original.state.undetermined)for(a[c.id]===t&&c.id!==e.jstree.root&&(a[c.id]=!0,d.push(c.id)),o=0,r=c.parents.length;r>o;o++)a[c.parents[o]]===t&&c.parents[o]!==e.jstree.root&&(a[c.parents[o]]=!0,d.push(c.parents[o]))}),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),i=0,s=d.length;s>i;i++)n[d[i]].state[l?"selected":"checked"]||(c=this.get_node(d[i],!0))&&c.length&&c.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")}},this.redraw_node=function(t,i,o,r){if(t=s.redraw_node.apply(this,arguments)){var a,n,l=null,c=null;for(a=0,n=t.childNodes.length;n>a;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){l=t.childNodes[a];break}l&&(!this.settings.checkbox.tie_selection&&this._model.data[t.id].state.checked&&(l.className+=" jstree-checked"),c=p.cloneNode(!1),this._model.data[t.id].state.checkbox_disabled&&(c.className+=" jstree-checkbox-disabled"),l.insertBefore(c,l.childNodes[0]))}return o||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)),t},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(t){t=this.get_node(t);var i,s,o=this.settings.checkbox.cascade,r=this.settings.checkbox.tie_selection,a=this._data[r?"core":"checkbox"].selected,n=this._model.data;if(!t||!0===t.state[r?"selected":"checked"]||-1===o.indexOf("undetermined")||-1===o.indexOf("down")&&-1===o.indexOf("up"))return!1;if(!t.state.loaded&&!0===t.original.state.undetermined)return!0;for(i=0,s=t.children_d.length;s>i;i++)if(-1!==e.inArray(t.children_d[i],a)||!n[t.children_d[i]].state.loaded&&n[t.children_d[i]].original.state.undetermined)return!0;return!1},this.disable_checkbox=function(t){var i,s,o;if(e.isArray(t)){for(i=0,s=(t=t.slice()).length;s>i;i++)this.disable_checkbox(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(o=this.get_node(t,!0),void(t.state.checkbox_disabled||(t.state.checkbox_disabled=!0,o&&o.length&&o.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-checkbox-disabled"),this.trigger("disable_checkbox",{node:t}))))},this.enable_checkbox=function(t){var i,s,o;if(e.isArray(t)){for(i=0,s=(t=t.slice()).length;s>i;i++)this.enable_checkbox(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(o=this.get_node(t,!0),void(t.state.checkbox_disabled&&(t.state.checkbox_disabled=!1,o&&o.length&&o.children(".jstree-anchor").children(".jstree-checkbox").removeClass("jstree-checkbox-disabled"),this.trigger("enable_checkbox",{node:t}))))},this.activate_node=function(t,i){return!e(i.target).hasClass("jstree-checkbox-disabled")&&(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||e(i.target).hasClass("jstree-checkbox"))&&(i.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!e(i.target).hasClass("jstree-checkbox")?s.activate_node.call(this,t,i):!this.is_disabled(t)&&(this.is_checked(t)?this.uncheck_node(t,i):this.check_node(t,i),void this.trigger("activate_node",{node:this.get_node(t)})))},this.check_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.select_node(t,!1,!0,i);var s,o,r;if(e.isArray(t)){for(o=0,r=(t=t.slice()).length;r>o;o++)this.check_node(t[o],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(s=this.get_node(t,!0),void(t.state.checked||(t.state.checked=!0,this._data.checkbox.selected.push(t.id),s&&s.length&&s.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:t,selected:this._data.checkbox.selected,event:i}))))},this.uncheck_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.deselect_node(t,!1,i);var s,o,r;if(e.isArray(t)){for(s=0,o=(t=t.slice()).length;o>s;s++)this.uncheck_node(t[s],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(r=this.get_node(t,!0),void(t.state.checked&&(t.state.checked=!1,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,t.id),r.length&&r.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:t,selected:this._data.checkbox.selected,event:i}))))},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var t,i;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data[e.jstree.root].children_d.concat(),t=0,i=this._data.checkbox.selected.length;i>t;t++)this._model.data[this._data.checkbox.selected[t]]&&(this._model.data[this._data.checkbox.selected[t]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var e,t,i=this._data.checkbox.selected.concat([]);for(e=0,t=this._data.checkbox.selected.length;t>e;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:i})},this.is_checked=function(t){return this.settings.checkbox.tie_selection?this.is_selected(t):!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.state.checked},this.get_checked=function(t){return this.settings.checkbox.tie_selection?this.get_selected(t):t?e.map(this._data.checkbox.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.checkbox.selected},this.get_top_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_top_selected(t);var i,s,o,r,a=this.get_checked(!0),n={};for(i=0,s=a.length;s>i;i++)n[a[i].id]=a[i];for(i=0,s=a.length;s>i;i++)for(o=0,r=a[i].children_d.length;r>o;o++)n[a[i].children_d[o]]&&delete n[a[i].children_d[o]];for(i in a=[],n)n.hasOwnProperty(i)&&a.push(i);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},this.get_bottom_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(t);var i,s,o=this.get_checked(!0),r=[];for(i=0,s=o.length;s>i;i++)o[i].children.length||r.push(o[i].id);return t?e.map(r,e.proxy(function(e){return this.get_node(e)},this)):r},this.load_node=function(t,i){var o,r,a;if(!e.isArray(t)&&!this.settings.checkbox.tie_selection&&((a=this.get_node(t))&&a.state.loaded))for(o=0,r=a.children_d.length;r>o;o++)this._model.data[a.children_d[o]].state.checked&&(!0,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,a.children_d[o]));return s.load_node.apply(this,arguments)},this.get_state=function(){var e=s.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection?e:(e.checkbox=this._data.checkbox.selected.slice(),e)},this.set_state=function(t,i){var o=s.set_state.apply(this,arguments);if(o&&t.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var r=this;e.each(t.checkbox,function(e,t){r.check_node(t)})}return delete t.checkbox,this.set_state(t,i),!1}return o},this.refresh=function(e,t){return this.settings.checkbox.tie_selection||(this._data.checkbox.selected=[]),s.refresh.apply(this,arguments)}},e.jstree.defaults.conditionalselect=function(){return!0},e.jstree.plugins.conditionalselect=function(e,t){this.activate_node=function(e,i){this.settings.conditionalselect.call(this,this.get_node(e),i)&&t.activate_node.call(this,e,i)}},e.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(t,i){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(t){var i=e.jstree.reference(t.reference),s=i.get_node(t.reference);i.create_node(s,{},"last",function(e){setTimeout(function(){i.edit(e)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(t){var i=e.jstree.reference(t.reference),s=i.get_node(t.reference);i.edit(s)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(t){var i=e.jstree.reference(t.reference),s=i.get_node(t.reference);i.is_selected(s)?i.delete_node(i.get_selected()):i.delete_node(s)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(t){var i=e.jstree.reference(t.reference),s=i.get_node(t.reference);i.is_selected(s)?i.cut(i.get_top_selected()):i.cut(s)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(t){var i=e.jstree.reference(t.reference),s=i.get_node(t.reference);i.is_selected(s)?i.copy(i.get_top_selected()):i.copy(s)}},paste:{separator_before:!1,icon:!1,_disabled:function(t){return!e.jstree.reference(t.reference).can_paste()},separator_after:!1,label:"Paste",action:function(t){var i=e.jstree.reference(t.reference),s=i.get_node(t.reference);i.paste(s)}}}}}}},e.jstree.plugins.contextmenu=function(i,s){this.bind=function(){s.bind.call(this);var t,i,o=0,r=null;this.element.on("contextmenu.jstree",".jstree-anchor",e.proxy(function(e,t){"input"!==e.target.tagName.toLowerCase()&&(e.preventDefault(),o=e.ctrlKey?+new Date:0,(t||r)&&(o=+new Date+1e4),r&&clearTimeout(r),this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e))},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){this._data.contextmenu.visible&&(!o||+new Date-o>250)&&e.vakata.context.hide(),o=0},this)).on("touchstart.jstree",".jstree-anchor",function(s){s.originalEvent&&s.originalEvent.changedTouches&&s.originalEvent.changedTouches[0]&&(t=s.originalEvent.changedTouches[0].clientX,i=s.originalEvent.changedTouches[0].clientY,r=setTimeout(function(){e(s.currentTarget).trigger("contextmenu",!0)},750))}).on("touchmove.vakata.jstree",function(e){r&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(Math.abs(t-e.originalEvent.changedTouches[0].clientX)>50||Math.abs(i-e.originalEvent.changedTouches[0].clientY)>50)&&clearTimeout(r)}).on("touchend.vakata.jstree",function(e){r&&clearTimeout(r)}),e(d).on("context_hide.vakata.jstree",e.proxy(function(t,i){this._data.contextmenu.visible=!1,e(i.reference).removeClass("jstree-context")},this))},this.teardown=function(){this._data.contextmenu.visible&&e.vakata.context.hide(),s.teardown.call(this)},this.show_contextmenu=function(i,s,o,r){if(!(i=this.get_node(i))||i.id===e.jstree.root)return!1;var a=this.settings.contextmenu,n=this.get_node(i,!0).children(".jstree-anchor"),l=!1,c=!1;(a.show_at_node||s===t||o===t)&&(l=n.offset(),s=l.left,o=l.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(i)&&this.activate_node(i,r),c=a.items,e.isFunction(c)&&(c=c.call(this,i,e.proxy(function(e){this._show_contextmenu(i,s,o,e)},this))),e.isPlainObject(c)&&this._show_contextmenu(i,s,o,c)},this._show_contextmenu=function(t,i,s,o){var r=this.get_node(t,!0).children(".jstree-anchor");e(d).one("context_show.vakata.jstree",e.proxy(function(t,i){var s="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";e(i.element).addClass(s),r.addClass("jstree-context")},this)),this._data.contextmenu.visible=!0,e.vakata.context.show(r,{x:i,y:s},o),this.trigger("show_contextmenu",{node:t,x:i,y:s})}},function(e){var t=!1,i={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};e.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(t){e(d).triggerHandler("context_"+t+".vakata",{reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}})},_execute:function(t){return!(!(t=i.items[t])||t._disabled&&(!e.isFunction(t._disabled)||t._disabled({item:t,reference:i.reference,element:i.element}))||!t.action)&&t.action.call(null,{item:t,reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}})},_parse:function(t,s){if(!t)return!1;s||(i.html="",i.items=[]);var o,r="",a=!1;return s&&(r+="<ul>"),e.each(t,function(t,s){return!s||(i.items.push(s),!a&&s.separator_before&&(r+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"),a=!1,r+="<li class='"+(s._class||"")+(!0===s._disabled||e.isFunction(s._disabled)&&s._disabled({item:s,reference:i.reference,element:i.element})?" vakata-contextmenu-disabled ":"")+"' "+(s.shortcut?" data-shortcut='"+s.shortcut+"' ":"")+">",r+="<a href='#' rel='"+(i.items.length-1)+"' "+(s.title?"title='"+s.title+"'":"")+">",e.vakata.context.settings.icons&&(r+="<i ",s.icon&&(r+=-1!==s.icon.indexOf("/")||-1!==s.icon.indexOf(".")?" style='background:url(\""+s.icon+"\") center center no-repeat' ":" class='"+s.icon+"' "),r+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),r+=(e.isFunction(s.label)?s.label({item:t,reference:i.reference,element:i.element}):s.label)+(s.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+s.shortcut+'">'+(s.shortcut_label||"")+"</span>":"")+"</a>",s.submenu&&((o=e.vakata.context._parse(s.submenu,!0))&&(r+=o)),r+="</li>",void(s.separator_after&&(r+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",a=!0)))}),r=r.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),s&&(r+="</ul>"),s||(i.html=r,e.vakata.context._trigger("parse")),r.length>10&&r},_show_submenu:function(i){if((i=e(i)).length&&i.children("ul").length){var s=i.children("ul"),o=i.offset().left,r=o+i.outerWidth(),a=i.offset().top,n=s.width(),l=s.height(),c=e(window).width()+e(window).scrollLeft(),d=e(window).height()+e(window).scrollTop();t?i[r-(n+10+i.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):i[r+n>c&&o>c-r?"addClass":"removeClass"]("vakata-context-right"),a+l+10>d&&s.css("bottom","-1px"),i.hasClass("vakata-context-right")?n>o&&s.css("margin-right",o-n):n>c-r&&s.css("margin-left",c-r-n),s.show()}},show:function(s,o,r){var a,n,l,c,d,h,m,u;switch(i.element&&i.element.length&&i.element.width(""),!0){case!o&&!s:return!1;case!!o&&!!s:i.reference=s,i.position_x=o.x,i.position_y=o.y;break;case!o&&!!s:i.reference=s,a=s.offset(),i.position_x=a.left+s.outerHeight(),i.position_y=a.top;break;case!!o&&!s:i.position_x=o.x,i.position_y=o.y}s&&!r&&e(s).data("vakata_contextmenu")&&(r=e(s).data("vakata_contextmenu")),e.vakata.context._parse(r)&&i.element.html(i.html),i.items.length&&(i.element.appendTo("body"),n=i.element,l=i.position_x,c=i.position_y,d=n.width(),h=n.height(),m=e(window).width()+e(window).scrollLeft(),u=e(window).height()+e(window).scrollTop(),t&&((l-=n.outerWidth()-e(s).outerWidth())<e(window).scrollLeft()+20&&(l=e(window).scrollLeft()+20)),l+d+20>m&&(l=m-(d+20)),c+h+20>u&&(c=u-(h+20)),i.element.css({left:l,top:c}).show().find("a").first().focus().parent().addClass("vakata-context-hover"),i.is_visible=!0,e.vakata.context._trigger("show"))},hide:function(){i.is_visible&&(i.element.hide().find("ul").hide().end().find(":focus").blur().end().detach(),i.is_visible=!1,e.vakata.context._trigger("hide"))}},e(function(){t="rtl"===e("body").css("direction");var s=!1;i.element=e("<ul class='vakata-context'></ul>"),i.element.on("mouseenter","li",function(t){t.stopImmediatePropagation(),e.contains(this,t.relatedTarget)||(s&&clearTimeout(s),i.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),e(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),e.vakata.context._show_submenu(this))}).on("mouseleave","li",function(t){e.contains(this,t.relatedTarget)||e(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(t){e(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),e.vakata.context.settings.hide_onmouseleave&&(s=setTimeout(function(){e.vakata.context.hide()},e.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(t){t.preventDefault(),e(this).blur().parent().hasClass("vakata-context-disabled")||!1===e.vakata.context._execute(e(this).attr("rel"))||e.vakata.context.hide()}).on("keydown","a",function(t){var s=null;switch(t.which){case 13:case 32:t.type="mouseup",t.preventDefault(),e(t.currentTarget).trigger(t);break;case 37:i.is_visible&&(i.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 38:i.is_visible&&((s=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first()).length||(s=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),s.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 39:i.is_visible&&(i.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 40:i.is_visible&&((s=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first()).length||(s=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),s.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 27:e.vakata.context.hide(),t.preventDefault()}}).on("keydown",function(e){e.preventDefault();var t=i.element.find(".vakata-contextmenu-shortcut-"+e.which).parent();t.parent().not(".vakata-context-disabled")&&t.click()}),e(d).on("mousedown.vakata.jstree",function(t){i.is_visible&&!e.contains(i.element[0],t.target)&&e.vakata.context.hide()}).on("context_show.vakata.jstree",function(e,s){i.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),t&&i.element.addClass("vakata-context-rtl").css("direction","rtl"),i.element.find("ul").hide().end()})})}(e),e.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1,use_html5:!1},e.jstree.plugins.dnd=function(t,i){this.init=function(e,t){i.init.call(this,e,t),this.settings.dnd.use_html5=this.settings.dnd.use_html5&&"draggable"in d.createElement("span")},this.bind=function(){i.bind.call(this),this.element.on(this.settings.dnd.use_html5?"dragstart.jstree":"mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",e.proxy(function(t){if(this.settings.dnd.large_drag_target&&e(t.target).closest(".jstree-node")[0]!==t.currentTarget)return!0;if("touchstart"===t.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))return!0;var i=this.get_node(t.target),s=this.is_selected(i)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,o=s>1?s+" "+this.get_string("nodes"):this.get_text(t.currentTarget);if(this.settings.core.force_text&&(o=e.vakata.html.escape(o)),i&&i.id&&i.id!==e.jstree.root&&(1===t.which||"touchstart"===t.type||"dragstart"===t.type)&&(!0===this.settings.dnd.is_draggable||e.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,s>1?this.get_top_selected(!0):[i],t))){if(m={jstree:!0,origin:this,obj:this.get_node(i,!0),nodes:s>1?this.get_top_selected():[i.id]},u=t.currentTarget,!this.settings.dnd.use_html5)return this.element.trigger("mousedown.jstree"),e.vakata.dnd.start(t,m,'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+o+'<ins class="jstree-copy" style="display:none;">+</ins></div>');e.vakata.dnd._trigger("start",t,{helper:e(),element:u,data:m})}},this)),this.settings.dnd.use_html5&&this.element.on("dragover.jstree",function(t){return t.preventDefault(),e.vakata.dnd._trigger("move",t,{helper:e(),element:u,data:m}),!1}).on("drop.jstree",e.proxy(function(t){return t.preventDefault(),e.vakata.dnd._trigger("stop",t,{helper:e(),element:u,data:m}),!1},this))},this.redraw_node=function(e,t,s,o){if((e=i.redraw_node.apply(this,arguments))&&this.settings.dnd.use_html5)if(this.settings.dnd.large_drag_target)e.setAttribute("draggable",!0);else{var r,a,n=null;for(r=0,a=e.childNodes.length;a>r;r++)if(e.childNodes[r]&&e.childNodes[r].className&&-1!==e.childNodes[r].className.indexOf("jstree-anchor")){n=e.childNodes[r];break}n&&n.setAttribute("draggable",!0)}return e}},e(function(){var i=!1,s=!1,o=!1,r=!1,a=e('<div id="jstree-marker">&#160;</div>').hide();e(d).on("dnd_start.vakata.jstree",function(e,t){i=!1,o=!1,t&&t.data&&t.data.jstree&&a.appendTo("body")}).on("dnd_move.vakata.jstree",function(n,l){if(r&&(l.event&&"dragover"===l.event.type&&l.event.target===o.target||clearTimeout(r)),l&&l.data&&l.data.jstree&&(!l.event.target.id||"jstree-marker"!==l.event.target.id)){o=l.event;var c,d,h,m,u,p,_,f,g,v,b,y,C,x,k,w,$=e.jstree.reference(l.event.target),j=!1,T=!1,I=!1;if($&&$._data&&$._data.dnd)if(a.attr("class","jstree-"+$.get_theme()+($.settings.core.themes.responsive?" jstree-dnd-responsive":"")),k=l.data.origin&&(l.data.origin.settings.dnd.always_copy||l.data.origin.settings.dnd.copy&&(l.event.metaKey||l.event.ctrlKey)),l.helper.children().attr("class","jstree-"+$.get_theme()+" jstree-"+$.get_theme()+"-"+$.get_theme_variant()+" "+($.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[k?"show":"hide"](),l.event.target!==$.element[0]&&l.event.target!==$.get_container_ul()[0]||0!==$.get_container_ul().children().length){if((j=$.settings.dnd.large_drop_target?e(l.event.target).closest(".jstree-node").children(".jstree-anchor"):e(l.event.target).closest(".jstree-anchor"))&&j.length&&j.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(T=j.offset(),I=(l.event.pageY!==t?l.event.pageY:l.event.originalEvent.pageY)-T.top,h=j.outerHeight(),p=h/3>I?["b","i","a"]:I>h-h/3?["a","i","b"]:I>h/2?["i","a","b"]:["i","b","a"],e.each(p,function(t,o){switch(o){case"b":c=T.left-6,d=T.top,m=$.get_parent(j),u=j.parent().index();break;case"i":C=$.settings.dnd.inside_pos,x=$.get_node(j.parent()),c=T.left-2,d=T.top+h/2+1,m=x.id,u="first"===C?0:"last"===C?x.children.length:Math.min(C,x.children.length);break;case"a":c=T.left-6,d=T.top+h,m=$.get_parent(j),u=j.parent().index()+1}for(_=!0,f=0,g=l.data.nodes.length;g>f;f++)if(v=l.data.origin&&(l.data.origin.settings.dnd.always_copy||l.data.origin.settings.dnd.copy&&(l.event.metaKey||l.event.ctrlKey))?"copy_node":"move_node",b=u,"move_node"===v&&"a"===o&&l.data.origin&&l.data.origin===$&&m===$.get_parent(l.data.nodes[f])&&(y=$.get_node(m),b>e.inArray(l.data.nodes[f],y.children)&&(b-=1)),!(_=_&&($&&$.settings&&$.settings.dnd&&!1===$.settings.dnd.check_while_dragging||$.check(v,l.data.origin&&l.data.origin!==$?l.data.origin.get_node(l.data.nodes[f]):l.data.nodes[f],m,b,{dnd:!0,ref:$.get_node(j.parent()),pos:o,origin:l.data.origin,is_multi:l.data.origin&&l.data.origin!==$,is_foreign:!l.data.origin})))){$&&$.last_error&&(s=$.last_error());break}return"i"===o&&j.parent().is(".jstree-closed")&&$.settings.dnd.open_timeout&&(r=setTimeout(function(e,t){return function(){e.open_node(t)}}($,j),$.settings.dnd.open_timeout)),_?((w=$.get_node(m,!0)).hasClass(".jstree-dnd-parent")||(e(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),w.addClass("jstree-dnd-parent")),i={ins:$,par:m,pos:"i"!==o||"last"!==C||0!==u||$.is_loaded(x)?u:"last"},a.css({left:c+"px",top:d+"px"}).show(),l.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),l.event.originalEvent&&l.event.originalEvent.dataTransfer&&(l.event.originalEvent.dataTransfer.dropEffect=k?"copy":"move"),s={},p=!0,!1):void 0}),!0===p))return}else{for(_=!0,f=0,g=l.data.nodes.length;g>f&&(_=_&&$.check(l.data.origin&&(l.data.origin.settings.dnd.always_copy||l.data.origin.settings.dnd.copy&&(l.event.metaKey||l.event.ctrlKey))?"copy_node":"move_node",l.data.origin&&l.data.origin!==$?l.data.origin.get_node(l.data.nodes[f]):l.data.nodes[f],e.jstree.root,"last",{dnd:!0,ref:$.get_node(e.jstree.root),pos:"i",origin:l.data.origin,is_multi:l.data.origin&&l.data.origin!==$,is_foreign:!l.data.origin}));f++);if(_)return i={ins:$,par:e.jstree.root,pos:"last"},a.hide(),l.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),void(l.event.originalEvent&&l.event.originalEvent.dataTransfer&&(l.event.originalEvent.dataTransfer.dropEffect=k?"copy":"move"))}e(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),i=!1,l.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),l.event.originalEvent&&l.event.originalEvent.dataTransfer&&(l.event.originalEvent.dataTransfer.dropEffect="none"),a.hide()}}).on("dnd_scroll.vakata.jstree",function(e,t){t&&t.data&&t.data.jstree&&(a.hide(),i=!1,o=!1,t.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",function(t,n){if(e(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),r&&clearTimeout(r),n&&n.data&&n.data.jstree){a.hide().detach();var l,c,d=[];if(i){for(l=0,c=n.data.nodes.length;c>l;l++)d[l]=n.data.origin?n.data.origin.get_node(n.data.nodes[l]):n.data.nodes[l];i.ins[n.data.origin&&(n.data.origin.settings.dnd.always_copy||n.data.origin.settings.dnd.copy&&(n.event.metaKey||n.event.ctrlKey))?"copy_node":"move_node"](d,i.par,i.pos,!1,!1,!1,n.data.origin)}else(l=e(n.event.target).closest(".jstree")).length&&s&&s.error&&"check"===s.error&&((l=l.jstree(!0))&&l.settings.core.error.call(this,s));o=!1,i=!1}}).on("keyup.jstree keydown.jstree",function(t,n){(n=e.vakata.dnd._get())&&n.data&&n.data.jstree&&("keyup"===t.type&&27===t.which?(r&&clearTimeout(r),i=!1,s=!1,o=!1,r=!1,a.hide().detach(),e.vakata.dnd._clean()):(n.helper.find(".jstree-copy").first()[n.data.origin&&(n.data.origin.settings.dnd.always_copy||n.data.origin.settings.dnd.copy&&(t.metaKey||t.ctrlKey))?"show":"hide"](),o&&(o.metaKey=t.metaKey,o.ctrlKey=t.ctrlKey,e.vakata.dnd._trigger("move",o))))})}),function(e){e.vakata.html={div:e("<div />"),escape:function(t){return e.vakata.html.div.text(t).html()},strip:function(t){return e.vakata.html.div.empty().append(e.parseHTML(t)).text()}};var i={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};e.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(i,s,o){o===t&&(o=e.vakata.dnd._get()),o.event=s,e(d).triggerHandler("dnd_"+i+".vakata",o)},_get:function(){return{data:i.data,element:i.element,helper:i.helper}},_clean:function(){i.helper&&i.helper.remove(),i.scroll_i&&(clearInterval(i.scroll_i),i.scroll_i=!1),i={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},e(d).off("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(d).off("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop)},_scroll:function(t){if(!i.scroll_e||!i.scroll_l&&!i.scroll_t)return i.scroll_i&&(clearInterval(i.scroll_i),i.scroll_i=!1),!1;if(!i.scroll_i)return i.scroll_i=setInterval(e.vakata.dnd._scroll,100),!1;if(!0===t)return!1;var s=i.scroll_e.scrollTop(),o=i.scroll_e.scrollLeft();i.scroll_e.scrollTop(s+i.scroll_t*e.vakata.dnd.settings.scroll_speed),i.scroll_e.scrollLeft(o+i.scroll_l*e.vakata.dnd.settings.scroll_speed),(s!==i.scroll_e.scrollTop()||o!==i.scroll_e.scrollLeft())&&e.vakata.dnd._trigger("scroll",i.scroll_e)},start:function(t,s,o){"touchstart"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=d.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_drag&&e.vakata.dnd.stop({});try{t.currentTarget.unselectable="on",t.currentTarget.onselectstart=function(){return!1},t.currentTarget.style&&(t.currentTarget.style.touchAction="none",t.currentTarget.style.msTouchAction="none",t.currentTarget.style.MozUserSelect="none")}catch(e){}return i.init_x=t.pageX,i.init_y=t.pageY,i.data=s,i.is_down=!0,i.element=t.currentTarget,i.target=t.target,i.is_touch="touchstart"===t.type,!1!==o&&(i.helper=e("<div id='vakata-dnd'></div>").html(o).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),e(d).on("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(d).on("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop),!1},drag:function(t){if("touchmove"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=d.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_down){if(!i.is_drag){if(!(Math.abs(t.pageX-i.init_x)>(i.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)||Math.abs(t.pageY-i.init_y)>(i.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)))return;i.helper&&(i.helper.appendTo("body"),i.helper_w=i.helper.outerWidth()),i.is_drag=!0,e(i.target).one("click.vakata",!1),e.vakata.dnd._trigger("start",t)}var s=!1,o=!1,r=!1,a=!1,n=!1,l=!1,c=!1,h=!1,m=!1,u=!1;return i.scroll_t=0,i.scroll_l=0,i.scroll_e=!1,e(e(t.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(e(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var s=e(this),o=s.offset();return this.scrollHeight>this.offsetHeight&&(o.top+s.height()-t.pageY<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=1),t.pageY-o.top<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(o.left+s.width()-t.pageX<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=1),t.pageX-o.left<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=-1)),i.scroll_t||i.scroll_l?(i.scroll_e=e(this),!1):void 0}),i.scroll_e||(s=e(d),o=e(window),r=s.height(),a=o.height(),n=s.width(),l=o.width(),c=s.scrollTop(),h=s.scrollLeft(),r>a&&t.pageY-c<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=-1),r>a&&a-(t.pageY-c)<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=1),n>l&&t.pageX-h<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=-1),n>l&&l-(t.pageX-h)<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=1),(i.scroll_t||i.scroll_l)&&(i.scroll_e=s)),i.scroll_e&&e.vakata.dnd._scroll(!0),i.helper&&(m=parseInt(t.pageY+e.vakata.dnd.settings.helper_top,10),u=parseInt(t.pageX+e.vakata.dnd.settings.helper_left,10),r&&m+25>r&&(m=r-50),n&&u+i.helper_w>n&&(u=n-(i.helper_w+2)),i.helper.css({left:u+"px",top:m+"px"})),e.vakata.dnd._trigger("move",t),!1}},stop:function(t){if("touchend"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=d.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_drag)t.target!==i.target&&e(i.target).off("click.vakata"),e.vakata.dnd._trigger("stop",t);else if("touchend"===t.type&&t.target===i.target){var s=setTimeout(function(){e(t.target).click()},100);e(t.target).one("click",function(){s&&clearTimeout(s)})}return e.vakata.dnd._clean(),!1}}}(e),e.jstree.defaults.massload=null,e.jstree.plugins.massload=function(t,i){this.init=function(e,t){this._data.massload={},i.init.call(this,e,t)},this._load_nodes=function(t,s,o,r){var a,n,l,c=this.settings.massload,d=(JSON.stringify(t),[]),h=this._model.data;if(!o){for(a=0,n=t.length;n>a;a++)(!h[t[a]]||!h[t[a]].state.loaded&&!h[t[a]].state.failed||r)&&(d.push(t[a]),(l=this.get_node(t[a],!0))&&l.length&&l.addClass("jstree-loading").attr("aria-busy",!0));if(this._data.massload={},d.length){if(e.isFunction(c))return c.call(this,d,e.proxy(function(e){var a,n;if(e)for(a in e)e.hasOwnProperty(a)&&(this._data.massload[a]=e[a]);for(a=0,n=t.length;n>a;a++)(l=this.get_node(t[a],!0))&&l.length&&l.removeClass("jstree-loading").attr("aria-busy",!1);i._load_nodes.call(this,t,s,o,r)},this));if("object"==typeof c&&c&&c.url)return c=e.extend(!0,{},c),e.isFunction(c.url)&&(c.url=c.url.call(this,d)),e.isFunction(c.data)&&(c.data=c.data.call(this,d)),e.ajax(c).done(e.proxy(function(e,a,n){var c,d;if(e)for(c in e)e.hasOwnProperty(c)&&(this._data.massload[c]=e[c]);for(c=0,d=t.length;d>c;c++)(l=this.get_node(t[c],!0))&&l.length&&l.removeClass("jstree-loading").attr("aria-busy",!1);i._load_nodes.call(this,t,s,o,r)},this)).fail(e.proxy(function(e){i._load_nodes.call(this,t,s,o,r)},this))}}return i._load_nodes.call(this,t,s,o,r)},this._load_node=function(t,s){var o,r=this._data.massload[t.id],a=null;return r?(a=this["string"==typeof r?"_append_html_data":"_append_json_data"](t,"string"==typeof r?e(e.parseHTML(r)).filter(function(){return 3!==this.nodeType}):r,function(e){s.call(this,e)}),(o=this.get_node(t.id,!0))&&o.length&&o.removeClass("jstree-loading").attr("aria-busy",!1),delete this._data.massload[t.id],a):i._load_node.call(this,t,s)}},e.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},e.jstree.plugins.search=function(i,s){this.bind=function(){s.bind.call(this),this._data.search.str="",this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this._data.search.smc=!1,this._data.search.hdn=[],this.element.on("search.jstree",e.proxy(function(t,i){if(this._data.search.som&&i.res.length){var s,o,r,a,n=this._model.data,l=[];for(s=0,o=i.res.length;o>s;s++)if(n[i.res[s]]&&!n[i.res[s]].state.hidden&&(l.push(i.res[s]),l=l.concat(n[i.res[s]].parents),this._data.search.smc))for(r=0,a=n[i.res[s]].children_d.length;a>r;r++)n[n[i.res[s]].children_d[r]]&&!n[n[i.res[s]].children_d[r]].state.hidden&&l.push(n[i.res[s]].children_d[r]);l=e.vakata.array_remove_item(e.vakata.array_unique(l),e.jstree.root),this._data.search.hdn=this.hide_all(!0),this.show_node(l,!0),this.redraw(!0)}},this)).on("clear_search.jstree",e.proxy(function(e,t){this._data.search.som&&t.res.length&&(this.show_node(this._data.search.hdn,!0),this.redraw(!0))},this))},this.search=function(i,s,o,r,a,n){if(!1===i||""===e.trim(i.toString()))return this.clear_search();r=(r=this.get_node(r))&&r.id?r.id:null,i=i.toString();var l,c,d=this.settings.search,h=!!d.ajax&&d.ajax,m=this._model.data,u=null,p=[],_=[];if(this._data.search.res.length&&!a&&this.clear_search(),o===t&&(o=d.show_only_matches),n===t&&(n=d.show_only_matches_children),!s&&!1!==h)return e.isFunction(h)?h.call(this,i,e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(i,!0,o,r,a)})},this),r):((h=e.extend({},h)).data||(h.data={}),h.data.str=i,r&&(h.data.inside=r),e.ajax(h).fail(e.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(h)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(i,!0,o,r,a)})},this)));if(a||(this._data.search.str=i,this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=o,this._data.search.smc=n),u=new e.vakata.search(i,!0,{caseSensitive:d.case_sensitive,fuzzy:d.fuzzy}),e.each(m[r||e.jstree.root].children_d,function(e,t){var s=m[t];s.text&&!s.state.hidden&&(!d.search_leaves_only||s.state.loaded&&0===s.children.length)&&(d.search_callback&&d.search_callback.call(this,i,s)||!d.search_callback&&u.search(s.text).isMatch)&&(p.push(t),_=_.concat(s.parents))}),p.length){for(l=0,c=(_=e.vakata.array_unique(_)).length;c>l;l++)_[l]!==e.jstree.root&&m[_[l]]&&!0===this.open_node(_[l],null,0)&&this._data.search.opn.push(_[l]);a?(this._data.search.dom=this._data.search.dom.add(e(this.element[0].querySelectorAll("#"+e.map(p,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #")))),this._data.search.res=e.vakata.array_unique(this._data.search.res.concat(p))):(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(p,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=p),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:i,res:this._data.search.res,show_only_matches:o})},this.clear_search=function(){this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.res.length&&(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(this._data.search.res,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search")),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=e()},this.redraw_node=function(t,i,o,r){if((t=s.redraw_node.apply(this,arguments))&&-1!==e.inArray(t.id,this._data.search.res)){var a,n,l=null;for(a=0,n=t.childNodes.length;n>a;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){l=t.childNodes[a];break}l&&(l.className+=" jstree-search")}return t}},function(e){e.vakata.search=function(t,i,s){s=s||{},!1!==(s=e.extend({},e.vakata.search.defaults,s)).fuzzy&&(s.fuzzy=!0),t=s.caseSensitive?t:t.toLowerCase();var o,r,a,n,l=s.location,c=s.distance,d=s.threshold,h=t.length;return h>32&&(s.fuzzy=!1),s.fuzzy&&(o=1<<h-1,r=function(){var e={},i=0;for(i=0;h>i;i++)e[t.charAt(i)]=0;for(i=0;h>i;i++)e[t.charAt(i)]|=1<<h-i-1;return e}(),a=function(e,t){var i=e/h,s=Math.abs(l-t);return c?i+s/c:s?1:i}),n=function(e){if(e=s.caseSensitive?e:e.toLowerCase(),t===e||-1!==e.indexOf(t))return{isMatch:!0,score:0};if(!s.fuzzy)return{isMatch:!1,score:1};var i,n,c,m,u,p,_,f,g,v=e.length,b=d,y=e.indexOf(t,l),C=h+v,x=1,k=[];for(-1!==y&&(b=Math.min(a(0,y),b),-1!==(y=e.lastIndexOf(t,l+h))&&(b=Math.min(a(0,y),b))),y=-1,i=0;h>i;i++){for(c=0,m=C;m>c;)a(i,l+m)<=b?c=m:C=m,m=Math.floor((C-c)/2+c);for(C=m,p=Math.max(1,l-m+1),_=Math.min(l+m,v)+h,(f=new Array(_+2))[_+1]=(1<<i)-1,n=_;n>=p;n--)if(g=r[e.charAt(n-1)],f[n]=0===i?(f[n+1]<<1|1)&g:(f[n+1]<<1|1)&g|(u[n+1]|u[n])<<1|1|u[n+1],f[n]&o&&b>=(x=a(i,n-1))){if(b=x,y=n-1,k.push(y),!(y>l))break;p=Math.max(1,2*l-y)}if(a(i+1,l)>b)break;u=f}return{isMatch:y>=0,score:x}},!0===i?{search:n}:n(i)},e.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,caseSensitive:!1}}(e),e.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1},e.jstree.plugins.sort=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("model.jstree",e.proxy(function(e,t){this.sort(t.parent,!0)},this)).on("rename_node.jstree create_node.jstree",e.proxy(function(e,t){this.sort(t.parent||t.node.parent,!1),this.redraw_node(t.parent||t.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",e.proxy(function(e,t){this.sort(t.parent,!1),this.redraw_node(t.parent,!0)},this))},this.sort=function(t,i){var s,o;if((t=this.get_node(t))&&t.children&&t.children.length&&(t.children.sort(e.proxy(this.settings.sort,this)),i))for(s=0,o=t.children_d.length;o>s;s++)this.sort(t.children_d[s],!1)}};var _=!1;e.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1},e.jstree.plugins.state=function(t,i){this.bind=function(){i.bind.call(this);var t=e.proxy(function(){this.element.on(this.settings.state.events,e.proxy(function(){_&&clearTimeout(_),_=setTimeout(e.proxy(function(){this.save_state()},this),100)},this)),this.trigger("state_ready")},this);this.element.on("ready.jstree",e.proxy(function(e,i){this.element.one("restore_state.jstree",t),this.restore_state()||t()},this))},this.save_state=function(){var t={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};e.vakata.storage.set(this.settings.state.key,JSON.stringify(t))},this.restore_state=function(){var t=e.vakata.storage.get(this.settings.state.key);if(t)try{t=JSON.parse(t)}catch(e){return!1}return!(t&&t.ttl&&t.sec&&+new Date-t.sec>t.ttl)&&(t&&t.state&&(t=t.state),t&&e.isFunction(this.settings.state.filter)&&(t=this.settings.state.filter.call(this,t)),!!t&&(this.element.one("set_state.jstree",function(i,s){s.instance.trigger("restore_state",{state:e.extend(!0,{},t)})}),this.set_state(t),!0))},this.clear_state=function(){return e.vakata.storage.del(this.settings.state.key)}},function(e,t){e.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}}}(e),e.jstree.defaults.types={default:{}},e.jstree.defaults.types[e.jstree.root]={},e.jstree.plugins.types=function(i,s){this.init=function(i,o){var r,a;if(o&&o.types&&o.types.default)for(r in o.types)if("default"!==r&&r!==e.jstree.root&&o.types.hasOwnProperty(r))for(a in o.types.default)o.types.default.hasOwnProperty(a)&&o.types[r][a]===t&&(o.types[r][a]=o.types.default[a]);s.init.call(this,i,o),this._model.data[e.jstree.root].type=e.jstree.root},this.refresh=function(t,i){s.refresh.call(this,t,i),this._model.data[e.jstree.root].type=e.jstree.root},this.bind=function(){this.element.on("model.jstree",e.proxy(function(i,s){var o,r,a,n=this._model.data,l=s.nodes,c=this.settings.types,d="default";for(o=0,r=l.length;r>o;o++){if(d="default",n[l[o]].original&&n[l[o]].original.type&&c[n[l[o]].original.type]&&(d=n[l[o]].original.type),n[l[o]].data&&n[l[o]].data.jstree&&n[l[o]].data.jstree.type&&c[n[l[o]].data.jstree.type]&&(d=n[l[o]].data.jstree.type),n[l[o]].type=d,!0===n[l[o]].icon&&c[d].icon!==t&&(n[l[o]].icon=c[d].icon),c[d].li_attr!==t&&"object"==typeof c[d].li_attr)for(a in c[d].li_attr)if(c[d].li_attr.hasOwnProperty(a)){if("id"===a)continue;n[l[o]].li_attr[a]===t?n[l[o]].li_attr[a]=c[d].li_attr[a]:"class"===a&&(n[l[o]].li_attr.class=c[d].li_attr.class+" "+n[l[o]].li_attr.class)}if(c[d].a_attr!==t&&"object"==typeof c[d].a_attr)for(a in c[d].a_attr)if(c[d].a_attr.hasOwnProperty(a)){if("id"===a)continue;n[l[o]].a_attr[a]===t?n[l[o]].a_attr[a]=c[d].a_attr[a]:"href"===a&&"#"===n[l[o]].a_attr[a]?n[l[o]].a_attr.href=c[d].a_attr.href:"class"===a&&(n[l[o]].a_attr.class=c[d].a_attr.class+" "+n[l[o]].a_attr.class)}}n[e.jstree.root].type=e.jstree.root},this)),s.bind.call(this)},this.get_json=function(t,i,o){var r,a,n=this._model.data,l=i?e.extend(!0,{},i,{no_id:!1}):{},c=s.get_json.call(this,t,l,o);if(!1===c)return!1;if(e.isArray(c))for(r=0,a=c.length;a>r;r++)c[r].type=c[r].id&&n[c[r].id]&&n[c[r].id].type?n[c[r].id].type:"default",i&&i.no_id&&(delete c[r].id,c[r].li_attr&&c[r].li_attr.id&&delete c[r].li_attr.id,c[r].a_attr&&c[r].a_attr.id&&delete c[r].a_attr.id);else c.type=c.id&&n[c.id]&&n[c.id].type?n[c.id].type:"default",i&&i.no_id&&(c=this._delete_ids(c));return c},this._delete_ids=function(t){if(e.isArray(t)){for(var i=0,s=t.length;s>i;i++)t[i]=this._delete_ids(t[i]);return t}return delete t.id,t.li_attr&&t.li_attr.id&&delete t.li_attr.id,t.a_attr&&t.a_attr.id&&delete t.a_attr.id,t.children&&e.isArray(t.children)&&(t.children=this._delete_ids(t.children)),t},this.check=function(i,o,r,a,n){if(!1===s.check.call(this,i,o,r,a,n))return!1;o=o&&o.id?o:this.get_node(o),r=r&&r.id?r:this.get_node(r);var l,c,d,h,m=o&&o.id?n&&n.origin?n.origin:e.jstree.reference(o.id):null;switch(m=m&&m._model&&m._model.data?m._model.data:null,i){case"create_node":case"move_node":case"copy_node":if("move_node"!==i||-1===e.inArray(o.id,r.children)){if((l=this.get_rules(r)).max_children!==t&&-1!==l.max_children&&l.max_children===r.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:!(!o||!o.id)&&o.id,par:!(!r||!r.id)&&r.id})},!1;if(l.valid_children!==t&&-1!==l.valid_children&&-1===e.inArray(o.type||"default",l.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:!(!o||!o.id)&&o.id,par:!(!r||!r.id)&&r.id})},!1;if(m&&o.children_d&&o.parents){for(c=0,d=0,h=o.children_d.length;h>d;d++)c=Math.max(c,m[o.children_d[d]].parents.length);c=c-o.parents.length+1}(0>=c||c===t)&&(c=1);do{if(l.max_depth!==t&&-1!==l.max_depth&&l.max_depth<c)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:!(!o||!o.id)&&o.id,par:!(!r||!r.id)&&r.id})},!1;r=this.get_node(r.parent),l=this.get_rules(r),c++}while(r)}}return!0},this.get_rules=function(e){if(!(e=this.get_node(e)))return!1;var i=this.get_type(e,!0);return i.max_depth===t&&(i.max_depth=-1),i.max_children===t&&(i.max_children=-1),i.valid_children===t&&(i.valid_children=-1),i},this.get_type=function(t,i){return!!(t=this.get_node(t))&&(i?e.extend({type:t.type},this.settings.types[t.type]):t.type)},this.set_type=function(i,s){var o,r,a,n,l,c,d,h,m=this._model.data;if(e.isArray(i)){for(r=0,a=(i=i.slice()).length;a>r;r++)this.set_type(i[r],s);return!0}if(o=this.settings.types,i=this.get_node(i),!o[s]||!i)return!1;if((d=this.get_node(i,!0))&&d.length&&(h=d.children(".jstree-anchor")),n=i.type,l=this.get_icon(i),i.type=s,(!0===l||o[n]&&o[n].icon!==t&&l===o[n].icon)&&this.set_icon(i,o[s].icon===t||o[s].icon),o[n].li_attr!==t&&"object"==typeof o[n].li_attr)for(c in o[n].li_attr)if(o[n].li_attr.hasOwnProperty(c)){if("id"===c)continue;"class"===c?(m[i.id].li_attr.class=(m[i.id].li_attr.class||"").replace(o[n].li_attr[c],""),d&&d.removeClass(o[n].li_attr[c])):m[i.id].li_attr[c]===o[n].li_attr[c]&&(m[i.id].li_attr[c]=null,d&&d.removeAttr(c))}if(o[n].a_attr!==t&&"object"==typeof o[n].a_attr)for(c in o[n].a_attr)if(o[n].a_attr.hasOwnProperty(c)){if("id"===c)continue;"class"===c?(m[i.id].a_attr.class=(m[i.id].a_attr.class||"").replace(o[n].a_attr[c],""),h&&h.removeClass(o[n].a_attr[c])):m[i.id].a_attr[c]===o[n].a_attr[c]&&("href"===c?(m[i.id].a_attr[c]="#",h&&h.attr("href","#")):(delete m[i.id].a_attr[c],h&&h.removeAttr(c)))}if(o[s].li_attr!==t&&"object"==typeof o[s].li_attr)for(c in o[s].li_attr)if(o[s].li_attr.hasOwnProperty(c)){if("id"===c)continue;m[i.id].li_attr[c]===t?(m[i.id].li_attr[c]=o[s].li_attr[c],d&&("class"===c?d.addClass(o[s].li_attr[c]):d.attr(c,o[s].li_attr[c]))):"class"===c&&(m[i.id].li_attr.class=o[s].li_attr[c]+" "+m[i.id].li_attr.class,d&&d.addClass(o[s].li_attr[c]))}if(o[s].a_attr!==t&&"object"==typeof o[s].a_attr)for(c in o[s].a_attr)if(o[s].a_attr.hasOwnProperty(c)){if("id"===c)continue;m[i.id].a_attr[c]===t?(m[i.id].a_attr[c]=o[s].a_attr[c],h&&("class"===c?h.addClass(o[s].a_attr[c]):h.attr(c,o[s].a_attr[c]))):"href"===c&&"#"===m[i.id].a_attr[c]?(m[i.id].a_attr.href=o[s].a_attr.href,h&&h.attr("href",o[s].a_attr.href)):"class"===c&&(m[i.id].a_attr.class=o[s].a_attr.class+" "+m[i.id].a_attr.class,h&&h.addClass(o[s].a_attr[c]))}return!0}},e.jstree.defaults.unique={case_sensitive:!1,duplicate:function(e,t){return e+" ("+t+")"}},e.jstree.plugins.unique=function(i,s){this.check=function(t,i,o,r,a){if(!1===s.check.call(this,t,i,o,r,a))return!1;if(i=i&&i.id?i:this.get_node(i),!(o=o&&o.id?o:this.get_node(o))||!o.children)return!0;var n,l,c="rename_node"===t?r:i.text,d=[],h=this.settings.unique.case_sensitive,m=this._model.data;for(n=0,l=o.children.length;l>n;n++)d.push(h?m[o.children[n]].text:m[o.children[n]].text.toLowerCase());switch(h||(c=c.toLowerCase()),t){case"delete_node":return!0;case"rename_node":return(n=-1===e.inArray(c,d)||i.text&&i.text[h?"toString":"toLowerCase"]()===c)||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+c+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:r,obj:!(!i||!i.id)&&i.id,par:!(!o||!o.id)&&o.id})}),n;case"create_node":return(n=-1===e.inArray(c,d))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+c+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:r,obj:!(!i||!i.id)&&i.id,par:!(!o||!o.id)&&o.id})}),n;case"copy_node":return(n=-1===e.inArray(c,d))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+c+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:r,obj:!(!i||!i.id)&&i.id,par:!(!o||!o.id)&&o.id})}),n;case"move_node":return(n=i.parent===o.id&&(!a||!a.is_multi)||-1===e.inArray(c,d))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+c+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:r,obj:!(!i||!i.id)&&i.id,par:!(!o||!o.id)&&o.id})}),n}return!0},this.create_node=function(i,o,r,a,n){if(!o||o.text===t){if(null===i&&(i=e.jstree.root),!(i=this.get_node(i)))return s.create_node.call(this,i,o,r,a,n);if(!(r=r===t?"last":r).toString().match(/^(before|after)$/)&&!n&&!this.is_loaded(i))return s.create_node.call(this,i,o,r,a,n);o||(o={});var l,c,d,h,m,u=this._model.data,p=this.settings.unique.case_sensitive,_=this.settings.unique.duplicate;for(c=l=this.get_string("New node"),d=[],h=0,m=i.children.length;m>h;h++)d.push(p?u[i.children[h]].text:u[i.children[h]].text.toLowerCase());for(h=1;-1!==e.inArray(p?c:c.toLowerCase(),d);)c=_.call(this,l,++h).toString();o.text=c}return s.create_node.call(this,i,o,r,a,n)}};var f=d.createElement("DIV");if(f.setAttribute("unselectable","on"),f.setAttribute("role","presentation"),f.className="jstree-wholerow",f.innerHTML="&#160;",e.jstree.plugins.wholerow=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("ready.jstree set_state.jstree",e.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",e.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var i,s,o=!1;for(i=0,s=t.selected.length;s>i;i++)(o=this.get_node(t.selected[i],!0))&&o.length&&o.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",e.proxy(function(e,t){this.get_node(t.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",e.proxy(function(e,t){"hover_node"===e.type&&this.is_disabled(t.node)||this.get_node(t.node,!0).children(".jstree-wholerow")["hover_node"===e.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",e.proxy(function(t){if(this._data.contextmenu){t.preventDefault();var i=e.Event("contextmenu",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,pageX:t.pageX,pageY:t.pageY});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i)}},this)).on("click.jstree",".jstree-wholerow",function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",e.proxy(function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",e.proxy(function(e){return e.stopImmediatePropagation(),this.is_disabled(e.currentTarget)||this.hover_node(e.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),i.teardown.call(this)},this.redraw_node=function(t,s,o,r){if(t=i.redraw_node.apply(this,arguments)){var a=f.cloneNode(!0);-1!==e.inArray(t.id,this._data.core.selected)&&(a.className+=" jstree-wholerow-clicked"),this._data.core.focused&&this._data.core.focused===t.id&&(a.className+=" jstree-wholerow-hovered"),t.insertBefore(a,t.childNodes[0])}return t}},window.customElements&&Object&&Object.create){var g=Object.create(HTMLElement.prototype);g.createdCallback=function(){var t,i={core:{},plugins:[]};for(t in e.jstree.plugins)e.jstree.plugins.hasOwnProperty(t)&&this.attributes[t]&&(i.plugins.push(t),this.getAttribute(t)&&JSON.parse(this.getAttribute(t))&&(i[t]=JSON.parse(this.getAttribute(t))));for(t in e.jstree.defaults.core)e.jstree.defaults.core.hasOwnProperty(t)&&this.attributes[t]&&(i.core[t]=JSON.parse(this.getAttribute(t))||this.getAttribute(t));e(this).jstree(i)};try{window.customElements.define("vakata-jstree",{prototype:g})}catch(e){}}}}),function(e){"use strict";e.fn.bootstrapSwitch=function(t){var i='input[type!="hidden"]',s={init:function(){return this.each(function(){var t,s,o,r,a,n,l=e(this),c=l.closest("form"),d="",h=l.attr("class"),m="ON",u="OFF",p=!1,_=!1;e.each(["switch-mini","switch-small","switch-large"],function(e,t){h.indexOf(t)>=0&&(d=t)}),l.addClass("has-switch"),void 0!==l.data("on")&&(a="switch-"+l.data("on")),void 0!==l.data("on-label")&&(m=l.data("on-label")),void 0!==l.data("off-label")&&(u=l.data("off-label")),void 0!==l.data("label-icon")&&(p=l.data("label-icon")),void 0!==l.data("text-label")&&(_=l.data("text-label")),s=e("<span>").addClass("switch-left").addClass(d).addClass(a).html(m),a="",void 0!==l.data("off")&&(a="switch-"+l.data("off")),o=e("<span>").addClass("switch-right").addClass(d).addClass(a).html(u),r=e("<label>").html("&nbsp;").addClass(d).attr("for",l.find(i).attr("id")),p&&r.html('<i class="icon '+p+'"></i>'),_&&r.html(""+_),t=l.find(i).wrap(e("<div>")).parent().data("animated",!1),!1!==l.data("animated")&&t.addClass("switch-animate").data("animated",!0),t.append(s).append(r).append(o),l.find(">div").addClass(l.find(i).is(":checked")?"switch-on":"switch-off"),l.find(i).is(":disabled")&&e(this).addClass("deactivate");var f=function(e){l.parent("label").is(".label-change-switch")||e.siblings("label").trigger("mousedown").trigger("mouseup").trigger("click")};l.on("keydown",function(t){32===t.keyCode&&(t.stopImmediatePropagation(),t.preventDefault(),f(e(t.target).find("span:first")))}),s.on("click",function(t){f(e(this))}),o.on("click",function(t){f(e(this))}),l.find(i).on("change",function(t,i){var s=e(this),o=s.parent(),r=s.is(":checked"),a=o.is(".switch-off");if(t.preventDefault(),o.css("left",""),a===r){if(r?o.removeClass("switch-off").addClass("switch-on"):o.removeClass("switch-on").addClass("switch-off"),!1!==o.data("animated")&&o.addClass("switch-animate"),"boolean"==typeof i&&i)return;o.parent().trigger("switch-change",{el:s,value:r})}}),l.find("label").on("mousedown touchstart",function(t){var i=e(this);n=!1,t.preventDefault(),t.stopImmediatePropagation(),i.closest("div").removeClass("switch-animate"),i.closest(".has-switch").is(".deactivate")?i.unbind("click"):i.closest(".switch-on").parent().is(".radio-no-uncheck")?i.unbind("click"):(i.on("mousemove touchmove",function(t){var i=e(this).closest(".make-switch"),s=((t.pageX||t.originalEvent.targetTouches[0].pageX)-i.offset().left)/i.width()*100;n=!0,s<25?s=25:s>75&&(s=75),i.find(">div").css("left",s-75+"%")}),i.on("click touchend",function(t){var i=e(this),s=e(t.target).siblings("input");t.stopImmediatePropagation(),t.preventDefault(),i.unbind("mouseleave"),n?s.prop("checked",!(parseInt(i.parent().css("left"))<-25)):s.prop("checked",!s.is(":checked")),n=!1,s.trigger("change")}),i.on("mouseleave",function(t){var i=e(this),s=i.siblings("input");t.preventDefault(),t.stopImmediatePropagation(),i.unbind("mouseleave"),i.trigger("mouseup"),s.prop("checked",!(parseInt(i.parent().css("left"))<-25)).trigger("change")}),i.on("mouseup",function(t){t.stopImmediatePropagation(),t.preventDefault(),e(this).unbind("mousemove")}))}),"injected"!==c.data("bootstrapSwitch")&&(c.bind("reset",function(){setTimeout(function(){c.find(".make-switch").each(function(){var t=e(this).find(i);t.prop("checked",t.is(":checked")).trigger("change")})},1)}),c.data("bootstrapSwitch","injected"))})},toggleActivation:function(){var t=e(this);t.toggleClass("deactivate"),t.find(i).prop("disabled",t.is(".deactivate"))},isActive:function(){return!e(this).hasClass("deactivate")},setActive:function(t){var s=e(this);t?(s.removeClass("deactivate"),s.find(i).removeAttr("disabled")):(s.addClass("deactivate"),s.find(i).attr("disabled","disabled"))},toggleState:function(t){var i=e(this).find(":checkbox");i.prop("checked",!i.is(":checked")).trigger("change",t)},toggleRadioState:function(t){var i=e(this).find(":radio");i.not(":checked").prop("checked",!i.is(":checked")).trigger("change",t)},toggleRadioStateAllowUncheck:function(t,i){var s=e(this).find(":radio");t?s.not(":checked").trigger("change",i):s.not(":checked").prop("checked",!s.is(":checked")).trigger("change",i)},setState:function(t,s){e(this).find(i).prop("checked",t).trigger("change",s)},setOnLabel:function(t){e(this).find(".switch-left").html(t)},setOffLabel:function(t){e(this).find(".switch-right").html(t)},setOnClass:function(t){var i=e(this).find(".switch-left"),s="";void 0!==t&&(void 0!==e(this).attr("data-on")&&(s="switch-"+e(this).attr("data-on")),i.removeClass(s),s="switch-"+t,i.addClass(s))},setOffClass:function(t){var i=e(this).find(".switch-right"),s="";void 0!==t&&(void 0!==e(this).attr("data-off")&&(s="switch-"+e(this).attr("data-off")),i.removeClass(s),s="switch-"+t,i.addClass(s))},setAnimated:function(t){var s=e(this).find(i).parent();void 0===t&&(t=!1),s.data("animated",t),s.attr("data-animated",t),!1!==s.data("animated")?s.addClass("switch-animate"):s.removeClass("switch-animate")},setSizeClass:function(t){var i=e(this),s=i.find(".switch-left"),o=i.find(".switch-right"),r=i.find("label");e.each(["switch-mini","switch-small","switch-large"],function(e,i){i!==t?(s.removeClass(i),o.removeClass(i),r.removeClass(i)):(s.addClass(i),o.addClass(i),r.addClass(i))})},status:function(){return e(this).find(i).is(":checked")},destroy:function(){var t,i=e(this),s=i.find("div"),o=i.closest("form");return s.find(":not(input)").remove(),(t=s.children()).unwrap().unwrap(),t.unbind("change"),o&&(o.unbind("reset"),o.removeData("bootstrapSwitch")),t}};return s[t]?s[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist!"):s.init.apply(this,arguments)}}(jQuery),melisCore.screenSize>=768&&$(window).on("scroll click resize",function(e){$("#id_meliscommerce_categories_category_header").css("width","100%");var t=$("#"+activeTabId+" #id_meliscommerce_categories_category"),i=$("#id_meliscommerce_categories_category_tabs .widget-head ul li.active a.search.active");t.length&&(t.position().top<$(window).scrollTop()-10&&1!==i.length?($("#id_meliscommerce_categories_category").addClass("fix-cat"),$("#saveCategory").css("margin-top","10px"),$("#id_meliscommerce_categories_category_header").width($("#id_meliscommerce_categories_list").width())):($("#id_meliscommerce_categories_category").removeClass("fix-cat"),$("#categoryInfoPanel").css("padding-top","0"),$("#saveCategory").css("margin-top","0")))});var categoryOpeningItemFlag=!0;$(function(){var e=$("body");e.on("click",".addCategory",function(e){$("#categoryTreeViewPanel").collapse("hide");var t="id_meliscommerce_categories_category",i=$("#categoryTreeView").jstree(!0).get_selected(),s="";i.length>=1&&(s=parseInt(i[0])),$("#"+t).removeClass("hidden"),melisHelper.zoneReload(t,"meliscommerce_categories_category",{catId:0,catFatherId:s}),melisCommerce.setUniqueId(0)}),e.on("click",".addCatalog",function(e){$("#categoryTreeViewPanel").collapse("hide");var t="id_meliscommerce_categories_category";$("#"+t).removeClass("hidden"),melisHelper.zoneReload(t,"meliscommerce_categories_category",{catId:0,catFatherId:-1}),melisCommerce.setUniqueId(0)}),e.on("click","#saveCategory",function(){var e=$(this),t=e.data("catid"),s=new Array;e.button("loading"),(s=$("#id_meliscommerce_categories_category form").not(".category_"+t+"_seo_form, .cat_trans_form").serializeArray()).push({name:"cat_id",value:t}),s=melisCommerceSeo.serializeSeo("category",t,s);var o=e.data("catfatherid");s.push({name:"cat_father_cat_id",value:o});var r=0;$('input[name="cat_status"]').is(":checked")&&(r=1),s.push({name:"cat_status",value:r}),$("form.cat_trans_form").each(function(){var e=$(this);langLocale=e.data("locale"),langId=e.data("langid"),catDataString=e.serializeArray(),$.each(catDataString,function(){s.push({name:"cat_trans["+langId+"]["+this.name+"]",value:this.value})})}),$("form.categoriesPriceDiscountForm").each(function(){var e=$(this),t=e.data("countryid"),i=e.data("groupid"),o=e.serializeArray();$.each(o,function(){""!==this.value&&s.push({name:"price_discount["+t+"]["+i+"]["+this.name+"]",value:this.value})})}),s=$.param(s),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComCategory/saveCategory",data:s,dataType:"json",encode:!0,cache:!1}).done(function(e){$("body");if($("#saveCategory").button("reset"),e.success){$("#categoryTreeViewPanel").collapse("show"),$("body").animate({scrollTop:0},1e3),melisCore.flashMessenger(),melisHelper.melisOkNotification(e.textTitle,e.textMessage);var s=$("#categoryTreeView").jstree(!0),r=s.settings.core.data.url,a="";if(0==t){var n=s.get_node(o),l=new Array;if(nodeParentsStr="",l.push(o),"object"==typeof n&&n.parents.length>1)for(i=0;i<n.parents.length-1;i++)l.push(n.parents[i]);nodeParentsStr="&openStateParent="+l.join(),a=e.cat_id}else{n=s.get_node(t),l=new Array;if(nodeParentsStr="",!1!==n){if(n.parents.length>1){for(i=0;i<n.parents.length-1;i++)l.push(n.parents[i]);nodeParentsStr="&openStateParent="+l.join()}s.get_node(t).state.selected=!0}a=t}s.settings.core.data.url=r+"&selected="+a+nodeParentsStr,s.deselect_all(),$("#categoryTreeView ul li div").removeClass("jstree-wholerow-clicked"),s.refresh(),s.settings.core.data.url=r;melisHelper.zoneReload("id_meliscommerce_categories_category","meliscommerce_categories_category",{catId:a}),melisCommerce.setUniqueId(a),$("#categoryTreeView #"+a+" div").first().addClass("jstree-wholerow-clicked")}else melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"id_meliscommerce_categories_category_form_transalations");melisCore.flashMessenger()}).fail(function(){$("#saveCategory").button("reset"),alert(translations.tr_meliscore_error_message)})}),e.on("click",".category-tree-view-lang.commerce-category-tree-view-lang li a",function(){var e=$(this),t=e.text(),i=e.data("locale");categoryOpeningItemFlag=!1,$(".cat-tree-view-languages.commerce-category-tree-view-languages span.filter-key").text(t),$("#categoryTreeView").data("langlocale",i),$("#categoryTreeView").jstree(!0).settings.core.data.data=[{name:"langlocale",value:i}],$("#categoryTreeView").jstree(!0).refresh()}),e.on("keyup","#categoryTreeViewSearchInput",function(e){var t=$(this).val().trim(),i=$("#categoryTreeView").jstree("search",t);categoryOpeningItemFlag=!1,setTimeout(function(){0==$(i).find(".jstree-search").length&&""!=t?($("#searchNoResult").removeClass("hidden"),$("#searchNoResult").find("strong").text(t)):$("#searchNoResult").addClass("hidden")},1500)}),e.on("keyup keypress","#categoryTreeViewSearchForm",function(e){if(13===(e.keyCode||e.which))return e.preventDefault(),!1}),e.on("click","#clearSearchInputBtn",function(e){$("#categoryTreeView").jstree(!0);categoryOpeningItemFlag=!1,$("#categoryTreeViewSearchInput").val(""),$("#categoryTreeView").jstree("search","")}),e.on("click","#expandCategoryTreeViewBtn",function(e){categoryOpeningItemFlag=!1,$("#categoryTreeView").jstree("open_all")}),e.on("click","#collapseCategoryTreeViewBtn",function(e){categoryOpeningItemFlag=!1,$("#categoryTreeView").jstree("close_all")}),e.on("click","#refreshCategoryTreeView",function(e){categoryOpeningItemFlag=!1;var t=$("#categoryTreeView").jstree(!0);t.deselect_all(),t.refresh(),$("#categoryTreeViewSearchInput").val(""),$("#categoryTreeView").jstree("search","")}),e.on("click",".ecom-coutries-checkbox",function(e){var t=$(this);t.find(".fa").hasClass("fa-check-square-o")?(t.find(".fa").removeClass("fa-check-square-o"),t.find(".fa").addClass("fa-square-o"),t.find('input[type="checkbox"]').removeAttr("checked"),t.find(".check-all").hasClass("fa-square-o")&&($(".ecom-coutries-checkbox .fa").not(".check-all").addClass("fa-square-o"),$(".ecom-coutries-checkbox .fa").not(".check-all").removeClass("fa-check-square-o"),$(".ecom-coutries-checkbox .fa").not(".check-all").next('input[type="checkbox"]').removeAttr("checked"))):(t.find(".fa").removeClass("fa-square-o"),t.find(".fa").addClass("fa-check-square-o"),t.find('input[type="checkbox"]').attr("checked","checked")),$(".ecom-coutries-checkbox .fa").not(".check-all").length==$(".ecom-coutries-checkbox .fa.fa-check-square-o").not(".check-all").next('input[type="checkbox"]:checked').length||t.find(".check-all").hasClass("fa-check-square-o")?($(".ecom-coutries-checkbox .fa").not(".check-all").removeClass("fa-square-o"),$(".ecom-coutries-checkbox .fa").not(".check-all").addClass("fa-check-square-o"),$(".ecom-coutries-checkbox .fa").not(".check-all").next('input[type="checkbox"]').removeAttr("checked"),$(".ecom-coutries-checkbox .fa.check-all").removeClass("fa-square-o"),$(".ecom-coutries-checkbox .fa.check-all").addClass("fa-check-square-o"),$(".ecom-coutries-checkbox .fa.check-all").next('input[type="checkbox"]').attr("checked","checked")):($(".ecom-coutries-checkbox .fa.fa-check-square-o").not(".check-all").next('input[type="checkbox"]').attr("checked","checked"),$(".ecom-coutries-checkbox .fa.check-all").addClass("fa-square-o"),$(".ecom-coutries-checkbox .fa.check-all").removeClass("fa-check-square-o"),$(".ecom-coutries-checkbox .fa.check-all").next('input[type="checkbox"]').removeAttr("checked")),e.stopPropagation(),e.preventDefault()}),e.on("switch-change","#cat_status",function(e,t){var i=$(this);1==t.value?i.find('input[type="checkbox"]').attr("checked","checked"):i.find('input[type="checkbox"]').removeAttr("checked")}),e.on("click",".categoryProductsRefresh",function(e,t){var i=$("#categoryProductListTbl").data("catid");melisHelper.zoneReload("id_meliscommerce_categories_category_tab_products","meliscommerce_categories_category_tab_products",{catId:i,activateTab:!0})}),e.on("click",".categoryProductsRemove",function(){var e=$(this).parents("tr").attr("id"),t=$("#categoryProductListTbl").data("catid"),i=$("#saveCategory").data("catfatherid"),s=translations.tr_meliscommerce_categories_category_product_remove,o=translations.tr_meliscommerce_categories_category_product_remove_confirm_msg;"-1"==i&&(s=translations.tr_meliscommerce_categories_catalog_product_remove,o=translations.tr_meliscommerce_categories_catalog_product_remove_confirm_msg),melisCoreTool.confirm(translations.tr_meliscommerce_categories_common_label_yes,translations.tr_meliscommerce_categories_common_label_no,s,o,function(){var s=new Array;s.push({name:"pcat_id",value:e}),s.push({name:"parent_id",value:i}),s.push({name:"cat_id",value:t}),s=$.param(s),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComCategory/removeCategoryProduct",data:s,dataType:"json",encode:!0}).done(function(e){e.success?melisHelper.zoneReload("id_meliscommerce_categories_category_tab_products","meliscommerce_categories_category_tab_products",{catId:t,activateTab:!0}):alert(translations.tr_meliscore_error_message),melisCore.flashMessenger(),melisHelper.melisOkNotification(e.textTitle,e.textMessage)}).fail(function(){alert(translations.tr_meliscore_error_message)})})}),e.on("click",".categoryProductsView",function(){var e=$(this),t=e.closest("tr").data("productid"),i=e.closest("tr").data("productname"),s="id_meliscommerce_product_list_container";melisHelper.tabOpen(translations.tr_meliscommerce_products_Products,"fa icon-shippment fa-2x","id_meliscommerce_product_list_container","meliscommerce_product_list_container");var o=$("body #melis-id-nav-bar-tabs li a.tab-element[data-id='"+s+"']"),r=setInterval(function(){o.length&&(melisCommerce.openProductPage(t,i,s),melisCommerce.setUniqueId(t),clearInterval(r))},500)}),e.on("dblclick","#categoryTreeViewPanel .jstree-node",function(e){e.stopPropagation(),e.preventDefault(),$("#categoryTreeViewPanel").collapse("hide");var t=$(this),i=parseInt(t.attr("id"),10),s="id_meliscommerce_categories_category";$("#"+s).removeClass("hidden"),melisHelper.zoneReload(s,"meliscommerce_categories_category",{catId:i}),$("#categoryTreeView #"+i+" div").first().addClass("jstree-wholerow-clicked"),melisCommerce.setUniqueId(i)}),e.on("click","#categoryTreeView .jstree-clicked",function(){var e=$("#"+activeTabId+" .addCategory");e.attr("disabled",!1),e.attr("title",null)}),e.on("click",".cat-div .jstree-node .jstree-icon",function(){categoryOpeningItemFlag=!0}),e.on("mouseenter mouseleave","#categoryProductListTbl .toolTipHoverEvent",function(e){var t=$(this).data("productid");loaderText='<div class="qtipLoader"><hr/><span class="text-center col-lg-12">Loading...</span><br/></div>',$(".thClassColId").attr("style",""),$.each($("table#catProductTable"+t+" thead").nextAll(),function(e,t){$(t).remove()}),$(loaderText).insertAfter("table#catProductTable"+t+" thead"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComProductList/getToolTip",data:{productId:t},dataType:"json",encode:!0}).done(function(e){$("div.qtipLoader").remove(),0===e.content.length?$('<div class="qtipLoader"><hr/><span class="text-center col-lg-12">'+translations.tr_meliscommerce_product_tooltip_no_variants+"</span><br/></div>").insertAfter("table.qtipTable thead"):($.each($("table#catProductTable"+t+" thead").nextAll(),function(e,t){$(t).remove()}),$.each(e.content.reverse(),function(e,i){$(i).insertAfter("table#catProductTable"+t+" thead")}))}).fail(function(e,t,i){alert(translations.tr_meliscore_error_message)})}),e.on("click","#categoryInfoPanel .widget-head .nav-tabs li a.shopping_cart",function(){melisCore.screenSize<=767&&$("#id_meliscommerce_categories_category_tab_products").find(".categoryProductsRefresh").trigger("click")})}),window.enableDisableAddCategoryBtn=function(e){var t=$(".addCategory");"enable"==e?(t.attr("disabled",!1),t.attr("title",null)):"disable"==e&&(t.attr("disabled",!0),t.attr("title",translations.tr_meliscommerce_categories_category_no_selected_catalog_category))},window.initCategoryTreeView=function(){$(this);var e=$("body"),t=$("#categoryTreeView");e.on("click","#categoryTreeView",function(e){$("#categoryTreeView ul li div").removeClass("jstree-wholerow-clicked"),e.stopPropagation(),e.preventDefault()}),t.on("changed.jstree",function(e,t){enableDisableAddCategoryBtn("enable")}).on("refresh.jstree",function(e,t){enableDisableAddCategoryBtn("disable")}).on("loading.jstree",function(e,t){melisCommerce.pendingZoneStart("meliscommerce_categories_list_search_input")}).on("loaded.jstree",function(e,t){melisCommerce.pendingZoneDone("meliscommerce_categories_list_search_input"),$("ul.jstree-container-ul > li > a").each(function(){var e=$(this),t=e.data("fathericon"),i=e.find("i");e.html(i.get(0).outerHTML+"<strong>"+t+" "+e.text()+"</strong>")})}).on("refresh.jstree",function(e,t){$("ul.jstree-container-ul > li > a").each(function(){var e=$(this),t=e.data("fathericon"),i=e.find("i");e.html(i.get(0).outerHTML+"<strong>"+t+" "+e.text()+"</strong>")})}).on("ready.jstree",function(e,t){}).on("load_node.jstree",function(e,t){}).on("open_node.jstree",function(e,t){1==categoryOpeningItemFlag&&$(".cat-div").length&&$(".cat-div #"+t.node.id).offset().top+$(".cat-div #"+t.node.id).height()>$(".cat-div").offset().top+$(".cat-div").height()&&($timeOut=setTimeout(function(){var e=$(".cat-div").scrollTop(),i=$(".cat-div #"+t.node.id).innerHeight();$(".cat-div").animate({scrollTop:e+i},"slow")},1e3))}).on("after_open.jstree",function(e,t){$.each(t.node.children_d,function(e,t){var i=$("#"+t+"_anchor").data("textlang"),s=$("#"+t+"_anchor").data("numprods"),o='<span title="'+translations.tr_meliscommerce_categories_list_tree_view_product_num+'">('+s+")</span>",r=$("#"+t+"_anchor").data("seopage");r&&(o=o+' - <span class="fa fa-file-o"></span> '+r),i&&(o=" "+i+o),$("#"+t+"_anchor").hasClass("updatedText")||($("#"+t+"_anchor").append(o),$("#"+t+"_anchor").addClass("updatedText"))})}).on("move_node.jstree",function(e,t){var i=t.node.id,s="#"==t.parent?"-1":t.parent,o="#"==t.old_parent?"-1":t.old_parent,r=t.position+1,a=new Array;a.push({name:"cat_id",value:parseInt(i,10)}),a.push({name:"cat_father_cat_id",value:parseInt(s,10)}),a.push({name:"cat_order",value:r}),a.push({name:"old_parent",value:parseInt(o,10)}),a=$.param(a),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComCategoryList/saveCategoryTreeView",data:a,dataType:"json",encode:!0}).done(function(e){e.success?($currentCategoryId=$("#saveCategory").data("catid"),$currentCategoryId==i&&$("#saveCategory").data("catfatherid",s)):alert(translations.tr_meliscore_error_message)}).fail(function(){alert(translations.tr_meliscore_error_message)})}).jstree({contextmenu:{items:function(e){return{Add:{label:translations.tr_meliscommerce_categories_common_btn_add,icon:"fa fa-plus",action:function(t){var i=parseInt(e.id),s=e.children.length+1;$("#categoryTreeViewPanel").collapse("hide");melisHelper.zoneReload("id_meliscommerce_categories_category","meliscommerce_categories_category",{catId:0,catFatherId:i,catOrder:s})}},Update:{label:translations.tr_meliscommerce_categories_common_btn_update,icon:"fa fa-edit",action:function(t){var i=parseInt(e.id,10);melisHelper.zoneReload("id_meliscommerce_categories_category","meliscommerce_categories_category",{catId:i}),$("#categoryTreeViewPanel").collapse("hide")}},Delete:{label:translations.tr_meliscommerce_categories_common_btn_delete,icon:"fa fa-trash-o",action:function(t){var i=new Array,s="#"==e.parent?"-1":parseInt(e.parent,10);i.push({name:"cat_father_cat_id",value:s});var o=parseInt(e.id);i.push({name:"cat_id",value:o}),i=$.param(i);var r=translations.tr_meliscommerce_categories_category_delete,a=translations.tr_meliscommerce_categories_category_delete_confirm_msg;"-1"==s&&(r=translations.tr_meliscommerce_categories_catalog_delete,a=translations.tr_meliscommerce_categories_catalog_delete_confirm_msg),melisCoreTool.confirm(translations.tr_meliscommerce_categories_common_label_yes,translations.tr_meliscommerce_categories_common_label_no,r,a,function(){$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComCategory/deleteCategory",data:i,dataType:"json",encode:!0}).done(function(e){if(e.success){if($("#categoryTreeView").jstree(!0).delete_node(o+"_categoryId_anchor"),$("#saveCategory").data("catid")==o){melisHelper.zoneReload("id_meliscommerce_categories_category","meliscommerce_categories_category")}melisCore.flashMessenger(),melisHelper.melisOkNotification(e.textTitle,e.textMessage)}else melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors)}).fail(function(){alert(translations.tr_meliscore_error_message)})})}}}}},core:{multiple:!1,check_callback:!0,animation:500,themes:{name:"proton",responsive:!1},dblclick_toggle:!1,data:{cache:!1,url:"/melis/MelisCommerce/MelisComCategoryList/getCategoryTreeView?langlocale="+$("#categoryTreeView").data("langlocale")}},types:{"#":{valid_children:["catalog"]},catalog:{valid_children:["category"]},category:{valid_children:["category"]}},plugins:["contextmenu","changed","dnd","search","types"]}),e.on("click",".categoryProductsExport",function(){melisCoreTool.isTableEmpty("categoryProductListTbl")||melisCoreTool.exportData("/melis/MelisCommerce/MelisComCategory/productsExportToCsv?catId="+$(this).data("catid"))})},window.initCategoryStatus=function(){$("#cat_status").bootstrapSwitch()},window.initCategoryProducts=function(e,t){var i=$("#"+t.sTableId).data("catid");e.catId=i;var s=$("#categoryTreeView").data("langlocale");e.catLangLocale=s,$("#categoryProductListTbl").on("row-reorder.dt",function(e,t,i){i.triggerRow.data()[1];for(var s=0,o=t.length;s<o;s++){$categoryProductListTbl.row(t[s].node).data()[1]+" updated to be in position "+t[s].newData+" (was "+t[s].oldData+")<br>"}if(!$.isEmptyObject(t)){var r=new Array,a=new Array;$.each(t,function(){a.push(this.node.id+"-"+this.newPosition)}),r.push({name:"catPrdOrderData",value:a.join()}),r=$.param(r),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComCategory/reOrderCategoryProducts",data:r,dataType:"json",encode:!0}).done(function(e){e.success||alert(translations.tr_meliscore_error_message)}).fail(function(){alert(translations.tr_meliscore_error_message)})}})},window.initCategoryProductsImgs=function(){lightbox.option({resizeDuration:200,wrapAround:!0})},$(function(){var e=$("body");e.on("keyup keydown change","input[name='eseo_meta_title']",{limit:60},seoCharCounter),e.on("keyup keydown change","textarea[name='eseo_meta_description']",{limit:160},seoCharCounter)}),window.preSeoCharCounter=function(){$("form.seoForm").each(function(){var e=$(this),t=e.find("input[name='eseo_meta_title']"),i=e.find("textarea[name='eseo_meta_description']");t.trigger("keyup"),i.trigger("keyup")})},window.seoCharCounter=function(e){var t=$(this),i=t.val().length,s=t.prev("label"),o=e.data.limit;s.find(".label-text span").length?0===i?(s.removeClass("limit"),s.find(".label-text span").remove()):(s.find(".label-text span").html('<i class="fa fa-text-width"></i>('+i+")"),i>o?(s.addClass("limit"),s.find(".label-text span").addClass("limit")):(s.removeClass("limit"),s.find(".label-text span").removeClass("limit"))):0!==i&&(s.find(".label-text").append("<span class='text-counter-indicator'><i class='fa fa-text-width'></i>("+i+")</span>"),i>o&&(s.addClass("limit"),s.find(".label-text span").addClass("limit")))};var melisCommerceSeo=function(e){return{serializeSeo:function(e,t,i){var s=new Array;return $("form."+e+"_"+t+"_seo_form").each(function(){langId=$(this).data("langid"),s=$(this).serializeArray(),$.each(s,function(){i.push({name:e+"_seo["+langId+"]["+this.name+"]",value:this.value})})}),i}}}(window),catTreeConfig=function(){var e=$("body"),t="",i="",s="",o=!0;function r(e,t,i,s){s=void 0===s?null:s;var o=i.jstree().get_node(t);o&&(o.state.selected||("enable"==e?($("#"+o.id).css("color","#72af46"),i.jstree("enable_node",o)):(i.jstree("disable_node",o),i.jstree("uncheck_node",o)),o.children.forEach(function(t){r(e,t,i)}))),null!==s&&s()}return e.on("click","#catTreeFilterPluginConfig ul li",function(e){if(o){var a=$(this);if(a.find("a").attr("id")===$(e.target).attr("id")){var n="#"+a.attr("id");if(i!=n)r("enable",n,t,function(){t.jstree("deselect_node",i),function(e,i){var s=i.replace("#",""),o=t.jstree().get_node(e);-1===jQuery.inArray(s,o.children)&&-1===jQuery.inArray(s,o.children_d)&&t.jstree("close_node",e);""==t.jstree().get_node(i).parent.replace("#","")?(r("enable",e,t),t.jstree("uncheck_node",e)):r("disable",e,t);-1!==jQuery.inArray(s,o.parents)&&r("enable",e,t)}(i,n),t.jstree("select_node",n),t.jstree("open_node",n),t.jstree("check_node",n),r("enable",n,t),i=n});else t.jstree().get_node(n).state.selected?(t.jstree("deselect_node",n),r("disable",n,t),$(s+"_form input[name='m_box_root_category_tree_id']").val("")):r("enable",n,t,function(){t.jstree("select_node",n),t.jstree("check_node",n)})}}}),{setCategoryTreeConfig:function(e,a,n,l,c){if(c=null==c||c,o=l=null==l||l,i="#"+n+"_categoryId",s=(t=e).selector,jQuery.isEmptyObject(a)||$.each(a,function(e,i){var s="#"+i+"_categoryId";t.jstree("open_node",s),t.jstree("check_node",s),setTimeout(function(){!function e(i){var s=t.jstree().get_node(i);s&&($("#"+s.id).css("color","#72af46"),s.children.forEach(function(t){e(t)}))}(s)},50)}),0!=n){var d="#"+n+"_categoryId";t.jstree("select_node",d)}c&&function(e,t){t.jstree("get_json").forEach(function(i){r(e,i,t)})}("disable",t)}}}();window.initProductSwitch=function(){setOnOff(),allLoaded()},window.initProductCategoryList=function(e,t){if(void 0===t&&(t=melisLangId),$("#"+e+"_productCategoryList").length){var i=$("#"+e+"_productCategoryList");t!==melisLangId&&i.data("langlocale",t),i.jstree("destroy");var s=new Array;s.push({name:"productId",value:e}),s.push({name:"idAndNameOnly",value:!0}),s.push({name:"langlocale",value:i.data("langlocale")}),$("div#"+e+"_product_category_area > span.prod-cat-values").each(function(){s.push({name:"categoriesChecked[]",value:$(this).data("pcat-cat-id")})}),s=$.param(s),i.on("loading.jstree",function(e,t){melisCommerce.pendingZoneStart("productCategorySearchZone")}).on("loaded.jstree",function(e,t){melisCommerce.pendingZoneDone("productCategorySearchZone")}).jstree({types:{default:{icon:"fa fa-circle text-success"},selected:{select_node:!1}},core:{check_callback:!0,animation:500,themes:{name:"proton",responsive:!1},dblclick_toggle:!1,data:{cache:!0,url:"/melis/MelisCommerce/MelisComCategoryList/getCategoryTreeView?"+s}},checkbox:{three_state:!1,whole_node:!1,tie_selection:!1},plugins:["search","changed","types","checkbox"]})}},window.initAttribute=function(e){null!=melisCommerce.getCurrentProductId()&&(e||populateAttribList(e))},window.populateAttribList=function(e){1===$("#"+activeTabId).length&&melisCommerce.enableAllTabs()},window.initProductTextTinyMce=function(e){var t="#"+e+"_id_meliscommerce_products_page textarea.product-text-mce[data-display='true']";$(t).length?$(t).each(function(t,i){var s=$(this),o=Math.random().toString(36).substr(2,9)+"_"+e+"_"+i.name;s.attr("id",o);var r={mode:"none",height:"400px",relative_urls:!1,language:"en",templates:"miniTemplates",menubar:!1,forced_root_block:"",paste_word_valid_elements:"p,b,strong,i,em,h1,h2,h3,h4",cleanup:!1,verify_html:!1,plugins:["advlist autolink lists link paste image charmap preview anchor emoticons help hr nonbreaking","searchreplace visualblocks code fullscreen","insertdatetime media table template"],image_advtab:!0,toolbar:"insertfile undo redo paste | formatselect | forecolor | bold italic strikethrough underline | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image media template | code",init_instance_callback:productTextTinyMCECallback(s,e)};melisTinyMCE.createTinyMCE("tool","#"+o,r)}):$("#"+e+"_id_meliscommerce_products_page .notifTinyMcePreloaInfo").fadeOut("slow")},window.productTextTinyMCECallback=function(e,t){$("#"+e.id).parents("div.form-group").attr("data-tinymce","true"),$("#"+t+"_id_meliscommerce_products_page .notifTinyMcePreloaInfo").fadeOut("slow")},window.allLoaded=function(){melisCommerce.enableAllTabs()},window.reInitProductTextTypeSelect=function(e){var t=[],i=$("#"+e+"_id_meliscommerce_products_page .product-text-forms > .custom-field-type");$.each(i,function(e,i){$.each($(i).find("input#ptt_id"),function(e,i){t.push($(i).val())})});var s=$("form[data-modalform='"+melisCommerce.getCurrentProductId()+"_productTextForm'] select#ptxt_type");$.each(t,function(e,t){s.find("option[value='"+t+"']").remove()})},$(function(){var e=$("body");e.on("click",".productCategoryList",function(){var e=$(this),t=e.data("productid");e.attr("disabled",!0),zoneId="id_meliscommerce_products_main_tab_categories_modal",melisKey="meliscommerce_products_main_tab_categories_modal",modalUrl="/melis/MelisCommerce/MelisComProduct/renderProductModal",melisHelper.createModal(zoneId,melisKey,!1,{productId:t},modalUrl,function(){e.attr("disabled",!1)})}),e.on("click",".addProductCategory",function(){var e=$(this).data("productid"),t=new Array;$.each($("#"+e+"_productCategoryList").jstree().get_checked(!0),function(){t.push(parseInt(this.id))});var i=new Array,s=new Array;$("#"+e+"_product_category_area span[data-pcat-cat-id]").each(function(){var e=$(this),o=parseInt(e.data("pcat-cat-id"));-1!==t.indexOf(o)?s.push(o):(i.push(o),$("span.prod-cat-values[data-pcat-cat-id='"+o+"']").remove())}),$.each($("#"+e+"_productCategoryList").jstree().get_checked(!0),function(){var t=parseInt(this.id);if(-1===i.indexOf(t)&&-1===s.indexOf(t)){var o=this.text.split(" - ")[1];$.get("/melis/MelisCommerce/MelisComProduct/getProductCategoryLastOrderNum",{catId:t,prodId:e},function(i){$("#"+e+"_product_category_area").append('<span class="prod-cat-values" data-pcat-id="'+i.id+'" data-pcat-cat-id="'+t+'" data-pcat-order="'+i.order+'"><span class="ab-attr">'+o+'<i class="prdDelCat fa fa-times"></i></span></span>')})}}),t.length?$("p#"+e+"_no_categories").hide():$("p#"+e+"_no_categories").show(),$("#id_meliscommerce_products_main_tab_categories_modal_container").modal("hide")}),e.on("click",".product-category-tree-view-lang li a",function(){var e=$(this),t=e.text(),i=e.data("locale"),s=$(".productCategoryLangDropdown").data("productid");$(".productCategoryLangDropdown span.filter-key").text(t),initProductCategoryList(s,i)}),e.on("click",".productTextForm .deleteTextInput",function(){var e=$(this),t=e.parent().attr("data-text-identifier"),i=e.parents("form"),s=$("form[data-modalform='"+melisCommerce.getCurrentProductId()+"_productTextForm'] select#ptxt_type");melisCoreTool.pending(".deleteTextInput"),melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_meliscommerce_product_confirm_remove_title,translations.tr_meliscommerce_product_confirm_remove_test,function(){$.each(i,function(e,t){var i=$(t).find("a[data-text-identifier]").attr("data-text-identifier"),o=$(t).find("input#ptt_id").val();s.find("option[value='"+o+"']").length||s.prepend($("<option>",{value:o,text:i}))}),$("#"+activeTabId+" .productTextForm .deleteTextInput").closest("a[data-text-identifier='"+t+"']").closest("form").remove()}),melisCoreTool.done(".deleteTextInput")}),e.on("click",".btnProductListEdit",function(){var e=$(this),t=e.parents("tr").attr("id"),i=e.parents("tr").find("td span").data("productname"),s="id_meliscommerce_product_list_container";$("body #melis-id-nav-bar-tabs li a.tab-element[data-id='id_meliscommerce_product_list_container']").length>0?(melisCommerce.disableAllTabs(),melisCommerce.openProductPage(t,i,s),melisCommerce.setUniqueId(t)):melisHelper.tabOpen("Products","icon-shipment","id_meliscommerce_product_list_container","meliscommerce_product_list_container","",s,function(){melisCommerce.disableAllTabs(),melisCommerce.openProductPage(t,i,s),melisCommerce.setUniqueId(t)})}),e.on("click","#btnAddProduct",function(){melisCommerce.openProductPage(0,translations.tr_meliscommerce_products_page_new_product,"id_meliscommerce_product_list_container"),melisCommerce.setUniqueId(0)}),e.on("click","#addProdTextType",function(){var e=$(this),t=(e.data("productid"),$("form#productTextTypeForm").serialize()),i=e.closest(".panel").find(".panel-heading .panel-title a"),s=e.closest(".panel").find(".panel-collapse");melisCoreTool.pending("#addProdTextType"),$.ajax({type:"POST",data:t,url:"/melis/MelisCommerce/MelisComProduct/addProductTextType",dataType:"json",encode:!0}).done(function(e){e.success?(melisCoreTool.clearForm("productTextTypeForm"),i.addClass("collapsed"),i.attr("aria-expanded",!1),s.removeClass("in"),s.attr("aria-expanded",!1),melisHelper.zoneReload(melisCommerce.getCurrentProductId()+"_id_meliscommerce_products_page_content_tab_product_text_modal_form","meliscommerce_products_page_content_tab_product_text_modal_form",{productId:melisCommerce.getCurrentProductId()})):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"productTextTypeForm")),melisCore.flashMessenger(),melisCoreTool.done("#addProdTextType")}).fail(function(){alert(translations.tr_meliscore_error_message)})}),e.on("click",".btnAddText",function(){var e=$(this).data("productid"),t=$("#"+e+"_id_meliscommerce_products_page_content_tab_product_text_modal_form").find("select#ptxt_type"),i=$("#"+e+"_id_meliscommerce_products_page_content_tab_product_text_modal_form").find("select#ptxt_type option:selected").text();typeId=t.val(),melisCoreTool.pending(this),$.ajax({type:"GET",url:"/melis/MelisCommerce/MelisComProduct/getEmptyProductTextForm?textTypeId="+typeId+"&text="+i,dataType:"json",encode:!0}).done(function(t){var s=$("#"+e+"_id_meliscommerce_products_page .product-text-forms > .custom-field-type");s.length&&$("#"+e+"_id_meliscommerce_products_page .notifTinyMcePreloaInfo").fadeIn("slow"),$.each(s,function(s,o){var r=$(o).data("lang-id"),a=$("#"+e+"_id_meliscommerce_products_page .product-text-tab li#languageList").length;$("#"+e+"_id_meliscommerce_products_page .productTextForm a[data-text='"+i+"']").length<a?($(o).find(".custom-field-type-area").append(t.content).data("text-lang-id",r),$(o).find("form[name='productTextForm']").attr("data-text-lang-id",r),$(o).find("form[name='productTextForm'] input#ptxt_lang_id").val(r),initProductTextTinyMce(e),$("div[data-modalname='genericProductTextModal']").modal("hide"),$("div[data-class='addTextFieldNotif']").html("").attr("class","")):melisCoreTool.alertDanger("div[data-class='addTextFieldNotif']","",translations.tr_meliscommerce_product_text_add_exists)}),melisCoreTool.done(".btnAddText")}).fail(function(){alert(translations.tr_meliscore_error_message)})}),e.on("click",".save_product",function(){var e=$(this),t=e.data("productid"),i=$("#"+melisCommerce.getCurrentProductId()+"_id_meliscommerce_products_page form"),s=[],o=0,r=0,a=e.closest(".container-level-a"),n=$(a).find("#"+t+"_id_meliscommerce_settings_tabs_content_main_details_left form"),l=$(a).find(".alert-email-values"),c="",d="",h="";Array.prototype.push.apply(s,$(n).serializeArray()),l.each(function(){var e=$(this);c=e.data("seaid"),d=e.data("alertemail"),h=e.data("userid"),s.push({name:"recipients["+r+"][sea_id]",value:c}),s.push({name:"recipients["+r+"][sea_email]",value:d}),s.push({name:"recipients["+r+"][sea_user_id]",value:h}),void 0!==t&&s.push({name:"recipients["+r+"][sea_prd_id]",value:t}),r++}),r=0,i.each(function(){var e=$(this),t=e.attr("name"),i=e.serializeArray();for(o=i.length,j=0;j<o;j++)s.push({name:t+"["+r+"]["+i[j].name+"]",value:i[j].value});r++}),$("#"+t+"_id_meliscommerce_products_page").find(".make-switch div").each(function(){var e=$(this).find("input").attr("name");if(void 0!==e&&!1!==e){var t="product[0]["+$(this).find("input").attr("name")+"]",i=0;$(this).hasClass("switch-on")&&(i=1),s.push({name:t,value:i})}}),s.push({name:"productId",value:t}),(s=melisCommerceSeo.serializeSeo("product",t,s)).push({name:"product[0][prd_id]",value:t}),r=0,$("div#"+melisCommerce.getCurrentProductId()+"_attribute_area > span.attr-values").each(function(){var e=$(this);s.push({name:"attributes["+r+"][patt_id]",value:e.data("patt-id")}),s.push({name:"attributes["+r+"][patt_attribute_id]",value:e.data("patt-attribute-id")}),r++}),r=0,$("div#"+melisCommerce.getCurrentProductId()+"_product_category_area > span.prod-cat-values").each(function(){var e=$(this);s.push({name:"categories["+r+"][pcat_id]",value:e.data("pcat-id")}),s.push({name:"categories["+r+"][pcat_cat_id]",value:e.data("pcat-cat-id")}),s.push({name:"categories["+r+"][pcat_order]",value:e.data("pcat-order")}),r++}),r=0,$("div#"+melisCommerce.getCurrentProductId()+"_deleted_product_category_area > span").each(function(){var e=$(this);s.push({name:"delcategories["+r+"][pcat_id]",value:e.data("pcat-id")}),r++}),r=0,melisCoreTool.pending(".save_product"),melisCommerce.disableAllTabs(),$.ajax({type:"POST",data:s,url:"/melis/MelisCommerce/MelisComProduct/saveProduct",dataType:"json",encode:!0}).done(function(e){if(e.success){var t=$('.tab-element[data-id="'+e.chunk.productId+'_id_meliscommerce_products_page"]').parent();if(melisCommerce.closeCurrentProductPage(),melisCommerce.openProductPage(e.chunk.productId,e.chunk.prodName,"id_meliscommerce_product_list_container"),melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload("id_meliscommerce_product_list_content","meliscommerce_product_list_content"),melisCommerce.setUniqueId(e.chunk.productId),t.hasClass("has-sub")){var i=t.find(".nav-group-dropdown").prop("outerHTML");$('.tab-element[data-id="'+e.chunk.productId+'_id_meliscommerce_products_page"]').parent().addClass("has-sub").append(i)}}else melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,activeTabId+" form");melisCoreTool.done(".save_product"),melisCore.flashMessenger(),melisCommerce.enableAllTabs()}).fail(function(){alert(translations.tr_meliscore_error_message)})}),e.on("click","a[data-meliskey='meliscommerce_products_page_header_save_product_cancel']",function(){melisCommerce.closeCurrentProductPage()}),e.on("click",".add-attribute",function(){var e=$("#"+melisCommerce.getCurrentProductId()+"_prodAttribInput"),t=$("#"+activeTabId+" #select2-"+melisCommerce.getCurrentProductId()+"_prodAttribInput-container"),i=$("#"+activeTabId+" #"+melisCommerce.getCurrentProductId()+"_id_meliscommerce_products_main_tab_attributes_add span.select2");$("div#"+activeTabId+" select.dropdown-input"+melisCommerce.getCurrentProductId());if(e.val()){var s=e.val(),o=$("#"+melisCommerce.getCurrentProductId()+"_prodAttribInput option[value='"+s+"']").html(),r=$("#"+melisCommerce.getCurrentProductId()+"_prodAttribInput option[value='"+s+"']");if(0===$("#"+melisCommerce.getCurrentProductId()+"_attribute_area").find("span[data-patt-attribute-id='"+s+"']").length){$("#"+melisCommerce.getCurrentProductId()+"_attribute_area").append('<span class="attr-values" data-patt-attribute-id="'+s+'"><span class="ab-attr"><span class="attrib-value">'+o+'</span><i class="prdDelAttr fa fa-times"></i></span>'),$("p#"+melisCommerce.getCurrentProductId()+"_no_attributes").hide();var a=0,n=new Object;$.each(e.find("option"),function(e,t){s!==$(t).val()&&(n[a]={id:$(t).val(),value:$(t).html()},a++)}),r.remove(),t.html("").attr("title","")}t.css("color","#444"),i.css("border","none")}else t.css("color","#e80e05"),i.css("border","1px solid #e80e05")}),e.on("click",".prdDelAttr",function(){var e=$(this),t=$("#"+melisCommerce.getCurrentProductId()+"_prodAttribInput"),i=e.parent().parent(),s=e.parents("span.attr-values").attr("data-patt-attribute-id"),o=e.parent().find("span.attrib-value").html();$.ajax({type:"GET",url:"/melis/MelisCommerce/MelisComProduct/checkAttributeOnVariant",data:{productId:melisCommerce.getCurrentProductId(),patt_attr_id:s},dataType:"json",encode:!0,beforeSend:function(){e.removeClass("fa-times"),e.addClass("fa-spinner fa-pulse")}}).done(function(r){if(r.attribute_is_used)e.removeClass("fa-spinner fa-pulse"),e.addClass("fa-times"),melisHelper.melisKoNotification(translations.tr_meliscommerce_attribute_delete_product_attr_title,translations.tr_meliscommerce_attribute_delete_product_attr_title_msg);else{var a=$("<option selected></option>");a.val(s),a.text(o),a.val(s),a.text(o),t.append(a),t.val(""),t.select2({placeholder:translations.tr_meliscommerce_products_main_tab_attributes_content_label,val:""}),t.val(""),i.fadeOut("fast").remove();$("#"+activeTabId+" #select2-"+melisCommerce.getCurrentProductId()+"_prodAttribInput-container");setTimeout(function(){},1),setTimeout(function(){melisCoreTool.pending(".prdDelAttr")},1e3),t.css("border","1px solid #e5e5e5"),0===$(".prdDelAttr").length&&$("p#"+melisCommerce.getCurrentProductId()+"_no_attributes").show()}}).fail(function(){alert(translations.tr_meliscore_error_message)})}),e.on("click",".prdDelCat",function(){var e=$(this).parent().parent();$("#"+melisCommerce.getCurrentProductId()+"_deleted_product_category_area").append('<span data-pcat-id="'+e.data("pcat-id")+'" data-pcat-cat-id="'+e.data("pcat-cat-id")+'"></span>'),e.fadeOut("slow").remove(),0===$(".prdDelCat").length&&$("p#"+melisCommerce.getCurrentProductId()+"_no_categories").show()}),e.on("keyup","#productCategorySearch",function(e){var t=$(this),i=t.data("productid"),s=t.val();$("#"+i+"_productCategoryList").jstree("search",s)}),e.on("click","#clearPrdCatSearchInputBtn",function(e){var t=$(this).data("productid"),i=$("#"+t+"_productCategoryList");categoryOpeningItemFlag=!1,$("#productCategorySearch").val(""),i.jstree("search","")}),e.on("click","#expandPrdCatTreeViewBtn",function(e){var t=$(this).data("productid");$("#"+t+"_productCategoryList").jstree("open_all")}),e.on("click","#collapsePrdCatTreeViewBtn",function(e){var t=$(this).data("productid");prdCatTree=$("#"+t+"_productCategoryList"),prdCatTree.jstree("close_all")}),e.on("click","#refreshPrdCatTreeView",function(e){var t=$(this).data("productid"),i=$("#"+t+"_productCategoryList");i.jstree(!0).refresh("forget_state",!0),i.jstree("search",""),$("#productCategorySearch").val("")}),e.on("click",".btnProductListDelete",function(){var e=$(this).closest("tr").attr("id");melisCoreTool.pending(".btnProductListDelete"),melisCoreTool.confirm(translations.tr_meliscommerce_documents_common_label_yes,translations.tr_meliscommerce_documents_common_label_no,translations.tr_meliscommerce_product_remove_title,translations.tr_meliscommerce_product_remove_confirm,function(){$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComProduct/delete",data:{productId:e},dataType:"json",encode:!0}).done(function(t){t.success&&($("#"+activeTabId+" .melis-refreshTable").trigger("click"),melisHelper.tabClose(e+"_id_meliscommerce_products_page"),melisCore.flashMessenger(),melisHelper.melisOkNotification(t.textTitle,t.textMessage))}).fail(function(){alert(translations.tr_meliscore_error_message)})}),melisCoreTool.done(".btnProductListDelete")}),e.on("click",".toggleformCreateTextTypeContainer",function(){$("div.formCreateTextTypeContainer").slideToggle()}),e.on("mouseenter mouseout",".toolTipHoverEvent",function(e){var t=$(this).data("productid");loaderText='<div class="qtipLoader"><hr/><span class="text-center col-lg-12">Loading...</span><br/></div>',$(".thClassColId").attr("style",""),$.each($("table#productTable"+t+" thead").nextAll(),function(e,t){$(t).remove()}),$(loaderText).insertAfter("table#productTable"+t+" thead"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComProductList/getToolTip",data:{productId:t},dataType:"json",encode:!0}).done(function(e){$("div.qtipLoader").remove(),0===e.content.length?$('<div class="qtipLoader"><hr/><span class="text-center col-lg-12">'+translations.tr_meliscommerce_product_tooltip_no_variants+"</span><br/></div>").insertAfter("table.qtipTable thead"):($.each($("table#productTable"+t+" thead").nextAll(),function(e,t){$(t).remove()}),$.each(e.content.reverse(),function(e,i){$(i).insertAfter("table#productTable"+t+" thead")}))}).fail(function(){alert(translations.tr_meliscore_error_message)})}),e.on("click",".add-product-text",function(){var e=$(this).data("target");$("div[data-class='addTextFieldNotif']").html("").attr("class","addTextFieldNotif"),melisHelper.zoneReload(melisCommerce.getCurrentProductId()+"_id_meliscommerce_products_page_content_tab_product_text_modal_form_product_type_text","meliscommerce_products_page_content_tab_product_text_modal_form_product_type_text",{productId:melisCommerce.getCurrentProductId()}),reInitProductTextTypeSelect(melisCommerce.getCurrentProductId()),$(e).modal("show")}),e.on("click",".openVariant",function(){var e=$(this),t=e.data("product-id"),i=e.data("product-name"),s=t+"_id_meliscommerce_products_page";melisCommerce.openProductPage(t,i,"id_meliscommerce_product_list_container",function(){var i=e.parent().siblings(":first").text(),o=e.parent().parent().find("td:nth-child(4)").text();melisCommerce.disableAllTabs(),melisHelper.tabOpen(o,"icon-tag-2",i+"_id_meliscommerce_variants_page","meliscommerce_variants_page",{variantId:i,productId:t},s),melisCommerce.setUniqueId(i),melisCommerce.enableAllTabs()})})}),$(function(){var e=$("body");e.on("keyup keydown change","input[name='eseo_meta_title']",{limit:60},seoCharCounter),e.on("keyup keydown change","textarea[name='eseo_meta_description']",{limit:160},seoCharCounter)}),window.preSeoCharCounter=function(){$("form.seoForm").each(function(){var e=$(this),t=e.find("input[name='eseo_meta_title']"),i=e.find("textarea[name='eseo_meta_description']");t.trigger("keyup"),i.trigger("keyup")})},window.seoCharCounter=function(e){var t=$(this),i=t.val().length,s=t.prev("label"),o=e.data.limit;s.find(".label-text span").length?0===i?(s.removeClass("limit"),s.find(".label-text span").remove()):(s.find(".label-text span").html('<i class="fa fa-text-width"></i>('+i+")"),i>o?(s.addClass("limit"),s.find(".label-text span").addClass("limit")):(s.removeClass("limit"),s.find(".label-text span").removeClass("limit"))):0!==i&&(s.find(".label-text").append("<span class='text-counter-indicator'><i class='fa fa-text-width'></i>("+i+")</span>"),i>o&&(s.addClass("limit"),s.find(".label-text span").addClass("limit")))};melisCommerceSeo=function(e){return{serializeSeo:function(e,t,i){var s=new Array;return $("form."+e+"_"+t+"_seo_form").each(function(){langId=$(this).data("langid"),s=$(this).serializeArray(),$.each(s,function(){i.push({name:e+"_seo["+langId+"]["+this.name+"]",value:this.value})})}),i}}}(window);$(function(){var e=$("body");e.on("click",".editvariant",function(){var e=$(this),t=e.closest("tr").attr("id"),i=e.closest("tr").find("td a").data("variantname"),s=e.closest(".container-level-a").attr("id").replace(/[^0-9]/g,""),o=s+"_id_meliscommerce_products_page";melisCommerce.disableAllTabs(),melisHelper.tabOpen(i,"icon-tag-2",t+"_id_meliscommerce_variants_page","meliscommerce_variants_page",{variantId:t,productId:s},o),melisCommerce.setUniqueId(t),melisCommerce.enableAllTabs()}),e.on("click",".add-variant",function(){var e=$(this).closest(".container-level-a").attr("id").replace(/[^0-9]/g,""),t=e+"_id_meliscommerce_products_page";melisCoreTool.processing(),melisHelper.tabOpen(translations.tr_meliscommerce_variant_main_information_sku_new,"icon-tag-2","id_meliscommerce_variants_page","meliscommerce_variants_page",{productId:e,page:"newvar"},t),melisCommerce.setUniqueId(0),melisCoreTool.processDone()}),e.on("click",".save-add-variant",function(){$(this).closest(".container-level-a").attr("id")}),e.on("click",".country-price-tab li a",function(){var e=$(this),t=e.data("country"),i=e.data("symbol"),s=$("[data-meliskey='meliscommerce_prices_tab_country_header'] .cur-symbol");""!=i?s.removeClass("fa fa-dollar").text(i).css("font-weight","600"):s.hasClass("fa")||s.empty().addClass("fa fa-dollar").removeAttr("style"),$(".country-price-label").text(t+" "+translations.tr_meliscommerce_variant_tab_prices_pricing)}),e.on("click",".country-stock-tab li a",function(){var e=$(this).data("country");"fr_FR"==melisLangId?$(".country-stock-label").text(translations.tr_meliscommerce_variant_tab_stocks_header+" "+e):$(".country-stock-label").text(e+" "+translations.tr_meliscommerce_variant_tab_stocks_header)}),e.on("click",".productvariant-refresh",function(){var e=melisCommerce.getCurrentProductId();melisHelper.zoneReload(e+"_id_meliscommerce_products_page_content_tab_variant_content_container","meliscommerce_products_page_content_tab_variant_content_container",{productId:e})}),e.on("click",".deletevariant",function(){var e=$(this).closest("tr").attr("id"),t=[];t.push({name:"var_id",value:e}),melisCoreTool.pending(this),melisCoreTool.confirm(translations.tr_meliscommerce_documents_common_label_yes,translations.tr_meliscommerce_documents_common_label_no,translations.tr_meliscommerce_variants_delete_title,translations.tr_meliscommerce_variants_delete_confirm,function(){melisCommerce.postSave("melis/MelisCommerce/MelisComVariant/deleteVariant",t,function(t){t.success?(melisHelper.melisOkNotification(t.textTitle,t.textMessage),melisHelper.zoneReload(melisCommerce.getCurrentProductId()+"_id_meliscommerce_products_page_content_tab_variant_content_container","meliscommerce_products_page_content_tab_variant_content_container",{productId:melisCommerce.getCurrentProductId()}),melisHelper.tabClose(e+"_id_meliscommerce_variants_page")):melisHelper.melisKoNotification(t.textTitle,t.textMessage,t.errors),melisCore.flashMessenger()},function(e){console.log(e)})}),melisCoreTool.done(this)}),e.on("click",".save-variant",function(){melisCoreTool.pending(".save-variant");var e,t,i=$(this),s=i.closest(".container-level-a").data("prodid"),o=s+"_id_meliscommerce_products_page",r=i.closest(".container-level-a").attr("id"),a=isNaN(parseInt(r,10))?"":parseInt(r,10),n=isNaN(parseInt(r,10))?"":parseInt(r,10)+"_",l=i.closest(".container-level-a").find("form"),c=[];t=0,l.each(function(){var i=$(this),s=i.attr("name"),o=i.serializeArray();for(e=o.length,j=0;j<e;j++)c.push({name:s+"["+t+"]["+o[j].name+"]",value:o[j].value});t++}),c.push({name:"variantId",value:a}),(c=melisCommerceSeo.serializeSeo("variant",a,c)).push({name:"variant[0][var_id]",value:a},{name:"variant[0][var_prd_id]",value:s}),$("#"+r).find(".make-switch div").each(function(){var e=$(this),t="variant[0]["+e.find("input").attr("name")+"]",i=0;e.hasClass("switch-on")&&(i=1),c.push({name:t,value:i})}),melisCommerce.postSave("/melis/MelisCommerce/MelisComVariant/saveVariant",c,function(e){if(e.success)melisHelper.tabClose(n+"id_meliscommerce_variants_page"),melisHelper.tabOpen(e.chunk.varSku,"icon-tag-2",e.chunk.variantId+"_id_meliscommerce_variants_page","meliscommerce_variants_page",{variantId:e.chunk.variantId,productId:s},o),melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload(s+"_id_meliscommerce_products_page_content_tab_variant_content_container","meliscommerce_products_page_content_tab_variant_content_container",{productId:s}),melisCommerce.setUniqueId(e.chunk.variantId),melisCore.flashMessenger();else{melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors);var t="id_meliscommerce_variant_content";e.chunk.variantId&&(t=e.chunk.variantId+"id_meliscommerce_variant_content"),melisCoreTool.highlightErrors(0,e.errors,t)}melisCoreTool.done(".save-variant"),melisCore.flashMessenger()},function(e){console.log(e),alert(translations.tr_meliscore_error_message)})}),e.on("mouseenter mouseleave",".toolTipVarHoverEvent",function(e){var t=$(this),i=t.data("variantid"),s=t.closest(".container-level-a").attr("id").replace(/[^0-9]/g,"");$.each($("table#variantTable"+i+" thead").nextAll(),function(e,t){$(t).remove()}),$('<div class="qtipLoader"><hr/><span class="text-center col-lg-12">Loading...</span><br/></div>').insertAfter("table#variantTable"+i+" thead"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComProductList/getToolTip",data:{variantId:i,productId:s},dataType:"json",encode:!0}).done(function(e){$("div.qtipLoader").remove(),0===e.content.length?$('<div class="qtipLoader"><hr/><span class="text-center col-lg-12">'+translations.tr_meliscommerce_product_tooltip_no_variants+"</span><br/></div>").insertAfter("table.qtipTable thead"):($.each($("table#variantTable"+i+" thead").nextAll(),function(e,t){$(t).remove()}),$.each(e.content.reverse(),function(e,t){$(t).insertAfter("table#variantTable"+i+" thead")}))}).fail(function(){alert(translations.tr_meliscore_error_message)})}),e.on("click",".updateVariantStatus",function(){var e=$(this),t="",i={},s="",o="",r="",a=e.closest("tr").attr("id"),n=e.closest("tr").attr("var_status"),l=e.closest(".container-level-a").attr("id").replace(/[^0-9]/g,"");0==n?(s=1,o="text-success",r="btn-danger",t=translations.tr_meliscommerce_variants_deactivate_status_title):(s=0,o="text-danger",r="btn-success",t=translations.tr_meliscommerce_variants_activate_status_title),i.id=a,i.var_status=s,$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComVariantList/updateVariantStatus",data:$.param(i),beforeSend:function(){e.addClass("disabled").attr("disabled",!0),e.find(".variant-update-icon-rotate").removeClass(function(e,t){return(t.match(/(^|\s)fa-\S+/g)||[]).join(" ")}).addClass("fa-spinner fa-pulse fa-fw")}}).done(function(i){i.success&&(e.closest("tr").attr("var_status",s),e.find(".variant-update-icon-rotate").removeClass(function(e,t){return(t.match(/(^|\s)fa-\S+/g)||[]).join(" ")}).addClass("fa-arrow-circle-up"),e.removeClass(function(e,t){return(t.match(/(^|\s)btn-\S+/g)||[]).join(" ")}).addClass(r),e.closest("tr").find(".var-status-indicator").removeClass(function(e,t){return(t.match(/(^|\s)text-\S+/g)||[]).join(" ")}).addClass(o),e.find(".variant-update-icon-rotate").toggleClass("down"),$("#"+a+"_id_meliscommerce_variant_tab_main_header_container").length&&melisHelper.zoneReload(a+"_id_meliscommerce_variant_tab_main_header_container","meliscommerce_variant_tab_main_header_container",{productId:l,variantId:a}),e.attr("title",t)),e.removeClass("disabled").attr("disabled",!1)}).fail(function(){alert(translations.tr_meliscore_error_message)})}),e.on("click",".tabs-label li a",function(){var e=$(this),t=e.attr("href");"meliscommerce_products_page_content_tab_variants"===e.closest("li").data("meliskey")&&$(t).find(".refresh-attribute-lists").trigger("click")})}),window.initProductVariant=function(e,t){var i=$("#"+t.sTableId).data("prodid");e.prodId=i},window.variantLoaded=function(){$(this);var e=$(".tab-pane#"+activeTabId).data("prodid")+"_id_meliscommerce_products_page";melisCommerce.enableTab(e)},window.checkVarStatus=function(){var e="",t="";e=null!=$(".updateVariantStatus").closest(".container-level-a.active").attr("id")?$(".updateVariantStatus").closest(".container-level-a.active").attr("id").replace(/[^0-9]/g,""):$(".save-variant").closest(".container-level-a.active").data("prodid"),$("#"+e+"_tableProductVariantList tbody tr").each(function(){var e=$(this).attr("var_status");if(null!=e){var i="btn-danger",s=$(this).find(".variant-update-icon-rotate");0==e?(i="btn-success",t=translations.tr_meliscommerce_variants_activate_status_title):(s.toggleClass("down"),t=translations.tr_meliscommerce_variants_deactivate_status_title),s.closest("a").removeClass(function(e,t){return(t.match(/(^|\s)btn-\S+/g)||[]).join(" ")}).addClass(i).attr("title",t)}})},$(function(){var e=$("body");e.on("keyup keydown change","input[name='eseo_meta_title']",{limit:60},seoCharCounter),e.on("keyup keydown change","textarea[name='eseo_meta_description']",{limit:160},seoCharCounter)}),window.preSeoCharCounter=function(){$("form.seoForm").each(function(){var e=$(this),t=e.find("input[name='eseo_meta_title']"),i=e.find("textarea[name='eseo_meta_description']");t.trigger("keyup"),i.trigger("keyup")})},window.seoCharCounter=function(e){var t=$(this),i=t.val().length,s=t.prev("label"),o=e.data.limit;s.find(".label-text span").length?0===i?(s.removeClass("limit"),s.find(".label-text span").remove()):(s.find(".label-text span").html('<i class="fa fa-text-width"></i>('+i+")"),i>o?(s.addClass("limit"),s.find(".label-text span").addClass("limit")):(s.removeClass("limit"),s.find(".label-text span").removeClass("limit"))):0!==i&&(s.find(".label-text").append("<span class='text-counter-indicator'><i class='fa fa-text-width'></i>("+i+")</span>"),i>o&&(s.addClass("limit"),s.find(".label-text span").addClass("limit")))};melisCommerceSeo=function(e){return{serializeSeo:function(e,t,i){var s=new Array;return $("form."+e+"_"+t+"_seo_form").each(function(){langId=$(this).data("langid"),s=$(this).serializeArray(),$.each(s,function(){i.push({name:e+"_seo["+langId+"]["+this.name+"]",value:this.value})})}),i}}}(window);function melisClientKoNotification(e,t,i,s){void 0===s&&(s="closeByButtonOnly"),s="closeByButtonOnly"!==s?"overlay-hideonclick":"";var o="<h3>"+melisHelper.melisTranslator(e)+"</h3>";o+="<h4>"+melisHelper.melisTranslator(t)+"</h4>",$.each(i,function(e,t){if("label"!==e){o+='<p class="modal-error-cont"><b>'+(null==i[e].label?null==i.label?e:i.label:i[e].label)+": </b>  ";try{$.each(t,function(e,t){"label"!==e&&"form"!==e&&($errMsg="",t instanceof Object?$errMsg=t[0]:$errMsg=t,o+='<span><i class="fa fa-circle"></i>'+$errMsg+"</span>")})}catch(i){"label"!==e&&"form"!==e&&(o+='<span><i class="fa fa-circle"></i>'+t+"</span>")}o+="</p>"}});var r="<div class='melis-modaloverlay "+s+"'></div>";r+="<div class='melis-modal-cont KOnotif'>  <div class='modal-content'>"+o+" <span class='btn btn-block btn-primary'>"+translations.tr_meliscore_notification_modal_Close+"</span></div> </div>",$body.append(r)}$(function(){var e=$("body");e.on("click",".addNewClient",function(){melisHelper.tabOpen(translations.tr_meliscommerce_clients_add_client,"fa fa-user-plus","0_id_meliscommerce_client_page","meliscommerce_client_page",{clientId:0},"id_meliscommerce_clients_list_page")}),e.on("click",function(e){var t=$("#id_meliscommerce_client_modal_address_form_container"),i=$("#id_meliscommerce_client_modal_contact_address_form_container");$(e.target).hasClass("modal")&&(t.modal("hide"),i.modal("hide"),t.modal("hide"))}),e.on("click",".viewCleintInfo",function(){var e=$(this).parents("tr").attr("id"),t=new Array;t.push({name:"clientId",value:e}),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComClient/getClientContactName",data:t,dataType:"json",encode:!0,cache:!1}).done(function(t){if($("#saveClientContact").button("reset"),t.success){melisHelper.tabOpen(t.clientContactName,"fa fa-user",e+"_id_meliscommerce_client_page","meliscommerce_client_page",{clientId:e},"id_meliscommerce_clients_list_page")}else melisHelper.melisKoNotification(t.textTitle,t.textMessage,t.errors)}).fail(function(){$("#saveClientContact").button("reset"),alert(translations.tr_meliscore_error_message)})}),e.on("click",".addNewContact",function(){var e=$(this).data("clientid");$(".addNewContact").button("loading"),zoneId="id_meliscommerce_client_modal_contact_form",melisKey="meliscommerce_client_modal_contact_form",modalUrl="/melis/MelisCommerce/MelisComClient/renderClientModal",melisHelper.createModal(zoneId,melisKey,!1,{clientId:e},modalUrl,function(){$(".addNewContact").button("reset")})}),e.on("click","#saveClientContact",function(){var e=$(this).data("clientid");dataString=$("#melisCommerceClientContactFormModal").serializeArray(),dataString.push({name:"clientId",value:e}),dataString=$.param(dataString),$("#saveClientContact").button("loading"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComClient/addClientContact",data:dataString,dataType:"json",encode:!0,cache:!1}).done(function(t){$("#saveClientContact").button("reset"),t.success?($("#"+e+"_client_contact_tab_nav").append(t.clientContactDom.tabNav),$("#"+e+"_client_contact_tab_content").append(t.clientContactDom.tabContent),$("#nav_"+t.clientContactDom.tabId).tab("show"),$("#id_meliscommerce_client_modal_contact_form_container").modal("hide")):(melisHelper.melisKoNotification(t.textTitle,t.textMessage,t.errors),melisCoreTool.highlightErrors(t.success,t.errors,"melisCommerceClientContactFormModal"))}).fail(function(){$("#saveClientContact").button("reset"),alert(translations.tr_meliscore_error_message)})}),e.on("click",".addNewContactAddress",function(){var e=$(this),t=e.data("clientid"),i=e.data("tabid");$(".addNewContactAddress").button("loading"),zoneId="id_meliscommerce_client_modal_contact_address_form",melisKey="meliscommerce_client_modal_contact_address_form",modalUrl="/melis/MelisCommerce/MelisComClient/renderClientModal",melisHelper.createModal(zoneId,melisKey,!1,{clientId:t,tabId:i},modalUrl,function(){$(".addNewContactAddress").button("reset")})}),e.on("click","#saveClientContactAddress",function(){var e=$(this),t=e.data("clientid");tabId=e.data("tabid"),dataString=$("#melisCommerceClientContactAddressFormModal").serializeArray(),dataString.push({name:"clientId",value:t}),dataString.push({name:"tabId",value:tabId}),dataString=$.param(dataString),$("#saveClientContactAddress").button("loading"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComClient/addClientContactAddress",data:dataString,dataType:"json",encode:!0,cache:!1}).done(function(e){$("#saveClientContactAddress").button("reset"),e.success?($("#"+tabId+"_contact_address").append(e.clientContactAddressDom.accordionContent),$("#nav_"+e.clientContactAddressDom.contactAddressId).click(),$("#id_meliscommerce_client_modal_contact_address_form_container").modal("hide")):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"melisCommerceClientContactAddressFormModal"))}).fail(function(){$("#saveClientContactAddress").button("reset"),alert(translations.tr_meliscore_error_message)})}),e.on("click",".addNewAddress",function(){var e=$(this).data("clientid");$(".addNewAddress").button("loading"),zoneId="id_meliscommerce_client_modal_address_form",melisKey="meliscommerce_client_modal_address_form",modalUrl="/melis/MelisCommerce/MelisComClient/renderClientModal",melisHelper.createModal(zoneId,melisKey,!1,{clientId:e},modalUrl,function(){$(".addNewAddress").button("reset")})}),e.on("click","#saveClientAddress",function(){var e=$(this).data("clientid");dataString=$("#melisCommerceClientAddressFormModal").serializeArray(),dataString.push({name:"clientId",value:e}),dataString=$.param(dataString),$("#saveClientAddress").button("loading"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComClient/addClientAddress",data:dataString,dataType:"json",encode:!0}).done(function(t){$("#saveClientAddress").button("reset"),t.success?($("#"+e+"_client_address_tab_nav").append(t.clientAddressDom.tabNav),$("#"+e+"_client_address_tab_content").append(t.clientAddressDom.tabContent),$("#nav_add_"+t.clientAddressDom.addressId).tab("show"),$("#id_meliscommerce_client_modal_address_form_container").modal("hide")):(melisHelper.melisKoNotification(t.textTitle,t.textMessage,t.errors),melisCoreTool.highlightErrors(t.success,t.errors,"melisCommerceClientAddressFormModal"))}).fail(function(){$("#saveClientAddress").button("reset"),alert(translations.tr_meliscore_error_message)})}),e.on("click",".deleteClientCotactAddress",function(){var e=$(this),t=e.data("addressid"),i=e.data("addressaccordionid"),s=e.data("isnewadded");melisCoreTool.confirm(translations.tr_meliscommerce_clients_common_label_yes,translations.tr_meliscommerce_clients_common_label_no,translations.tr_meliscommerce_client_delete_address,translations.tr_meliscommerce_client_delete_address_confirm_msg,function(){0==s&&$("#deletedClientAddress").append("<input name='deletedaddresses[]' value='"+t+"'>"),$("#"+i+"_contact_address_content").remove()})}),e.on("click",".deleteClientAddress",function(){var e=$(this),t=e.data("addressid"),i=e.data("tabclass"),s=e.data("isnewadded");melisCoreTool.confirm(translations.tr_meliscommerce_clients_common_label_yes,translations.tr_meliscommerce_clients_common_label_no,translations.tr_meliscommerce_client_delete_address,translations.tr_meliscommerce_client_delete_address_confirm_msg,function(){0==s&&$("#deletedClientAddress").append("<input name='deletedaddresses[]' value='"+t+"'>"),$("."+i+":first").hasClass("active")&&($("."+i+":first").next().find("a").length?$("."+i+":first").next().find("a").tab("show"):$("."+i+":first").prev().find("a")&&$("."+i+":first").prev().find("a").tab("show")),$("."+i).remove()})}),e.on("click",".clientMainContact",function(){var e=$(this),t=e.data("clientid"),i=e.data("tabid");e.hasClass("fa-star-o")?($("#"+t+"_client_contact_tab_content .clientMainContact").removeClass("fa-star"),$("#"+t+"_client_contact_tab_content .clientMainContact").addClass("fa-star-o"),e.addClass("fa-star"),e.removeClass("fa-star-o"),$("#"+t+"_client_contact_tab_content").find('form input[name="cper_is_main_person"]').val(0),$("#"+i).find("form input[name='cper_is_main_person']").val(1)):(e.removeClass("fa-star"),e.addClass("fa-star-o"),$("#"+i).find("form input[name='cper_is_main_person']").val(0))}),e.on("switch-change",".clientContactStatus",function(){var e=e,t=(e.data("clientid"),e.data("tabid"));e.find(".switch-animate").hasClass("switch-on")?(e.find(".switch-animate").removeClass("switch-off").addClass("switch-on"),$("#"+t).find("form input[name='cper_status']").val(1)):$("#"+t).find("form input[name='cper_status']").val(0)}),e.on("switch-change",".modalClientContactStatus",function(){var e=$(this),t=(e.data("clientid"),$("#melisCommerceClientContactFormModal").find("input[name='cper_status']"));e.find(".switch-animate").hasClass("switch-on")?(e.find(".switch-animate").removeClass("switch-off").addClass("switch-on"),t.val(1)):t.val(0)}),e.on("click",".deleteClientContactAddress",function(){var e=$(this).data("tabclass");melisCoreTool.confirm(translations.tr_meliscommerce_clients_common_label_yes,translations.tr_meliscommerce_clients_common_label_no,translations.tr_meliscommerce_client_delete_new_contact,translations.tr_meliscommerce_client_delete_new_contact_confirm_msg,function(){var t=$("."+e+"_client_contact:first"),i=$("."+e+"_client_contact");t.hasClass("active")&&(t.next().find("a").length?t.next().find("a").tab("show"):t.prev().find("a")&&t.prev().find("a").tab("show")),i.remove()})}),e.on("click",".saveClientInfo",function(){var e=$(this),t=e.data("clientid"),i=new Array;i=$("#"+t+"_id_meliscommerce_client_page form").not(".clientContactForm, .clientContactAddressForm, .clientAddressForm").serializeArray(),$("#"+t+"_id_meliscommerce_client_page form.clientContactForm").addClass(t+"_clientContactForm"),$("."+t+"_clientContactForm").each(function(){var e=$(this),t=e.data("tabid"),s=e.serializeArray();$.each(s,function(){i.push({name:"clientContacts["+t+"]["+this.name+"]",value:this.value})}),$("#"+t+"_contact_address form").each(function(){var e=$(this),s=e.data("contactaddressid"),o=e.serializeArray();$.each(o,function(){i.push({name:"clientContacts["+t+"][contact_address]["+s+"]["+this.name+"]",value:this.value})})})}),$("#"+t+"_id_meliscommerce_client_page form.clientAddressForm").addClass(t+"_clientAddressForm"),$("."+t+"_clientAddressForm").each(function(){var e=$(this),t=e.data("addressid"),s=e.serializeArray();$.each(s,function(){i.push({name:"clientAddresses["+t+"]["+this.name+"]",value:this.value})})}),i.push({name:"clientId",value:t});var s=0;$("#"+t+"_cli_status input").is(":checked")&&(s=1),i.push({name:"cli_status",value:s}),e.button("loading"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComClient/saveClient",data:i,dataType:"json",encode:!0}).done(function(e){if($(".saveClientInfo").button("reset"),e.success){melisHelper.tabClose(t+"_id_meliscommerce_client_page"),melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.tabOpen(e.clientContactName,"fa fa-user",e.clientId+"_id_meliscommerce_client_page","meliscommerce_client_page",{clientId:e.clientId},"id_meliscommerce_clients_list_page"),melisHelper.zoneReload("id_meliscommerce_clients_list_content","meliscommerce_clients_list_content")}else melisClientKoNotification(e.textTitle,e.textMessage,e.errors),clientHighlightErrors(e.success,e.errors,activeTabId+" form");melisCore.flashMessenger()}).fail(function(){$(".saveClientInfo").button("reset"),alert(translations.tr_meliscore_error_message)})}),e.on("click",".clientOrderView",function(){var e=$(this),t=e.closest("tr").attr("id"),i=e.closest("tr").find("td:nth-child(2)").text();melisHelper.tabOpen(translations.tr_meliscommerce_orders_Orders,"fa fa fa-cart-plus fa-2x","id_meliscommerce_order_list_page","meliscommerce_order_list_page");var s=$("body #melis-id-nav-bar-tabs li a.tab-element[data-id='id_meliscommerce_order_list_page']"),o=setInterval(function(){s.length&&(melisHelper.tabOpen(i,"fa fa fa-cart-plus fa-2x",t+"_id_meliscommerce_orders_page","meliscommerce_orders_page",{orderId:t},"id_meliscommerce_order_list_page"),clearInterval(o))},500)}),e.on("click",".clientOrderListRefresh",function(){var e=$(this).data("clientid");melisHelper.zoneReload(e+"_id_meliscommerce_client_page_tab_orders","meliscommerce_client_page_tab_orders",{clientId:e,activateTab:!0})}),e.on("click",".clientsExport",function(){melisCoreTool.isTableEmpty("clientListTbl")||(zoneId="id_meliscommerce_client_list_content_export_form",melisKey="meliscommerce_client_list_content_export_form",modalUrl="/melis/MelisCommerce/MelisComClientList/renderClientListModal",melisHelper.createModal(zoneId,melisKey,!1,{},modalUrl,function(){melisCoreTool.done(this)}))}),e.on("click","#exportClients",function(){var e=$(this),t=e.closest("#id_meliscommerce_client_list_content_export_form").find("form").serializeArray();melisCoreTool.pending(e),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComClientList/clientsExportValidate",data:t,dataType:"json",encode:!0}).done(function(e){e.success?(melisCoreTool.exportData("/melis/MelisCommerce/MelisComClientList/clientsExportToCsv"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(0,e.errors,"id_meliscommerce_client_list_content_export_form"),$(".date_start").prev("label").css("color","#686868"),$(".date_end").prev("label").css("color","#686868"),$.each(e.errors,function(e,t){"date_start"==e&&$(".date_start").prev("label").css("color","red"),"date_end"==e&&$(".date_end").prev("label").css("color","red")}))}),melisCoreTool.done(e)}),e.on("click",".shopping_cart",function(){var e=$(this).attr("href"),t=$(e);melisCore.screenSize<768&&t.find(".clientOrderListRefresh").trigger("click")}),e.on("change","#clientsGroupSelect",function(){$("#clientListTbl").DataTable().ajax.reload()})}),window.clientHighlightErrors=function(e,t,i){0===e?(""!==i&&$("#"+i+" .form-group label").css("color","#686868"),$.each(t,function(e,t){"form"in t?$.each(this.form,function(t,i){$("#"+i+" .form-control[name='"+e+"']").prev("label").css("color","red")}):""!==i&&$("#"+i+" .form-control[name='"+e+"']").prev("label").css("color","red")})):$("#"+i+" .form-group label").css("color","#686868")},window.initClientStatus=function(){$("#cli_status").bootstrapSwitch()},window.initClientOrderList=function(e,t){clientId=$("#"+t.sTableId).data("clientid"),e.clientId=clientId,e.osta_id=$("#"+clientId+"_id_meliscommerce_client_page_tab_orders .orderFilterStatus").val(),e.startDate=$("#"+clientId+"_tableClientOrderList").data("dStartDate"),e.endDate=$("#"+clientId+"_tableClientOrderList").data("dEndDate");t.iDraw>1&&(dateSelectionContent=translations.tr_meliscore_datepicker_select_date+"<i class=\"glyphicon glyphicon-calendar fa fa-calendar\"></i> <span class='sdate'>"+dStartDate+" - "+dEndDate+'</span> <b class="caret"></b>',$("#"+clientId+"_tableClientOrderList_wrapper .dt_orderdatepicker .dt_dateInfo").html(dateSelectionContent)),dStartDate="",dEndDate=""},window.initClientListTitle=function(){$("#"+clientId+"_tableClientOrderList .icon-shippment").parent("th").attr("title",translations.tr_meliscommerce_clients_list_col_products),$("#"+clientId+"_tableClientOrderList .fa-usd").parent("th").attr("title",translations.tr_meliscommerce_clients_list_col_price_title)},window.initClientContactAddressForm=function(){var e=$("#saveClientContactAddress").data("tabid"),t=$("#melisCommerceClientContactAddressFormModal");t.find("#cadd_civility").val($("#"+e+"_contact_form").find("#cper_civility").val()),t.find("#cadd_firstname").val($("#"+e+"_contact_form").find("#cper_firstname").val()),t.find("#cadd_name").val($("#"+e+"_contact_form").find("#cper_name").val()),t.find("#cadd_middle_name").val($("#"+e+"_contact_form").find("#cper_middle_name").val())},window.initClientsFilters=function(e){$("#clientsGroupSelect").length&&(e.cgroup_id=$("#clientsGroupSelect").val())},$(function(){var e=$("body");$(".a-accordion");function t(e,t){melisHelper.tabOpen(e,"fa fa fa-cart-plus fa-2x",t+"_id_meliscommerce_orders_page","meliscommerce_orders_page",{orderId:t},"id_meliscommerce_order_list_page")}e.on("click",function(e){$(e.target).hasClass("modal")&&($("#id_meliscommerce_order_list_content_status_form_container").modal("hide"),$("#id_meliscommerce_order_modal_content_shipping_form_container").modal("hide"))}),e.on("click",".orderInfo",function(e){var i=$(this),s=i.closest("tr").attr("id"),o=i.closest("tr").find("td:nth-child(2)").text(),r="";i[0].classList[2];r=o.length>0?o:s,melisHelper.tabOpen(translations.tr_meliscommerce_orders_Orders,"fa fa fa-cart-plus fa-2x","id_meliscommerce_order_list_page","meliscommerce_order_list_page");var a=$("body #melis-id-nav-bar-tabs li a.tab-element[data-id='id_meliscommerce_order_list_page']"),n=setInterval(function(){a.length&&(t(translations.tr_meliscommerce_orders_Order+" "+r,s),clearInterval(n))},500)}),e.on("click",".addMessage",function(){$(this).closest(".container-level-a").find(".add-message").slideToggle()}),e.on("click",".addReturnMessage",function(){$(this).closest(".container-level-a").find(".add-return-message").slideToggle()}),e.on("click",".orderListRefresh",function(){if(melisHelper.zoneReload("id_meliscommerce_order_list_page","meliscommerce_order_list_page"),"coupon"==$("#"+activeTabId).data("pageid")){var e=activeTabId.split("_")[0];melisHelper.zoneReload(e+"_id_meliscommerce_coupon_tabs_content_orders_details_table","meliscommerce_coupon_tabs_content_orders_details_table",{couponId:e})}}),e.on("click",".orderStatusRefresh",function(){melisHelper.zoneReload("id_meliscommerce_order_status_content_table","meliscommerce_order_status_content_table")}),e.on("click",".addNewOrderStatus",function(){var e=$(this).closest("tr").attr("id");zoneId="id_meliscommerce_order_status_form",melisKey="meliscommerce_order_status_form",modalUrl="/melis/MelisCommerce/MelisComOrderStatus/renderOrderStatusModal",melisHelper.createModal(zoneId,melisKey,!1,{ostaId:e},modalUrl,function(){})}),e.on("click",".orderBasketRefresh",function(){var e=$(this).closest(".container-level-a").attr("id"),t=isNaN(parseInt(e,10))?"":parseInt(e,10);melisHelper.zoneReload(t+"_id_meliscommerce_orders_content_tabs_content_baskets_details_list","meliscommerce_orders_content_tabs_content_baskets_details_list",{orderId:t})}),e.on("click",".orderList",function(){melisHelper.tabOpen(translations.tr_meliscommerce_orders_Orders,"fa fa fa-cart-plus fa-2x","id_meliscommerce_order_list_page","meliscommerce_order_list_page")}),e.on("click",".saveOrder",function(){var e,i=$(this),s="melis/MelisCommerce/MelisComOrder/saveOrder",o=i.closest(".container-level-a").attr("id"),r=isNaN(parseInt(o,10))?"":parseInt(o,10),a=i.closest(".container-level-a").find("form"),n=[],l=0,c=i.closest(".container-level-a").find(".selectedStatus").data("statusid"),d=i.closest(".container-level-a").find("input[name=ord_reference]").val(),h=i.data("orderstatus");melisCoreTool.pending(".saveOrder"),a.each(function(){var t=$(this),i=t.attr("name"),s=t.serializeArray();for(e=s.length,j=0;j<e;j++)n.push({name:i+"["+l+"]["+s[j].name+"]",value:s[j].value});l++}),n.push({name:"orderId",value:r}),n.push({name:"order[0][ord_status]",value:c}),n.push({name:"lastStatus",value:h}),5==c&&5!=h?melisCoreTool.confirm(translations.tr_meliscommerce_order_common_label_yes,translations.tr_meliscommerce_order_common_label_no,d,translations.tr_meliscommerce_order_save_status_canceled_confirm,function(){melisCommerce.postSave(s,n,function(e){e.success?(melisHelper.tabClose(r+"_id_meliscommerce_orders_page"),t(translations.tr_meliscommerce_orders_Order+" "+e.chunk.order.ord_reference,e.chunk.order.ord_id),melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload("id_meliscommerce_order_list_page","meliscommerce_order_list_page"),melisCore.flashMessenger(),e.clientId+"_id_meliscommerce_client_page_tab_orders".length&&melisHelper.zoneReload(e.clientId+"_id_meliscommerce_client_page_tab_orders","meliscommerce_client_page_tab_orders",{clientId:e.clientId,activateTab:!0})):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,r+"_id_meliscommerce_orders_page"))},function(e){console.log(e)})}):melisCommerce.postSave(s,n,function(e){e.success?(melisHelper.tabClose(r+"_id_meliscommerce_orders_page"),t(translations.tr_meliscommerce_orders_Order+" "+e.chunk.order.ord_reference,e.chunk.order.ord_id),melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload("id_meliscommerce_order_list_page","meliscommerce_order_list_page"),melisCore.flashMessenger(),e.clientId+"_id_meliscommerce_client_page_tab_orders".length&&melisHelper.zoneReload(e.clientId+"_id_meliscommerce_client_page_tab_orders","meliscommerce_client_page_tab_orders",{clientId:e.clientId,activateTab:!0})):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,r+"_id_meliscommerce_orders_page"))},function(e){console.log(e)}),melisCoreTool.done(".saveOrder")}),e.on("click",".add-order-message",function(){var e=$(this),t=e.data("type"),i=e.closest(".container-level-a").attr("id"),s=isNaN(parseInt(i,10))?"":parseInt(i,10),o=e.closest("div").find("form").serializeArray();o.push({name:"orderId",value:s}),o.push({name:"omsg_type",value:t}),melisCoreTool.pending(this),melisCommerce.postSave("melis/MelisCommerce/MelisComOrder/saveOrderMessage",o,function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload(s+"_id_meliscommerce_orders_content_tabs_content_messages_details","meliscommerce_orders_content_tabs_content_messages_details",{orderId:s})):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,s+"_id_meliscommerce_orders_page"))},function(e){console.log(e)}),melisCoreTool.done(this)}),e.on("click",".add-order-return-message",function(){var e=$(this),t=e.closest(".container-level-a").attr("id"),i=isNaN(parseInt(t,10))?"":parseInt(t,10),s=e.closest("div").find("form").serializeArray();s.push({name:"orderId",value:i}),s.push({name:"omsg_type",value:"RETURN"}),melisCoreTool.pending(this),melisCommerce.postSave("melis/MelisCommerce/MelisComOrder/saveOrderMessage",s,function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload(i+"_id_meliscommerce_orders_content_tabs_content_return_products_content_message_timeline","meliscommerce_orders_content_tabs_content_return_products_content_message_timeline",{orderId:i})):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,i+"_id_meliscommerce_orders_page"))},function(e){console.log(e)}),melisCoreTool.done(this)}),e.on("click",".updateListStatus",function(){var e=$(this).data("orderid");melisCoreTool.pending(this),zoneId="id_meliscommerce_order_list_content_status_form",melisKey="meliscommerce_order_list_content_status_form",modalUrl="/melis/MelisCommerce/MelisComOrderList/renderOrderListModal",melisHelper.createModal(zoneId,melisKey,!1,{orderId:e},modalUrl,function(){melisCoreTool.done(this)})}),e.on("click",".addShipping",function(){var e=$(this).closest("tr").attr("id");melisCoreTool.pending(this),zoneId="id_meliscommerce_order_modal_content_shipping_form",melisKey="meliscommerce_order_modal_content_shipping_form",modalUrl="/melis/MelisCommerce/MelisComOrder/renderOrderModal",melisHelper.createModal(zoneId,melisKey,!1,{orderId:e},modalUrl,function(){}),melisCoreTool.done(this)}),e.on("click","#saveOrderStatus",function(){var e=$(this),t=e.closest("#id_meliscommerce_order_list_content_status_form").find("form").serializeArray(),i="melis/MelisCommerce/MelisComOrderList/saveOrderStatus",s=$('#id_meliscommerce_order_list_content_status_form select[name="ord_status"]').val(),o=translations.tr_meliscommerce_orders_Order+" "+e.data("reference");melisCoreTool.pending(this),5==s?melisCoreTool.confirm(translations.tr_meliscommerce_order_common_label_yes,translations.tr_meliscommerce_order_common_label_no,o,translations.tr_meliscommerce_order_save_status_canceled_confirm,function(){melisCommerce.postSave(i,t,function(e){if(e.success){if(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload("id_meliscommerce_order_list_page","meliscommerce_order_list_page"),e.clientId+"_id_meliscommerce_client_page_tab_orders".length&&melisHelper.zoneReload(e.clientId+"_id_meliscommerce_client_page_tab_orders","meliscommerce_client_page_tab_orders",{clientId:e.clientId,activateTab:!0}),"coupon"==$("#"+activeTabId).data("pageid")){var t=activeTabId.split("_")[0];melisHelper.zoneReload(t+"_id_meliscommerce_coupon_tabs_content_orders_details_table","meliscommerce_coupon_tabs_content_orders_details_table",{couponId:t})}melisCore.flashMessenger()}else melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"id_meliscommerce_order_list_content_status_form")},function(e){console.log(e)})}):melisCommerce.postSave(i,t,function(e){if(e.success){if(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload("id_meliscommerce_order_list_page","meliscommerce_order_list_page"),e.clientId+"_id_meliscommerce_client_page_tab_orders".length&&melisHelper.zoneReload(e.clientId+"_id_meliscommerce_client_page_tab_orders","meliscommerce_client_page_tab_orders",{clientId:e.clientId,activateTab:!0}),"coupon"==$("#"+activeTabId).data("pageid")){var t=activeTabId.split("_")[0];melisHelper.zoneReload(t+"_id_meliscommerce_coupon_tabs_content_orders_details_table","meliscommerce_coupon_tabs_content_orders_details_table",{couponId:t})}melisCore.flashMessenger()}else melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"id_meliscommerce_order_list_content_status_form")},function(e){console.log(e)}),melisCoreTool.done(this),$("#id_meliscommerce_order_list_content_status_form_container").modal("hide")}),e.on("click","#saveOrderShipping",function(){var e,t=$(this).closest("#id_meliscommerce_order_modal_content_shipping_form").find("form"),i=$("#"+activeTabId+" input[name=ord_reference]").val(),s=$("#"+activeTabId+" .selectedStatus").data("statusid"),o=$("#"+activeTabId).attr("id"),r=isNaN(parseInt(o,10))?"":parseInt(o,10),a=[],n=0;melisCoreTool.pending(this),t.each(function(){var t=$(this),i=t.attr("name"),s=t.serializeArray();for(e=s.length,j=0;j<e;j++)a.push({name:i+"["+n+"]["+s[j].name+"]",value:s[j].value});n++}),a.push({name:"order[0][ord_id]",value:r}),a.push({name:"order[0][ord_reference]",value:i}),a.push({name:"order[0][ord_status]",value:s}),a.push({name:"orderId",value:r}),melisCommerce.postSave("melis/MelisCommerce/MelisComOrder/saveOrder",a,function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),e.clientId+"_id_meliscommerce_client_page_tab_orders".length&&melisHelper.zoneReload(e.clientId+"_id_meliscommerce_client_page_tab_orders","meliscommerce_client_page_tab_orders",{clientId:e.clientId,activateTab:!0}),$("#id_meliscommerce_order_modal_content_shipping_form_container").modal("hide"),melisHelper.zoneReload(r+"_id_meliscommerce_orders_content_tabs_content_shipping_details","meliscommerce_orders_content_tabs_content_shipping_details",{orderId:r}),melisCore.flashMessenger()):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"id_meliscommerce_order_modal_content_shipping_form"),$("#id_meliscommerce_order_modal_content_shipping_form .shippingDate").prev("label").css("color","#686868"),$.each(e.errors,function(e,t){"oship_date_sent"==e&&$("#id_meliscommerce_order_modal_content_shipping_form .shippingDate").prev("label").css("color","red")}))},function(e){console.log(e)}),melisCoreTool.done(this)}),e.on("click",".mainOrderStatus",function(){var e=$(this),t=e.find("span"),i=t.css("border-top-color");e.parent().find(".mainOrderStatus").each(function(){var e=$(this),t=e.find("span"),i=t.css("border-top-color");e.removeClass("selectedStatus"),t.css("color",i),t.css("background","#fff")}),e.addClass("selectedStatus"),t.css("color","#fff"),t.css("background",i)}),e.on("apply.daterangepicker",".dt_orderdatepicker",function(e,t){var i=$(this).parents().eq(5).find("table").attr("id");$("#"+i).data("dStartDate",dStartDate),$("#"+i).data("dEndDate",dEndDate),$("#"+i).DataTable().ajax.reload()}),e.on("change",".orderFilterStatus",function(){var e=$(this).parents().eq(6).find("table").attr("id");$("#"+e).DataTable().ajax.reload()}),e.on("click",".variantInfo",function(){var e=$(this),t=e.closest("tr").data("variantid"),i=e.closest("tr").data("sku"),s=e.closest("tr").data("productid"),o=e.closest("tr").find("td:nth-child(3)").text(),r=s+"_id_meliscommerce_products_page",a="id_meliscommerce_product_list_container";$("body #melis-id-nav-bar-tabs li a.tab-element[data-id='id_meliscommerce_product_list_container']").length>0?(melisCommerce.disableAllTabs(),melisCommerce.openProductPage(s,o,a,function(){melisCommerce.setUniqueId(s),melisHelper.tabOpen(i,"icon-tag-2",t+"_id_meliscommerce_variants_page","meliscommerce_variants_page",{variantId:t,productId:s},r),melisCommerce.setUniqueId(t),melisCommerce.enableAllTabs()})):melisHelper.tabOpen("Products","icon-shippment","id_meliscommerce_product_list_container","meliscommerce_product_list_container","",a,function(){melisCommerce.disableAllTabs(),melisCommerce.openProductPage(s,o,a,function(){melisCommerce.setUniqueId(s),melisHelper.tabOpen(i,"icon-tag-2",t+"_id_meliscommerce_variants_page","meliscommerce_variants_page",{variantId:t,productId:s},r),melisCommerce.setUniqueId(t),melisCommerce.enableAllTabs()})})}),e.on("click",".ordersExport",function(){melisCoreTool.isTableEmpty("tableOrderList")||(zoneId="id_meliscommerce_order_list_content_export_form",melisKey="meliscommerce_order_list_content_export_form",modalUrl="/melis/MelisCommerce/MelisComOrderList/renderOrderListModal",melisHelper.createModal(zoneId,melisKey,!1,{},modalUrl,function(){melisCoreTool.done(this)}))}),e.on("click","#exportOrders",function(){var e=$(this),t=e.closest("#id_meliscommerce_order_list_content_export_form").find("form").serializeArray();melisCoreTool.pending(e),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComOrderList/ordersExportValidate",data:t,dataType:"json",encode:!0}).done(function(e){e.success?(melisCoreTool.exportData("/melis/MelisCommerce/MelisComOrderList/ordersExportToCsv"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(0,e.errors,"id_meliscommerce_order_list_content_export_form"),$(".date_start").prev("label").css("color","#686868"),$(".date_end").prev("label").css("color","#686868"),$.each(e.errors,function(e,t){"date_start"==e&&$(".date_start").prev("label").css("color","red"),"date_end"==e&&$(".date_end").prev("label").css("color","red")}))}),melisCoreTool.done(e)}),e.on("click","#saveOrderStatusForm",function(){var e,t=$(this).data("statusid"),i=$("#id_meliscommerce_order_status_form_container .make-switch div").hasClass("switch-on"),s=$("#id_meliscommerce_order_status_form_container").find("form"),o=[],r=0,a=0;i&&(a=1),s.each(function(){var t=$(this),i=t.attr("name"),s=t.serializeArray();for(e=s.length,j=0;j<e;j++)o.push({name:i+"["+r+"]["+s[j].name+"]",value:s[j].value});r++}),o.push({name:"statusId",value:t}),o.push({name:"order_status[0][osta_status]",value:a}),melisCoreTool.pending(this),melisCommerce.postSave("melis/MelisCommerce/MelisComOrderStatus/saveOrderStatus",o,function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload("id_meliscommerce_order_status_content_table","meliscommerce_order_status_content_table"),$("#id_meliscommerce_order_status_form_container").modal("hide")):(melisCoreTool.highlightErrors(e.success,e.errors,"id_meliscommerce_order_status_form_container"),$.each(e.errors,function(e,t){"osta_color_code"==e&&$(".osta_color_code").prev("label").css("color","red")}),melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors)),melisCore.flashMessenger()},function(e){console.log(e)}),melisCoreTool.done(this)}),e.on("click",".orderStatusDelete",function(){var e=$(this).closest("tr").attr("id"),t=[];t.push({name:"ostaId",value:e}),melisCoreTool.pending(this),melisCoreTool.confirm(translations.tr_meliscommerce_documents_common_label_yes,translations.tr_meliscommerce_documents_common_label_no,translations.tr_meliscommerce_order_status_tool_leftmenu,translations.tr_meliscommerce_order_status_delete_confirm,function(){melisCommerce.postSave("melis/MelisCommerce/MelisComOrderStatus/deleteOrderStatus",t,function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload("id_meliscommerce_order_status_content_table","meliscommerce_order_status_content_table"),melisHelper.tabClose(couponId+"_id_meliscommerce_coupon_page")):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCore.flashMessenger()},function(e){console.log(e)})}),melisCoreTool.done(this)}),e.on("click",".a-accordion",function(){var e=$(this),t=e.attr("href");e.hasClass("collapsed")?e.removeClass("collapsed"):e.toggleClass("collapsed"),$(t).collapse("toggle")}),e.on("click",".tabs-label li a",function(){var e=$(this),t=e.attr("href");e.hasClass("shopping_bag")&&melisCore.screenSize<768&&$(t).find(".orderBasketRefresh").trigger("click")})}),window.initOrderBasket=function(e,t){var i=$("#"+t.sTableId).data("orderid");e.orderId=i},window.hideBasketButton=function(e,t){$(".variantInfo").each(function(){var e=$(this);variantId=e.closest("tr").data("variantid"),productId=e.closest("tr").data("productid"),null!=variantId&&null!=productId||e.hide()})},window.initOrderList=function(e,t){e.osta_id=$("#id_meliscommerce_order_list_content_table .orderFilterStatus").val(),e.startDate=$("#tableOrderList").data("dStartDate"),e.endDate=$("#tableOrderList").data("dEndDate");t.iDraw>1&&(dateSelectionContent=translations.tr_meliscore_datepicker_select_date+"<i class=\"glyphicon glyphicon-calendar fa fa-calendar\"></i> <span class='sdate'>"+dStartDate+" - "+dEndDate+'</span> <b class="caret"></b>',$("#tableOrderList_wrapper .dt_orderdatepicker .dt_dateInfo").html(dateSelectionContent)),dStartDate="",dEndDate=""},window.initOrderListTitle=function(){$("#tableOrderList .icon-shippment").parent("th").attr("title",translations.tr_meliscommerce_order_list_col_products),$("#tableOrderList .fa-usd").parent("th").attr("title",translations.tr_meliscommerce_order_list_col_price_title)},window.initCheckPermStatus=function(e){$("tr.primeStatus td").find(".orderStatusDelete").remove()},function(e,t){"function"==typeof define&&define.amd?define(["jquery"],function(e){return t(e)}):"object"==typeof exports?module.exports=t(require("jquery")):jQuery&&!jQuery.fn.colorpicker&&t(jQuery)}(0,function(e){"use strict";var t=function(i,s,o,r,a){this.fallbackValue=o?o&&void 0!==o.h?o:this.value={h:0,s:0,b:0,a:1}:null,this.fallbackFormat=r||"rgba",this.hexNumberSignPrefix=!0===a,this.value=this.fallbackValue,this.origFormat=null,this.predefinedColors=s||{},this.colors=e.extend({},t.webColors,this.predefinedColors),i&&(void 0!==i.h?this.value=i:this.setColor(String(i))),this.value||(this.value={h:0,s:0,b:0,a:1})};t.webColors={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32",transparent:"transparent"},t.prototype={constructor:t,colors:{},predefinedColors:{},getValue:function(){return this.value},setValue:function(e){this.value=e},_sanitizeNumber:function(e){return"number"==typeof e?e:isNaN(e)||null===e||""===e||void 0===e?1:""===e?0:void 0!==e.toLowerCase?(e.match(/^\./)&&(e="0"+e),Math.ceil(100*parseFloat(e))/100):1},isTransparent:function(e){return!(!e||!("string"==typeof e||e instanceof String))&&("transparent"===(e=e.toLowerCase().trim())||e.match(/#?00000000/)||e.match(/(rgba|hsla)\(0,0,0,0?\.?0\)/))},rgbaIsTransparent:function(e){return 0===e.r&&0===e.g&&0===e.b&&0===e.a},setColor:function(e){if(e=e.toLowerCase().trim()){if(this.isTransparent(e))return this.value={h:0,s:0,b:0,a:0},!0;var t=this.parse(e);t?(this.value=this.value={h:t.h,s:t.s,b:t.b,a:t.a},this.origFormat||(this.origFormat=t.format)):this.fallbackValue&&(this.value=this.fallbackValue)}return!1},setHue:function(e){this.value.h=1-e},setSaturation:function(e){this.value.s=e},setBrightness:function(e){this.value.b=1-e},setAlpha:function(e){this.value.a=Math.round(parseInt(100*(1-e),10)/100*100)/100},toRGB:function(e,t,i,s){var o,r,a,n,l;return 0===arguments.length&&(e=this.value.h,t=this.value.s,i=this.value.b,s=this.value.a),e=(e*=360)%360/60,o=r=a=i-(l=i*t),o+=[l,n=l*(1-Math.abs(e%2-1)),0,0,n,l][e=~~e],r+=[n,l,l,n,0,0][e],a+=[0,0,n,l,l,n][e],{r:Math.round(255*o),g:Math.round(255*r),b:Math.round(255*a),a:s}},toHex:function(e,t,i,s){0===arguments.length&&(e=this.value.h,t=this.value.s,i=this.value.b,s=this.value.a);var o=this.toRGB(e,t,i,s);return this.rgbaIsTransparent(o)?"transparent":(this.hexNumberSignPrefix?"#":"")+((1<<24)+(parseInt(o.r)<<16)+(parseInt(o.g)<<8)+parseInt(o.b)).toString(16).slice(1)},toHSL:function(e,t,i,s){0===arguments.length&&(e=this.value.h,t=this.value.s,i=this.value.b,s=this.value.a);var o=e,r=(2-t)*i,a=t*i;return a/=r>0&&r<=1?r:2-r,r/=2,a>1&&(a=1),{h:isNaN(o)?0:o,s:isNaN(a)?0:a,l:isNaN(r)?0:r,a:isNaN(s)?0:s}},toAlias:function(e,t,i,s){var o,r=0===arguments.length?this.toHex():this.toHex(e,t,i,s),a="alias"===this.origFormat?r:this.toString(this.origFormat,!1);for(var n in this.colors)if((o=this.colors[n].toLowerCase().trim())===r||o===a)return n;return!1},RGBtoHSB:function(e,t,i,s){var o,r,a,n;return e/=255,t/=255,i/=255,o=((o=0===(n=(a=Math.max(e,t,i))-Math.min(e,t,i))?null:a===e?(t-i)/n:a===t?(i-e)/n+2:(e-t)/n+4)+360)%6*60/360,r=0===n?0:n/a,{h:this._sanitizeNumber(o),s:r,b:a,a:this._sanitizeNumber(s)}},HueToRGB:function(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e},HSLtoRGB:function(e,t,i,s){var o;t<0&&(t=0);var r=2*i-(o=i<=.5?i*(1+t):i+t-i*t),a=e+1/3,n=e,l=e-1/3;return[Math.round(255*this.HueToRGB(r,o,a)),Math.round(255*this.HueToRGB(r,o,n)),Math.round(255*this.HueToRGB(r,o,l)),this._sanitizeNumber(s)]},parse:function(t){if(0===arguments.length)return!1;var i,s,o=this,r=!1,a=void 0!==this.colors[t];return a&&(t=this.colors[t].toLowerCase().trim()),e.each(this.stringParsers,function(e,n){var l=n.re.exec(t);return!(i=l&&n.parse.apply(o,[l]))||(r={},s=a?"alias":n.format?n.format:o.getValidFallbackFormat(),(r=s.match(/hsla?/)?o.RGBtoHSB.apply(o,o.HSLtoRGB.apply(o,i)):o.RGBtoHSB.apply(o,i))instanceof Object&&(r.format=s),!1)}),r},getValidFallbackFormat:function(){var e=["rgba","rgb","hex","hsla","hsl"];return this.origFormat&&-1!==e.indexOf(this.origFormat)?this.origFormat:this.fallbackFormat&&-1!==e.indexOf(this.fallbackFormat)?this.fallbackFormat:"rgba"},toString:function(e,i){i=i||!1;var s=!1;switch(e=e||this.origFormat||this.fallbackFormat){case"rgb":return s=this.toRGB(),this.rgbaIsTransparent(s)?"transparent":"rgb("+s.r+","+s.g+","+s.b+")";case"rgba":return"rgba("+(s=this.toRGB()).r+","+s.g+","+s.b+","+s.a+")";case"hsl":return s=this.toHSL(),"hsl("+Math.round(360*s.h)+","+Math.round(100*s.s)+"%,"+Math.round(100*s.l)+"%)";case"hsla":return s=this.toHSL(),"hsla("+Math.round(360*s.h)+","+Math.round(100*s.s)+"%,"+Math.round(100*s.l)+"%,"+s.a+")";case"hex":return this.toHex();case"alias":return!1===(s=this.toAlias())?this.toString(this.getValidFallbackFormat()):i&&!(s in t.webColors)&&s in this.predefinedColors?this.predefinedColors[s]:s;default:return s}},stringParsers:[{re:/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*?\)/,format:"rgb",parse:function(e){return[e[1],e[2],e[3],1]}},{re:/rgb\(\s*(\d*(?:\.\d+)?)\%\s*,\s*(\d*(?:\.\d+)?)\%\s*,\s*(\d*(?:\.\d+)?)\%\s*?\)/,format:"rgb",parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],1]}},{re:/rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d*(?:\.\d+)?)\s*)?\)/,format:"rgba",parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba\(\s*(\d*(?:\.\d+)?)\%\s*,\s*(\d*(?:\.\d+)?)\%\s*,\s*(\d*(?:\.\d+)?)\%\s*(?:,\s*(\d*(?:\.\d+)?)\s*)?\)/,format:"rgba",parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/hsl\(\s*(\d*(?:\.\d+)?)\s*,\s*(\d*(?:\.\d+)?)\%\s*,\s*(\d*(?:\.\d+)?)\%\s*?\)/,format:"hsl",parse:function(e){return[e[1]/360,e[2]/100,e[3]/100,e[4]]}},{re:/hsla\(\s*(\d*(?:\.\d+)?)\s*,\s*(\d*(?:\.\d+)?)\%\s*,\s*(\d*(?:\.\d+)?)\%\s*(?:,\s*(\d*(?:\.\d+)?)\s*)?\)/,format:"hsla",parse:function(e){return[e[1]/360,e[2]/100,e[3]/100,e[4]]}},{re:/#?([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,format:"hex",parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),1]}},{re:/#?([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,format:"hex",parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),1]}}],colorNameToHex:function(e){return void 0!==this.colors[e.toLowerCase()]&&this.colors[e.toLowerCase()]}};var i={horizontal:!1,inline:!1,color:!1,format:!1,input:"input",container:!1,component:".add-on, .input-group-addon",fallbackColor:!1,fallbackFormat:"hex",hexNumberSignPrefix:!0,sliders:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setHue"},alpha:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setAlpha"}},slidersHorz:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:100,maxTop:0,callLeft:"setHue",callTop:!1},alpha:{maxLeft:100,maxTop:0,callLeft:"setAlpha",callTop:!1}},template:'<div class="colorpicker dropdown-menu"><div class="colorpicker-saturation"><i><b></b></i></div><div class="colorpicker-hue"><i></i></div><div class="colorpicker-alpha"><i></i></div><div class="colorpicker-color"><div /></div><div class="colorpicker-selectors"></div></div>',align:"right",customClass:null,colorSelectors:null},s=function(t,s){this.element=e(t).addClass("colorpicker-element"),this.options=e.extend(!0,{},i,this.element.data(),s),this.component=this.options.component,this.component=!1!==this.component&&this.element.find(this.component),this.component&&0===this.component.length&&(this.component=!1),this.container=!0===this.options.container?this.element:this.options.container,this.container=!1!==this.container&&e(this.container),this.input=this.element.is("input")?this.element:!!this.options.input&&this.element.find(this.options.input),this.input&&0===this.input.length&&(this.input=!1),this.color=this.createColor(!1!==this.options.color?this.options.color:this.getValue()),this.format=!1!==this.options.format?this.options.format:this.color.origFormat,!1!==this.options.color&&(this.updateInput(this.color),this.updateData(this.color));var o=this.picker=e(this.options.template);if(this.options.customClass&&o.addClass(this.options.customClass),this.options.inline?o.addClass("colorpicker-inline colorpicker-visible"):o.addClass("colorpicker-hidden"),this.options.horizontal&&o.addClass("colorpicker-horizontal"),-1===["rgba","hsla","alias"].indexOf(this.format)&&!1!==this.options.format&&"transparent"!==this.getValue()||o.addClass("colorpicker-with-alpha"),"right"===this.options.align&&o.addClass("colorpicker-right"),!0===this.options.inline&&o.addClass("colorpicker-no-arrow"),this.options.colorSelectors){var r=this,a=r.picker.find(".colorpicker-selectors");a.length>0&&(e.each(this.options.colorSelectors,function(t,i){var s=e("<i />").addClass("colorpicker-selectors-color").css("background-color",i).data("class",t).data("alias",t);s.on("mousedown.colorpicker touchstart.colorpicker",function(t){t.preventDefault(),r.setValue("alias"===r.format?e(this).data("alias"):e(this).css("background-color"))}),a.append(s)}),a.show().addClass("colorpicker-visible"))}o.on("mousedown.colorpicker touchstart.colorpicker",e.proxy(function(e){e.target===e.currentTarget&&e.preventDefault()},this)),o.find(".colorpicker-saturation, .colorpicker-hue, .colorpicker-alpha").on("mousedown.colorpicker touchstart.colorpicker",e.proxy(this.mousedown,this)),o.appendTo(this.container?this.container:e("body")),!1!==this.input&&(this.input.on({"keyup.colorpicker":e.proxy(this.keyup,this)}),this.input.on({"change.colorpicker":e.proxy(this.change,this)}),!1===this.component&&this.element.on({"focus.colorpicker":e.proxy(this.show,this)}),!1===this.options.inline&&this.element.on({"focusout.colorpicker":e.proxy(this.hide,this)})),!1!==this.component&&this.component.on({"click.colorpicker":e.proxy(this.show,this)}),!1===this.input&&!1===this.component&&this.element.on({"click.colorpicker":e.proxy(this.show,this)}),!1!==this.input&&!1!==this.component&&"color"===this.input.attr("type")&&this.input.on({"click.colorpicker":e.proxy(this.show,this),"focus.colorpicker":e.proxy(this.show,this)}),this.update(),e(e.proxy(function(){this.element.trigger("create")},this))};s.Color=t,s.prototype={constructor:s,destroy:function(){this.picker.remove(),this.element.removeData("colorpicker","color").off(".colorpicker"),!1!==this.input&&this.input.off(".colorpicker"),!1!==this.component&&this.component.off(".colorpicker"),this.element.removeClass("colorpicker-element"),this.element.trigger({type:"destroy"})},reposition:function(){if(!1!==this.options.inline||this.options.container)return!1;var e=this.container&&this.container[0]!==window.document.body?"position":"offset",t=this.component||this.element,i=t[e]();"right"===this.options.align&&(i.left-=this.picker.outerWidth()-t.outerWidth()),this.picker.css({top:i.top+t.outerHeight(),left:i.left})},show:function(t){this.isDisabled()||(this.picker.addClass("colorpicker-visible").removeClass("colorpicker-hidden"),this.reposition(),e(window).on("resize.colorpicker",e.proxy(this.reposition,this)),!t||this.hasInput()&&"color"!==this.input.attr("type")||t.stopPropagation&&t.preventDefault&&(t.stopPropagation(),t.preventDefault()),!this.component&&this.input||!1!==this.options.inline||e(window.document).on({"mousedown.colorpicker":e.proxy(this.hide,this)}),this.element.trigger({type:"showPicker",color:this.color}))},hide:function(t){if(void 0!==t&&t.target&&(e(t.currentTarget).parents(".colorpicker").length>0||e(t.target).parents(".colorpicker").length>0))return!1;this.picker.addClass("colorpicker-hidden").removeClass("colorpicker-visible"),e(window).off("resize.colorpicker",this.reposition),e(window.document).off({"mousedown.colorpicker":this.hide}),this.update(),this.element.trigger({type:"hidePicker",color:this.color})},updateData:function(e){return e=e||this.color.toString(this.format,!1),this.element.data("color",e),e},updateInput:function(e){return e=e||this.color.toString(this.format,!1),!1!==this.input&&(this.input.prop("value",e),this.input.trigger("change")),e},updatePicker:function(e){void 0!==e&&(this.color=this.createColor(e));var t=!1===this.options.horizontal?this.options.sliders:this.options.slidersHorz,i=this.picker.find("i");if(0!==i.length)return!1===this.options.horizontal?(t=this.options.sliders,i.eq(1).css("top",t.hue.maxTop*(1-this.color.value.h)).end().eq(2).css("top",t.alpha.maxTop*(1-this.color.value.a))):(t=this.options.slidersHorz,i.eq(1).css("left",t.hue.maxLeft*(1-this.color.value.h)).end().eq(2).css("left",t.alpha.maxLeft*(1-this.color.value.a))),i.eq(0).css({top:t.saturation.maxTop-this.color.value.b*t.saturation.maxTop,left:this.color.value.s*t.saturation.maxLeft}),this.picker.find(".colorpicker-saturation").css("backgroundColor",(this.options.hexNumberSignPrefix?"":"#")+this.color.toHex(this.color.value.h,1,1,1)),this.picker.find(".colorpicker-alpha").css("backgroundColor",(this.options.hexNumberSignPrefix?"":"#")+this.color.toHex()),this.picker.find(".colorpicker-color, .colorpicker-color div").css("backgroundColor",this.color.toString(this.format,!0)),e},updateComponent:function(e){var t;if(t=void 0!==e?this.createColor(e):this.color,!1!==this.component){var i=this.component.find("i").eq(0);i.length>0?i.css({backgroundColor:t.toString(this.format,!0)}):this.component.css({backgroundColor:t.toString(this.format,!0)})}return t.toString(this.format,!1)},update:function(e){var t;return!1===this.getValue(!1)&&!0!==e||(t=this.updateComponent(),this.updateInput(t),this.updateData(t),this.updatePicker()),t},setValue:function(e){this.color=this.createColor(e),this.update(!0),this.element.trigger({type:"changeColor",color:this.color,value:e})},createColor:function(e){return new t(e||null,this.options.colorSelectors,this.options.fallbackColor?this.options.fallbackColor:this.color,this.options.fallbackFormat,this.options.hexNumberSignPrefix)},getValue:function(e){var t;return e=void 0===e?this.options.fallbackColor:e,void 0!==(t=this.hasInput()?this.input.val():this.element.data("color"))&&""!==t&&null!==t||(t=e),t},hasInput:function(){return!1!==this.input},isDisabled:function(){return!!this.hasInput()&&!0===this.input.prop("disabled")},disable:function(){return!!this.hasInput()&&(this.input.prop("disabled",!0),this.element.trigger({type:"disable",color:this.color,value:this.getValue()}),!0)},enable:function(){return!!this.hasInput()&&(this.input.prop("disabled",!1),this.element.trigger({type:"enable",color:this.color,value:this.getValue()}),!0)},currentSlider:null,mousePointer:{left:0,top:0},mousedown:function(t){!t.pageX&&!t.pageY&&t.originalEvent&&t.originalEvent.touches&&(t.pageX=t.originalEvent.touches[0].pageX,t.pageY=t.originalEvent.touches[0].pageY),t.stopPropagation(),t.preventDefault();var i=e(t.target).closest("div"),s=this.options.horizontal?this.options.slidersHorz:this.options.sliders;if(!i.is(".colorpicker")){if(i.is(".colorpicker-saturation"))this.currentSlider=e.extend({},s.saturation);else if(i.is(".colorpicker-hue"))this.currentSlider=e.extend({},s.hue);else{if(!i.is(".colorpicker-alpha"))return!1;this.currentSlider=e.extend({},s.alpha)}var o=i.offset();this.currentSlider.guide=i.find("i")[0].style,this.currentSlider.left=t.pageX-o.left,this.currentSlider.top=t.pageY-o.top,this.mousePointer={left:t.pageX,top:t.pageY},e(window.document).on({"mousemove.colorpicker":e.proxy(this.mousemove,this),"touchmove.colorpicker":e.proxy(this.mousemove,this),"mouseup.colorpicker":e.proxy(this.mouseup,this),"touchend.colorpicker":e.proxy(this.mouseup,this)}).trigger("mousemove")}return!1},mousemove:function(e){!e.pageX&&!e.pageY&&e.originalEvent&&e.originalEvent.touches&&(e.pageX=e.originalEvent.touches[0].pageX,e.pageY=e.originalEvent.touches[0].pageY),e.stopPropagation(),e.preventDefault();var t=Math.max(0,Math.min(this.currentSlider.maxLeft,this.currentSlider.left+((e.pageX||this.mousePointer.left)-this.mousePointer.left))),i=Math.max(0,Math.min(this.currentSlider.maxTop,this.currentSlider.top+((e.pageY||this.mousePointer.top)-this.mousePointer.top)));return this.currentSlider.guide.left=t+"px",this.currentSlider.guide.top=i+"px",this.currentSlider.callLeft&&this.color[this.currentSlider.callLeft].call(this.color,t/this.currentSlider.maxLeft),this.currentSlider.callTop&&this.color[this.currentSlider.callTop].call(this.color,i/this.currentSlider.maxTop),!1!==this.options.format||"setAlpha"!==this.currentSlider.callTop&&"setAlpha"!==this.currentSlider.callLeft||(1!==this.color.value.a?(this.format="rgba",this.color.origFormat="rgba"):(this.format="hex",this.color.origFormat="hex")),this.update(!0),this.element.trigger({type:"changeColor",color:this.color}),!1},mouseup:function(t){return t.stopPropagation(),t.preventDefault(),e(window.document).off({"mousemove.colorpicker":this.mousemove,"touchmove.colorpicker":this.mousemove,"mouseup.colorpicker":this.mouseup,"touchend.colorpicker":this.mouseup}),!1},change:function(e){this.keyup(e)},keyup:function(e){38===e.keyCode?(this.color.value.a<1&&(this.color.value.a=Math.round(100*(this.color.value.a+.01))/100),this.update(!0)):40===e.keyCode?(this.color.value.a>0&&(this.color.value.a=Math.round(100*(this.color.value.a-.01))/100),this.update(!0)):(this.color=this.createColor(this.input.val()),this.color.origFormat&&!1===this.options.format&&(this.format=this.color.origFormat),!1!==this.getValue(!1)&&(this.updateData(),this.updateComponent(),this.updatePicker())),this.element.trigger({type:"changeColor",color:this.color,value:this.input.val()})}},e.colorpicker=s,e.fn.colorpicker=function(t){var i=Array.prototype.slice.call(arguments,1),o=1===this.length,r=null,a=this.each(function(){var o=e(this),a=o.data("colorpicker");a||(a=new s(this,"object"==typeof t?t:{}),o.data("colorpicker",a)),"string"==typeof t?e.isFunction(a[t])?r=a[t].apply(a,i):(i.length&&(a[t]=i[0]),r=a[t]):r=o});return o?r:a},e.fn.colorpicker.constructor=s}),$(function(){var e=$("body");e.on("keyup keydown change","input[name='eseo_meta_title']",{limit:60},seoCharCounter),e.on("keyup keydown change","textarea[name='eseo_meta_description']",{limit:160},seoCharCounter)}),window.preSeoCharCounter=function(){$("form.seoForm").each(function(){var e=$(this),t=e.find("input[name='eseo_meta_title']"),i=e.find("textarea[name='eseo_meta_description']");t.trigger("keyup"),i.trigger("keyup")})},window.seoCharCounter=function(e){var t=$(this),i=t.val().length,s=t.prev("label"),o=e.data.limit;s.find(".label-text span").length?0===i?(s.removeClass("limit"),s.find(".label-text span").remove()):(s.find(".label-text span").html('<i class="fa fa-text-width"></i>('+i+")"),i>o?(s.addClass("limit"),s.find(".label-text span").addClass("limit")):(s.removeClass("limit"),s.find(".label-text span").removeClass("limit"))):0!==i&&(s.find(".label-text").append("<span class='text-counter-indicator'><i class='fa fa-text-width'></i>("+i+")</span>"),i>o&&(s.addClass("limit"),s.find(".label-text span").addClass("limit")))};melisCommerceSeo=function(e){return{serializeSeo:function(e,t,i){var s=new Array;return $("form."+e+"_"+t+"_seo_form").each(function(){langId=$(this).data("langid"),s=$(this).serializeArray(),$.each(s,function(){i.push({name:e+"_seo["+langId+"]["+this.name+"]",value:this.value})})}),i}}}(window);function melisSKUKoNotification(e,t,i,s){void 0===s&&(s="closeByButtonOnly"),s="closeByButtonOnly"!==s?"overlay-hideonclick":"";var o="<h3>"+melisHelper.melisTranslator(e)+"</h3>";o+="<h4>"+melisHelper.melisTranslator(t)+"</h4>",$.each(i,function(e,t){if("label"!==e){o+='<p class="modal-error-cont"><strong>'+(null==i[e].label?null==i.label?e:i.label:i[e].label)+": </strong>  ";try{$.each(t,function(e,t){"label"!==e&&"form"!==e&&($errMsg="",t instanceof Object?$errMsg=t[0]:$errMsg=t,o+='<span><i class="fa fa-circle"></i>'+$errMsg+"</span>")})}catch(i){"label"!==e&&"form"!==e&&(o+='<span><i class="fa fa-circle"></i>'+t+"</span>")}o+="</p>"}});var r="<div class='melis-modaloverlay "+s+"'></div>";r+="<div class='melis-modal-cont KOnotif'>  <div class='modal-content'>"+o+" <span class='btn btn-block btn-primary'>"+translations.tr_meliscore_notification_modal_Close+"</span></div> </div>",$body.append(r)}function highlightSKUErrors(e,t,i){$(".duplicate-table-label").css("color","inherit"),0===e&&$.each(t,function(e,t){"form"in t&&$.each(this.form,function(e,t){$("#"+t+"_label").css("color","red")})})}$(function(){var e=$("body");function t(e){var t=activeTabId.split("_")[0];e.push({name:"ccli_coupon_id",value:t}),melisCommerce.postSave("/melis/MelisCommerce/MelisComCoupon/couponClientManagement",e,function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload(t+"_id_meliscommerce_coupon_tabs_content_assign_details","meliscommerce_coupon_tabs_content_assign_details",{couponId:t}),melisHelper.zoneReload(t+"_id_meliscommerce_coupon_tabs_content_assigned_details_table","meliscommerce_coupon_tabs_content_assigned_details_table",{couponId:t})):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCore.flashMessenger()},function(e){console.log(e),alert(translations.tr_meliscore_error_message)}),$("#"+t+"_id_meliscommerce_coupon_tabs_content_assign_details").addClass("active")}function i(e,t,i){var s=i;melisHelper.tabOpen(e,"fa fa-ticket",t+"_id_meliscommerce_coupon_page","meliscommerce_coupon_page",{couponId:t},s)}function s(e){var t=activeTabId.split("_")[0];e.push({name:"cprod_coupon_id",value:t}),melisCommerce.postSave("/melis/MelisCommerce/MelisComCoupon/couponProductManagement",e,function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload(t+"_id_meliscommerce_coupon_tabs_content_assign_product_details_table","meliscommerce_coupon_tabs_content_assign_product_details_table",{couponId:t}),melisHelper.zoneReload(t+"_id_meliscommerce_coupon_tabs_content_assigned_product_details_table","meliscommerce_coupon_tabs_content_assigned_product_details_table",{couponId:t})):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCore.flashMessenger()},function(e){console.log(e)})}e.on("click",".orderPaymentCouponLink",function(){var e=$(this),t=e.data("couponid"),s=e.data("couponname"),o=$("body #melis-id-nav-bar-tabs li a.tab-element[data-id='id_meliscommerce_coupon_list_page']");melisHelper.tabOpen(translations.tr_meliscommerce_coupon_list_page,"fa fa-ticket","id_meliscommerce_coupon_list_page","meliscommerce_coupon_list_page",{},"");var r=setInterval(function(){o.length&&(i(s,t,"id_meliscommerce_coupon_list_page"),clearInterval(r))},500)}),e.on("click",".couponListRefresh",function(){melisHelper.zoneReload("id_meliscommerce_coupon_list_content_table","meliscommerce_coupon_list_content_table")}),e.on("click",".couponAssignedClientListRefresh",function(){var e=activeTabId.split("_")[0];melisHelper.zoneReload(e+"_id_meliscommerce_coupon_tabs_content_assigned_details_table","meliscommerce_coupon_tabs_content_assigned_details_table",{couponId:e})}),e.on("click",".couponClientListRefresh",function(){var e=$(this),t=e.parents().eq(5).attr("id"),i=e.parents().eq(5).data("meliskey"),s=activeTabId.split("_")[0];melisHelper.zoneReload(t,i,{couponId:s})}),e.on("click",".addNewCoupon",function(){melisHelper.tabOpen(translations.tr_meliscommerce_coupon_list_add_coupon,"fa fa-ticket","0_id_meliscommerce_coupon_page","meliscommerce_coupon_page",{},"id_meliscommerce_coupon_list_page")}),e.on("click",".removeCouponFromClient",function(){var e=$(this),i=e.closest("tr").attr("id"),s=[],o=e.closest("td").prev().find("a").data("ccli_id");melisCoreTool.pending(this),s.push({name:"ccli_client_id",value:i}),s.push({name:"method",value:"remove"}),s.push({name:"ccliId",value:o}),t(s),melisCoreTool.done(this)}),e.on("click",".addCouponToClient",function(){var e=$(this).closest("tr").attr("id"),i=[];melisCoreTool.pending(this),i.push({name:"ccli_client_id",value:e}),i.push({name:"method",value:"add"}),t(i),melisCoreTool.done(this)}),e.on("click",".saveCoupon",function(){melisCoreTool.pending(this);var e,t=activeTabId.split("_")[0],s=$(this).closest(".container-level-a").find("form"),o=[];s.each(function(){var t=0,i=$(this).attr("name"),s=$(this).serializeArray();for(e=s.length,j=0;j<e;j++)o.push({name:i+"["+t+"]["+s[j].name+"]",value:s[j].value});t++,0}),o.push({name:"couponId",value:t}),$("#"+activeTabId+" .make-switch div").each(function(){var e="switch["+$(this).find("input").attr("name")+"]",t=0;$(this).hasClass("switch-on")&&(t=1),o.push({name:e,value:t})}),melisCommerce.postSave("/melis/MelisCommerce/MelisComCoupon/saveCouponData",o,function(e){e.success?(melisHelper.tabClose(t+"_id_meliscommerce_coupon_page",!0),i(translations.tr_meliscommerce_coupon_page+" "+e.chunk.coup_code,e.chunk.couponId,"id_meliscommerce_coupon_list_page"),melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload("id_meliscommerce_coupon_list_content_table","meliscommerce_coupon_list_content_table")):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,t+"_id_meliscommerce_coupon_page"),$(".couponEnd").prev("label").css("color","#686868"),$.each(e.errors,function(e,i){"coup_date_valid_end"==e&&$(".couponEnd").prev("label").css("color","red"),"values"==e&&($("#"+t+"_id_meliscommerce_coupon_page .form-control[name='coup_percentage']").prev("label").css("color","red"),$("#"+t+"_id_meliscommerce_coupon_page .form-control[name='coup_discount_value']").prev("label").css("color","red"))})),melisCore.flashMessenger()},function(e){console.log(e)}),melisCoreTool.done(this)}),e.on("click",".couponInfo",function(){var e=$(this),t=e.closest("tr").attr("id"),s=e.closest("tr").find("td:nth-child(3)").text(),o=t;s.length>0&&(o=s),i(translations.tr_meliscommerce_coupon_page+" "+o,t,"id_meliscommerce_coupon_list_page")}),e.on("click",".couponDelete",function(){var e=$(this).closest("tr").attr("id"),t=[];t.push({name:"couponId",value:e}),melisCoreTool.pending(this),melisCoreTool.confirm(translations.tr_meliscommerce_documents_common_label_yes,translations.tr_meliscommerce_documents_common_label_no,translations.tr_meliscommerce_coupon_list_page_coupon,translations.tr_meliscommerce_coupon_delete_confirm,function(){melisCommerce.postSave("/melis/MelisCommerce/MelisComCouponList/deleteCoupon",t,function(t){t.success?(melisHelper.melisOkNotification(t.textTitle,t.textMessage),melisHelper.zoneReload("id_meliscommerce_coupon_list_content_table","meliscommerce_coupon_list_content_table"),melisHelper.tabClose(e+"_id_meliscommerce_coupon_page")):melisHelper.melisKoNotification(t.textTitle,t.textMessage,t.errors),melisCore.flashMessenger()},function(e){console.log(e)})}),melisCoreTool.done(this)}),e.on("click",".couponAssignedDelete",function(){var e=$(this),t=e.closest("tr").attr("id"),i=e.closest("tr").data("couponid"),s=[];s.push({name:"couponId",value:i}),s.push({name:"clientId",value:t}),melisCoreTool.pending(this),melisCoreTool.confirm(translations.tr_meliscommerce_documents_common_label_yes,translations.tr_meliscommerce_documents_common_label_no,translations.tr_meliscommerce_coupon_list_page_coupon,translations.tr_meliscommerce_coupon_delete_confirm_remove,function(){melisCommerce.postSave("/melis/MelisCommerce/MelisComCoupon/deleteAssignedCoupon",s,function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload(i+"_id_meliscommerce_coupon_tabs_content_assign_details","meliscommerce_coupon_tabs_content_assign_details",{couponId:i}),melisHelper.zoneReload(i+"_id_meliscommerce_coupon_tabs_content_assigned_details_table","meliscommerce_coupon_tabs_content_assigned_details_table",{couponId:i})):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCore.flashMessenger()},function(e){console.log(e)})}),$("#"+i+"_id_meliscommerce_coupon_tabs_content_assign_details").addClass("active"),melisCoreTool.done(this)}),e.on("click",".addCouponToProduct",function(){var e=$(this).closest("tr").attr("id"),t=[];melisCoreTool.pending(this),t.push({name:"cprod_product_id",value:e}),t.push({name:"method",value:"add"}),s(t),melisCoreTool.done(this)}),e.on("click",".couponAssignedProductDelete",function(){var e=$(this).closest("tr").attr("id"),t=[];melisCoreTool.pending(this),t.push({name:"cprod_product_id",value:e}),t.push({name:"method",value:"remove"}),melisCoreTool.confirm(translations.tr_meliscommerce_documents_common_label_yes,translations.tr_meliscommerce_documents_common_label_no,translations.tr_meliscommerce_coupon_list_page_coupon,translations.tr_meliscommerce_coupon_delete_confirm_remove_product,function(){s(t)}),melisCoreTool.done(this)}),e.on("click",".user_add",function(){var e=$(this).attr("href");$(e).find(".couponClientListRefresh").trigger("click")}),e.on("click",".more_items",function(){var e=$(this).attr("href");$(e).find(".couponClientListRefresh").trigger("click")})}),window.initCouponClient=function(e,t){var i=$("#"+t.sTableId).data("couponid");e.couponId=i},window.initCouponClientTable=function(){$(".couponNoAddButton .addCouponToClient").remove(),$(".couponNoAddButton .assignedClients").show()},window.initCouponProductTable=function(){$(".couponProductNoAddButton .addCouponToProduct").remove(),$(".couponProductNoAddButton .assignedProduct").show()},window.initCouponOrder=function(e,t){var i=$("#"+t.sTableId).data("couponid");e.couponId=i,e.osta_id=$("#"+i+"_id_meliscommerce_coupon_tabs_content_orders_details_table .orderFilterStatus").val(),e.startDate=$("#"+i+"_couponOrderList").data("dStartDate"),e.endDate=$("#"+i+"_couponOrderList").data("dEndDate");t.iDraw>1&&(dateSelectionContent=translations.tr_meliscore_datepicker_select_date+"<i class=\"glyphicon glyphicon-calendar fa fa-calendar\"></i> <span class='sdate'>"+dStartDate+" - "+dEndDate+'</span> <strong class="caret"></strong>',$("#"+i+"_couponOrderList_wrapper .dt_orderdatepicker .dt_dateInfo").html(dateSelectionContent)),dStartDate="",dEndDate=""},window.drawCouponClient=function(){},window.initCheckUsedCoupon=function(){$("#tableCouponList tr.couponUsed td").find(".couponDelete").remove(),$(".couponListNoDeleteButton .couponDelete").remove()},window.initCheckClientUsedCoupon=function(e){$("tr.couponAssigned td").find(".couponAssignedDelete").remove()},window.initMelisCommerceCouponTbl=function(){$(".commerce-coupon-percent").attr("title",translations.tr_meliscommerce_coupon_list_col_percent),$(".commerce-coupon-value").attr("title",translations.tr_meliscommerce_coupon_list_col_money)},window.initMelisCouponProduct=function(e,t){var i=$("#"+t.sTableId).data("couponid"),s=$("#"+t.sTableId).data("assign");e.couponId=i,e.assign=s},$(function(){var e=$("body");e.on("click",".addNewOrder",function(){melisHelper.tabOpen(translations.tr_meliscommerce_order_checkout_title,"fa fa fa-plus fa-2x","id_meliscommerce_order_checkout","meliscommerce_order_checkout","","id_meliscommerce_order_list_page")}),e.on("click",".orderCheckoutProduListViewVariant",function(){var e=$(this).closest("tr"),t=$orderCheckoutProductListTbl.row(e),i=e.attr("id");if(t.child.isShown())t.child.hide(),e.removeClass("shown");else{var s=i+"_id_meliscommerce_order_checkout_product_variant_list",o="meliscommerce_order_checkout_product_variant_list",r='<div class="checkout-product-variant-list" id="'+s+'" melisKey="'+o+'"></div>';t.child(r).show(),e.addClass("shown"),$(".checkout-product-variant-list").attr("style","margin-bottom: 10px;"),melisHelper.zoneReload(s,o,{productId:i})}}),e.on("change","#orderCheckoutCountries",function(){var e=$(this),t=new Array;$countryId=e.val(),t.push({name:"countryId",value:$countryId}),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComOrderCheckout/orderCheckoutSetCountry",data:t,dataType:"json",encode:!0}).done(function(e){e.success?(melisHelper.zoneReload("id_meliscommerce_order_checkout_product_list","meliscommerce_order_checkout_product_list"),melisHelper.zoneReload("id_meliscommerce_order_checkout_product_bakset","meliscommerce_order_checkout_product_bakset")):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors)}).fail(function(){alert(translations.tr_meliscore_error_message)})}),e.on("click",".orderCheckoutVariantAddBasket",function(){var e=$(this).data("variantid");dataString=new Array,dataString.push({name:"var_id",value:e}),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComOrderCheckout/addBasket",data:dataString,dataType:"json",encode:!0}).done(function(e){if(e.success){melisHelper.zoneReload("id_meliscommerce_order_checkout_product_bakset","meliscommerce_order_checkout_product_bakset"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)}else melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors)}).fail(function(){alert(translations.tr_meliscore_error_message)})}),e.on("change",".orderBasketVariantQty",function(){var e=$(this),t=e.data("variantid"),i=parseInt(e.data("quantity")),s=parseInt(e.val());i<s?updateVariantbasket("add",t,s):updateVariantbasket("deduct",t,s)}),e.on("keydown",".orderBasketVariantQty",function(e){-1!==$.inArray(e.keyCode,[46,8,9,27,13,110,190])||65===e.keyCode&&(!0===e.ctrlKey||!0===e.metaKey)||e.keyCode>=35&&e.keyCode<=40||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()}),e.on("click",".qty-plus",function(){var e=$(this).data("variantid"),t=$("#"+e+"_orderBasketVariantQty");variantQty=parseInt(t.val())+1,t.val(variantQty),updateVariantbasket("add",e,variantQty)}),e.on("click",".qty-minus",function(){var e=$(this).data("variantid"),t=$("#"+e+"_orderBasketVariantQty");$varQty=t.val(),parseInt($varQty)>0&&(variantQty=parseInt(t.val())-1,t.val(variantQty),updateVariantbasket("deduct",e,variantQty))}),e.on("click",".orderCheckoutFirstStepBtn",function(){var e=$(this),t=e.data("tabid");e.button("loading"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComOrderCheckout/checkBasket",dataType:"json",encode:!0}).done(function(i){i.success?melisCommerce.switchOrderTab(t):melisHelper.melisKoNotification(i.textTitle,i.textMessage,i.errors),e.button("reset")}).fail(function(){e.button("reset"),alert(translations.tr_meliscore_error_message)})}),e.on("click",".orderCheckoutNextStep",function(){var e=$("html, body"),t=$("#id_meliscommerce_order_checkout_choose_contact_step"),i=t.find(".orderCheckoutContactListRefresh");e.stop().animate({scrollTop:0},"500","swing"),setTimeout(function(){t.hasClass("active")&&i.length>0&&melisCore.screenSize<768&&i.trigger("click")},3e3)}),e.on("click",".orderCheckoutPrevStep",function(){var e=$(this).data("tabid"),t=$("html, body");melisCommerce.switchOrderTab(e),"#id_meliscommerce_order_checkout_select_addresses_step_nav"==e&&(melisHelper.zoneReload("id_meliscommerce_order_checkout_billing_address","meliscommerce_order_checkout_billing_address"),melisHelper.zoneReload("id_meliscommerce_order_checkout_delivery_address","meliscommerce_order_checkout_delivery_address")),t.stop().animate({scrollTop:0},"500","swing")}),e.on("click",".orderCheckoutSelectContact",function(){var e=$(this),t=e.closest("tr").attr("id"),i=e.data("tabid"),s=new Array;e.attr("disabled",!0),s.push({name:"contactId",value:t}),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComOrderCheckout/selectContact",data:s,dataType:"json",encode:!0}).done(function(t){t.success?(melisCommerce.switchOrderTab(i),setTimeout(function(){melisHelper.zoneReload("id_meliscommerce_order_checkout_product_list","meliscommerce_order_checkout_product_list"),melisHelper.zoneReload("id_meliscommerce_order_checkout_product_bakset","meliscommerce_order_checkout_product_bakset"),melisHelper.zoneReload("id_meliscommerce_order_checkout_billing_address","meliscommerce_order_checkout_billing_address"),melisHelper.zoneReload("id_meliscommerce_order_checkout_delivery_address","meliscommerce_order_checkout_delivery_address")},300)):melisHelper.melisKoNotification(t.textTitle,t.textMessage,t.errors),e.attr("disabled",!1)}).fail(function(){e.attr("disabled",!1),alert(translations.tr_meliscore_error_message)})}),e.on("click",".orderCheckoutContactListRefresh",function(){melisHelper.zoneReload("id_meliscommerce_order_checkout_choose_contact_step_content","meliscommerce_order_checkout_choose_contact_step_content")}),e.on("change","#orderCheckoutBillingSelect",function(){var e=$(this).val();melisHelper.zoneReload("id_meliscommerce_order_checkout_billing_address","meliscommerce_order_checkout_billing_address",{cadd_id:e,action:1})}),e.on("change","#order-checkout-billing-address-same",function(){var e=$(this),t=$("#order-checkout-billing-form-zone");e.is(":checked")?t.addClass("hidden"):t.removeClass("hidden")}),e.on("change","#orderCheckoutDeliverySelect",function(){var e=$(this).val();melisHelper.zoneReload("id_meliscommerce_order_checkout_delivery_address","meliscommerce_order_checkout_delivery_address",{cadd_id:e})}),e.on("click","#orderCheckoutCreateBillingAdd",function(){melisHelper.zoneReload("id_meliscommerce_order_checkout_billing_address","meliscommerce_order_checkout_billing_address",{emptyBillingAddress:1})}),e.on("click","#orderCheckoutCreateDeliveryAdd",function(){melisHelper.zoneReload("id_meliscommerce_order_checkout_delivery_address","meliscommerce_order_checkout_delivery_address",{emptyDeliveryAddress:1})}),e.on("click",".orderCheckoutValidateAddresses",function(){var e=$(this),t=new Array,i=e.data("tabid");$("#id_meliscommerce_order_checkout_delivery_address form").each(function(){var e=$(this).serializeArray();$.each(e,function(){t.push({name:"delivery["+this.name+"]",value:this.value})})}),$("#deliveryAddressOrderCheckoutForm").hasClass("hidden")&&t.push({name:"delivery[noSelected]",value:!0}),$("#id_meliscommerce_order_checkout_billing_address form").each(function(){var e=$(this).serializeArray();$.each(e,function(){t.push({name:"billing["+this.name+"]",value:this.value})})}),$("#billingAddressOrderCheckoutForm").hasClass("hidden")&&t.push({name:"billing[noSelected]",value:!0});var s=0;$("#order-checkout-billing-address-same").is(":checked")&&(s=1),t.push({name:"billing[sameAddress]",value:s}),e.attr("disabled",!0),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComOrderCheckout/selectAddresses",data:t,dataType:"json",encode:!0}).done(function(t){t.success?(melisCommerce.switchOrderTab(i),melisHelper.zoneReload("id_meliscommerce_order_checkout_summary_basket","meliscommerce_order_checkout_summary_basket"),melisHelper.zoneReload("id_meliscommerce_order_checkout_summary_billing_address","meliscommerce_order_checkout_summary_billing_address"),melisHelper.zoneReload("id_meliscommerce_order_checkout_summary_delivery_address","meliscommerce_order_checkout_summary_delivery_address")):(melisHelper.melisMultiKoNotification(t.textTitle,t.textMessage,t.errors),melisHelper.highlightMultiErrors(t.success,t.errors,activeTabId+" form")),e.attr("disabled",!1)}).fail(function(){e.attr("disabled",!1),alert(translations.tr_meliscore_error_message)})}),e.on("click","#orderCheckoutValidateCoupon",function(){var e=$("#orderCheckoutCouponCode").val();""!=e&&melisHelper.zoneReload("id_meliscommerce_order_checkout_summary_basket","meliscommerce_order_checkout_summary_basket",{couponCode:e})}),e.on("click",".orderValidCoupons i",function(){var e=$(this).closest(".orderValidCoupons").data("couponcode");""!=e&&melisHelper.zoneReload("id_meliscommerce_order_checkout_summary_basket","meliscommerce_order_checkout_summary_basket",{removeCoupon:e})}),e.on("change",".orderSummaryBasketVariantQty",function(){var e=$(this),t=e.data("variantid"),i=parseInt(e.data("quantity")),s=parseInt(e.val());i<s?updateSummaryVariantbasket("add",t,s):updateSummaryVariantbasket("deduct",t,s)}),e.on("keydown",".orderSummaryBasketVariantQty",function(e){-1!==$.inArray(e.keyCode,[46,8,9,27,13,110,190])||65===e.keyCode&&(!0===e.ctrlKey||!0===e.metaKey)||e.keyCode>=35&&e.keyCode<=40||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()}),e.on("click",".summary-qty-plus",function(){var e=$(this).data("variantid"),t=$("#"+e+"_orderSummaryBasketVariantQty");variantQty=parseInt(t.val())+1,t.val(variantQty),updateSummaryVariantbasket("add",e,variantQty)}),e.on("click",".summary-qty-minus",function(){var e=$(this).data("variantid"),t=$("#"+e+"_orderSummaryBasketVariantQty");$varQty=t.val(),parseInt($varQty)>0&&(variantQty=parseInt(t.val())-1,t.val(variantQty),updateSummaryVariantbasket("deduct",e,variantQty))}),e.on("click",".orderCheckoutConfirmSummary",function(){var e=$(this),t=e.data("tabid"),i=new Array;i.push({name:"couponCode",value:$("#orderCheckoutCouponCode").length?$("#orderCheckoutCouponCode").val():""}),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComOrderCheckout/confirmOrderCheckoutSummary",data:i,dataType:"json",encode:!0}).done(function(i){i.success?(melisCommerce.switchOrderTab(t),melisHelper.zoneReload("id_meliscommerce_order_checkout_payment_step_content","meliscommerce_order_checkout_payment_step_content")):melisHelper.melisMultiKoNotification(i.textTitle,i.textMessage,i.errors),e.attr("disabled",!1)}).fail(function(){e.attr("disabled",!1),alert(translations.tr_meliscore_error_message)})}),e.on("click",".orderCheckoutConfirmPayment",function(){var e=$(this).data("tabid");melisCommerce.switchOrderTab(e),melisHelper.zoneReload("id_meliscommerce_order_checkout_confirmation_step","meliscommerce_order_checkout_confirmation_step",{activateTab:!0}),melisHelper.zoneReload("id_meliscommerce_order_list_content_table","meliscommerce_order_list_content_table")}),e.on("change","#orderCheckoutCouponCode",function(){var e=$(this);""==e.val()&&e.parent(".input-group").next().fadeOut("slow")})}),window.productNextButtonState=function(){var e=$(".orderCheckoutFirstStepBtn");$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComOrderCheckout/checkBasket",dataType:"json",encode:!0}).done(function(t){t.success?(e.attr("disabled",!1),e.attr("title","")):(e.attr("disabled",!0),e.attr("title",translations.tr_meliscommerce_order_checkout_product_basket_empty))}).fail(function(){alert(translations.tr_meliscore_error_message)})},window.updateSummaryVariantbasket=function(e,t,i){var s=$("#orderCheckoutCouponCode").val();""==s&&(s=null),melisHelper.zoneReload("id_meliscommerce_order_checkout_summary_basket","meliscommerce_order_checkout_summary_basket",{action:e,variantId:t,variantQty:i,couponCode:s}),setTimeout(function(){melisHelper.zoneReload("id_meliscommerce_order_checkout_product_bakset","meliscommerce_order_checkout_product_bakset")},3e3)},window.updateVariantbasket=function(e,t,i){melisHelper.zoneReload("id_meliscommerce_order_checkout_product_bakset","meliscommerce_order_checkout_product_bakset",{action:e,variantId:t,variantQty:i})},window.initCheckoutSelectContactTable=function(){$(".checkoutSelectContactOrderHeader").attr("title",translations.tr_meliscommerce_checkout_tbl_cper_num_orders)},$(function(){var e=$("body"),t="id_meliscommerce_currency_content_modal_form",i="meliscommerce_currency_content_modal_form",s="/melis/MelisCommerce/MelisComCurrency/renderCurrencyModalContainer";e.on("switch-change",".make-switch",function(e,t){var i=$(this);if(i.find("#cur_status").length&&!1===t.value){var s=i.closest("form").find("#id_cur_id").val(),o=$(".make-switch");o.bootstrapSwitch("setActive",!1),o.bootstrapSwitch("toggleState",!0,!0),melisCoreTool.pending("#btnComSaveCurrency"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComCurrency/getCountriesUsingCurrency",data:{currencyId:s},dataType:"json",encode:!0}).done(function(e){if(e.countries.length>0){var t='<ul class="container">';$.each(e.countries,function(e,i){t+="<li>"+i.ctry_name+"</li>"}),t+="</ul>",BootstrapDialog.show({title:translations.tr_meliscommerce_currency,message:translations.tr_meliscommerce_currency_prompt_are_you_sure+"<br><br>"+translations.tr_meliscommerce_currency_prompt_is_used+"<br>"+t,type:BootstrapDialog.TYPE_WARNING,closable:!0,buttons:[{label:translations.tr_meliscore_common_no,cssClass:"btn-danger float-left",action:function(e){o.bootstrapSwitch("setActive",!0),melisCoreTool.done("#btnComSaveCurrency"),e.close()}},{label:translations.tr_meliscore_common_yes,cssClass:"btn-success",action:function(e){o.bootstrapSwitch("setActive",!0),o.bootstrapSwitch("toggleState",!0,!0),melisCoreTool.done("#btnComSaveCurrency"),e.close()}}]})}else o.bootstrapSwitch("setActive",!0),o.bootstrapSwitch("toggleState",!0,!0),melisCoreTool.done("#btnComSaveCurrency")}).fail(function(){o.bootstrapSwitch("setActive",!0),melisCoreTool.done("#btnComSaveCurrency"),alert(translations.tr_meliscore_error_message)})}}),e.on("click","#btnComAddCurrency",function(){melisCoreTool.pending("#btnComAddCurrency"),melisHelper.createModal(t,i,!1,{curId:null,saveType:"new"},s,function(){melisCoreTool.done("#btnComAddCurrency")})}),e.on("click",function(e){$(e.target).hasClass("modal")&&$("#id_meliscommerce_currency_content_modal_form_container").modal("hide")}),e.on("click",".btnEditComCurrency",function(){var e=$(this);id=e.parents("tr").attr("id"),melisCoreTool.pending(".btnEditComCurrency"),melisHelper.createModal(t,i,!1,{curId:id,saveType:"edit"},s,function(){melisCoreTool.done(".btnEditComCurrency")})}),e.on("click","#btnComSaveCurrency",function(){var e=$("form#ecomCurrencyForm"),t=e.serializeArray(),i=e.data("savetype"),s=0;$("#cur_status").parent().hasClass("switch-on")&&(s=1),t.push({name:"cur_status",value:s}),t.push({name:"saveType",value:i}),t=$.param(t),melisCoreTool.pending("#btnComSaveCurrency"),melisCommerce.postSave("/melis/MelisCommerce/MelisComCurrency/save",t,function(e){e.success?($("div.modal").modal("hide"),$("#"+activeTabId+" .melis-refreshTable").trigger("click"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"id_meliscommerce_currency_content_modal_form form#ecomCurrencyForm")),melisCore.flashMessenger(),melisCoreTool.done("#btnComSaveCurrency")},function(){melisCoreTool.done("#btnComSaveCurrency"),alert(translations.tr_meliscore_error_message)})}),e.on("click",".btnComCurrencyDelete",function(){var e=$(this).parents("tr").attr("id");melisCoreTool.pending(".btnComCountryDelete"),melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_meliscommerce_currency_delete_currency,translations.tr_meliscommerce_currency_delete_confirm,function(){$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComCurrency/delete",data:{id:e},dataType:"json",encode:!0}).done(function(e){melisCoreTool.pending(".btnComCurrencyDelete"),e.success?($("#"+activeTabId+" .melis-refreshTable").trigger("click"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.done(".btnComCurrencyDelete"),melisCore.flashMessenger()}).fail(function(){alert(translations.tr_meliscore_error_message)})}),melisCoreTool.done(".btnComCurrencyDelete")}),e.on("click",".btnComCurrencyMakeDefault",function(){var e=$(this).parents("tr").attr("id");melisCoreTool.pending(".btnComCurrencyMakeDefault"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComCurrency/setDefaultCurrency",data:{id:e},dataType:"json",encode:!0}).done(function(e){e.success?($("#"+activeTabId+" .melis-refreshTable").trigger("click"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.done(".btnComCurrencyMakeDefault"),melisCore.flashMessenger()}).fail(function(){melisCoreTool.done(".btnComCurrencyMakeDefault"),alert(translations.tr_meliscore_error_message)})})}),window.reInitTableEcomCurrency=function(){$("tr.defaultEcomCurrency").find(".btnComCurrencyDelete").remove(),$("tr.defaultEcomCurrency").find(".btnComCurrencyMakeDefault").remove()},$(function(){var e=$("body");function t(e,t){melisHelper.tabOpen(e,"fa fa-cubes",t+"_id_meliscommerce_attribute_page","meliscommerce_attribute_page",{attributeId:t},"id_meliscommerce_attribute_list_page")}e.on("click",".attributeListRefresh",function(){melisHelper.zoneReload("id_meliscommerce_attribute_list_content_table","meliscommerce_attribute_list_content_table")}),e.on("click",function(e){$(e.target).hasClass("modal")&&$("#id_meliscommerce_attribute_value_modal_value_form_container").modal("hide")}),e.on("click",".attributeValueRefresh",function(){var e=activeTabId.split("_")[0];melisHelper.zoneReload(e+"_id_meliscommerce_attributes_tabs_content_values_details_table","meliscommerce_attributes_tabs_content_values_details_table",{attributeId:e})}),e.on("click",".addNewAttribute",function(){t(translations.tr_meliscommerce_attribute_page_new_attribute,0)}),e.on("click",".attributeInfo",function(){var e=$(this),i=e.closest("tr").attr("id"),s=e.closest("tr").find("td:nth-child(5)").text(),o=i;s.length>0&&(o=s),t(translations.tr_meliscommerce_attribute_page+" "+o,i)}),e.on("click",".attributeHeading a",function(){melisHelper.tabOpen(translations.tr_meliscommerce_attribute_list_page,"fa fa-cubes","id_meliscommerce_attribute_list_page","meliscommerce_attribute_list_page")}),e.on("click",".addAttributeValue",function(){var e=activeTabId.split("_")[0];melisCoreTool.pending(this),zoneId="id_meliscommerce_attribute_value_modal_value_form",melisKey="meliscommerce_attribute_value_modal_value_form",modalUrl="/melis/MelisCommerce/MelisComAttribute/renderAttributeModal",melisHelper.createModal(zoneId,melisKey,!1,{attributeId:e},modalUrl,function(){}),melisCoreTool.done(this)}),e.on("click",".attributeValueInfo",function(){var e=$(this),t=activeTabId.split("_")[0],i=e.closest("tr").attr("id");melisCoreTool.pending(this),zoneId="id_meliscommerce_attribute_value_modal_value_form",melisKey="meliscommerce_attribute_value_modal_value_form",modalUrl="/melis/MelisCommerce/MelisComAttribute/renderAttributeModal",melisHelper.createModal(zoneId,melisKey,!1,{attributeId:t,attributeValueId:i},modalUrl,function(){}),melisCoreTool.done(this)}),e.on("click",".attributeValueDelete",function(){var e=$(this),t=activeTabId.split("_")[0],i=e.closest("tr").attr("id"),s=[];s.push({name:"attributeValueId",value:i}),melisCoreTool.pending(this),melisCoreTool.confirm(translations.tr_meliscommerce_documents_common_label_yes,translations.tr_meliscommerce_documents_common_label_no,translations.tr_meliscommerce_attribute_value_delete_title,translations.tr_meliscommerce_attribute_value_delete_confirm,function(){melisCommerce.postSave("melis/MelisCommerce/MelisComAttribute/deleteAttributeValue",s,function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload(t+"_id_meliscommerce_attributes_tabs_content_values_details_table","meliscommerce_attributes_tabs_content_values_details_table",{attributeId:t})):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCore.flashMessenger()},function(e){console.log(e)})}),melisCoreTool.done(this)}),e.on("click","#saveAttributeValue",function(){var e,t=$(this),i=activeTabId.split("_")[0],s=t.closest("#"+i+"_id_meliscommerce_attribute_value_modal_value_form").find("form"),o=[],r=0;s.each(function(){var t=$(this),i=t.attr("name"),s=t.serializeArray();for(e=s.length,j=0;j<e;j++)o.push({name:i+"["+r+"]["+s[j].name+"]",value:s[j].value});r++}),o.push({name:"attributeId",value:i}),melisCoreTool.pending(this),melisCommerce.postSave("melis/MelisCommerce/MelisComAttribute/saveAttributeValues",o,function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload(i+"_id_meliscommerce_attributes_tabs_content_values_details_table","meliscommerce_attributes_tabs_content_values_details_table",{attributeId:i}),$("#id_meliscommerce_attribute_value_modal_value_form_container").modal("hide")):(melisCoreTool.highlightErrors(e.success,e.errors,i+"_id_meliscommerce_attribute_value_modal_value_form"),melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors)),melisCore.flashMessenger()},function(e){console.log(e)}),melisCoreTool.done(this)}),e.on("click",".attributeSave",function(){melisCoreTool.pending(this);var e,i=$(this),s=activeTabId.split("_")[0],o=i.closest(".container-level-a").find("form"),r=[];ctr=0,o.each(function(){var t=$(this),i=t.find(":input:disabled").removeAttr("disabled"),s=t.attr("name"),o=t.serializeArray();for(e=o.length,j=0;j<e;j++)r.push({name:s+"["+ctr+"]["+o[j].name+"]",value:o[j].value});i.attr("disabled","disabled"),ctr++}),r.push({name:"attributeId",value:s}),$("#"+activeTabId+" .make-switch div").each(function(){var e=$(this),t="switch["+e.find("input").attr("name")+"]",i=0;e.hasClass("switch-on")&&(i=1),r.push({name:t,value:i})}),melisCommerce.postSave("melis/MelisCommerce/MelisComAttribute/saveAttribute",r,function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.tabClose(s+"_id_meliscommerce_attribute_page"),t(translations.tr_meliscommerce_attribute_page+" "+e.chunk.tabName,e.chunk.attributeId),melisHelper.zoneReload("id_meliscommerce_attribute_list_content_table","meliscommerce_attribute_list_content_table")):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,s+"_id_meliscommerce_attribute_page")),melisCore.flashMessenger()},function(e){console.log(e)}),melisCoreTool.done(this)}),e.on("click",".attributeDelete",function(){var e=$(this).closest("tr").attr("id"),t=[];t.push({name:"attributeId",value:e}),melisCoreTool.pending(this),melisCoreTool.confirm(translations.tr_meliscommerce_documents_common_label_yes,translations.tr_meliscommerce_documents_common_label_no,translations.tr_meliscommerce_attribute_delete_title,translations.tr_meliscommerce_attribute_delete_confirm,function(){melisCommerce.postSave("melis/MelisCommerce/MelisComAttributeList/deleteAttribute",t,function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage,"#72af46"),melisHelper.zoneReload("id_meliscommerce_attribute_list_content_table","meliscommerce_attribute_list_content_table")):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,"closeByButtonOnly"),melisCore.flashMessenger()},function(e){console.log(e)})}),melisCoreTool.done(this)})}),window.initAttributeValue=function(e,t){var i=$("#"+t.sTableId).data("attributeid");e.attributeId=i},$(function(){var e=$("body"),t="id_meliscommerce_language_list_page_content_modal_form",i="meliscommerce_language_list_page_content_modal_form",s="/melis/MelisCommerce/MelisComLanguage/renderLanguageListPageModalContainer";e.on("click",function(e){$(e.target).hasClass("modal")&&$("#id_meliscommerce_language_list_page_content_modal_form_container").modal("hide")}),$(document).on("submit","form#ecomlanguageform",function(e){var t=$(this),i=new FormData(t[0]),s=$("#elang_status").parent().hasClass("switch-on"),o=0;saveType=t.data("savetype"),s&&(o=1),i.append("elang_status",o),i.append("saveType",saveType),melisCoreTool.pending("#btnComSaveLang"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComLanguage/save",data:i,processData:!1,cache:!1,contentType:!1,dataType:"json"}).done(function(e){e.success?($("div.modal").modal("hide"),$("#"+activeTabId+" .melis-refreshTable").trigger("click"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"id_meliscommerce_language_list_page_content_modal_form form#ecomlanguageform")),melisCore.flashMessenger(),melisCoreTool.done("#btnComSaveLang")}).fail(function(e){melisCoreTool.done("#btnComSaveLang"),alert(translations.tr_meliscore_error_message)}),e.preventDefault()}),e.on("click",".btnEcomLangDelete",function(){var e=$(this).parents("tr").attr("id");melisCoreTool.pending(".btnEcomLangDelete"),melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_meliscommerce_language_delete,translations.tr_meliscore_tool_language_delete_confirm,function(){$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComLanguage/delete",data:{id:e},dataType:"json",encode:!0}).done(function(e){melisCoreTool.pending(".btnEcomLangDelete"),e.success?($("#"+activeTabId+" .melis-refreshTable").trigger("click"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.done(".btnEcomLangDelete"),melisCore.flashMessenger()}).fail(function(){alert(translations.tr_meliscore_error_message)})}),melisCoreTool.done(".btnEcomLangDelete")}),e.on("click",".btnEditComLang",function(){var e=$(this).parents("tr").attr("id");melisCoreTool.pending(".btnEditComLang"),melisHelper.createModal(t,i,!1,{langId:e,saveType:"edit"},s,function(){melisCoreTool.done(".btnEditComLang")})}),e.on("click","#btnComAddLang",function(){melisCoreTool.pending("#btnComAddLang"),melisHelper.createModal(t,i,!1,{langId:null,saveType:"new"},s,function(){melisCoreTool.done("#btnComAddLang")})})}),$(function(){var e=$("body"),t="id_meliscommerce_country_list_page_content_modal_form",i="meliscommerce_country_list_page_content_modal_form",s="/melis/MelisCommerce/MelisComCountry/renderCountryListPageModalContainer";e.on("click","#btnComAddCountry",function(){melisCoreTool.pending("#btnComAddCountry"),melisHelper.createModal(t,i,!1,{ctryId:null,saveType:"new"},s,function(){melisCoreTool.done("#btnComAddCountry")})}),e.on("click",function(e){$(e.target).hasClass("modal")&&$("#id_meliscommerce_country_list_page_content_modal_form_container").modal("hide")}),e.on("click",".btnEditComCountry",function(){var e=$(this).parents("tr").attr("id");melisCoreTool.pending(".btnEditComCountry"),melisHelper.createModal(t,i,!1,{ctryId:e,saveType:"edit"},s,function(){melisCoreTool.done(".btnEditComCountry")})}),$(document).on("submit","form#ecomCountryform",function(e){var t=$(this),i=new FormData(t[0]),s=$("#ctry_status").parent().hasClass("switch-on"),o=0;saveType=t.data("savetype"),s&&(o=1),i.append("ctry_status",o),i.append("saveType",saveType),melisCoreTool.pending("#btnComSaveCountry"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComCountry/save",data:i,processData:!1,cache:!1,contentType:!1,dataType:"json"}).done(function(e){e.success?($("div.modal").modal("hide"),$("#"+activeTabId+" .melis-refreshTable").trigger("click"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"id_meliscommerce_country_list_page_content_modal_form form#ecomCountryform")),melisCore.flashMessenger(),melisCoreTool.done("#btnComSaveCountry")}).fail(function(e){melisCoreTool.done("#btnComSaveCountry"),alert(translations.tr_meliscore_error_message)}),e.preventDefault()}),e.on("click",".btnComCountryDelete",function(){var e=$(this).parents("tr").attr("id");melisCoreTool.pending(".btnComCountryDelete"),melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_meliscommerce_country_delete_country,translations.tr_meliscommerce_country_delete_confirm,function(){$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComCountry/delete",data:{id:e},dataType:"json",encode:!0}).done(function(e){melisCoreTool.pending(".btnComCountryDelete"),e.success?($("#"+activeTabId+" .melis-refreshTable").trigger("click"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.done(".btnComCountryDelete"),melisCore.flashMessenger()}).fail(function(){alert(translations.tr_meliscore_error_message)})}),melisCoreTool.done(".btnComCountryDelete")})}),window.loadAssocVariantList=function(e,t){var i=$("#"+t.sTableId).data("variantid");e.variantId=i},$(function(){var e=$("body");e.on("click",".btnAssocVAssign",function(){var e=$(this),t=e.data("variantid"),i=e.data("productid"),s=e.parents(".tableAssocVariantList2"),o=s.attr("id"),r=s.data("variantid"),a=e.parents(".variant-assoc-product-variant-list");melisCommerce.disableAllTabs(),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComAssociateVariant/assignVariant",data:{assignVariantid:t,assignToVariantId:r},dataType:"json",encode:!0}).done(function(e){if(e.success){if(melisHelper.zoneReload(r+"_id_meliscommerce_avar_tab_assoc_vars_list","meliscommerce_avar_tab_assoc_vars_list",{variantId:r}),a.length){var t=a.attr("id"),s=a.attr("data-melisKey"),n=$("#"+o+"_filter input[type='search']").val();melisHelper.zoneReload(t,s,{productId:i,variantId:r,search:n})}melisHelper.melisOkNotification(e.textTitle,e.textMessage)}else melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors);melisCommerce.enableAllTabs(),melisCore.flashMessenger()}).fail(function(){melisCommerce.enableAllTabs(),alert(translations.tr_meliscore_error_message)})}),e.on("click",".removeAssoc",function(){var e=$(this),t=e.closest("tr").attr("id"),i=e.parents(".tableAssocVariantList1").data("variantid"),s=e.closest("tr").attr("data-productid");melisCoreTool.pending(".removeAssociation"),melisCommerce.disableAllTabs(),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComAssociateVariant/removeAssociation",data:{assignedVariantId:t,variantId:i},dataType:"json",encode:!0}).done(function(e){if(e.success){melisHelper.zoneReload(i+"_id_meliscommerce_avar_tab_assoc_vars_list","meliscommerce_avar_tab_assoc_vars_list",{variantId:i});var t=$("#"+s+"_"+i+"_id_meliscommerce_avar_product_variants");if(t.length){var o=$(this),r=t.attr("id"),a=t.attr("data-melisKey"),n=o.parents(".tableAssocVariantList2").attr("id"),l=$("#"+n+"_filter input[type='search']").val();melisHelper.zoneReload(r,a,{productId:s,variantId:i,search:l})}melisHelper.melisOkNotification(e.textTitle,e.textMessage)}else melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors);melisCoreTool.done(".removeAssociation"),melisCore.flashMessenger(),melisCommerce.enableAllTabs()}).fail(function(){alert(translations.tr_meliscore_error_message)})}),e.on("click",".refreshVarList",function(){var e=$(this).closest(".container-level-a").attr("id").replace(/[^0-9]/g,"");melisHelper.zoneReload(e+"_id_meliscommerce_avar_tab_var_lists","meliscommerce_avar_tab_var_lists",{variantId:e})}),e.on("click",".refreshAssocVarList",function(){var e=$(this).closest(".container-level-a").attr("id").replace(/[^0-9]/g,"");melisHelper.zoneReload(e+"_id_meliscommerce_avar_tab_assoc_vars_list","meliscommerce_avar_tab_assoc_vars_list",{variantId:e})}),e.on("click",".btnAVVV1",function(){var e=$(this),t=e.parents("tr").children().eq(2).find("span").data().prodId,i=e.parents("tr").children().eq(3).find("span").data().sku,s=e.closest("tr").attr("id");melisCommerce.disableAllTabs(),melisHelper.tabOpen(i,"icon-tag-2",s+"_id_meliscommerce_variants_page","meliscommerce_variants_page",{variantId:s,productId:t}),melisCommerce.enableAllTabs()}),e.on("click",".btnAVVV2",function(){var e=$(this),t=e.data("variantsku"),i=e.data("productid"),s=e.closest("tr").prev("tr").find("td:nth-child(3)").text(),o=i+"_id_meliscommerce_products_page",r="id_meliscommerce_product_list_container",a=e.data("variantid");$("body #melis-id-nav-bar-tabs li a.tab-element[data-id='id_meliscommerce_product_list_container']").length>0?(melisCommerce.disableAllTabs(),melisCommerce.openProductPage(i,s,r,function(){melisHelper.tabOpen(t,"icon-tag-2",a+"_id_meliscommerce_variants_page","meliscommerce_variants_page",{variantId:a,productId:i},o),melisCommerce.setUniqueId(a),melisCommerce.enableAllTabs()})):melisHelper.tabOpen("Products","icon-shippment","id_meliscommerce_product_list_container","meliscommerce_product_list_container","",r,function(){melisCommerce.disableAllTabs(),melisCommerce.openProductPage(i,s,r,function(){melisCommerce.setUniqueId(i),melisHelper.tabOpen(t,"icon-tag-2",a+"_id_meliscommerce_variants_page","meliscommerce_variants_page",{variantId:a,productId:i},o),melisCommerce.setUniqueId(a),melisCommerce.enableAllTabs()})})}),e.on("click",".showPrdVariants .dtActionCls",function(){var e=$(this),t=e.parents(".tableAssocVariantList2"),i=t.attr("id"),s=$("#"+i).DataTable(),o=t.data("variantid"),r=e.closest("tr"),a=s.row(r),n=r.attr("id");if(a.child.isShown())a.child.hide(),r.removeClass("shown");else{var l=n+"_"+o+"_id_meliscommerce_avar_product_variants",c="meliscommerce_avar_product_variants",d='<div class="variant-assoc-product-variant-list" id="'+l+'" melisKey="'+c+'" style="height:50px"></div>',h=$("#"+i+"_filter input[type='search']").val();a.child(d).show(),r.addClass("shown"),$(".checkout-product-variant-list").attr("style","margin-bottom: 10px;"),melisHelper.zoneReload(l,c,{productId:n,variantId:o,search:h})}}),e.on("click",".tabs-label li a",function(){var e=$(this),t=e.attr("href");"meliscommerce_avar_tab"===e.closest("li").data("meliskey")&&($(t).find(".refreshAssocVarList").trigger("click"),$(t).find(".refreshVarList").trigger("click"))})}),$(function(){var e=$("body");e.on("click",".melisComDuplicateVariant",function(){var e=$(this),t=e.parents("tr").attr("id");e.attr("disabled",!0),zoneId="id_meliscommerce_variant_duplication",melisKey="meliscommerce_variant_duplication",modalUrl="/melis/MelisCommerce/MelisComPrdVarDuplication/renderDuplicateModal",melisHelper.createModal(zoneId,melisKey,!1,{variantId:t},modalUrl,function(){e.attr("disabled",!1)})}),e.on("click",".melisComDuplicateProduct",function(){var e=$(this),t=e.parents("tr").attr("id");e.attr("disabled",!0),zoneId="id_meliscommerce_product_duplication",melisKey="meliscommerce_product_duplication",modalUrl="/melis/MelisCommerce/MelisComPrdVarDuplication/renderDuplicateModal",melisHelper.createModal(zoneId,melisKey,!1,{productId:t},modalUrl,function(){e.attr("disabled",!1)})}),e.on("click","#melisComStartDuplicateVariant",function(){var e=$(this),t=new Array;$("#id_meliscommerce_variant_duplication form").each(function(){var e=$(this),i=e.find("input[name='var_id']").val(),s=e.serializeArray();$.each(s,function(){"var_id"!==this.name&&t.push({name:"variantSku["+i+"]["+this.name+"]",value:this.value})})});var i=0;$("#duplicate_images").is(":checked")&&(i=1),t.push({name:"duplicate_images",value:i});var s=0;$("#duplicate_documents").is(":checked")&&(s=1),t.push({name:"duplicate_documents",value:s});var o=0;$("#put_online").is(":checked")&&(o=1),t.push({name:"var_status",value:o}),t.push({name:"duplication_type",value:"variant"}),e.attr("disabled",!0),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComPrdVarDuplication/duplicateVariant",data:t,dataType:"json",encode:!0}).done(function(t){e.attr("disabled",!1),t.success?($("#id_meliscommerce_variant_duplication_container").modal("hide"),melisHelper.melisOkNotification(t.textTitle,t.textMessage,"#72af46"),melisHelper.zoneReload(melisCommerce.getCurrentProductId()+"_id_meliscommerce_products_page_content_tab_variant_content_container","meliscommerce_products_page_content_tab_variant_content_container",{productId:melisCommerce.getCurrentProductId()})):melisSKUKoNotification(t.textTitle,t.textMessage,t.errors,"closeByButtonOnly"),highlightSKUErrors(t.success,t.errors),melisCore.flashMessenger()}).fail(function(){e.attr("disabled",!1),alert(translations.tr_meliscore_error_message)})}),e.on("click",".main-variant-radio i",function(){var e=$(this),t=$(".main-variant-radio i");e.addClass("fa-dot-circle-o"),e.addClass("text-success"),t.not(this).addClass("fa-circle-o"),t.not(this).removeClass("fa-dot-circle-o"),t.not(this).removeClass("text-success")}),e.on("click","#melisComStartDuplicateProduct",function(){var e=$(this),t=new Array;$("#id_meliscommerce_product_duplication form").each(function(){var e=$(this),i=e.find("input[name='var_id']").val(),s=e.serializeArray();$.each(s,function(){"var_id"!==this.name&&t.push({name:"variantSku["+i+"]["+this.name+"]",value:this.value})})}),t.push({name:"product_id",value:e.data("productid")});var i=0;$("#duplicate_images").is(":checked")&&(i=1),t.push({name:"duplicate_images",value:i});var s=0;$("#duplicate_documents").is(":checked")&&(s=1),t.push({name:"duplicate_documents",value:s});var o=0;$("#put_online").is(":checked")&&(o=1),t.push({name:"prd_status",value:o}),t.push({name:"main_variant_id",value:$(".main-variant-radio i.fa-dot-circle-o").data("variantid")}),t.push({name:"duplication_type",value:"product"}),e.attr("disabled",!0),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComPrdVarDuplication/duplicateProduct",data:t,dataType:"json",encode:!0}).done(function(t){e.attr("disabled",!1),t.success?($("#id_meliscommerce_product_duplication_container").modal("hide"),melisHelper.melisOkNotification(t.textTitle,t.textMessage,"#72af46"),melisHelper.zoneReload("id_meliscommerce_product_list_container","meliscommerce_product_list_container")):melisSKUKoNotification(t.textTitle,t.textMessage,t.errors),highlightSKUErrors(t.success,t.errors),melisCore.flashMessenger()}).fail(function(){e.attr("disabled",!1),alert(translations.tr_meliscore_error_message)})})}),$(function(){var e=$("body");e.on("click","#btnAddClientGroup",function(){melisHelper.createModal("id_meliscommerce_clients_group_tool_content_modal","meliscommerce_clients_group_tool_content_modal",!1,{},"/melis/MelisCore/MelisGenericModal/emptyGenericModal")}),e.on("click",".btnEditClientGroup",function(){var e=$(this).parents("tr");e.hasClass("child")&&(e=e.prev());var t=e.data("cgroup-id");melisHelper.createModal("id_meliscommerce_clients_group_tool_content_modal","meliscommerce_clients_group_tool_content_modal",!1,{groupId:t},"/melis/MelisCore/MelisGenericModal/emptyGenericModal")}),e.on("click",".btnSaveClientsGroup",function(){var e=$(this).data("group-id");melisCoreTool.pending(".btnSaveClientsGroup");var t=$("form#clientsGroupForm").serializeArray();t.push({name:"groupId",value:e}),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComClientsGroupController/saveClientsGroup",data:t}).done(function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),$("#tableClientsGroupsList").DataTable().ajax.reload(),$("#id_meliscommerce_clients_group_tool_content_modal_container").modal("hide")):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisHelper.highlightMultiErrors(e.success,e.errors,"#clientsGroupForm")),melisCore.flashMessenger(),melisCoreTool.done(".btnSaveClientsGroup")}).fail(function(e){melisCoreTool.pending(".btnSaveClientsGroup"),alert(translations.tr_meliscore_error_message)})}),e.on("click",".btnDeleteClientGroup",function(){var e=$(this).parents("tr");e.hasClass("child")&&(e=e.prev());var t=e.data("cgroup-id");melisCoreTool.pending(".btnSaveClientsGroup"),melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_meliscommerce_clients_group_delete_confirm_title,translations.tr_meliscommerce_clients_group_delete_confirm_msg,function(){$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComClientsGroupController/deleteClientsGroup",data:{groupId:t}}).done(function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),$("#tableClientsGroupsList").DataTable().ajax.reload()):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCore.flashMessenger(),melisCoreTool.pending(".btnDeleteClientGroup")}).fail(function(e){melisCoreTool.pending(".btnDeleteClientGroup"),alert(translations.tr_meliscore_error_message)})})})}),window.clientsGroupTableCallBack=function(){$("#tableClientsGroupsList tbody").find("tr[data-cgroup-id='1']").find("a.btnDeleteClientGroup").addClass("hidden")},$(function(){var e=$("body");e.on("click",".addStockAlertEmail",function(){var e=$(this),t=e.closest("div").find(".stockAlertSelect").val(),i=e.closest("div").find(".stockAlertSelect option:selected"),s=e.closest(".email-alert-area").find(".email_area"),o="";o+='<span class="alert-email-values" data-seaid="" data-userid="'+t+'" data-alertemail="'+i.text()+'">',o+='<span class="ab-attr">',o+='<span class="alert-email-value-email">',o+=i.text(),o+="</span>",o+='<i class="alert-email-remove fa fa-times"></i>',o+="</span>",o+="</span>",""!=t&&(i.remove(),s.append(o),e.closest(".email-alert-area").find(".noAlertRecipients").hide())}),e.on("click",".alert-email-values .alert-email-remove",function(){var e=$(this),t=e.closest(".alert-email-values"),i=t.data("userid"),s=t.data("alertemail"),o=e.closest(".email-alert-area").find(".stockAlertSelect"),r=o.val();o.append($("<option>",{value:i,text:s}));var a=e.closest(".email-alert-area").find(".stockAlertSelect option");a.sort(function(e,t){return e.value>t.value?1:e.value<t.value?-1:0}),o.empty().append(a),o.val(r),t.remove()}),e.on("click",".saveSettings",function(){var e=$(this).closest(".container-level-a");melisCommerceSettings.submitStockAlertSettings(e)})});var melisCommerceSettings=function(e){return{submitStockAlertSettings:function(e){var t=$(e).find("#id_meliscommerce_settings_tabs_content_main_details_left form"),i=[],s=$(e).find(".alert-email-values"),o=0,r="",a="",n="";Array.prototype.push.apply(i,$(t).serializeArray()),s.each(function(){var e=$(this);r=e.data("seaid"),a=e.data("alertemail"),n=e.data("userid"),i.push({name:"recipients["+o+"][sea_id]",value:r}),i.push({name:"recipients["+o+"][sea_email]",value:a}),i.push({name:"recipients["+o+"][sea_user_id]",value:n}),o++}),melisCommerce.postSave("melis/MelisCommerce/MelisComSettings/saveSettings",i,function(e){e.success?(melisHelper.tabClose("id_meliscommerce_settings_page"),melisHelper.tabOpen(translations.tr_meliscommerce_settings,"fa fa-wrench","id_meliscommerce_settings_page","meliscommerce_settings_page",{}),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"id_meliscommerce_settings_page")),melisCore.flashMessenger()},function(e){alert(translations.tr_meliscore_error_message)})}}}(window);$(function(){var e=0,t=$("body");t.on("change",".com-orders-dash-chart-line",function(){var e=$(this);commerceDashboardOrdersLineGraphInit(e);var t=e.closest(".grid-stack-item").find(".grid-stack-item-content .widget .widget-parent .widget-body .dashboard-plugin-json-config"),i=JSON.parse(t.text());i.activeFilter=e.val(),$(t).text(JSON.stringify(i)),melisDashBoardDragnDrop.saveCurrentDashboard(e)}),t.on("click",".melis-commerce-dashboard-plugin-orders-number-item",function(){var e=$(this),t=e.find(".melis-commerce-dashboard-plugin-orders-number-item-id").text(),i=e.find(".melis-commerce-dashboard-plugin-orders-number-item-ref").text();melisHelper.tabOpen(translations.tr_meliscommerce_orders_Orders,"fa fa fa-cart-plus fa-2x","id_meliscommerce_order_list_page","meliscommerce_order_list_page");var s=$("body #melis-id-nav-bar-tabs li a.tab-element[data-id='id_meliscommerce_order_list_page']"),o=setInterval(function(){if(s.length){melisHelper.tabOpen(translations.tr_meliscommerce_orders_Order+" "+i,"fa fa fa-cart-plus fa-2x",t+"_id_meliscommerce_orders_page","meliscommerce_orders_page",{orderId:t},"id_meliscommerce_order_list_page"),clearInterval(o)}},500)}),charts.commerceDashboardOrdersLineGraph={data:{d1:[]},plot:null,options:{grid:{color:"#dedede",borderWidth:1,borderColor:"#eee",clickable:!0,hoverable:!0,labelMargin:20},series:{lines:{show:!0,fill:!1,lineWidth:2,steps:!1},points:{show:!0,radius:5,lineWidth:3,fill:!0,fillColor:"#000"}},xaxis:{tickColor:"#eee"},yaxis:{show:!0,tickColor:"#eee",min:0,tickDecimals:0},legend:{position:"nw",noColumns:2,backgroundColor:null,backgroundOpacity:0},shadowSize:0,tooltip:!0,tooltipOpts:{content:"%y %s - %x",shifts:{x:-30,y:-50},defaultTheme:!1}},placeholder:"#"+activeTabId+" .commerce-dashboard-orders-chart-linegraph-placeholder",init:function(){null==this.plot&&commerceDashboardOrdersLineGraphInit()}},window.commerceDashboardOrdersLineGraphInit=function(i,s){s=s||null;var o="";if(null===(i=i||null)){var r=t.find(".commerce-dashboard-orders-chart-linegraph-placeholder"),a=0;if(t.find(".commerce-dashboard-orders-chart-linegraph-placeholder").each(function(e,t){""===$(this).text()&&a++}),a===t.find(".commerce-dashboard-orders-chart-linegraph-placeholder").length){var n=$(r[e]).closest(".grid-stack-item").find(".grid-stack-item-content .widget .widget-parent .widget-body .dashboard-plugin-json-config").text();++e===r.length&&(e=0),o=JSON.parse(n).activeFilter,s="#commerce-dashboard-orders-chart-linegraph-placeholder-"+JSON.parse(n).plugin_id}else{var l=body.find(".commerce-dashboard-orders-chart-linegraph-placeholder").length-1;n=$(r[l]).closest(".grid-stack-item").find(".grid-stack-item-content .widget .widget-parent .widget-body .dashboard-plugin-json-config").text();o=JSON.parse(n).activeFilter,s="#commerce-dashboard-orders-chart-linegraph-placeholder-"+JSON.parse(n).plugin_id}}else"string"==typeof i?(o=i,s="#commerce-dashboard-orders-chart-linegraph-placeholder-"+s):(o=i.val(),s="#"+i.closest(".tab-pane").find(".commerce-dashboard-orders-chart-linegraph-placeholder").attr("id"));$.ajax({type:"POST",url:"/melis/dashboard-plugin/MelisCommerceDashboardPluginOrdersNumber/getDashboardOrdersData",data:{chartFor:o},dataType:"json",encode:!0}).done(function(e){for(var t=[],i=[],r=e.values.length,a=($(window).width(),""),n=[translations.tr_meliscommerce_dashboardplugin_jan,translations.tr_meliscommerce_dashboardplugin_feb,translations.tr_meliscommerce_dashboardplugin_mar,translations.tr_meliscommerce_dashboardplugin_apr,translations.tr_meliscommerce_dashboardplugin_may,translations.tr_meliscommerce_dashboardplugin_jun,translations.tr_meliscommerce_dashboardplugin_jul,translations.tr_meliscommerce_dashboardplugin_aug,translations.tr_meliscommerce_dashboardplugin_sep,translations.tr_meliscommerce_dashboardplugin_oct,translations.tr_meliscommerce_dashboardplugin_nov,translations.tr_meliscommerce_dashboardplugin_dec],l=0;l<e.values.length;l++){if("hourly"===o){a="fr_FR"===melisLangId?moment(e.values[l][0],"YYYY-MM-DD HH").format("HH")+"h":moment(e.values[l][0],"YYYY-MM-DD HH").format("h A")}else if("daily"===o){var c=moment(e.values[l][0],"YYYY-MM-DD"),d=c.format("DD");a=(u=n[parseInt(c.format("M"))-1]).replace("%day",d)}else if("weekly"===o){var h=moment(e.values[l][0],"YYYY-MM-DD").format("W"),m=moment().day("Monday").week(h),u=n[parseInt(m.format("M"))-1];d=m.format("DD");a=u.replace("%day",d)}else if("monthly"===o){var p=moment(e.values[l][0],"YYYY-MM-DD").format("M");a=(u=n[parseInt(parseInt(p))-1]).replace("%day","")}t.push([r,e.values[l][1]]),i.push([r,a]),r--}charts.commerceDashboardOrdersLineGraph.options.xaxis.ticks=i,charts.commerceDashboardOrdersLineGraph.options.tooltipOpts.content="%y %s",charts.commerceDashboardOrdersLineGraph.plot=$.plot($(s),[{label:translations.tr_melis_commerce_dashboard_plugin_orders_number,data:t,color:"#3997d4",lines:{fill:.2},points:{fillColor:"#fff"}}],charts.commerceDashboardOrdersLineGraph.options)}).fail(function(e,t,i){console.log("ERROR !! Status = "+t+"\n Error = "+i+"\n xhr = "+e.statusText),alert(translations.tr_meliscore_error_message)})},t.find(".commerce-dashboard-orders-chart-linegraph-placeholder").each(function(e,t){var i=$(t).closest(".grid-stack-item").find(".grid-stack-item-content .widget .widget-parent .widget-body .dashboard-plugin-json-config").text(),s=JSON.parse(i).activeFilter,o=JSON.parse(i).plugin_id;commerceDashboardOrdersLineGraphInit(s,o)})});var commerceDashboardPluginSalesRevenue=function(e,t){var i=e("body"),s=0;function o(){charts.commerceDashboardPluginSalesRevenueChartStackedBars={data:null,plot:null,options:{grid:{color:"#dedede",borderWidth:1,borderColor:"transparent",clickable:!0,hoverable:!0,backgroundColor:{colors:["#fff","#fff"]}},series:{stack:!0,grow:{active:!1},bars:{show:!0,barWidth:.5,fill:1,align:"center"}},xaxis:{mode:"time"},yaxis:{min:0,tickDecimals:2},legend:{position:"ne",backgroundColor:null,backgroundOpacity:0,noColumns:2},colors:["#7acc66","#66cccc"],shadowSize:0,tooltip:!0,tooltipOpts:{content:"%s : %y",shifts:{x:-30,y:-50},defaultTheme:!1}},placeholder:".commerce-dashboard-plugin-sales-revenue-placeholder",init:function(){null==this.plot&&r()}}}function r(r,a){r=r||null,a=a||null;var n="";if(o(),null==r){var l=i.find(".commerce-dashboard-plugin-sales-revenue-placeholder"),c=0;if(i.find(".commerce-dashboard-plugin-sales-revenue-placeholder").each(function(t,i){""===e(this).text()&&c++}),c===i.find(".commerce-dashboard-plugin-sales-revenue-placeholder").length){var d=e(l[s]).closest(".grid-stack-item").find(".grid-stack-item-content .widget .widget-parent .widget-body .dashboard-plugin-json-config").text();d=JSON.parse(d),++s===l.length&&(s=0),n=d.datas.activeFilter,a="#commerce-dashboard-plugin-sales-revenue-placeholder-"+d.plugin_id}else{var h=i.find(".commerce-dashboard-plugin-sales-revenue-placeholder").length-1;d=e(l[h]).closest(".grid-stack-item").find(".grid-stack-item-content .widget .widget-parent .widget-body .dashboard-plugin-json-config").text();d=JSON.parse(d),n=d.datas.activeFilter,a="#commerce-dashboard-plugin-sales-revenue-placeholder-"+d.plugin_id}}else"string"==typeof r?(n=r,a="#commerce-dashboard-plugin-sales-revenue-placeholder-"+a):(n=r.val(),a="#"+r.closest(".tab-pane").find(".commerce-dashboard-plugin-sales-revenue-placeholder").attr("id"));e.ajax({type:"POST",url:"/melis/dashboard-plugin/MelisCommerceDashboardPluginSalesRevenue/getDashboardSalesRevenueData",data:{chartFor:n},dataType:"json",encode:!0}).done(function(i){for(var s=[],o=[],r=[],l=i.values.length,c=(e(t).width(),""),d=[translations.tr_meliscommerce_dashboardplugin_jan,translations.tr_meliscommerce_dashboardplugin_feb,translations.tr_meliscommerce_dashboardplugin_mar,translations.tr_meliscommerce_dashboardplugin_apr,translations.tr_meliscommerce_dashboardplugin_may,translations.tr_meliscommerce_dashboardplugin_jun,translations.tr_meliscommerce_dashboardplugin_jul,translations.tr_meliscommerce_dashboardplugin_aug,translations.tr_meliscommerce_dashboardplugin_sep,translations.tr_meliscommerce_dashboardplugin_oct,translations.tr_meliscommerce_dashboardplugin_nov,translations.tr_meliscommerce_dashboardplugin_dec],h=0;h<i.values.length;h++){if("hourly"===n){c="fr_FR"===melisLangId?moment(i.values[h][0],"YYYY-MM-DD HH").format("HH")+"h":moment(i.values[h][0],"YYYY-MM-DD HH").format("h A")}else if("daily"===n){var m=moment(i.values[h][0],"YYYY-MM-DD"),u=m.format("DD");c=(f=d[parseInt(m.format("M"))-1]).replace("%day",u)}else if("weekly"===n){var p=moment(i.values[h][0],"YYYY-MM-DD").format("W"),_=moment().day("Monday").week(p),f=d[parseInt(_.format("M"))-1];u=_.format("DD");c=f.replace("%day",u)}else if("monthly"===n){var g=moment(i.values[h][0],"YYYY-MM-DD").format("M");c=(f=d[parseInt(parseInt(g))-1]).replace("%day","")}s.push([l,i.values[h][1]]),o.push([l,i.values[h][2]]),r.push([l,c]),l--}charts.commerceDashboardPluginSalesRevenueChartStackedBars.options.xaxis.ticks=r,charts.commerceDashboardPluginSalesRevenueChartStackedBars.data=[],charts.commerceDashboardPluginSalesRevenueChartStackedBars.data.push({label:translations.tr_melis_commerce_dashboard_plugin_sales_revenue_order_price,data:s}),charts.commerceDashboardPluginSalesRevenueChartStackedBars.data.push({label:translations.tr_melis_commerce_dashboard_plugin_sales_revenue_shipping_price,data:o}),charts.commerceDashboardPluginSalesRevenueChartStackedBars.plot=e.plot(e(a),charts.commerceDashboardPluginSalesRevenueChartStackedBars.data,charts.commerceDashboardPluginSalesRevenueChartStackedBars.options)}).fail(function(e,t,i){console.log("ERROR !! Status = "+t+"\n Error = "+i+"\n xhr = "+e.statusText)})}return{loadChart:function(){r()},setUpChart:o,commerceDashboardPluginSalesRevenueChartStackedBarsInit:r}}($,window);$(function(){var e=$("body"),t=$("#"+activeTabId);e.on("change",".commerce-dashboard-plugin-sales-revenue",function(){var e=$(this);commerceDashboardPluginSalesRevenue.commerceDashboardPluginSalesRevenueChartStackedBarsInit(e);var t=e.closest(".grid-stack-item").find(".grid-stack-item-content .widget .widget-parent .widget-body .dashboard-plugin-json-config"),i=JSON.parse(t.text());i.activeFilter=e.val(),$(t).text(JSON.stringify(i)),melisDashBoardDragnDrop.saveCurrentDashboard(e)}),e.find(".commerce-dashboard-plugin-sales-revenue-placeholder").each(function(e,t){var i=$(t).closest(".grid-stack-item").find(".grid-stack-item-content .widget .widget-parent .widget-body .dashboard-plugin-json-config").text(),s=JSON.parse(i).activeFilter,o=JSON.parse(i).plugin_id;commerceDashboardPluginSalesRevenue.commerceDashboardPluginSalesRevenueChartStackedBarsInit(s,o)}),"undefined"==typeof melisUserTabs&&t.find(".commerce-dashboard-plugin-sales-revenue-placeholder").length>0&&commerceDashboardPluginSalesRevenue.loadChart()});var commerceDashPluginOrderMessagesAllMessagesInterval="",commerceDashPluginOrderMessagesUnseenMessagesInterval="",commerceDashPluginorderMessagesInstanceCount=0,commDashPluginOrderMessagesWithUnansweredFilterInstance=0;function commerceDasboardPluginOrderMessagesDelete(e){1===e.find(".melis-commerce-dashboard-plugin-order-messages-parent").length&&(e.find(".melis-commerce-dashboard-plugin-order-messages-parent label.active input[value='all']").length>0?0===--commerceDashPluginorderMessagesInstanceCount&&(clearInterval(commerceDashPluginOrderMessagesAllMessagesInterval),commerceDashPluginOrderMessagesAllMessagesInterval=""):0===--commDashPluginOrderMessagesWithUnansweredFilterInstance&&(clearInterval(commerceDashPluginOrderMessagesUnseenMessagesInterval),commerceDashPluginOrderMessagesUnseenMessagesInterval=""))}$(function(){var e=$("body"),t="",i="";function s(e){$.ajax({type:"POST",url:"/melis/dashboard-plugin/MelisCommerceDashboardPluginOrderMessages/getMessages",data:{filter:e},dataType:"json",encode:!0}).done(function(i){$(".melis-commerce-dashboard-plugin-order-messages-parent").find('label.active input[value="'+e+'"]').each(function(e,t){o.clear(t),o.setUnansweredMessages(i.unansweredMessages,t)}),$.each(i.messages,function(i,s){o.setMessages(t,s,e)})}).fail(function(e,t,i){console.log("ERROR !! Status = "+t+"\n Error = "+i+"\n xhr = "+e.statusText),alert(translations.tr_meliscore_error_message)})}e.on("change",".commerce-dashboard-plugin-order-messages",function(){commerceDashboardPluginOrderMessagesInit($(this))}),e.on("click",".commerce-dashboard-plugin-order-messages",function(){o.openOrderMessages(this)}),window.commerceDashboardPluginOrderMessagesInit=function(e){var o="";i=".message-count",void 0===e?(o="all",t=".commerce-dashboard-plugin-order-messages-list"):(o=e.val(),t="#"+e.closest(".melis-commerce-dashboard-plugin-order-messages-parent").find(".commerce-dashboard-plugin-order-messages-list").attr("id")),commDashPluginOrderMessagesWithUnansweredFilterInstance=$(".melis-commerce-dashboard-plugin-order-messages-parent").find('label.active input[value="unseen"]').length,commerceDashPluginorderMessagesInstanceCount=$(".melis-commerce-dashboard-plugin-order-messages-parent").find('label.active input[value="all"]').length,s(o),0===commDashPluginOrderMessagesWithUnansweredFilterInstance&&(clearInterval(commerceDashPluginOrderMessagesUnseenMessagesInterval),commerceDashPluginOrderMessagesUnseenMessagesInterval=""),0===commerceDashPluginorderMessagesInstanceCount&&(clearInterval(commerceDashPluginOrderMessagesAllMessagesInterval),commerceDashPluginOrderMessagesAllMessagesInterval=""),"all"===o?""===commerceDashPluginOrderMessagesAllMessagesInterval&&(commerceDashPluginOrderMessagesAllMessagesInterval=setInterval(s,6e4,o)):""===commerceDashPluginOrderMessagesUnseenMessagesInterval&&(commerceDashPluginOrderMessagesUnseenMessagesInterval=setInterval(s,6e4,o))},$(".commerce-dashboard-plugin-order-messages-list").length>0&&commerceDashboardPluginOrderMessagesInit();var o={openOrderMessages:function(e){var t=$(e).find(".order-message-id").val(),i=$(e).find(".order-message-reference").val();melisHelper.tabOpen(translations.tr_meliscommerce_orders_Orders,"fa fa fa-cart-plus fa-2x","id_meliscommerce_order_list_page","meliscommerce_order_list_page");var s=$("body #melis-id-nav-bar-tabs li a.tab-element[data-id='id_meliscommerce_order_list_page']"),o=$("body a.tab-element[data-id='"+t+"_id_meliscommerce_orders_page']"),r=($("body #"+t+"_id_meliscommerce_orders_page"),setInterval(function(){if(s.length)if(o.length)o[0].click(),melisHelper.zoneReload(t+"_id_meliscommerce_orders_content_tabs_content_messages_details","meliscommerce_orders_content_tabs_content_messages_details",{orderId:t},function(){$("#"+(t+"_id_meliscommerce_orders_content_tabs")).find("a[href='#"+t+"_id_meliscommerce_orders_content_tabs_content_messages']")[0].click()});else{melisHelper.tabOpen(translations.tr_meliscommerce_orders_Order+" "+i,"fa fa fa-cart-plus fa-2x",t+"_id_meliscommerce_orders_page","meliscommerce_orders_page",{orderId:t},"id_meliscommerce_order_list_page",function(){$("#"+(t+"_id_meliscommerce_orders_content_tabs")).find("a[href='#"+t+"_id_meliscommerce_orders_content_tabs_content_messages']")[0].click()})}clearInterval(r)},500))},clear:function(e){$(e).closest(".melis-commerce-dashboard-plugin-order-messages-parent").find(".commerce-dashboard-plugin-order-messages-list").empty(),$(e).closest(".melis-commerce-dashboard-plugin-order-messages-parent").find(".message-count").empty()},setUnansweredMessages:function(e,t){var s="";s=e>1?translations.tr_melis_commerce_dashboard_plugin_order_messages_unanswered_messages.replace("%d",e):translations.tr_melis_commerce_dashboard_plugin_order_messages_unanswered_messages.replace("messages","message").replace("%d",e),$(t).closest(".melis-commerce-dashboard-plugin-order-messages-parent").find(i).append(s)},setMessages:function(e,t,i){var s=t.omsg_message.length>70?t.omsg_message.substring(0,70)+"...":t.omsg_message,o=moment(t.omsg_date_creation,"YYYY-MM-DD HH:mm:ss"),r="answered";t.noReply&&(r="unanswered");var a=[translations.tr_meliscommerce_dashboardplugin_jan,translations.tr_meliscommerce_dashboardplugin_feb,translations.tr_meliscommerce_dashboardplugin_mar,translations.tr_meliscommerce_dashboardplugin_apr,translations.tr_meliscommerce_dashboardplugin_may,translations.tr_meliscommerce_dashboardplugin_jun,translations.tr_meliscommerce_dashboardplugin_jul,translations.tr_meliscommerce_dashboardplugin_aug,translations.tr_meliscommerce_dashboardplugin_sep,translations.tr_meliscommerce_dashboardplugin_oct,translations.tr_meliscommerce_dashboardplugin_nov,translations.tr_meliscommerce_dashboardplugin_dec][parseInt(o.format("M"))-1],n='<span class="label label-inverse float-right">'+o.format("HH:mm:ss")+" "+a.replace("%day",o.format("DD"))+"</span>",l='<i class="fa fa-angle-double-right"<i/>',c="<span>"+t.clientFirstName+" "+t.clientLastName+"</span> "+l+" <small>"+translations.tr_melis_commerce_dashboard_plugin_order_messages_message_order_amount+t.totalOrderAmount+"</small> "+l+" <small>"+translations.tr_melis_commerce_dashboard_plugin_order_messages_message_placed_on+t.orderDate+"</small>",d='<a href="#" class="list-group-item commerce-dashboard-plugin-order-messages '+r+'">  <input class="order-message-id" type="text" value="'+t.omsg_order_id+'" hidden="hidden">  <input class="order-message-reference" type="text" value="'+t.reference+'" hidden="hidden">  <span class="media">    <span class="media-body media-body-inline">'+n+c+'    <p class="list-group-item-text"> '+s+"     </p>    </span>  </span></a>";$(".melis-commerce-dashboard-plugin-order-messages-parent").find('label.active input[value="'+i+'"]').each(function(e,t){$(t).closest(".melis-commerce-dashboard-plugin-order-messages-parent").find(".commerce-dashboard-plugin-order-messages-list").append(d)})}}});
