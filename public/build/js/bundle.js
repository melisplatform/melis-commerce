var pUniqueId=[],melisCommerce=function(e){function t(e){$("li a.tab-element[data-id='"+e+"']").css("pointer-events","none").parent().css("cursor","not-allowed")}function o(e){$("li a.tab-element[data-id='"+e+"']").css("pointer-events","auto").parent().css("cursor","pointer")}return{pendingZoneStart:function(e){$("#"+e).append('<div id="loader" class="overlay-loader"><img class="loader-icon spinning-cog" src="/MelisCore/assets/images/cog12.svg" data-cog="cog12"></div>')},pendingZoneDone:function(e){$("#"+e+" .loader-icon").removeClass("spinning-cog").addClass("shrinking-cog"),setTimeout((function(){$("#"+e+" #loader").remove()}),500)},initTooltipTable:function(){var e=$(".tooltipTable");e.length&&e.each((function(){$(this).qtip({content:{text:$(this).next(".tooltiptext")},overwrite:!1,style:{classes:"qtip-tipsy qtip-shadow",width:"auto"},hide:{fixed:!0,delay:300,event:"mouseleave"},position:{target:"mouse",adjust:{mouse:!1},my:"center center",at:"center center"}})}))},initTooltipVarTable:function(){var e=$(".tooltipTableVar");e.length&&e.each((function(){$(this).qtip({content:{text:$(this).next(".tooltiptext")},overwrite:!1,style:{classes:"qtip-tipsy qtip-shadow",width:"auto"},hide:{fixed:!0,delay:300,event:"mouseleave"},position:{target:"mouse",adjust:{mouse:!1},my:"center center",at:"center center"}})}))},initCommerceTable:function(e,t,i,o,a,s){s||(s="default"),$(e).DataTable({responsive:!0,paging:!0,ordering:!0,processing:!0,serverSide:!0,searching:!0,lengthMenu:[[5,10,25,50,100,-1],[5,10,25,50,100,"All"]],pageLength:10,ajax:{url:t,type:"POST"},order:[[1,"asc"]],columns:i,columnDefs:[{responsivePriority:1,targets:0},{responsivePriority:2,targets:-1}],language:melisDataTable.tableLanguage[s],dom:'<"bulk-action"><"filter-bar fl">rtip',drawCallback:function(e){$(this).css("width","100%")}}),$(".filter-bar").html(o),$(".bulk-action").html(a)},openProductPage:function(e,t,i,o){melisHelper.tabOpen(melisCore.escapeHtml(t),"icon-shippment",e+"_id_meliscommerce_products_page","meliscommerce_products_page",{productId:e},i),o&&"function"==typeof o&&o()},postSave:function(e,t,i,o){$.ajax({type:"POST",url:e,data:t,dataType:"json",encode:!0}).done((function(e){i(e)})).fail((function(){o()}))},getCurrentProductId:function(){return activeTabId.split("_")[0]},closeCurrentProductPage:function(){melisHelper.tabClose(melisCommerce.getCurrentProductId()+"_id_meliscommerce_products_page")},reloadCurrentProdPage:function(e){var t=melisCommerce.getCurrentProductId();null!=e&&(t=e),melisCoreTool.clearForm("productTextTypeForm"),melisHelper.zoneReload(t+"_id_meliscommerce_products_page","meliscommerce_products_page",{productId:t})},initTinyMCE:function(){var e="";e="en_EN"==melisLangId?"en":melisLangId,setTimeout((function(){tinymce.init({mode:"specific_textareas",editor_selector:"mceEditor",language:e,height:200,plugins:["advlist autolink lists link image charmap preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table minitemplate"],external_plugins:{minitemplate:"/MelisCore/js/minitemplate/plugin.min.js"},menubar:!1,toolbar:"undo redo | styleselect | bold italic | link image |  alignleft aligncenter alignright alignjustify | code",toolbar_mode:"sliding"})}),1e3)},getDocFormType:function(){return $("#"+activeTabId).find("div.ecom-doc-container").data("form-type")},setUniqueId:function(e){null==e?$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComDocument/setUniqueId",data:{id:e},dataType:"json",encode:!0}).done((function(e){pUniqueId[activeTabId]=e.id})).fail((function(){alert(translations.tr_meliscore_error_message)})):pUniqueId[activeTabId]=e},getUniqueId:function(){return pUniqueId[activeTabId]},enableTab:o,disableTab:t,disableAllTabs:function(){$.each($("#melis-id-nav-bar-tabs li a"),(function(e,i){t($(i).data("id"))})),$.each($("ul.sideMenu"),(function(e,t){$(t).css("pointer-events","none").parent().css("cursor","not-allowed")}))},enableAllTabs:function(){$.each($("#melis-id-nav-bar-tabs li a"),(function(e,t){o($(t).data("id"))})),$.each($("ul.sideMenu"),(function(e,t){$(t).css("pointer-events","none").css("pointer-events","auto").parent().css("cursor","pointer")}))},accordionToggle:function(e){var t=e.target,i=$(t).attr("href");$(i).collapse("toggle")},switchOrderTab:function(e){var t=$(e),i=$(e+"[data-bs-toggle='tab']"),o=i.closest("li"),a=i.attr("href");$("#id_meliscommerce_order_checkout_content .tab-content").find(".tab-pane").siblings().removeClass("active"),t.removeClass("active"),$(a).show(),$(a).siblings().hide(),$(a).addClass("active"),o.siblings().removeClass("active"),o.addClass("active")},priceLogTooltip:function(){var e=$(".price-log-data-tooltip");e.length&&e.each((function(){var e=$(this),t=$(this).find(".price-log-data").text(),o="";if(""!=t)for(logs=JSON.parse(t),i=0;i<logs.length;i++)o+="<li>"+logs[i]+"</li>";o=""==o?"N/A":o,e.qtip({content:{text:"<div class='price-log-data-container'><p>Price Log</p><ul>"+o+"</ul></div>"},overwrite:!1,style:{classes:"qtip-tipsy qtip-shadow",width:"auto"},hide:{fixed:!0,delay:300,event:"mouseleave"},position:{target:"mouse",adjust:{mouse:!1},my:"center center",at:"center center"}})}))}}}(window);setInterval((function(){melisCommerce.enableAllTabs()}),1e4),$((function(){var e=$("body");e.on("click",".accordion-toggle",melisCommerce.accordionToggle),e.on("click",".melis-commerce-checkbox input[type=checkbox]",(function(){$(this).parent().find(".cbmask-inner").toggleClass("cb-active")}))})),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):e(jQuery)}((function(e){var t=e.fn.checkbox,i=function(e){window&&window.console&&window.console.error&&window.console.error(e)},o=function(t,o){this.options=e.extend({},e.fn.checkbox.defaults,o);var a=e(t);if("label"===t.tagName.toLowerCase()){this.$label=a,this.$chk=this.$label.find('input[type="checkbox"]'),this.$container=a.parent(".checkbox"),!this.options.ignoreVisibilityCheck&&this.$chk.css("visibility").match(/hidden|collapse/)&&i("For accessibility reasons, in order for tab and space to function on checkbox, checkbox `<input />`'s `visibility` must not be set to `hidden` or `collapse`. See https://github.com/ExactTarget/fuelux/pull/1996 for more details.");var s=this.$chk.attr("data-toggle");this.$toggleContainer=e(s),this.$chk.on("change",e.proxy(this.itemchecked,this)),this.setInitialState()}else i("Checkbox must be initialized on the `label` that wraps the `input` element. See https://github.com/ExactTarget/fuelux/blob/master/reference/markup/checkbox.html for example of proper markup. Call `.checkbox()` on the `<label>` not the `<input>`")};(o.prototype={constructor:o,setInitialState:function(){var e=this.$chk,t=e.prop("checked"),i=e.prop("disabled");this.setCheckedState(e,t),this.setDisabledState(e,i)},setCheckedState:function(e,t){var i=e,o=this.$label,a=this.$toggleContainer;t?(i.prop("checked",!0),o.addClass("checked"),a.removeClass("hide hidden"),o.trigger("checked.fu.checkbox")):(i.prop("checked",!1),o.removeClass("checked"),a.addClass("hidden"),o.trigger("unchecked.fu.checkbox")),o.trigger("changed.fu.checkbox",t)},setDisabledState:function(t,i){var o=e(t),a=this.$label;return i?(o.prop("disabled",!0),a.addClass("disabled"),a.trigger("disabled.fu.checkbox")):(o.prop("disabled",!1),a.removeClass("disabled"),a.trigger("enabled.fu.checkbox")),o},itemchecked:function(t){var i=e(t.target),o=i.prop("checked");this.setCheckedState(i,o)},toggle:function(){this.isChecked()?this.uncheck():this.check()},check:function(){this.setCheckedState(this.$chk,!0)},uncheck:function(){this.setCheckedState(this.$chk,!1)},isChecked:function(){return this.$chk.prop("checked")},enable:function(){this.setDisabledState(this.$chk,!1)},disable:function(){this.setDisabledState(this.$chk,!0)},destroy:function(){return this.$label.remove(),this.$label[0].outerHTML}}).getValue=o.prototype.isChecked,e.fn.checkbox=function(t){var i,a=Array.prototype.slice.call(arguments,1),s=this.each((function(){var s=e(this),r=s.data("fu.checkbox"),n="object"==typeof t&&t;r||s.data("fu.checkbox",r=new o(this,n)),"string"==typeof t&&(i=r[t].apply(r,a))}));return void 0===i?s:i},e.fn.checkbox.defaults={ignoreVisibilityCheck:!1},e.fn.checkbox.Constructor=o,e.fn.checkbox.noConflict=function(){return e.fn.checkbox=t,this},e(document).on("mouseover.fu.checkbox.data-api","[data-initialize=checkbox]",(function(t){var i=e(t.target);i.data("fu.checkbox")||i.checkbox(i.data())})),e((function(){e("[data-initialize=checkbox]").each((function(){var t=e(this);t.data("fu.checkbox")||t.checkbox(t.data())}))}))})),function(e,t,i){!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):jQuery&&!jQuery.fn.qtip&&e(jQuery)}((function(o){"use strict";var a,s,r,n,l,c=!0,d=!1,h=null,m="x",u="y",_="width",p="height",f="top",g="left",v="bottom",b="right",y="center",C="shift",k={},x="qtip",w="data-hasqtip",$="data-qtip-id",T=["ui-widget","ui-tooltip"],j="."+x,I="click dblclick mousedown mouseup mousemove mouseleave mouseenter".split(" "),S=x+"-fixed",M=x+"-default",A=x+"-focus",O=x+"-hover",D=x+"-disabled",P="_replacedByqTip",L="oldtitle",H={ie:function(){var e,i;for(e=4,i=t.createElement("div");(i.innerHTML="\x3c!--[if gt IE "+e+"]><i></i><![endif]--\x3e")&&i.getElementsByTagName("i")[0];e+=1);return e>4?e:NaN}(),iOS:parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||d};function E(e,t,i,a){this.id=i,this.target=e,this.tooltip=h,this.elements={target:e},this._id=x+"-"+i,this.timers={img:{}},this.options=t,this.plugins={},this.cache={event:{},target:o(),disabled:d,attr:a,onTooltip:d,lastClass:""},this.rendered=this.destroyed=this.disabled=this.waiting=this.hiddenDuringWait=this.positioning=this.triggering=d}function N(e){return e===h||"object"!=typeof e}function z(e){return!("function"==typeof e||e&&e.attr||e.length||"object"==typeof e&&(e.jquery||e.then))}function R(e){var t,i,a,s;return N(e)?d:(N(e.metadata)&&(e.metadata={type:e.metadata}),"content"in e&&(N(t=e.content)||t.jquery||t.done?(i=z(t)?d:t,t=e.content={text:i}):i=t.text,"ajax"in t&&(a=t.ajax,s=a&&a.once!==d,delete t.ajax,t.text=function(e,t){var r=i||o(this).attr(t.options.content.attr)||"Loading...",n=o.ajax(o.extend({},a,{context:t})).then(a.success,h,a.error).then((function(e){return e&&s&&t.set("content.text",e),e}),(function(e,i,o){t.destroyed||0===e.status||t.set("content.text",i+": "+o)}));return s?r:(t.set("content.text",r),n)}),"title"in t&&(o.isPlainObject(t.title)&&(t.button=t.title.button,t.title=t.title.text),z(t.title||d)&&(t.title=d))),"position"in e&&N(e.position)&&(e.position={my:e.position,at:e.position}),"show"in e&&N(e.show)&&(e.show=e.show.jquery?{target:e.show}:e.show===c?{ready:c}:{event:e.show}),"hide"in e&&N(e.hide)&&(e.hide=e.hide.jquery?{target:e.hide}:{event:e.hide}),"style"in e&&N(e.style)&&(e.style={classes:e.style}),o.each(k,(function(){this.sanitize&&this.sanitize(e)})),e)}function q(e,t){for(var i,o=0,a=e,s=t.split(".");a=a[s[o++]];)o<s.length&&(i=a);return[i||e,s.pop()]}function F(e,t){var i,o,a;for(i in this.checks)if(this.checks.hasOwnProperty(i))for(o in this.checks[i])this.checks[i].hasOwnProperty(o)&&(a=new RegExp(o,"i").exec(e))&&(t.push(a),("builtin"===i||this.plugins[i])&&this.checks[i][o].apply(this.plugins[i]||this,t))}(s=E.prototype)._when=function(e){return o.when.apply(o,e)},s.render=function(e){if(this.rendered||this.destroyed)return this;var t=this,i=this.options,s=this.cache,r=this.elements,n=i.content.text,l=i.content.title,h=i.content.button,m=i.position,u=[];return o.attr(this.target[0],"aria-describedby",this._id),s.posClass=this._createPosClass((this.position={my:m.my,at:m.at}).my),this.tooltip=r.tooltip=o("<div/>",{id:this._id,class:[x,M,i.style.classes,s.posClass].join(" "),width:i.style.width||"",height:i.style.height||"",tracking:"mouse"===m.target&&m.adjust.mouse,role:"alert","aria-live":"polite","aria-atomic":d,"aria-describedby":this._id+"-content","aria-hidden":c}).toggleClass(D,this.disabled).attr($,this.id).data(x,this).appendTo(m.container).append(r.content=o("<div />",{class:x+"-content",id:this._id+"-content","aria-atomic":c})),this.rendered=-1,this.positioning=c,l&&(this._createTitle(),"function"!=typeof l&&u.push(this._updateTitle(l,d))),h&&this._createButton(),"function"!=typeof n&&u.push(this._updateContent(n,d)),this.rendered=c,this._setWidget(),o.each(k,(function(e){var i;"render"===this.initialize&&(i=this(t))&&(t.plugins[e]=i)})),this._unassignEvents(),this._assignEvents(),this._when(u).then((function(){t._trigger("render"),t.positioning=d,t.hiddenDuringWait||!i.show.ready&&!e||t.toggle(c,s.event,d),t.hiddenDuringWait=d})),a.api[this.id]=this,this},s.destroy=function(e){if(this.destroyed)return this.target;function t(){if(!this.destroyed){this.destroyed=c;var e,t=this.target,i=t.attr(L);for(e in this.rendered&&this.tooltip.stop(1,0).find("*").remove().end().remove(),o.each(this.plugins,(function(){this.destroy&&this.destroy()})),this.timers)this.timers.hasOwnProperty(e)&&clearTimeout(this.timers[e]);t.removeData(x).removeAttr($).removeAttr(w).removeAttr("aria-describedby"),this.options.suppress&&i&&t.attr("title",i).removeAttr(L),this._unassignEvents(),this.options=this.elements=this.cache=this.timers=this.plugins=this.mouse=h,delete a.api[this.id]}}return e===c&&"hide"!==this.triggering||!this.rendered?t.call(this):(this.tooltip.one("tooltiphidden",o.proxy(t,this)),!this.triggering&&this.hide()),this.target},n=s.checks={builtin:{"^id$":function(e,t,i,s){var r=i===c?a.nextid:i,n=x+"-"+r;r!==d&&r.length>0&&!o("#"+n).length?(this._id=n,this.rendered&&(this.tooltip[0].id=this._id,this.elements.content[0].id=this._id+"-content",this.elements.title[0].id=this._id+"-title")):e[t]=s},"^prerender":function(e,t,i){i&&!this.rendered&&this.render(this.options.show.ready)},"^content.text$":function(e,t,i){this._updateContent(i)},"^content.attr$":function(e,t,i,o){this.options.content.text===this.target.attr(o)&&this._updateContent(this.target.attr(i))},"^content.title$":function(e,t,i){if(!i)return this._removeTitle();i&&!this.elements.title&&this._createTitle(),this._updateTitle(i)},"^content.button$":function(e,t,i){this._updateButton(i)},"^content.title.(text|button)$":function(e,t,i){this.set("content."+t,i)},"^position.(my|at)$":function(e,t,i){"string"==typeof i&&(this.position[t]=e[t]=new r(i,"at"===t))},"^position.container$":function(e,t,i){this.rendered&&this.tooltip.appendTo(i)},"^show.ready$":function(e,t,i){i&&(!this.rendered&&this.render(c)||this.toggle(c))},"^style.classes$":function(e,t,i,o){this.rendered&&this.tooltip.removeClass(o).addClass(i)},"^style.(width|height)":function(e,t,i){this.rendered&&this.tooltip.css(t,i)},"^style.widget|content.title":function(){this.rendered&&this._setWidget()},"^style.def":function(e,t,i){this.rendered&&this.tooltip.toggleClass(M,!!i)},"^events.(render|show|move|hide|focus|blur)$":function(e,t,i){this.rendered&&this.tooltip[("function"==typeof i?"":"un")+"bind"]("tooltip"+t,i)},"^(show|hide|position).(event|target|fixed|inactive|leave|distance|viewport|adjust)":function(){if(this.rendered){var e=this.options.position;this.tooltip.attr("tracking","mouse"===e.target&&e.adjust.mouse),this._unassignEvents(),this._assignEvents()}}}},s.get=function(e){if(this.destroyed)return this;var t=q(this.options,e.toLowerCase()),i=t[0][t[1]];return i.precedance?i.string():i};var V=/^position\.(my|at|adjust|target|container|viewport)|style|content|show\.ready/i,B=/^prerender|show\.ready/i;s.set=function(e,t){if(this.destroyed)return this;var i,a=this.rendered,s=d,r=this.options;return"string"==typeof e?(i=e,(e={})[i]=t):e=o.extend({},e),o.each(e,(function(t,i){if(a&&B.test(t))delete e[t];else{var n,l=q(r,t.toLowerCase());n=l[0][l[1]],l[0][l[1]]=i&&i.nodeType?o(i):i,s=V.test(t)||s,e[t]=[l[0],l[1],i,n]}})),R(r),this.positioning=c,o.each(e,o.proxy(F,this)),this.positioning=d,this.rendered&&this.tooltip[0].offsetWidth>0&&s&&this.reposition("mouse"===r.position.target?h:this.cache.event),this},s._update=function(e,t){var i=this,o=this.cache;return this.rendered&&e?("function"==typeof e&&(e=e.call(this.elements.target,o.event,this)||""),"function"==typeof e.then?(o.waiting=c,e.then((function(e){return o.waiting=d,i._update(e,t)}),h,(function(e){return i._update(e,t)}))):e===d||!e&&""!==e?d:(e.jquery&&e.length>0?t.empty().append(e.css({display:"block",visibility:"visible"})):t.html(e),this._waitForContent(t).then((function(e){i.rendered&&i.tooltip[0].offsetWidth>0&&i.reposition(o.event,!e.length)})))):d},s._waitForContent=function(e){var t=this.cache;return t.waiting=c,(o.fn.imagesLoaded?e.imagesLoaded():(new o.Deferred).resolve([])).done((function(){t.waiting=d})).promise()},s._updateContent=function(e,t){this._update(e,this.elements.content,t)},s._updateTitle=function(e,t){this._update(e,this.elements.title,t)===d&&this._removeTitle(d)},s._createTitle=function(){var e=this.elements,t=this._id+"-title";e.titlebar&&this._removeTitle(),e.titlebar=o("<div />",{class:x+"-titlebar "+(this.options.style.widget?U("header"):"")}).append(e.title=o("<div />",{id:t,class:x+"-title","aria-atomic":c})).insertBefore(e.content).on("mousedown keydown mouseup keyup mouseout",".qtip-close",(function(e){o(this).toggleClass("ui-state-active ui-state-focus","down"===e.type.substr(-4))})).on("mouseover mouseout",".qtip-close",(function(e){o(this).toggleClass("ui-state-hover","mouseover"===e.type)})),this.options.content.button&&this._createButton()},s._removeTitle=function(e){var t=this.elements;t.title&&(t.titlebar.remove(),t.titlebar=t.title=t.button=h,e!==d&&this.reposition())},s._createPosClass=function(e){return x+"-pos-"+(e||this.options.position.my).abbrev()},s.reposition=function(i,a){if(!this.rendered||this.positioning||this.destroyed)return this;this.positioning=c;var s,r,n,l,h=this.cache,m=this.tooltip,u=this.options.position,_=u.target,p=u.my,C=u.at,x=u.viewport,w=u.container,$=u.adjust,T=$.method.split(" "),j=m.outerWidth(d),I=m.outerHeight(d),S=0,M=0,A=m.css("position"),O={left:0,top:0},D=m[0].offsetWidth>0,P=i&&"scroll"===i.type,L=o(e),E=w[0].ownerDocument,N=this.mouse;if(Array.isArray(_)&&2===_.length)C={x:g,y:f},O={left:_[0],top:_[1]};else if("mouse"===_)C={x:g,y:f},(!$.mouse||this.options.hide.distance)&&h.origin&&h.origin.pageX?i=h.origin:!i||i&&("resize"===i.type||"scroll"===i.type)?i=h.event:N&&N.pageX&&(i=N),"static"!==A&&(O=w.offset()),E.body.offsetWidth!==(e.innerWidth||E.documentElement.clientWidth)&&(r=o(t.body).offset()),O={left:i.pageX-O.left+(r&&r.left||0),top:i.pageY-O.top+(r&&r.top||0)},$.mouse&&P&&N&&(O.left-=(N.scrollX||0)-L.scrollLeft(),O.top-=(N.scrollY||0)-L.scrollTop());else{if("event"===_?i&&i.target&&"scroll"!==i.type&&"resize"!==i.type?h.target=o(i.target):i.target||(h.target=this.elements.target):"event"!==_&&(h.target=o(_.jquery?_:this.elements.target)),_=h.target,0===(_=o(_).eq(0)).length)return this;_[0]===t||_[0]===e?(S=H.iOS?e.innerWidth:_.width(),M=H.iOS?e.innerHeight:_.height(),_[0]===e&&(O={top:(x||_).scrollTop(),left:(x||_).scrollLeft()})):k.imagemap&&_.is("area")?s=k.imagemap(this,_,C,k.viewport?T:d):k.svg&&_&&_[0].ownerSVGElement?s=k.svg(this,_,C,k.viewport?T:d):(S=_.outerWidth(d),M=_.outerHeight(d),O=_.offset()),s&&(S=s.width,M=s.height,r=s.offset,O=s.position),O=this.reposition.offset(_,O,w),(H.iOS>3.1&&H.iOS<4.1||H.iOS>=4.3&&H.iOS<4.33||!H.iOS&&"fixed"===A)&&(O.left-=L.scrollLeft(),O.top-=L.scrollTop()),(!s||s&&s.adjustable!==d)&&(O.left+=C.x===b?S:C.x===y?S/2:0,O.top+=C.y===v?M:C.y===y?M/2:0)}return O.left+=$.x+(p.x===b?-j:p.x===y?-j/2:0),O.top+=$.y+(p.y===v?-I:p.y===y?-I/2:0),k.viewport?(n=O.adjusted=k.viewport(this,O,u,S,M,j,I),r&&n.left&&(O.left+=r.left),r&&n.top&&(O.top+=r.top),n.my&&(this.position.my=n.my)):O.adjusted={left:0,top:0},h.posClass!==(l=this._createPosClass(this.position.my))&&(h.posClass=l,m.removeClass(h.posClass).addClass(l)),this._trigger("move",[O,x.elem||x],i)?(delete O.adjusted,a===d||!D||isNaN(O.left)||isNaN(O.top)||"mouse"===_||"function"!=typeof u.effect?m.css(O):"function"==typeof u.effect&&(u.effect.call(m,this,o.extend({},O)),m.queue((function(e){o(this).css({opacity:"",height:""}),H.ie&&this.style.removeAttribute("filter"),e()}))),this.positioning=d,this):this},s.reposition.offset=function(e,i,a){if(!a[0])return i;var s,r,n,l,c=o(e[0].ownerDocument),d=!!H.ie&&"CSS1Compat"!==t.compatMode,h=a[0];function m(e,t){i.left+=t*e.scrollLeft(),i.top+=t*e.scrollTop()}do{"static"!==(r=o.css(h,"position"))&&("fixed"===r?(n=h.getBoundingClientRect(),m(c,-1)):((n=o(h).position()).left+=parseFloat(o.css(h,"borderLeftWidth"))||0,n.top+=parseFloat(o.css(h,"borderTopWidth"))||0),i.left-=n.left+(parseFloat(o.css(h,"marginLeft"))||0),i.top-=n.top+(parseFloat(o.css(h,"marginTop"))||0),s||"hidden"===(l=o.css(h,"overflow"))||"visible"===l||(s=o(h)))}while(h=h.offsetParent);return s&&(s[0]!==c[0]||d)&&m(s,1),i};var K=(r=s.reposition.Corner=function(e,t){e=(""+e).replace(/([A-Z])/," $1").replace(/middle/gi,y).toLowerCase(),this.x=(e.match(/left|right/i)||e.match(/center/)||["inherit"])[0].toLowerCase(),this.y=(e.match(/top|bottom|center/i)||["inherit"])[0].toLowerCase(),this.forceY=!!t;var i=e.charAt(0);this.precedance="t"===i||"b"===i?u:m}).prototype;function U(e){return T.concat("").join(e?"-"+e+" ":" ")}function W(e,t){if(t>0)return setTimeout(o.proxy(e,this),t);e.call(this)}function Y(e){this.tooltip.hasClass(D)||(clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this.timers.show=W.call(this,(function(){this.toggle(c,e)}),this.options.show.delay))}function G(e){if(!this.tooltip.hasClass(D)&&!this.destroyed){var t=o(e.relatedTarget),i=t.closest(j)[0]===this.tooltip[0],a=t[0]===this.options.show.target[0];if(clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this!==t[0]&&"mouse"===this.options.position.target&&i||this.options.hide.fixed&&/mouse(out|leave|move)/.test(e.type)&&(i||a))try{e.preventDefault(),e.stopImmediatePropagation()}catch(e){}else this.timers.hide=W.call(this,(function(){this.toggle(d,e)}),this.options.hide.delay,this)}}function Q(e){!this.tooltip.hasClass(D)&&this.options.hide.inactive&&(clearTimeout(this.timers.inactive),this.timers.inactive=W.call(this,(function(){this.hide(e)}),this.options.hide.inactive))}function X(e){this.rendered&&this.tooltip[0].offsetWidth>0&&this.reposition(e)}function J(e,i,s){o(t.body).on((i.split?i:i.join("."+x+" "))+"."+x,e,(function(){var e=a.api[o.attr(this,$)];e&&!e.disabled&&s.apply(e,arguments)}))}K.invert=function(e,t){this[e]=this[e]===g?b:this[e]===b?g:t||this[e]},K.string=function(e){var t=this.x,i=this.y,o=t!==i?"center"===t||"center"!==i&&(this.precedance===u||this.forceY)?[i,t]:[t,i]:[t];return!1!==e?o.join(" "):o},K.abbrev=function(){var e=this.string(!1);return e[0].charAt(0)+(e[1]&&e[1].charAt(0)||"")},K.clone=function(){return new r(this.string(),this.forceY)},s.toggle=function(e,i){var a=this.cache,s=this.options,r=this.tooltip;if(i){if(/over|enter/.test(i.type)&&a.event&&/out|leave/.test(a.event.type)&&s.show.target.add(i.target).length===s.show.target.length&&r.has(i.relatedTarget).length)return this;a.event=o.event.fix(i)}if(this.waiting&&!e&&(this.hiddenDuringWait=c),!this.rendered)return e?this.render(1):this;if(this.destroyed||this.disabled)return this;var n,m,u,_=e?"show":"hide",p=this.options[_],f=this.options.position,g=this.options.content,v=this.tooltip.css("width"),b=this.tooltip.is(":visible"),y=e||1===p.target.length,C=!i||p.target.length<2||a.target[0]===i.target;return(typeof e).search("boolean|number")&&(e=!b),m=(n=!r.is(":animated")&&b===e&&C)?h:!!this._trigger(_,[90]),this.destroyed?this:(m!==d&&e&&this.focus(i),!m||n||(o.attr(r[0],"aria-hidden",!e),e?(this.mouse&&(a.origin=o.event.fix(this.mouse)),"function"==typeof g.text&&this._updateContent(g.text,d),"function"==typeof g.title&&this._updateTitle(g.title,d),!l&&"mouse"===f.target&&f.adjust.mouse&&(o(t).on("mousemove."+x,this._storeMouse),l=c),v||r.css("width",r.outerWidth(d)),this.reposition(i,arguments[2]),v||r.css("width",""),p.solo&&("string"==typeof p.solo?o(p.solo):o(j,p.solo)).not(r).not(p.target).qtip("hide",new o.Event("tooltipsolo"))):(clearTimeout(this.timers.show),delete a.origin,l&&!o(j+'[tracking="true"]:visible',p.solo).not(r).length&&(o(t).off("mousemove."+x),l=d),this.blur(i)),u=o.proxy((function(){e?(H.ie&&r[0].style.removeAttribute("filter"),r.css("overflow",""),"string"==typeof p.autofocus&&o(this.options.show.autofocus,r).trigger("focus"),this.options.show.target.trigger("qtip-"+this.id+"-inactive")):r.css({display:"",visibility:"",opacity:"",left:"",top:""}),this._trigger(e?"visible":"hidden")}),this),p.effect===d||y===d?(r[_](),u()):"function"==typeof p.effect?(r.stop(1,1),p.effect.call(r,this),r.queue("fx",(function(e){u(),e()}))):r.fadeTo(90,e?1:0,u),e&&p.target.trigger("qtip-"+this.id+"-inactive")),this)},s.show=function(e){return this.toggle(c,e)},s.hide=function(e){return this.toggle(d,e)},s.focus=function(e){if(!this.rendered||this.destroyed)return this;var t=o(j),i=this.tooltip,s=parseInt(i[0].style.zIndex,10),r=a.zindex+t.length;return i.hasClass(A)||this._trigger("focus",[r],e)&&(s!==r&&(t.each((function(){this.style.zIndex>s&&(this.style.zIndex=this.style.zIndex-1)})),t.filter("."+A).qtip("blur",e)),i.addClass(A)[0].style.zIndex=r),this},s.blur=function(e){return!this.rendered||this.destroyed||(this.tooltip.removeClass(A),this._trigger("blur",[this.tooltip.css("zIndex")],e)),this},s.disable=function(e){return this.destroyed||("toggle"===e?e=!(this.rendered?this.tooltip.hasClass(D):this.disabled):"boolean"!=typeof e&&(e=c),this.rendered&&this.tooltip.toggleClass(D,e).attr("aria-disabled",e),this.disabled=!!e),this},s.enable=function(){return this.disable(d)},s._createButton=function(){var e=this,t=this.elements,i=t.tooltip,a=this.options.content.button,s="string"==typeof a?a:"Close tooltip";t.button&&t.button.remove(),a.jquery?t.button=a:t.button=o("<a />",{class:"qtip-close "+(this.options.style.widget?"":x+"-icon"),title:s,"aria-label":s}).prepend(o("<span />",{class:"ui-icon ui-icon-close",html:"&times;"})),t.button.appendTo(t.titlebar||i).attr("role","button").click((function(t){return i.hasClass(D)||e.hide(t),d}))},s._updateButton=function(e){if(!this.rendered)return d;var t=this.elements.button;e?this._createButton():t.remove()},s._setWidget=function(){var e=this.options.style.widget,t=this.elements,i=t.tooltip,o=i.hasClass(D);i.removeClass(D),D=e?"ui-state-disabled":"qtip-disabled",i.toggleClass(D,o),i.toggleClass("ui-helper-reset "+U(),e).toggleClass(M,this.options.style.def&&!e),t.content&&t.content.toggleClass(U("content"),e),t.titlebar&&t.titlebar.toggleClass(U("header"),e),t.button&&t.button.toggleClass(x+"-icon",!e)},s._storeMouse=function(e){return(this.mouse=o.event.fix(e)).type="mousemove",this},s._bind=function(e,t,i,a,s){if(e&&i&&t.length){var r="."+this._id+(a?"-"+a:"");return o(e).on((t.split?t:t.join(r+" "))+r,o.proxy(i,s||this)),this}},s._unbind=function(e,t){return e&&o(e).off("."+this._id+(t?"-"+t:"")),this},s._trigger=function(e,t,i){var a=new o.Event("tooltip"+e);return a.originalEvent=i&&o.extend({},i)||this.cache.event||h,this.triggering=e,this.tooltip.trigger(a,[this].concat(t||[])),this.triggering=d,!a.isDefaultPrevented()},s._bindEvents=function(e,t,i,a,s,r){var n=i.filter(a).add(a.filter(i)),l=[];n.length&&(o.each(t,(function(t,i){var a=o.inArray(i,e);a>-1&&l.push(e.splice(a,1)[0])})),l.length&&(this._bind(n,l,(function(e){(!!this.rendered&&this.tooltip[0].offsetWidth>0?r:s).call(this,e)})),i=i.not(n),a=a.not(n))),this._bind(i,e,s),this._bind(a,t,r)},s._assignInitialEvents=function(e){var t=this.options,i=t.show.target,a=t.hide.target,s=t.show.event?t.show.event.split(" ").filter((function(e){return e.trim()})):[],r=t.hide.event?t.hide.event.split(" ").filter((function(e){return e.trim()})):[];function n(e){if(this.disabled||this.destroyed)return d;this.cache.event=e&&o.event.fix(e),this.cache.target=e&&o(e.target),clearTimeout(this.timers.show),this.timers.show=W.call(this,(function(){this.render("object"==typeof e||t.show.ready)}),t.prerender?0:t.show.delay)}this._bind(this.elements.target,["remove","removeqtip"],(function(){this.destroy(!0)}),"destroy"),/mouse(over|enter)/i.test(t.show.event)&&!/mouse(out|leave)/i.test(t.hide.event)&&r.push("mouseleave"),this._bind(i,"mousemove",(function(e){this._storeMouse(e),this.cache.onTarget=c})),this._bindEvents(s,r,i,a,n,(function(){if(!this.timers)return d;clearTimeout(this.timers.show)})),(t.show.ready||t.prerender)&&n.call(this,e)},s._assignEvents=function(){var i=this,s=this.options,r=s.position,n=this.tooltip,l=s.show.target,c=s.hide.target,h=r.container,m=r.viewport,u=o(t),_=o(e),p=s.show.event?s.show.event.split(" ").filter((function(e){return e.trim()})):[],f=s.hide.event?s.hide.event.split(" ").filter((function(e){return e.trim()})):[];o.each(s.events,(function(e,t){i._bind(n,"toggle"===e?["tooltipshow","tooltiphide"]:["tooltip"+e],t,null,n)})),/mouse(out|leave)/i.test(s.hide.event)&&"window"===s.hide.leave&&this._bind(u,["mouseout","blur"],(function(e){/select|option/.test(e.target.nodeName)||e.relatedTarget||this.hide(e)})),s.hide.fixed?c=c.add(n.addClass(S)):/mouse(over|enter)/i.test(s.show.event)&&this._bind(c,"mouseleave",(function(){clearTimeout(this.timers.show)})),(""+s.hide.event).indexOf("unfocus")>-1&&this._bind(h.closest("html"),["mousedown","touchstart"],(function(e){var t=o(e.target),i=this.rendered&&!this.tooltip.hasClass(D)&&this.tooltip[0].offsetWidth>0,a=t.parents(j).filter(this.tooltip[0]).length>0;t[0]===this.target[0]||t[0]===this.tooltip[0]||a||this.target.has(t[0]).length||!i||this.hide(e)})),"number"==typeof s.hide.inactive&&(this._bind(l,"qtip-"+this.id+"-inactive",Q,"inactive"),this._bind(c.add(n),a.inactiveEvents,Q)),this._bindEvents(p,f,l,c,Y,G),this._bind(l.add(n),"mousemove",(function(e){if("number"==typeof s.hide.distance){var t=this.cache.origin||{},i=this.options.hide.distance,o=Math.abs;(o(e.pageX-t.pageX)>=i||o(e.pageY-t.pageY)>=i)&&this.hide(e)}this._storeMouse(e)})),"mouse"===r.target&&r.adjust.mouse&&(s.hide.event&&this._bind(l,["mouseenter","mouseleave"],(function(e){if(!this.cache)return d;this.cache.onTarget="mouseenter"===e.type})),this._bind(u,"mousemove",(function(e){this.rendered&&this.cache.onTarget&&!this.tooltip.hasClass(D)&&this.tooltip[0].offsetWidth>0&&this.reposition(e)}))),(r.adjust.resize||m.length)&&this._bind(o.event.special.resize?m:_,"resize",X),r.adjust.scroll&&this._bind(_.add(r.container),"scroll",X)},s._unassignEvents=function(){var i=this.options,a=i.show.target,s=i.hide.target,r=o.grep([this.elements.target[0],this.rendered&&this.tooltip[0],i.position.container[0],i.position.viewport[0],i.position.container.closest("html")[0],e,t],(function(e){return"object"==typeof e}));a&&a.toArray&&(r=r.concat(a.toArray())),s&&s.toArray&&(r=r.concat(s.toArray())),this._unbind(r)._unbind(r,"destroy")._unbind(r,"inactive")},o((function(){J(j,["mouseenter","mouseleave"],(function(e){var t="mouseenter"===e.type,i=o(e.currentTarget),a=o(e.relatedTarget||e.target),s=this.options;t?(this.focus(e),i.hasClass(S)&&!i.hasClass(D)&&clearTimeout(this.timers.hide)):"mouse"===s.position.target&&s.position.adjust.mouse&&s.hide.event&&s.show.target&&!a.closest(s.show.target[0]).length&&this.hide(e),i.toggleClass(O,t)})),J("["+$+"]",I,Q)})),a=o.fn.qtip=function(e,s,n){var l=(""+e).toLowerCase(),m=h,u=o.makeArray(arguments).slice(1),_=u[u.length-1],p=this[0]?o.data(this[0],x):h;return!arguments.length&&p||"api"===l?p:"string"==typeof e?(this.each((function(){var e=o.data(this,x);if(!e)return c;if(_&&_.timeStamp&&(e.cache.event=_),!s||"option"!==l&&"options"!==l)e[l]&&e[l].apply(e,u);else{if(n===i&&!o.isPlainObject(s))return m=e.get(s),d;e.set(s,n)}})),m!==h?m:this):"object"!=typeof e&&arguments.length?void 0:(p=R(o.extend(c,{},e)),this.each((function(e){var i,s;if(s=!(s=Array.isArray(p.id)?p.id[e]:p.id)||s===d||s.length<1||a.api[s]?a.nextid++:s,i=function(e,i,s){var n,l,m,u,_,p=o(t.body),f=e[0]===t?p:e,g=e.metadata?e.metadata(s.metadata):h,v="html5"===s.metadata.type&&g?g[s.metadata.name]:h,b=e.data(s.metadata.name||"qtipopts");try{b="string"==typeof b?JSON.parse(b):b}catch(e){}if(l=(u=o.extend(c,{},a.defaults,s,"object"==typeof b?R(b):h,R(v||g))).position,u.id=i,"boolean"==typeof u.content.text){if(m=e.attr(u.content.attr),u.content.attr===d||!m)return d;u.content.text=m}if(l.container.length||(l.container=p),l.target===d&&(l.target=f),u.show.target===d&&(u.show.target=f),u.show.solo===c&&(u.show.solo=l.container.closest("body")),u.hide.target===d&&(u.hide.target=f),u.position.viewport===c&&(u.position.viewport=l.container),l.container=l.container.eq(0),l.at=new r(l.at,c),l.my=new r(l.my),e.data(x))if(u.overwrite)e.qtip("destroy",!0);else if(u.overwrite===d)return d;return e.attr(w,i),u.suppress&&(_=e.attr("title"))&&e.removeAttr("title").attr(L,_).attr("title",""),n=new E(e,u,i,!!m),e.data(x,n),n}(o(this),s,p),i===d)return c;a.api[s]=i,o.each(k,(function(){"initialize"===this.initialize&&this(i)})),i._assignInitialEvents(_)})))},o.qtip=E,a.api={},o.each({attr:function(e,t){if(this.length){var i=this[0],a="title",s=o.data(i,"qtip");if(e===a&&s&&s.options&&"object"==typeof s&&"object"==typeof s.options&&s.options.suppress)return arguments.length<2?o.attr(i,L):(s&&s.options.content.attr===a&&s.cache.attr&&s.set("content.text",t),this.attr(L,t))}return o.fn["attr"+P].apply(this,arguments)},clone:function(e){var t=o.fn["clone"+P].apply(this,arguments);return e||t.filter("["+L+"]").attr("title",(function(){return o.attr(this,L)})).removeAttr(L),t}},(function(e,t){if(!t||o.fn[e+P])return c;var i=o.fn[e+P]=o.fn[e];o.fn[e]=function(){return t.apply(this,arguments)||i.apply(this,arguments)}})),o.ui||(o["cleanData"+P]=o.cleanData,o.cleanData=function(e){for(var t,i=0;(t=o(e[i])).length;i++)if(t.attr(w))try{t.triggerHandler("removeqtip")}catch(e){}o["cleanData"+P].apply(this,arguments)}),a.version="@@VERSION",a.nextid=0,a.inactiveEvents=I,a.zindex=15e3,a.defaults={prerender:d,id:d,overwrite:c,suppress:c,content:{text:c,attr:"title",title:d,button:d},position:{my:"top left",at:"bottom right",target:d,container:d,viewport:d,adjust:{x:0,y:0,mouse:c,scroll:c,resize:c,method:"flipinvert flipinvert"},effect:function(e,t){o(this).animate(t,{duration:200,queue:d})}},show:{target:d,event:"mouseenter",effect:c,delay:90,solo:d,ready:d,autofocus:d},hide:{target:d,event:"mouseleave",effect:c,delay:0,fixed:d,inactive:d,leave:"window",distance:d},style:{classes:"",widget:d,width:d,height:d,def:c},events:{render:h,move:h,show:h,hide:h,toggle:h,visible:h,hidden:h,focus:h,blur:h}};var Z,ee,te,ie,oe,ae="margin",se="border",re="color",ne="background-color",le="transparent",ce=" !important",de=!!t.createElement("canvas").getContext,he=/rgba?\(0, 0, 0(, 0)?\)|transparent|#123456/i;function me(e){return e.charAt(0).toUpperCase()+e.slice(1)}var ue,_e={},pe=["Webkit","O","Moz","ms"];function fe(e,t){return Math.ceil(parseFloat(function(e,t){var o,a,s=t.charAt(0).toUpperCase()+t.slice(1),r=(t+" "+pe.join(s+" ")+s).split(" "),n=0;if(_e[t])return e.css(_e[t]);for(;o=r[n++];)if((a=e.css(o))!==i)return _e[t]=o,a}(e,t)))}function ge(e,t){this._ns="tip",this.options=t,this.offset=t.offset,this.size=[t.width,t.height],this.qtip=e,this.init(e)}de?(ie=e.devicePixelRatio||1,oe=(ue=t.createElement("canvas").getContext("2d")).backingStorePixelRatio||ue.webkitBackingStorePixelRatio||ue.mozBackingStorePixelRatio||ue.msBackingStorePixelRatio||ue.oBackingStorePixelRatio||1,te=ie/oe):ee=function(e,t,i){return"<qtipvml:"+e+' xmlns="urn:schemas-microsoft.com:vml" class="qtip-vml" '+(t||"")+' style="behavior: url(#default#VML); '+(i||"")+'" />'},o.extend(ge.prototype,{init:function(e){var t,i;i=this.element=e.elements.tip=o("<div />",{class:x+"-tip"}).prependTo(e.tooltip),de?((t=o("<canvas />").appendTo(this.element)[0].getContext("2d")).lineJoin="miter",t.miterLimit=1e5,t.save()):(t=ee("shape",'coordorigin="0,0"',"position:absolute;"),this.element.html(t+t),e._bind(o("*",i).add(i),["click","mousedown"],(function(e){e.stopPropagation()}),this._ns)),e._bind(e.tooltip,"tooltipmove",this.reposition,this._ns,this),this.create()},_swapDimensions:function(){this.size[0]=this.options.height,this.size[1]=this.options.width},_resetDimensions:function(){this.size[0]=this.options.width,this.size[1]=this.options.height},_useTitle:function(e){var t=this.qtip.elements.titlebar;return t&&(e.y===f||e.y===y&&this.element.position().top+this.size[1]/2+this.options.offset<t.outerHeight(c))},_parseCorner:function(e){var t=this.qtip.options.position.my;return e===d||t===d?e=d:e===c?e=new r(t.string()):e.string||((e=new r(e)).fixed=c),e},_parseWidth:function(e,t,i){var o=this.qtip.elements,a=se+me(t)+"Width";return(i?fe(i,a):fe(o.content,a)||fe(this._useTitle(e)&&o.titlebar||o.content,a)||fe(o.tooltip,a))||0},_parseRadius:function(e){var t=this.qtip.elements,i=se+me(e.y)+me(e.x)+"Radius";return H.ie<9?0:fe(this._useTitle(e)&&t.titlebar||t.content,i)||fe(t.tooltip,i)||0},_invalidColour:function(e,t,i){var o=e.css(t);return!o||i&&o===e.css(i)||he.test(o)?d:o},_parseColours:function(e){var t=this.qtip.elements,i=this.element.css("cssText",""),a=se+me(e[e.precedance])+me(re),s=this._useTitle(e)&&t.titlebar||t.content,r=this._invalidColour,n=[];return n[0]=r(i,ne)||r(s,ne)||r(t.content,ne)||r(t.tooltip,ne)||i.css(ne),n[1]=r(i,a,re)||r(s,a,re)||r(t.content,a,re)||r(t.tooltip,a,re)||t.tooltip.css(a),o("*",i).add(i).css("cssText",ne+":"+le+ce+";"+se+":0"+ce+";"),n},_calculateSize:function(e){var t,i,o=e.precedance===u,a=this.options.width,s=this.options.height,r="c"===e.abbrev(),n=(o?a:s)*(r?.5:1),l=Math.pow,c=Math.round,d=Math.sqrt(l(n,2)+l(s,2)),h=[this.border/n*d,this.border/s*d];return h[2]=Math.sqrt(l(h[0],2)-l(this.border,2)),h[3]=Math.sqrt(l(h[1],2)-l(this.border,2)),i=[c((t=(d+h[2]+h[3]+(r?0:h[0]))/d)*a),c(t*s)],o?i:i.reverse()},_calculateTip:function(e,t,i){i=i||1;var o=(t=t||this.size)[0]*i,a=t[1]*i,s=Math.ceil(o/2),r=Math.ceil(a/2),n={br:[0,0,o,a,o,0],bl:[0,0,o,0,0,a],tr:[0,a,o,0,o,a],tl:[0,0,0,a,o,a],tc:[0,a,s,0,o,a],bc:[0,0,o,0,s,a],rc:[0,0,o,r,0,a],lc:[o,0,o,a,0,r]};return n.lt=n.br,n.rt=n.bl,n.lb=n.tr,n.rb=n.tl,n[e.abbrev()]},_drawCoords:function(e,t){e.beginPath(),e.moveTo(t[0],t[1]),e.lineTo(t[2],t[3]),e.lineTo(t[4],t[5]),e.closePath()},create:function(){var e=this.corner=(de||H.ie)&&this._parseCorner(this.options.corner);return this.enabled=!!this.corner&&"c"!==this.corner.abbrev(),this.enabled&&(this.qtip.cache.corner=e.clone(),this.update()),this.element.toggle(this.enabled),this.corner},update:function(t,i){if(!this.enabled)return this;var a,s,n,l,h,C,k,x,w=this.qtip.elements,$=this.element,T=$.children(),j=this.options,I=this.size,S=j.mimic,M=Math.round;t||(t=this.qtip.cache.corner||this.corner),S===d?S=t:((S=new r(S)).precedance=t.precedance,"inherit"===S.x?S.x=t.x:"inherit"===S.y?S.y=t.y:S.x===S.y&&(S[t.precedance]=t[t.precedance])),s=S.precedance,t.precedance===m?this._swapDimensions():this._resetDimensions(),(a=this.color=this._parseColours(t))[1]!==le?(x=this.border=this._parseWidth(t,t[t.precedance]),j.border&&x<1&&!he.test(a[1])&&(a[0]=a[1]),this.border=x=j.border!==c?j.border:x):this.border=x=0,k=this.size=this._calculateSize(t),$.css({width:k[0],height:k[1],lineHeight:k[1]+"px"}),C=t.precedance===u?[M(S.x===g?x:S.x===b?k[0]-I[0]-x:(k[0]-I[0])/2),M(S.y===f?k[1]-I[1]:0)]:[M(S.x===g?k[0]-I[0]:0),M(S.y===f?x:S.y===v?k[1]-I[1]-x:(k[1]-I[1])/2)],de?((n=T[0].getContext("2d")).restore(),n.save(),n.clearRect(0,0,6e3,6e3),l=this._calculateTip(S,I,te),h=this._calculateTip(S,this.size,te),T.attr(_,k[0]*te).attr(p,k[1]*te),T.css(_,k[0]).css(p,k[1]),this._drawCoords(n,h),n.fillStyle=a[1],n.fill(),n.translate(C[0]*te,C[1]*te),this._drawCoords(n,l),n.fillStyle=a[0],n.fill()):(l="m"+(l=this._calculateTip(S))[0]+","+l[1]+" l"+l[2]+","+l[3]+" "+l[4]+","+l[5]+" xe",C[2]=x&&/^(r|b)/i.test(t.string())?8===H.ie?2:1:0,T.css({coordsize:k[0]+x+" "+k[1]+x,antialias:""+(S.string().indexOf(y)>-1),left:C[0]-C[2]*Number(s===m),top:C[1]-C[2]*Number(s===u),width:k[0]+x,height:k[1]+x}).each((function(e){var t=o(this);t[t.prop?"prop":"attr"]({coordsize:k[0]+x+" "+k[1]+x,path:l,fillcolor:a[0],filled:!!e,stroked:!e}).toggle(!(!x&&!e)),!e&&t.html(ee("stroke",'weight="'+2*x+'px" color="'+a[1]+'" miterlimit="1000" joinstyle="miter"'))}))),e.opera&&setTimeout((function(){w.tip.css({display:"inline-block",visibility:"visible"})}),1),i!==d&&this.calculate(t,k)},calculate:function(e,t){if(!this.enabled)return d;var i,a,s=this,r=this.qtip.elements,n=this.element,l=this.options.offset,c={};return e=e||this.corner,i=e.precedance,t=t||this._calculateSize(e),a=[e.x,e.y],i===m&&a.reverse(),o.each(a,(function(o,a){var n,d,h;a===y?(c[n=i===u?g:f]="50%",c[ae+"-"+n]=-Math.round(t[i===u?0:1]/2)+l):(n=s._parseWidth(e,a,r.tooltip),d=s._parseWidth(e,a,r.content),h=s._parseRadius(e),c[a]=Math.max(-s.border,o?d:l+(h>n?h:-n)))})),c[e[i]]-=t[i===m?0:1],n.css({margin:"",top:"",bottom:"",left:"",right:""}).css(c),c},reposition:function(e,t,o){if(this.enabled){var a,s,r=t.cache,n=this.corner.clone(),l=o.adjusted,h=t.options.position.adjust.method.split(" "),_=h[0],p=h[1]||h[0],k={left:d,top:d,x:0,y:0},x={};this.corner.fixed!==c&&(w(_,m,u,g,b),w(p,u,m,f,v),n.string()===r.corner.string()&&r.cornerTop===l.top&&r.cornerLeft===l.left||this.update(n,d)),(a=this.calculate(n)).right!==i&&(a.left=-a.right),a.bottom!==i&&(a.top=-a.bottom),a.user=this.offset,k.left=_===C&&!!l.left,k.left&&$(m,g,b),k.top=p===C&&!!l.top,k.top&&$(u,f,v),this.element.css(x).toggle(!(k.x&&k.y||n.x===y&&k.y||n.y===y&&k.x)),o.left-=a.left.charAt?a.user:_!==C||k.top||!k.left&&!k.top?a.left+this.border:0,o.top-=a.top.charAt?a.user:p!==C||k.left||!k.left&&!k.top?a.top+this.border:0,r.cornerLeft=l.left,r.cornerTop=l.top,r.corner=n.clone()}function w(e,t,i,o,a){e===C&&n.precedance===t&&l[o]&&n[i]!==y?n.precedance=n.precedance===m?u:m:e!==C&&l[o]&&(n[t]=n[t]===y?l[o]>0?o:a:n[t]===o?a:o)}function $(e,t,r){n[e]===y?x[ae+"-"+t]=k[e]=a[ae+"-"+t]-l[t]:(s=a[r]!==i?[l[t],-a[t]]:[-l[t],a[t]],(k[e]=Math.max(s[0],s[1]))>s[0]&&(o[t]-=l[t],k[t]=d),x[a[r]!==i?r:t]=k[e])}},destroy:function(){this.qtip._unbind(this.qtip.tooltip,this._ns),this.qtip.elements.tip&&this.qtip.elements.tip.find("*").remove().end().remove()}}),(Z=k.tip=function(e){return new ge(e,e.options.style.tip)}).initialize="render",Z.sanitize=function(e){if(e.style&&"tip"in e.style){var t=e.style.tip;"object"!=typeof t&&(t=e.style.tip={corner:t}),/string|boolean/i.test(typeof t.corner)||(t.corner=c)}},n.tip={"^position.my|style.tip.(corner|mimic|border)$":function(){this.create(),this.qtip.reposition()},"^style.tip.(height|width)$":function(e){this.size=[e.width,e.height],this.update(),this.qtip.reposition()},"^content.title|style.(classes|widget)$":function(){this.update()}},o.extend(c,a.defaults,{style:{tip:{corner:c,mimic:d,width:6,height:6,border:c,offset:0}}});var ve,be,ye="qtip-modal",Ce="."+ye;function ke(e,t){this.options=t,this._ns="-modal",this.qtip=e,this.init(e)}be=new(be=function(){var e,i,a,s=this,r={};function n(e){r.length<1&&e.length?e.not("body").blur():r.first().focus()}function l(t){if(a.is(":visible")){var i=o(t.target),s=e.tooltip,r=i.closest(j);(r.length<1?d:parseInt(r[0].style.zIndex,10)>parseInt(s[0].style.zIndex,10))||i.closest(j)[0]===s[0]||n(i)}}o.extend(s,{init:function(){return a=s.elem=o("<div />",{id:"qtip-overlay",html:"<div></div>"}).on("mousedown",(function(){return d})).hide(),o(t.body).on("focusin"+Ce,l),o(t).on("keydown"+Ce,(function(t){e&&e.options.show.modal.escape&&27===t.key&&e.hide(t)})),a.on("click"+Ce,(function(t){e&&e.options.show.modal.blur&&e.hide(t)})),s},update:function(t){e=t,r=t.options.show.modal.stealfocus!==d?t.tooltip.find("*").filter((function(){return function(e){if(o.expr[":"].focusable)return o.expr[":"].focusable;var t,i,a,s=!isNaN(o.attr(e,"tabindex")),r=e.nodeName&&e.nodeName.toLowerCase();return"area"===r?(i=(t=e.parentNode).name,!(!e.href||!i||"map"!==t.nodeName.toLowerCase())&&!!(a=o("img[usemap=#"+i+"]")[0])&&a.is(":visible")):/input|select|textarea|button|object/.test(r)?!e.disabled:"a"===r&&e.href||s}(this)})):[]},toggle:function(r,l,m){var u=r.tooltip,_=r.options.show.modal,p=_.effect,f=l?"show":"hide",g=a.is(":visible"),v=o(Ce).filter(":visible:not(:animated)").not(u);return s.update(r),l&&_.stealfocus!==d&&n(o(":focus")),a.toggleClass("blurs",_.blur),l&&a.appendTo(t.body),a.is(":animated")&&g===l&&i!==d||!l&&v.length||(a.stop(c,d),"function"==typeof p?p.call(a,l):p===d?a[f]():a.fadeTo(parseInt(m,10)||90,l?1:0,(function(){l||a.hide()})),l||a.queue((function(e){a.css({left:"",top:""}),o(Ce).length||a.detach(),e()})),i=l,e.destroyed&&(e=h)),s}}),s.init()}),o.extend(ke.prototype,{init:function(e){var t=e.tooltip;if(!this.options.on)return this;e.elements.overlay=be.elem,t.addClass(ye).css("z-index",a.modal_zindex+o(Ce).length),e._bind(t,["tooltipshow","tooltiphide"],(function(e,i,a){var s=e.originalEvent;if(e.target===t[0])if(s&&"tooltiphide"===e.type&&/mouse(leave|enter)/.test(s.type)&&o(s.relatedTarget).closest(be.elem[0]).length)try{e.preventDefault()}catch(e){}else(!s||s&&"tooltipsolo"!==s.type)&&this.toggle(e,"tooltipshow"===e.type,a)}),this._ns,this),e._bind(t,"tooltipfocus",(function(e,i){if(!e.isDefaultPrevented()&&e.target===t[0]){var s=o(Ce),r=a.modal_zindex+s.length,n=parseInt(t[0].style.zIndex,10);be.elem[0].style.zIndex=r-1,s.each((function(){this.style.zIndex>n&&(this.style.zIndex-=1)})),s.filter("."+A).qtip("blur",e.originalEvent),t.addClass(A)[0].style.zIndex=r,be.update(i);try{e.preventDefault()}catch(e){}}}),this._ns,this),e._bind(t,"tooltiphide",(function(e){e.target===t[0]&&o(Ce).filter(":visible").not(t).last().qtip("focus",e)}),this._ns,this)},toggle:function(e,t,i){if(e&&e.isDefaultPrevented())return this;be.toggle(this.qtip,!!t,i)},destroy:function(){this.qtip.tooltip.removeClass(ye),this.qtip._unbind(this.qtip.tooltip,this._ns),be.toggle(this.qtip,d),delete this.qtip.elements.overlay}}),(ve=k.modal=function(e){return new ke(e,e.options.show.modal)}).sanitize=function(e){e.show&&("object"!=typeof e.show.modal?e.show.modal={on:!!e.show.modal}:void 0===e.show.modal.on&&(e.show.modal.on=c))},a.modal_zindex=a.zindex-200,ve.initialize="render",n.modal={"^show.modal.(on|blur)$":function(){this.destroy(),this.init(),this.qtip.elems.overlay.toggle(this.qtip.tooltip[0].offsetWidth>0)}},o.extend(c,a.defaults,{show:{modal:{on:d,effect:c,blur:c,stealfocus:c,escape:c}}}),k.viewport=function(i,a,s,r,n,l,c){var h,k,x,w,$,T,j,I,S=s.target,M=i.elements.tooltip,A=s.my,O=s.at,D=s.adjust,P=D.method.split(" "),L=P[0],H=P[1]||P[0],E=s.viewport,N=s.container,z={left:0,top:0};if(!E.jquery||S[0]===e||S[0]===t.body||"none"===D.method)return z;x=N.offset()||z,w="static"===N.css("position"),h="fixed"===M.css("position"),$=E[0]===e?E.width():E.outerWidth(d),T=E[0]===e?E.height():E.outerHeight(d),j={left:h?0:E.scrollLeft(),top:h?0:E.scrollTop()};var R=(E.ownerDocument||t).documentElement;function q(e,t,i,o,s,r,n,l,c){var d=a[s],h=A[e],m=O[e],u=i===C,p=h===s?c:h===r?-c:-c/2,f=m===s?l:m===r?-l:-l/2,g=j[s]+I[s]-(w?0:x[s]),v=g-d,b=d+c-(n===_?$:T)-g,S=p-(A.precedance===e||h===A[t]?f:0)-(m===y?l/2:0);return u?(S=(h===s?1:-1)*p,a[s]+=v>0?v:b>0?-b:0,a[s]=Math.max(-x[s]+I[s],d-S,Math.min(Math.max(-x[s]+I[s]+(n===_?$:T),d+S),a[s],"center"===h?d-p:1e9))):(o*="flipinvert"===i?2:0,v>0&&(h!==s||b>0)?(a[s]-=S+o,k.invert(e,s)):b>0&&(h!==r||v>0)&&(a[s]-=(h===y?-S:S)+o,k.invert(e,r)),a[s]<j[s]&&-a[s]>b&&(a[s]=d,k=A.clone())),a[s]-d}return I=o.contains(R,E)&&E.offset()||z,"shift"===L&&"shift"===H||(k=A.clone()),z={left:"none"!==L?q(m,u,L,D.x,g,b,_,r,l):0,top:"none"!==H?q(u,m,H,D.y,f,v,p,n,c):0,my:k}},k.polys={polygon:function(e,t){var i,o,a,s={width:0,height:0,position:{top:1e10,right:0,bottom:0,left:1e10},adjustable:d},r=0,n=[],l=1,c=1,h=0,m=0;for(r=e.length;r--;)(i=[parseInt(e[--r],10),parseInt(e[r+1],10)])[0]>s.position.right&&(s.position.right=i[0]),i[0]<s.position.left&&(s.position.left=i[0]),i[1]>s.position.bottom&&(s.position.bottom=i[1]),i[1]<s.position.top&&(s.position.top=i[1]),n.push(i);if(o=s.width=Math.abs(s.position.right-s.position.left),a=s.height=Math.abs(s.position.bottom-s.position.top),"c"===t.abbrev())s.position={left:s.position.left+s.width/2,top:s.position.top+s.height/2};else{for(;o>0&&a>0&&l>0&&c>0;)for(o=Math.floor(o/2),a=Math.floor(a/2),t.x===g?l=o:t.x===b?l=s.width-o:l+=Math.floor(o/2),t.y===f?c=a:t.y===v?c=s.height-a:c+=Math.floor(a/2),r=n.length;r--&&!(n.length<2);)h=n[r][0]-s.position.left,m=n[r][1]-s.position.top,(t.x===g&&h>=l||t.x===b&&h<=l||t.x===y&&(h<l||h>s.width-l)||t.y===f&&m>=c||t.y===v&&m<=c||t.y===y&&(m<c||m>s.height-c))&&n.splice(r,1);s.position={left:n[0][0],top:n[0][1]}}return s},rect:function(e,t,i,o){return{width:Math.abs(i-e),height:Math.abs(o-t),position:{left:Math.min(e,i),top:Math.min(t,o)}}},_angles:{tc:1.5,tr:7/4,tl:5/4,bc:.5,br:1/4,bl:3/4,rc:2,lc:1,c:0},ellipse:function(e,t,i,o,a){var s=k.polys._angles[a.abbrev()],r=0===s?0:i*Math.cos(s*Math.PI),n=o*Math.sin(s*Math.PI);return{width:2*i-Math.abs(r),height:2*o-Math.abs(n),position:{left:e+r,top:t+n},adjustable:d}},circle:function(e,t,i,o){return k.polys.ellipse(e,t,i,i,o)}},k.svg=function(e,i,a){for(var s,r,n,l,c,h,m,u,_,p=i[0],f=o(p.ownerSVGElement),g=p.ownerDocument,v=(parseInt(i.css("stroke-width"),10)||0)/2;!p.getBBox;)p=p.parentNode;if(!p.getBBox||!p.parentNode)return d;switch(p.nodeName){case"ellipse":case"circle":u=k.polys.ellipse(p.cx.baseVal.value,p.cy.baseVal.value,(p.rx||p.r).baseVal.value+v,(p.ry||p.r).baseVal.value+v,a);break;case"line":case"polygon":case"polyline":for(u=[],h=-1,l=(m=p.points||[{x:p.x1.baseVal.value,y:p.y1.baseVal.value},{x:p.x2.baseVal.value,y:p.y2.baseVal.value}]).numberOfItems||m.length;++h<l;)c=m.getItem?m.getItem(h):m[h],u.push.apply(u,[c.x,c.y]);u=k.polys.polygon(u,a);break;default:u={width:(u=p.getBBox()).width,height:u.height,position:{left:u.x,top:u.y}}}return _=u.position,(f=f[0]).createSVGPoint&&(r=p.getScreenCTM(),(m=f.createSVGPoint()).x=_.left,m.y=_.top,n=m.matrixTransform(r),_.left=n.x,_.top=n.y),g!==t&&"mouse"!==e.position.target&&(s=o((g.defaultView||g.parentWindow).frameElement).offset())&&(_.left+=s.left,_.top+=s.top),g=o(g),_.left+=g.scrollLeft(),_.top+=g.scrollTop(),u},k.imagemap=function(e,t,i){t.jquery||(t=o(t));var a,s,r,n,l,c=(t.attr("shape")||"rect").toLowerCase().replace("poly","polygon"),h=o('img[usemap="#'+t.parent("map").attr("name")+'"]'),m=t.attr("coords").trim().replace(/,$/,"").split(",");if(!h.length)return d;if("polygon"===c)n=k.polys.polygon(m,i);else{if(!k.polys[c])return d;for(r=-1,l=m.length,s=[];++r<l;)s.push(parseInt(m[r],10));n=k.polys[c].apply(this,s.concat(i))}return(a=h.offset()).left+=Math.ceil((h.outerWidth(d)-h.width())/2),a.top+=Math.ceil((h.outerHeight(d)-h.height())/2),n.position.left+=a.left,n.position.top+=a.top,n};function xe(e){this._ns="ie6",this.qtip=e,this.init(e)}o.extend(xe.prototype,{_scroll:function(){var t=this.qtip.elements.overlay;t&&(t[0].style.top=o(e).scrollTop()+"px")},init:function(i){var a=i.tooltip;o("select, object").length<1&&(this.bgiframe=i.elements.bgiframe=o('<iframe class="qtip-bgiframe" frameborder="0" tabindex="-1" src="javascript:\'\';"  style="display:block; position:absolute; z-index:-1; filter:alpha(opacity=0); -ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";"></iframe>').appendTo(a),i._bind(a,"tooltipmove",this.adjustBGIFrame,this._ns,this)),this.redrawContainer=o("<div/>",{id:x+"-rcontainer"}).appendTo(t.body),i.elements.overlay&&i.elements.overlay.addClass("qtipmodal-ie6fix")&&(i._bind(e,["scroll","resize"],this._scroll,this._ns,this),i._bind(a,["tooltipshow"],this._scroll,this._ns,this)),this.redraw()},adjustBGIFrame:function(){var e,t,i=this.qtip.tooltip,o={height:i.outerHeight(d),width:i.outerWidth(d)},a=this.qtip.plugins.tip,s=this.qtip.elements.tip;t={left:-(t=parseInt(i.css("borderLeftWidth"),10)||0),top:-t},a&&s&&(t[(e="x"===a.corner.precedance?[_,g]:[p,f])[1]]-=s[e[0]]()),this.bgiframe.css(t).css(o)},redraw:function(){if(this.qtip.rendered<1||this.drawing)return this;var e,t,i,o,a=this.qtip.tooltip,s=this.qtip.options.style,r=this.qtip.options.position.container;return this.qtip.drawing=1,s.height&&a.css(p,s.height),s.width?a.css(_,s.width):(a.css(_,"").appendTo(this.redrawContainer),(t=a.width())%2<1&&(t+=1),e=((i=a.css("maxWidth")||"")+(o=a.css("minWidth")||"")).indexOf("%")>-1?r.width()/100:0,t=(i=(i.indexOf("%")>-1?e:1*parseInt(i,10))||t)+(o=(o.indexOf("%")>-1?e:1*parseInt(o,10))||0)?Math.min(Math.max(t,o),i):t,a.css(_,Math.round(t)).appendTo(r)),this.drawing=0,this},destroy:function(){this.bgiframe&&this.bgiframe.remove(),this.qtip._unbind([e,this.qtip.tooltip],this._ns)}}),(k.ie6=function(e){return 6===H.ie?new xe(e):d}).initialize="render",n.ie6={"^content|style$":function(){this.redraw()}}}))}(window,document);var EasyAutocomplete=function(e){return e.main=function(t,i){function o(){return 0===g.length?void u.error("Input field doesn't exist."):m.checkDataUrlProperties()?m.checkRequiredProperties()?(a(),void function(){function e(){f("autocompleteOff",!0)&&_(),t(),i(),o(),a(),s(),h()}function t(){g.focusout((function(){var e,t=g.val();m.get("list").match.caseSensitive||(t=t.toLowerCase());for(var i=0,o=b.length;i<o;i+=1)if(e=m.get("getValue")(b[i]),m.get("list").match.caseSensitive||(e=e.toLowerCase()),e===t)return void l(y=i)}))}function i(){g.off("keyup").keyup((function(e){function t(e){function t(){var e={},t=m.get("ajaxSettings")||{};for(var i in t)e[i]=t[i];return e}function i(e,t){return!1===m.get("matchResponseProperty")||("string"==typeof m.get("matchResponseProperty")?t[m.get("matchResponseProperty")]===e:"function"!=typeof m.get("matchResponseProperty")||m.get("matchResponseProperty")(t)===e)}if(!(e.length<m.get("minCharNumber"))){if("list-required"!==m.get("data")){var o=m.get("data"),a=p.init(o);a=p.updateCategories(a,o),c(a=p.processData(a,e),e),g.parent().find("li").length>0?r():n()}var s=t();void 0!==s.url&&""!==s.url||(s.url=m.get("url")),void 0!==s.dataType&&""!==s.dataType||(s.dataType=m.get("dataType")),void 0!==s.url&&"list-required"!==s.url&&(s.url=s.url(e),s.data=m.get("preparePostData")(s.data,e),$.ajax(s).done((function(t){var o=p.init(t);o=p.updateCategories(o,t),o=p.convertXml(o),i(e,t)&&c(o=p.processData(o,e),e),p.checkIfDataExists(o)&&g.parent().find("li").length>0?r():n(),m.get("ajaxCallback")()})).fail((function(){u.warning("Fail to load response data")})).always((function(){})))}}switch(e.keyCode){case 27:n(),g.trigger("blur");break;case 38:e.preventDefault(),b.length>0&&y>0&&(y-=1,g.val(m.get("getValue")(b[y])),l(y));break;case 40:e.preventDefault(),b.length>0&&y<b.length-1&&(y+=1,g.val(m.get("getValue")(b[y])),l(y));break;default:if(e.keyCode>40||8===e.keyCode||0===e.keyCode){var i=g.val();!0!==m.get("list").hideOnEmptyPhrase||8!==e.keyCode||""!==i?m.get("requestDelay")>0?(void 0!==d&&clearTimeout(d),d=setTimeout((function(){t(i)}),m.get("requestDelay"))):t(i):n()}}}))}function o(){g.on("keydown",(function(e){if(38===(e=e||window.event).keyCode)return suppressKeypress=!0,!1})).keydown((function(e){13===e.keyCode&&y>-1&&(g.val(m.get("getValue")(b[y])),m.get("list").onKeyEnterEvent(),m.get("list").onChooseEvent(),y=-1,n(),e.preventDefault())}))}function a(){g.off("keypress")}function s(){g.focus((function(){""!==g.val()&&b.length>0&&(y=-1,r())}))}function h(){g.blur((function(){setTimeout((function(){y=-1,n()}),250)}))}function _(){g.attr("autocomplete","off")}e()}()):void u.error("Will not work without mentioned properties."):void u.error("One of options variables 'data' or 'url' must be defined.")}function a(){function e(e,t){return m.get("highlightPhrase")&&""!==t?function(e,t){var i=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}(t);return(e+"").replace(new RegExp("("+i+")","gi"),"<b>$1</b>")}(e,t):e}g.parent().hasClass(h.getValue("WRAPPER_CSS_CLASS"))&&(g.next("."+h.getValue("CONTAINER_CLASS")).remove(),g.unwrap()),function(){var e=$("<div>"),t=h.getValue("WRAPPER_CSS_CLASS");m.get("theme")&&""!==m.get("theme")&&(t+=" eac-"+m.get("theme")),m.get("cssClasses")&&""!==m.get("cssClasses")&&(t+=" "+m.get("cssClasses")),""!==_.getTemplateClass()&&(t+=" "+_.getTemplateClass()),e.addClass(t),g.wrap(e),!0===m.get("adjustWidth")&&function(){var e=g.outerWidth();g.parent().css("width",e)}()}(),function(){var t=$("<div>").addClass(h.getValue("CONTAINER_CLASS"));t.attr("id",s()).prepend($("<ul>")),t.on("show.eac",(function(){if(g.is(":focus")){switch(m.get("list").showAnimation.type){case"slide":var e=m.get("list").showAnimation.time,i=m.get("list").showAnimation.callback;t.find("ul").slideDown(e,i);break;case"fade":e=m.get("list").showAnimation.time,i=m.get("list").showAnimation.callback,t.find("ul").fadeIn(e);break;default:t.find("ul").show()}m.get("list").onShowListEvent()}})).on("hide.eac",(function(){switch(m.get("list").hideAnimation.type){case"slide":var e=m.get("list").hideAnimation.time,i=m.get("list").hideAnimation.callback;t.find("ul").slideUp(e,i);break;case"fade":e=m.get("list").hideAnimation.time,i=m.get("list").hideAnimation.callback,t.find("ul").fadeOut(e,i);break;default:t.find("ul").hide()}m.get("list").onHideListEvent()})).on("selectElement.eac",(function(){t.find("ul li").removeClass("selected"),t.find("ul li").eq(y).addClass("selected"),m.get("list").onSelectItemEvent()})).on("loadElements.eac",(function(i,o,a){var s="",r=t.find("ul");r.empty().detach(),b=[];for(var n=0,c=0,d=o.length;c<d;c+=1){var h=o[c].data;if(0!==h.length){void 0!==o[c].header&&o[c].header.length>0&&r.append("<div class='eac-category' >"+o[c].header+"</div>");for(var u=0,p=h.length;u<p&&n<o[c].maxListSize;u+=1)s=$("<li><div class='eac-item'></div></li>"),function(){var t=u,i=n,r=o[c].getValue(h[t]);s.find(" > div").on("click",(function(){g.val(r).trigger("change"),y=i,l(i),m.get("list").onClickEvent(),m.get("list").onChooseEvent()})).mouseover((function(){y=i,l(i),m.get("list").onMouseOverEvent()})).mouseout((function(){m.get("list").onMouseOutEvent()})).html(_.build(e(r,a),h[t]))}(),r.append(s),b.push(h[u]),n+=1}}t.append(r),m.get("list").onLoadEvent()})),g.after(t)}(),v=$("#"+s()),m.get("placeholder")&&g.attr("placeholder",m.get("placeholder"))}function s(){var e=g.attr("id");return h.getValue("CONTAINER_ID")+e}function r(){v.trigger("show.eac")}function n(){v.trigger("hide.eac")}function l(e){v.trigger("selectElement.eac",e)}function c(e,t){v.trigger("loadElements.eac",[e,t])}var d,h=new e.Constants,m=new e.Configuration(i),u=new e.Logger,_=new e.Template(i.template),p=new e.ListBuilderService(m,e.proccess),f=m.equals,g=t,v="",b=[],y=-1;e.consts=h,this.getConstants=function(){return h},this.getConfiguration=function(){return m},this.getContainer=function(){return v},this.getSelectedItemIndex=function(){return y},this.getItems=function(){return b},this.getItemData=function(e){return b.length<e||void 0===b[e]?-1:b[e]},this.getSelectedItemData=function(){return this.getItemData(y)},this.build=function(){a()},this.init=function(){o()}},e.eacHandles=[],e.getHandle=function(t){return e.eacHandles[t]},e.inputHasId=function(e){return void 0!==$(e).attr("id")&&$(e).attr("id").length>0},e.assignRandomId=function(t){var i="";do{i="eac-"+Math.floor(1e4*Math.random())}while(0!==$("#"+i).length);elementId=e.consts.getValue("CONTAINER_ID")+i,$(t).attr("id",i)},e.setHandle=function(t,i){e.eacHandles[i]=t},e}((EasyAutocomplete=function(e){return e.Template=function(e){var t={basic:{type:"basic",method:function(e){return e},cssClass:""},description:{type:"description",fields:{description:"description"},method:function(e){return e+" - description"},cssClass:"eac-description"},iconLeft:{type:"iconLeft",fields:{icon:""},method:function(e){return e},cssClass:"eac-icon-left"},iconRight:{type:"iconRight",fields:{iconSrc:""},method:function(e){return e},cssClass:"eac-icon-right"},links:{type:"links",fields:{link:""},method:function(e){return e},cssClass:""},custom:{type:"custom",method:function(){},cssClass:""}};this.getTemplateClass=function(e){return e&&e.type&&e.type&&t[e.type]?function(){var i=t[e.type].cssClass;return function(){return i}}():function(){return""}}(e),this.build=function(e){return e&&e.type&&e.type&&t[e.type]?function(e){var i,o=e.fields;return"description"===e.type?(i=t.description.method,"string"==typeof o.description?i=function(e,t){return e+" - <span>"+t[o.description]+"</span>"}:"function"==typeof o.description&&(i=function(e,t){return e+" - <span>"+o.description(t)+"</span>"}),i):"iconRight"===e.type?("string"==typeof o.iconSrc?i=function(e,t){return e+"<img class='eac-icon' src='"+t[o.iconSrc]+"' />"}:"function"==typeof o.iconSrc&&(i=function(e,t){return e+"<img class='eac-icon' src='"+o.iconSrc(t)+"' />"}),i):"iconLeft"===e.type?("string"==typeof o.iconSrc?i=function(e,t){return"<img class='eac-icon' src='"+t[o.iconSrc]+"' />"+e}:"function"==typeof o.iconSrc&&(i=function(e,t){return"<img class='eac-icon' src='"+o.iconSrc(t)+"' />"+e}),i):"links"===e.type?("string"==typeof o.link?i=function(e,t){return"<a href='"+t[o.link]+"' >"+e+"</a>"}:"function"==typeof o.link&&(i=function(e,t){return"<a href='"+o.link(t)+"' >"+e+"</a>"}),i):"custom"===e.type?e.method:t.basic.method}(e):t.basic.method}(e)},e}((EasyAutocomplete=function(e){return e.proccess=function(t,i,o){function a(e,i){return t.get("list").match.caseSensitive||("string"==typeof e&&(e=e.toLowerCase()),i=i.toLowerCase()),t.get("list").match.method(e,i)}e.proccess.match=a;var s=i.data;return s=function(e,i){var o=[];if(t.get("list").match.enabled)for(var s=0,r=e.length;s<r;s+=1)a(t.get("getValue")(e[s]),i)&&o.push(e[s]);else o=e;return o}(s,o),s=function(e){return void 0!==i.maxNumberOfElements&&e.length>i.maxNumberOfElements&&(e=e.slice(0,i.maxNumberOfElements)),e}(s),function(e){return t.get("list").sort.enabled&&e.sort(t.get("list").sort.method),e}(s)},e}((EasyAutocomplete=function(e){return e.ListBuilderService=function(e,t){function i(t,i){var o={};if(o="XML"===e.get("dataType").toUpperCase()?function(){var o,a={};return void 0!==t.xmlElementName&&(a.xmlElementName=t.xmlElementName),void 0!==t.listLocation?o=t.listLocation:void 0!==e.get("listLocation")&&(o=e.get("listLocation")),void 0!==o?"string"==typeof o?a.data=$(i).find(o):"function"==typeof o&&(a.data=o(i)):a.data=i,a}():function(){var e={};return void 0!==t.listLocation?"string"==typeof t.listLocation?e.data=i[t.listLocation]:"function"==typeof t.listLocation&&(e.data=t.listLocation(i)):e.data=i,e}(),void 0!==t.header&&(o.header=t.header),void 0!==t.maxNumberOfElements&&(o.maxNumberOfElements=t.maxNumberOfElements),void 0!==e.get("list").maxNumberOfElements&&(o.maxListSize=e.get("list").maxNumberOfElements),void 0!==t.getValue)if("string"==typeof t.getValue){var a=t.getValue;o.getValue=function(e){return e[a]}}else"function"==typeof t.getValue&&(o.getValue=t.getValue);else o.getValue=e.get("getValue");return o}function o(t){var i=[];return void 0===t.xmlElementName&&(t.xmlElementName=e.get("xmlElementName")),$(t.data).find(t.xmlElementName).each((function(){i.push(this)})),i}this.init=function(t){var i=[],o={};return o.data=e.get("listLocation")(t),o.getValue=e.get("getValue"),o.maxListSize=e.get("list").maxNumberOfElements,i.push(o),i},this.updateCategories=function(t,o){if(e.get("categoriesAssigned")){t=[];for(var a=0;a<e.get("categories").length;a+=1){var s=i(e.get("categories")[a],o);t.push(s)}}return t},this.convertXml=function(t){if("XML"===e.get("dataType").toUpperCase())for(var i=0;i<t.length;i+=1)t[i].data=o(t[i]);return t},this.processData=function(i,o){for(var a=0,s=i.length;a<s;a+=1)i[a].data=t(e,i[a],o);return i},this.checkIfDataExists=function(e){for(var t=0,i=e.length;t<i;t+=1)if(void 0!==e[t].data&&e[t].data instanceof Array&&e[t].data.length>0)return!0;return!1}},e}((EasyAutocomplete=function(e){return e.Constants=function(){var e={CONTAINER_CLASS:"easy-autocomplete-container",CONTAINER_ID:"eac-container-",WRAPPER_CSS_CLASS:"easy-autocomplete"};this.getValue=function(t){return e[t]}},e}((EasyAutocomplete=function(e){return e.Logger=function(){this.error=function(e){console.log("ERROR: "+e)},this.warning=function(e){console.log("WARNING: "+e)}},e}((EasyAutocomplete=function(e){return e.Configuration=function(e){function t(e,t){!function t(i,a){for(var s in a)void 0===i[s]&&e.log("Property '"+s+"' does not exist in EasyAutocomplete options API."),"object"==typeof i[s]&&-1===$.inArray(s,o)&&t(i[s],a[s])}(i,t)}var i={data:"list-required",url:"list-required",dataType:"json",listLocation:function(e){return e},xmlElementName:"",getValue:function(e){return e},autocompleteOff:!0,placeholder:!1,ajaxCallback:function(){},matchResponseProperty:!1,list:{sort:{enabled:!1,method:function(e,t){return(e=i.getValue(e))<(t=i.getValue(t))?-1:e>t?1:0}},maxNumberOfElements:6,hideOnEmptyPhrase:!0,match:{enabled:!1,caseSensitive:!1,method:function(e,t){return e.search(t)>-1}},showAnimation:{type:"normal",time:400,callback:function(){}},hideAnimation:{type:"normal",time:400,callback:function(){}},onClickEvent:function(){},onSelectItemEvent:function(){},onLoadEvent:function(){},onChooseEvent:function(){},onKeyEnterEvent:function(){},onMouseOverEvent:function(){},onMouseOutEvent:function(){},onShowListEvent:function(){},onHideListEvent:function(){}},highlightPhrase:!0,theme:"",cssClasses:"",minCharNumber:0,requestDelay:0,adjustWidth:!0,ajaxSettings:{},preparePostData:function(e,t){return e},loggerEnabled:!0,template:"",categoriesAssigned:!1,categories:[{maxNumberOfElements:4}]},o=["ajaxSettings","template"];this.get=function(e){return i[e]},this.equals=function(e,t){return!(!function(e){return void 0!==i[e]&&null!==i[e]}(e)||i[e]!==t)},this.checkDataUrlProperties=function(){return!("list-required"===i.url&&"list-required"===i.data)},this.checkRequiredProperties=function(){for(var e in i)if("required"===i[e])return logger.error("Option "+e+" must be defined"),!1;return!0},this.printPropertiesThatDoesntExist=function(e,i){t(e,i)},function(){if("xml"===e.dataType&&(e.getValue||(e.getValue=function(e){return $(e).text()}),e.list||(e.list={}),e.list.sort||(e.list.sort={}),e.list.sort.method=function(t,i){return(t=e.getValue(t))<(i=e.getValue(i))?-1:t>i?1:0},e.list.match||(e.list.match={}),e.list.match.method=function(e,t){return e.search(t)>-1}),void 0!==e.categories&&e.categories instanceof Array){for(var t=[],o=0,a=e.categories.length;o<a;o+=1){var s=e.categories[o];for(var r in i.categories[0])void 0===s[r]&&(s[r]=i.categories[0][r]);t.push(s)}e.categories=t}}(),i=function e(t,i){var o=t||{};for(var a in t)void 0!==i[a]&&null!==i[a]&&("object"!=typeof i[a]||i[a]instanceof Array?o[a]=i[a]:e(t[a],i[a]));return void 0!==i.data&&null!==i.data&&"object"==typeof i.data&&(o.data=i.data),o}(i,e),!0===i.loggerEnabled&&t(console,e),void 0!==e.ajaxSettings&&"object"==typeof e.ajaxSettings?i.ajaxSettings=e.ajaxSettings:i.ajaxSettings={},function(){if("list-required"!==i.url&&"function"!=typeof i.url){var t=i.url;i.url=function(){return t}}if(void 0!==i.ajaxSettings.url&&"function"!=typeof i.ajaxSettings.url){t=i.ajaxSettings.url;i.ajaxSettings.url=function(){return t}}if("string"==typeof i.listLocation){var o=i.listLocation;"XML"===i.dataType.toUpperCase()?i.listLocation=function(e){return $(e).find(o)}:i.listLocation=function(e){return e[o]}}if("string"==typeof i.getValue){var a=i.getValue;i.getValue=function(e){return e[a]}}void 0!==e.categories&&(i.categoriesAssigned=!0)}()},e}(EasyAutocomplete||{}))||{}))||{}))||{}))||{}))||{}))||{});!function(e){e.fn.easyAutocomplete=function(t){return this.each((function(){var i=e(this),o=new EasyAutocomplete.main(i,t);EasyAutocomplete.inputHasId(i)||EasyAutocomplete.assignRandomId(i),o.init(),EasyAutocomplete.setHandle(o,i.attr("id"))}))},e.fn.getSelectedItemIndex=function(){var t=e(this).attr("id");return void 0!==t?EasyAutocomplete.getHandle(t).getSelectedItemIndex():-1},e.fn.getItems=function(){var t=e(this).attr("id");return void 0!==t?EasyAutocomplete.getHandle(t).getItems():-1},e.fn.getItemData=function(t){var i=e(this).attr("id");return void 0!==i&&t>-1?EasyAutocomplete.getHandle(i).getItemData(t):-1},e.fn.getSelectedItemData=function(){var t=e(this).attr("id");return void 0!==t?EasyAutocomplete.getHandle(t).getSelectedItemData():-1}}(jQuery),function(){function e(e){var t=Array.isArray(e)?{label:e[0],value:e[1]}:"object"==typeof e&&"label"in e&&"value"in e?e:{label:e,value:e};this.label=t.label||t.value,this.value=t.value}function t(e,t){return"string"==typeof e?(t||document).querySelector(e):e||null}function i(e,t){return s.call((t||document).querySelectorAll(e))}function o(){i("input.awesomplete").forEach((function(e){new a(e)}))}var a=function(e,i){var o=this;a.count=(a.count||0)+1,this.count=a.count,this.isOpened=!1,this.input=t(e),this.input.setAttribute("autocomplete","off"),this.input.setAttribute("aria-expanded","false"),this.input.setAttribute("aria-owns","awesomplete_list_"+this.count),this.input.setAttribute("role","combobox"),this.options=i=i||{},function(e,t,i){for(var o in t){var a=t[o],s=e.input.getAttribute("data-"+o.toLowerCase());e[o]="number"==typeof a?parseInt(s):!1===a?null!==s:a instanceof Function?null:s,e[o]||0===e[o]||(e[o]=o in i?i[o]:a)}}(this,{minChars:2,maxItems:10,autoFirst:!1,data:a.DATA,filter:a.FILTER_CONTAINS,sort:!1!==i.sort&&a.SORT_BYLENGTH,container:a.CONTAINER,item:a.ITEM,replace:a.REPLACE,tabSelect:!1,listLabel:"Results List"},i),this.index=-1,this.container=this.container(e),this.ul=t.create("ul",{hidden:"hidden",role:"listbox",id:"awesomplete_list_"+this.count,inside:this.container,"aria-label":this.listLabel}),this.status=t.create("span",{className:"visually-hidden",role:"status","aria-live":"assertive","aria-atomic":!0,inside:this.container,textContent:0!=this.minChars?"Type "+this.minChars+" or more characters for results.":"Begin typing for results."}),this._events={input:{input:this.evaluate.bind(this),blur:this.close.bind(this,{reason:"blur"}),keydown:function(e){var t=e.keyCode;o.opened&&(13===t&&o.selected?(e.preventDefault(),o.select(void 0,void 0,e)):9===t&&o.selected&&o.tabSelect?o.select(void 0,void 0,e):27===t?o.close({reason:"esc"}):38!==t&&40!==t||(e.preventDefault(),o[38===t?"previous":"next"]()))}},form:{submit:this.close.bind(this,{reason:"submit"})},ul:{mousedown:function(e){e.preventDefault()},click:function(e){var t=e.target;if(t!==this){for(;t&&!/li/i.test(t.nodeName);)t=t.parentNode;t&&0===e.button&&(e.preventDefault(),o.select(t,e.target,e))}}}},t.bind(this.input,this._events.input),t.bind(this.input.form,this._events.form),t.bind(this.ul,this._events.ul),this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||i.list||[],a.all.push(this)};a.prototype={set list(e){if(Array.isArray(e))this._list=e;else if("string"==typeof e&&e.indexOf(",")>-1)this._list=e.split(/\s*,\s*/);else if((e=t(e))&&e.children){var i=[];s.apply(e.children).forEach((function(e){if(!e.disabled){var t=e.textContent.trim(),o=e.value||t,a=e.label||t;""!==o&&i.push({label:a,value:o})}})),this._list=i}document.activeElement===this.input&&this.evaluate()},get selected(){return this.index>-1},get opened(){return this.isOpened},close:function(e){this.opened&&(this.input.setAttribute("aria-expanded","false"),this.ul.setAttribute("hidden",""),this.isOpened=!1,this.index=-1,this.status.setAttribute("hidden",""),t.fire(this.input,"awesomplete-close",e||{}))},open:function(){this.input.setAttribute("aria-expanded","true"),this.ul.removeAttribute("hidden"),this.isOpened=!0,this.status.removeAttribute("hidden"),this.autoFirst&&-1===this.index&&this.goto(0),t.fire(this.input,"awesomplete-open")},destroy:function(){if(t.unbind(this.input,this._events.input),t.unbind(this.input.form,this._events.form),!this.options.container){var e=this.container.parentNode;e.insertBefore(this.input,this.container),e.removeChild(this.container)}this.input.removeAttribute("autocomplete"),this.input.removeAttribute("aria-autocomplete");var i=a.all.indexOf(this);-1!==i&&a.all.splice(i,1)},next:function(){var e=this.ul.children.length;this.goto(this.index<e-1?this.index+1:e?0:-1)},previous:function(){var e=this.ul.children.length,t=this.index-1;this.goto(this.selected&&-1!==t?t:e-1)},goto:function(e){var i=this.ul.children;this.selected&&i[this.index].setAttribute("aria-selected","false"),this.index=e,e>-1&&i.length>0&&(i[e].setAttribute("aria-selected","true"),this.status.textContent=i[e].textContent+", list item "+(e+1)+" of "+i.length,this.input.setAttribute("aria-activedescendant",this.ul.id+"_item_"+this.index),this.ul.scrollTop=i[e].offsetTop-this.ul.clientHeight+i[e].clientHeight,t.fire(this.input,"awesomplete-highlight",{text:this.suggestions[this.index]}))},select:function(e,i,o){if(e?this.index=t.siblingIndex(e):e=this.ul.children[this.index],e){var a=this.suggestions[this.index];t.fire(this.input,"awesomplete-select",{text:a,origin:i||e,originalEvent:o})&&(this.replace(a),this.close({reason:"select"}),t.fire(this.input,"awesomplete-selectcomplete",{text:a,originalEvent:o}))}},evaluate:function(){var t=this,i=this.input.value;i.length>=this.minChars&&this._list&&this._list.length>0?(this.index=-1,this.ul.innerHTML="",this.suggestions=this._list.map((function(o){return new e(t.data(o,i))})).filter((function(e){return t.filter(e,i)})),!1!==this.sort&&(this.suggestions=this.suggestions.sort(this.sort)),this.suggestions=this.suggestions.slice(0,this.maxItems),this.suggestions.forEach((function(e,o){t.ul.appendChild(t.item(e,i,o))})),0===this.ul.children.length?(this.status.textContent="No results found",this.close({reason:"nomatches"})):(this.open(),this.status.textContent=this.ul.children.length+" results found")):(this.close({reason:"nomatches"}),this.status.textContent="No results found")}},a.all=[],a.FILTER_CONTAINS=function(e,i){return RegExp(t.regExpEscape(i.trim()),"i").test(e)},a.FILTER_STARTSWITH=function(e,i){return RegExp("^"+t.regExpEscape(i.trim()),"i").test(e)},a.SORT_BYLENGTH=function(e,t){return e.length!==t.length?e.length-t.length:e<t?-1:1},a.CONTAINER=function(e){return t.create("div",{className:"awesomplete",around:e})},a.ITEM=function(e,i,o){return t.create("li",{innerHTML:""===i.trim()?e:e.replace(RegExp(t.regExpEscape(i.trim()),"gi"),"<mark>$&</mark>"),role:"option","aria-selected":"false",id:"awesomplete_list_"+this.count+"_item_"+o})},a.REPLACE=function(e){this.input.value=e.value},a.DATA=function(e){return e},Object.defineProperty(e.prototype=Object.create(String.prototype),"length",{get:function(){return this.label.length}}),e.prototype.toString=e.prototype.valueOf=function(){return""+this.label};var s=Array.prototype.slice;t.create=function(e,i){var o=document.createElement(e);for(var a in i){var s=i[a];if("inside"===a)t(s).appendChild(o);else if("around"===a){var r=t(s);r.parentNode.insertBefore(o,r),o.appendChild(r),null!=r.getAttribute("autofocus")&&r.focus()}else a in o?o[a]=s:o.setAttribute(a,s)}return o},t.bind=function(e,t){if(e)for(var i in t){var o=t[i];i.split(/\s+/).forEach((function(t){e.addEventListener(t,o)}))}},t.unbind=function(e,t){if(e)for(var i in t){var o=t[i];i.split(/\s+/).forEach((function(t){e.removeEventListener(t,o)}))}},t.fire=function(e,t,i){var o=document.createEvent("HTMLEvents");for(var a in o.initEvent(t,!0,!0),i)o[a]=i[a];return e.dispatchEvent(o)},t.regExpEscape=function(e){return e.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")},t.siblingIndex=function(e){for(var t=0;e=e.previousElementSibling;t++);return t},"undefined"!=typeof self&&(self.Awesomplete=a),"undefined"!=typeof Document&&("loading"!==document.readyState?o():document.addEventListener("DOMContentLoaded",o)),a.$=t,a.$$=i,"object"==typeof module&&module.exports&&(module.exports=a)}();var commerceCategoryTree=function(){function e(e){$("form#"+e+"_form input[name='m_category_ids[]']").each((function(){var e=$(this);$("#"+e.val()+"_categoryId_anchor").addClass("jstree-checked")}))}function t(e){$("#"+e+".jstree li.jstree-node .jstree-anchor").each((function(){var e=$(this),t=e.data("textlang"),i='<span title="'+translations.tr_meliscommerce_categories_list_tree_view_product_num+'"></span>';t&&(i=" "+t+i),e.hasClass("updatedText")||(e.append(i),e.addClass("updatedText"))}))}function i(e){var t=$("#"+e),i=new Array;return i.push({name:"langlocale",value:t.data("langlocale")}),i.push({name:"idAndNameOnly",value:!0}),$("form#"+e+"_form input[name='m_category_ids[]']").each((function(){i.push({name:"categoriesChecked[]",value:$(this).val()})})),i}return{initCategoryTree:function(o,a){a=null==a?null:a;var s=$("#"+o);s.jstree({core:{multiple:!1,check_callback:!0,animation:500,themes:{name:"proton",responsive:!1,icons:!1},dblclick_toggle:!1,data:{cache:!1,data:i(o),url:"/melis/MelisCommerce/MelisComCategoryList/getCategoryTreeView"}},types:{default:{icon:"fa fa-circle text-success"},selected:{select_node:!1}},checkbox:{three_state:!1,whole_node:!1,tie_selection:!1},plugins:["search","types","checkbox"]}).on("check_node.jstree uncheck_node.jstree",(function(e,t){var i=$("#"+o+"_form").data("input-field-selected");t.node.state.checked?$("#"+o+"_form").append('<input type="hidden" name="'+i+'[]" value="'+t.node.original.cat_id+'">'):$("#"+o+"_form input[name='"+i+"[]'][value='"+t.node.original.cat_id+"']").remove()})).on("select_node.jstree deselect_node.jstree ",(function(e,t){var i=$("#"+o+"_form").data("input-field-root");t.node.state.selected&&$("#"+o+"_form input[name='"+i+"']").val(t.node.original.cat_id)})).on("after_open.jstree",(function(i,a){e(o),t(o)})).on("loaded.jstree",(function(e,t){!function(e){var t=$("#"+e);$("#catPrdSliderPluginSearch").on("keyup",(function(i){var o=$(this).val().trim(),a=t.jstree("search",o);setTimeout((function(){0==$(a).find(".jstree-search").length&&""!=o?($("#"+e).prev("div.alert").removeClass("hidden"),$("#"+e).prev("div.alert").find("strong").text(o)):$("#"+e).prev("div.alert").addClass("hidden")}),1500)})),$("#catPrdSliderPluginClearBtn").on("click",(function(i){$("#catPrdSliderPluginSearch").val(""),t.jstree("search",""),$("#"+e+"SearchNoResult").addClass("hidden")})),$("#catPrdSliderPluginExpandBtn").on("click",(function(e){t.jstree("open_all")})),$("#catPrdSliderPluginCollapseBtn").on("click",(function(e){t.jstree("close_all")})),$("#catPrdSliderPluginRefreshBtn").on("click",(function(e){t.jstree("search",""),$("#catPrdSliderPluginSearch").val(""),t.jstree(!0).refresh()})),$(".category-tree-view-lang-plugin li a").on("click",(function(){$(this);var o=$(this).text(),a=$(this).data("locale");$(".categoryLangTreePluginDropdown span.filter-key").text(o),t.data("langlocale",a),t.jstree(!0).settings.core.data.data=i(e),t.jstree(!0).refresh()}))}(o),null!==a&&a(e,t,s)})).on("refresh.jstree",(function(i,a){e(o),t(o)}))}}}();function widgetCollapsibleInit(){!function(e){e('.widget[data-toggle="collapse-widget"] .widget-body').on("show.bs.collapse",(function(){e(this).parents(".widget:first").attr("data-collapse-closed","false")})).on("shown.bs.collapse",(function(){setTimeout((function(){e(window).trigger("resize")}),500)})).on("hidden.bs.collapse",(function(){e(this).parents(".widget:first").attr("data-collapse-closed","true")})),e('.widget[data-toggle="collapse-widget"]').each((function(){e(this).find(".widget-head > .collapse-toggle").length||e('<span class="collapse-toggle"></span>').prependTo(e(this).find(".widget-head")),e(this).find(".widget-body").not(".collapse").addClass("collapse"),"true"!==e(this).attr("data-collapse-closed")&&e(this).find(".widget-body").addClass("in"),e(this).find(".accordionTitle").on("click",(function(){var t=e(".prices-accordion.active");e.each(t,(function(){e(this).find(".widget[data-collapse-closed=false]").find(".widget-body").collapse("toggle")})),e(this).parents(".widget:first").find(".widget-body").collapse("toggle")}))}))}(jQuery)}var contactToolSelectedAccount="",accountToolSelectedContact="",contactToolInitAccountAutoSuggest=!1,accountToolInitContactAutoSuggest=!1;!function(e,t){"use strict";"function"==typeof define&&define.amd?define("jquery-bridget/jquery-bridget",["jquery"],(function(i){t(e,i)})):"object"==typeof module&&module.exports?module.exports=t(e,require("jquery")):e.jQueryBridget=t(e,e.jQuery)}(window,(function(e,t){"use strict";function i(i,s,n){(n=n||t||e.jQuery)&&(s.prototype.option||(s.prototype.option=function(e){n.isPlainObject(e)&&(this.options=n.extend(!0,this.options,e))}),n.fn[i]=function(e){return"string"==typeof e?function(e,t,o){var a,s="$()."+i+'("'+t+'")';return e.each((function(e,l){var c=n.data(l,i);if(c){var d=c[t];if(d&&"_"!=t.charAt(0)){var h=d.apply(c,o);a=void 0===a?h:a}else r(s+" is not a valid method")}else r(i+" not initialized. Cannot call methods, i.e. "+s)})),void 0!==a?a:e}(this,e,a.call(arguments,1)):(function(e,t){e.each((function(e,o){var a=n.data(o,i);a?(a.option(t),a._init()):(a=new s(o,t),n.data(o,i,a))}))}(this,e),this)},o(n))}function o(e){!e||e&&e.bridget||(e.bridget=i)}var a=Array.prototype.slice,s=e.console,r=void 0===s?function(){}:function(e){s.error(e)};return o(t||e.jQuery),i})),function(e,t){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",t):"object"==typeof module&&module.exports?module.exports=t():e.EvEmitter=t()}("undefined"!=typeof window?window:this,(function(){function e(){}var t=e.prototype;return t.on=function(e,t){if(e&&t){var i=this._events=this._events||{},o=i[e]=i[e]||[];return-1==o.indexOf(t)&&o.push(t),this}},t.once=function(e,t){if(e&&t){this.on(e,t);var i=this._onceEvents=this._onceEvents||{};return(i[e]=i[e]||{})[t]=!0,this}},t.off=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){var o=i.indexOf(t);return-1!=o&&i.splice(o,1),this}},t.emitEvent=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){var o=0,a=i[o];t=t||[];for(var s=this._onceEvents&&this._onceEvents[e];a;){var r=s&&s[a];r&&(this.off(e,a),delete s[a]),a.apply(this,t),a=i[o+=r?0:1]}return this}},e})),function(e,t){"use strict";"function"==typeof define&&define.amd?define("get-size/get-size",[],(function(){return t()})):"object"==typeof module&&module.exports?module.exports=t():e.getSize=t()}(window,(function(){"use strict";function e(e){var t=parseFloat(e);return-1==e.indexOf("%")&&!isNaN(t)&&t}function t(e){var t=getComputedStyle(e);return t||s("Style returned "+t+". Are you running this code in a hidden iframe on Firefox? See http://bit.ly/getsizebug1"),t}function i(){if(!l){l=!0;var i=document.createElement("div");i.style.width="200px",i.style.padding="1px 2px 3px 4px",i.style.borderStyle="solid",i.style.borderWidth="1px 2px 3px 4px",i.style.boxSizing="border-box";var s=document.body||document.documentElement;s.appendChild(i);var r=t(i);o.isBoxSizeOuter=a=200==e(r.width),s.removeChild(i)}}function o(o){if(i(),"string"==typeof o&&(o=document.querySelector(o)),o&&"object"==typeof o&&o.nodeType){var s=t(o);if("none"==s.display)return function(){for(var e={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},t=0;n>t;t++)e[r[t]]=0;return e}();var l={};l.width=o.offsetWidth,l.height=o.offsetHeight;for(var c=l.isBorderBox="border-box"==s.boxSizing,d=0;n>d;d++){var h=r[d],m=s[h],u=parseFloat(m);l[h]=isNaN(u)?0:u}var _=l.paddingLeft+l.paddingRight,p=l.paddingTop+l.paddingBottom,f=l.marginLeft+l.marginRight,g=l.marginTop+l.marginBottom,v=l.borderLeftWidth+l.borderRightWidth,b=l.borderTopWidth+l.borderBottomWidth,y=c&&a,C=e(s.width);!1!==C&&(l.width=C+(y?0:_+v));var k=e(s.height);return!1!==k&&(l.height=k+(y?0:p+b)),l.innerWidth=l.width-(_+v),l.innerHeight=l.height-(p+b),l.outerWidth=l.width+f,l.outerHeight=l.height+g,l}}var a,s="undefined"==typeof console?function(){}:function(e){console.error(e)},r=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],n=r.length,l=!1;return o})),function(e,t){"use strict";"function"==typeof define&&define.amd?define("desandro-matches-selector/matches-selector",t):"object"==typeof module&&module.exports?module.exports=t():e.matchesSelector=t()}(window,(function(){"use strict";var e=function(){var e=Element.prototype;if(e.matches)return"matches";if(e.matchesSelector)return"matchesSelector";for(var t=["webkit","moz","ms","o"],i=0;i<t.length;i++){var o=t[i]+"MatchesSelector";if(e[o])return o}}();return function(t,i){return t[e](i)}})),function(e,t){"function"==typeof define&&define.amd?define("fizzy-ui-utils/utils",["desandro-matches-selector/matches-selector"],(function(i){return t(e,i)})):"object"==typeof module&&module.exports?module.exports=t(e,require("desandro-matches-selector")):e.fizzyUIUtils=t(e,e.matchesSelector)}(window,(function(e,t){var i={extend:function(e,t){for(var i in t)e[i]=t[i];return e},modulo:function(e,t){return(e%t+t)%t},makeArray:function(e){var t=[];if(Array.isArray(e))t=e;else if(e&&"number"==typeof e.length)for(var i=0;i<e.length;i++)t.push(e[i]);else t.push(e);return t},removeFrom:function(e,t){var i=e.indexOf(t);-1!=i&&e.splice(i,1)},getParent:function(e,i){for(;e!=document.body;)if(e=e.parentNode,t(e,i))return e},getQueryElement:function(e){return"string"==typeof e?document.querySelector(e):e},handleEvent:function(e){var t="on"+e.type;this[t]&&this[t](e)},filterFindElements:function(e,o){e=i.makeArray(e);var a=[];return e.forEach((function(e){if(e instanceof HTMLElement){if(!o)return void a.push(e);t(e,o)&&a.push(e);for(var i=e.querySelectorAll(o),s=0;s<i.length;s++)a.push(i[s])}})),a},debounceMethod:function(e,t,i){var o=e.prototype[t],a=t+"Timeout";e.prototype[t]=function(){var e=this[a];e&&clearTimeout(e);var t=arguments,s=this;this[a]=setTimeout((function(){o.apply(s,t),delete s[a]}),i||100)}},docReady:function(e){var t=document.readyState;"complete"==t||"interactive"==t?e():document.addEventListener("DOMContentLoaded",e)},toDashed:function(e){return e.replace(/(.)([A-Z])/g,(function(e,t,i){return t+"-"+i})).toLowerCase()}},o=e.console;return i.htmlInit=function(t,a){i.docReady((function(){var s=i.toDashed(a),r="data-"+s,n=document.querySelectorAll("["+r+"]"),l=document.querySelectorAll(".js-"+s),c=i.makeArray(n).concat(i.makeArray(l)),d=r+"-options",h=e.jQuery;c.forEach((function(e){var i,s=e.getAttribute(r)||e.getAttribute(d);try{i=s&&JSON.parse(s)}catch(t){return void(o&&o.error("Error parsing "+r+" on "+e.className+": "+t))}var n=new t(e,i);h&&h.data(e,a,n)}))}))},i})),function(e,t){"function"==typeof define&&define.amd?define("outlayer/item",["ev-emitter/ev-emitter","get-size/get-size"],t):"object"==typeof module&&module.exports?module.exports=t(require("ev-emitter"),require("get-size")):(e.Outlayer={},e.Outlayer.Item=t(e.EvEmitter,e.getSize))}(window,(function(e,t){"use strict";function i(e,t){e&&(this.element=e,this.layout=t,this.position={x:0,y:0},this._create())}var o=document.documentElement.style,a="string"==typeof o.transition?"transition":"WebkitTransition",s="string"==typeof o.transform?"transform":"WebkitTransform",r={WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[a],n={transform:s,transition:a,transitionDuration:a+"Duration",transitionProperty:a+"Property",transitionDelay:a+"Delay"},l=i.prototype=Object.create(e.prototype);l.constructor=i,l._create=function(){this._transn={ingProperties:{},clean:{},onEnd:{}},this.css({position:"absolute"})},l.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},l.getSize=function(){this.size=t(this.element)},l.css=function(e){var t=this.element.style;for(var i in e){t[n[i]||i]=e[i]}},l.getPosition=function(){var e=getComputedStyle(this.element),t=this.layout._getOption("originLeft"),i=this.layout._getOption("originTop"),o=e[t?"left":"right"],a=e[i?"top":"bottom"],s=this.layout.size,r=-1!=o.indexOf("%")?parseFloat(o)/100*s.width:parseInt(o,10),n=-1!=a.indexOf("%")?parseFloat(a)/100*s.height:parseInt(a,10);r=isNaN(r)?0:r,n=isNaN(n)?0:n,r-=t?s.paddingLeft:s.paddingRight,n-=i?s.paddingTop:s.paddingBottom,this.position.x=r,this.position.y=n},l.layoutPosition=function(){var e=this.layout.size,t={},i=this.layout._getOption("originLeft"),o=this.layout._getOption("originTop"),a=i?"paddingLeft":"paddingRight",s=i?"left":"right",r=i?"right":"left",n=this.position.x+e[a];t[s]=this.getXValue(n),t[r]="";var l=o?"paddingTop":"paddingBottom",c=o?"top":"bottom",d=o?"bottom":"top",h=this.position.y+e[l];t[c]=this.getYValue(h),t[d]="",this.css(t),this.emitEvent("layout",[this])},l.getXValue=function(e){var t=this.layout._getOption("horizontal");return this.layout.options.percentPosition&&!t?e/this.layout.size.width*100+"%":e+"px"},l.getYValue=function(e){var t=this.layout._getOption("horizontal");return this.layout.options.percentPosition&&t?e/this.layout.size.height*100+"%":e+"px"},l._transitionTo=function(e,t){this.getPosition();var i=this.position.x,o=this.position.y,a=parseInt(e,10),s=parseInt(t,10),r=a===this.position.x&&s===this.position.y;if(this.setPosition(e,t),!r||this.isTransitioning){var n=e-i,l=t-o,c={};c.transform=this.getTranslate(n,l),this.transition({to:c,onTransitionEnd:{transform:this.layoutPosition},isCleaning:!0})}else this.layoutPosition()},l.getTranslate=function(e,t){return"translate3d("+(e=this.layout._getOption("originLeft")?e:-e)+"px, "+(t=this.layout._getOption("originTop")?t:-t)+"px, 0)"},l.goTo=function(e,t){this.setPosition(e,t),this.layoutPosition()},l.moveTo=l._transitionTo,l.setPosition=function(e,t){this.position.x=parseInt(e,10),this.position.y=parseInt(t,10)},l._nonTransition=function(e){for(var t in this.css(e.to),e.isCleaning&&this._removeStyles(e.to),e.onTransitionEnd)e.onTransitionEnd[t].call(this)},l.transition=function(e){if(parseFloat(this.layout.options.transitionDuration)){var t=this._transn;for(var i in e.onTransitionEnd)t.onEnd[i]=e.onTransitionEnd[i];for(i in e.to)t.ingProperties[i]=!0,e.isCleaning&&(t.clean[i]=!0);if(e.from){this.css(e.from);this.element.offsetHeight;null}this.enableTransition(e.to),this.css(e.to),this.isTransitioning=!0}else this._nonTransition(e)};var c="opacity,"+function(e){return e.replace(/([A-Z])/g,(function(e){return"-"+e.toLowerCase()}))}(s);l.enableTransition=function(){if(!this.isTransitioning){var e=this.layout.options.transitionDuration;e="number"==typeof e?e+"ms":e,this.css({transitionProperty:c,transitionDuration:e,transitionDelay:this.staggerDelay||0}),this.element.addEventListener(r,this,!1)}},l.onwebkitTransitionEnd=function(e){this.ontransitionend(e)},l.onotransitionend=function(e){this.ontransitionend(e)};var d={"-webkit-transform":"transform"};l.ontransitionend=function(e){if(e.target===this.element){var t=this._transn,i=d[e.propertyName]||e.propertyName;if(delete t.ingProperties[i],function(e){for(var t in e)return!1;return!0}(t.ingProperties)&&this.disableTransition(),i in t.clean&&(this.element.style[e.propertyName]="",delete t.clean[i]),i in t.onEnd)t.onEnd[i].call(this),delete t.onEnd[i];this.emitEvent("transitionEnd",[this])}},l.disableTransition=function(){this.removeTransitionStyles(),this.element.removeEventListener(r,this,!1),this.isTransitioning=!1},l._removeStyles=function(e){var t={};for(var i in e)t[i]="";this.css(t)};var h={transitionProperty:"",transitionDuration:"",transitionDelay:""};return l.removeTransitionStyles=function(){this.css(h)},l.stagger=function(e){e=isNaN(e)?0:e,this.staggerDelay=e+"ms"},l.removeElem=function(){this.element.parentNode.removeChild(this.element),this.css({display:""}),this.emitEvent("remove",[this])},l.remove=function(){return a&&parseFloat(this.layout.options.transitionDuration)?(this.once("transitionEnd",(function(){this.removeElem()})),void this.hide()):void this.removeElem()},l.reveal=function(){delete this.isHidden,this.css({display:""});var e=this.layout.options,t={};t[this.getHideRevealTransitionEndProperty("visibleStyle")]=this.onRevealTransitionEnd,this.transition({from:e.hiddenStyle,to:e.visibleStyle,isCleaning:!0,onTransitionEnd:t})},l.onRevealTransitionEnd=function(){this.isHidden||this.emitEvent("reveal")},l.getHideRevealTransitionEndProperty=function(e){var t=this.layout.options[e];if(t.opacity)return"opacity";for(var i in t)return i},l.hide=function(){this.isHidden=!0,this.css({display:""});var e=this.layout.options,t={};t[this.getHideRevealTransitionEndProperty("hiddenStyle")]=this.onHideTransitionEnd,this.transition({from:e.visibleStyle,to:e.hiddenStyle,isCleaning:!0,onTransitionEnd:t})},l.onHideTransitionEnd=function(){this.isHidden&&(this.css({display:"none"}),this.emitEvent("hide"))},l.destroy=function(){this.css({position:"",left:"",right:"",top:"",bottom:"",transition:"",transform:""})},i})),function(e,t){"use strict";"function"==typeof define&&define.amd?define("outlayer/outlayer",["ev-emitter/ev-emitter","get-size/get-size","fizzy-ui-utils/utils","./item"],(function(i,o,a,s){return t(e,i,o,a,s)})):"object"==typeof module&&module.exports?module.exports=t(e,require("ev-emitter"),require("get-size"),require("fizzy-ui-utils"),require("./item")):e.Outlayer=t(e,e.EvEmitter,e.getSize,e.fizzyUIUtils,e.Outlayer.Item)}(window,(function(e,t,i,o,a){"use strict";function s(e,t){var i=o.getQueryElement(e);if(i){this.element=i,l&&(this.$element=l(this.element)),this.options=o.extend({},this.constructor.defaults),this.option(t);var a=++d;this.element.outlayerGUID=a,h[a]=this,this._create(),this._getOption("initLayout")&&this.layout()}else n&&n.error("Bad element for "+this.constructor.namespace+": "+(i||e))}function r(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}var n=e.console,l=e.jQuery,c=function(){},d=0,h={};s.namespace="outlayer",s.Item=a,s.defaults={containerStyle:{position:"relative"},initLayout:!0,originLeft:!0,originTop:!0,resize:!0,resizeContainer:!0,transitionDuration:"0.4s",hiddenStyle:{opacity:0,transform:"scale(0.001)"},visibleStyle:{opacity:1,transform:"scale(1)"}};var m=s.prototype;o.extend(m,t.prototype),m.option=function(e){o.extend(this.options,e)},m._getOption=function(e){var t=this.constructor.compatOptions[e];return t&&void 0!==this.options[t]?this.options[t]:this.options[e]},s.compatOptions={initLayout:"isInitLayout",horizontal:"isHorizontal",layoutInstant:"isLayoutInstant",originLeft:"isOriginLeft",originTop:"isOriginTop",resize:"isResizeBound",resizeContainer:"isResizingContainer"},m._create=function(){this.reloadItems(),this.stamps=[],this.stamp(this.options.stamp),o.extend(this.element.style,this.options.containerStyle),this._getOption("resize")&&this.bindResize()},m.reloadItems=function(){this.items=this._itemize(this.element.children)},m._itemize=function(e){for(var t=this._filterFindItemElements(e),i=this.constructor.Item,o=[],a=0;a<t.length;a++){var s=new i(t[a],this);o.push(s)}return o},m._filterFindItemElements=function(e){return o.filterFindElements(e,this.options.itemSelector)},m.getItemElements=function(){return this.items.map((function(e){return e.element}))},m.layout=function(){this._resetLayout(),this._manageStamps();var e=this._getOption("layoutInstant"),t=void 0!==e?e:!this._isLayoutInited;this.layoutItems(this.items,t),this._isLayoutInited=!0},m._init=m.layout,m._resetLayout=function(){this.getSize()},m.getSize=function(){this.size=i(this.element)},m._getMeasurement=function(e,t){var o,a=this.options[e];a?("string"==typeof a?o=this.element.querySelector(a):a instanceof HTMLElement&&(o=a),this[e]=o?i(o)[t]:a):this[e]=0},m.layoutItems=function(e,t){e=this._getItemsForLayout(e),this._layoutItems(e,t),this._postLayout()},m._getItemsForLayout=function(e){return e.filter((function(e){return!e.isIgnored}))},m._layoutItems=function(e,t){if(this._emitCompleteOnItems("layout",e),e&&e.length){var i=[];e.forEach((function(e){var o=this._getItemLayoutPosition(e);o.item=e,o.isInstant=t||e.isLayoutInstant,i.push(o)}),this),this._processLayoutQueue(i)}},m._getItemLayoutPosition=function(){return{x:0,y:0}},m._processLayoutQueue=function(e){this.updateStagger(),e.forEach((function(e,t){this._positionItem(e.item,e.x,e.y,e.isInstant,t)}),this)},m.updateStagger=function(){var e=this.options.stagger;return null==e?void(this.stagger=0):(this.stagger=function(e){if("number"==typeof e)return e;var t=e.match(/(^\d*\.?\d*)(\w*)/),i=t&&t[1],o=t&&t[2];return i.length?(i=parseFloat(i))*(u[o]||1):0}(e),this.stagger)},m._positionItem=function(e,t,i,o,a){o?e.goTo(t,i):(e.stagger(a*this.stagger),e.moveTo(t,i))},m._postLayout=function(){this.resizeContainer()},m.resizeContainer=function(){if(this._getOption("resizeContainer")){var e=this._getContainerSize();e&&(this._setContainerMeasure(e.width,!0),this._setContainerMeasure(e.height,!1))}},m._getContainerSize=c,m._setContainerMeasure=function(e,t){if(void 0!==e){var i=this.size;i.isBorderBox&&(e+=t?i.paddingLeft+i.paddingRight+i.borderLeftWidth+i.borderRightWidth:i.paddingBottom+i.paddingTop+i.borderTopWidth+i.borderBottomWidth),e=Math.max(e,0),this.element.style[t?"width":"height"]=e+"px"}},m._emitCompleteOnItems=function(e,t){function i(){a.dispatchEvent(e+"Complete",null,[t])}function o(){++r==s&&i()}var a=this,s=t.length;if(t&&s){var r=0;t.forEach((function(t){t.once(e,o)}))}else i()},m.dispatchEvent=function(e,t,i){var o=t?[t].concat(i):i;if(this.emitEvent(e,o),l)if(this.$element=this.$element||l(this.element),t){var a=l.Event(t);a.type=e,this.$element.trigger(a,i)}else this.$element.trigger(e,i)},m.ignore=function(e){var t=this.getItem(e);t&&(t.isIgnored=!0)},m.unignore=function(e){var t=this.getItem(e);t&&delete t.isIgnored},m.stamp=function(e){(e=this._find(e))&&(this.stamps=this.stamps.concat(e),e.forEach(this.ignore,this))},m.unstamp=function(e){(e=this._find(e))&&e.forEach((function(e){o.removeFrom(this.stamps,e),this.unignore(e)}),this)},m._find=function(e){return e?("string"==typeof e&&(e=this.element.querySelectorAll(e)),e=o.makeArray(e)):void 0},m._manageStamps=function(){this.stamps&&this.stamps.length&&(this._getBoundingRect(),this.stamps.forEach(this._manageStamp,this))},m._getBoundingRect=function(){var e=this.element.getBoundingClientRect(),t=this.size;this._boundingRect={left:e.left+t.paddingLeft+t.borderLeftWidth,top:e.top+t.paddingTop+t.borderTopWidth,right:e.right-(t.paddingRight+t.borderRightWidth),bottom:e.bottom-(t.paddingBottom+t.borderBottomWidth)}},m._manageStamp=c,m._getElementOffset=function(e){var t=e.getBoundingClientRect(),o=this._boundingRect,a=i(e);return{left:t.left-o.left-a.marginLeft,top:t.top-o.top-a.marginTop,right:o.right-t.right-a.marginRight,bottom:o.bottom-t.bottom-a.marginBottom}},m.handleEvent=o.handleEvent,m.bindResize=function(){e.addEventListener("resize",this),this.isResizeBound=!0},m.unbindResize=function(){e.removeEventListener("resize",this),this.isResizeBound=!1},m.onresize=function(){this.resize()},o.debounceMethod(s,"onresize",100),m.resize=function(){this.isResizeBound&&this.needsResizeLayout()&&this.layout()},m.needsResizeLayout=function(){var e=i(this.element);return this.size&&e&&e.innerWidth!==this.size.innerWidth},m.addItems=function(e){var t=this._itemize(e);return t.length&&(this.items=this.items.concat(t)),t},m.appended=function(e){var t=this.addItems(e);t.length&&(this.layoutItems(t,!0),this.reveal(t))},m.prepended=function(e){var t=this._itemize(e);if(t.length){var i=this.items.slice(0);this.items=t.concat(i),this._resetLayout(),this._manageStamps(),this.layoutItems(t,!0),this.reveal(t),this.layoutItems(i)}},m.reveal=function(e){if(this._emitCompleteOnItems("reveal",e),e&&e.length){var t=this.updateStagger();e.forEach((function(e,i){e.stagger(i*t),e.reveal()}))}},m.hide=function(e){if(this._emitCompleteOnItems("hide",e),e&&e.length){var t=this.updateStagger();e.forEach((function(e,i){e.stagger(i*t),e.hide()}))}},m.revealItemElements=function(e){var t=this.getItems(e);this.reveal(t)},m.hideItemElements=function(e){var t=this.getItems(e);this.hide(t)},m.getItem=function(e){for(var t=0;t<this.items.length;t++){var i=this.items[t];if(i.element==e)return i}},m.getItems=function(e){e=o.makeArray(e);var t=[];return e.forEach((function(e){var i=this.getItem(e);i&&t.push(i)}),this),t},m.remove=function(e){var t=this.getItems(e);this._emitCompleteOnItems("remove",t),t&&t.length&&t.forEach((function(e){e.remove(),o.removeFrom(this.items,e)}),this)},m.destroy=function(){var e=this.element.style;e.height="",e.position="",e.width="",this.items.forEach((function(e){e.destroy()})),this.unbindResize();var t=this.element.outlayerGUID;delete h[t],delete this.element.outlayerGUID,l&&l.removeData(this.element,this.constructor.namespace)},s.data=function(e){var t=(e=o.getQueryElement(e))&&e.outlayerGUID;return t&&h[t]},s.create=function(e,t){var i=r(s);return i.defaults=o.extend({},s.defaults),o.extend(i.defaults,t),i.compatOptions=o.extend({},s.compatOptions),i.namespace=e,i.data=s.data,i.Item=r(a),o.htmlInit(i,e),l&&l.bridget&&l.bridget(e,i),i};var u={ms:1,s:1e3};return s.Item=a,s})),function(e,t){"function"==typeof define&&define.amd?define("isotope/js/item",["outlayer/outlayer"],t):"object"==typeof module&&module.exports?module.exports=t(require("outlayer")):(e.Isotope=e.Isotope||{},e.Isotope.Item=t(e.Outlayer))}(window,(function(e){"use strict";function t(){e.Item.apply(this,arguments)}var i=t.prototype=Object.create(e.Item.prototype),o=i._create;i._create=function(){this.id=this.layout.itemGUID++,o.call(this),this.sortData={}},i.updateSortData=function(){if(!this.isIgnored){this.sortData.id=this.id,this.sortData["original-order"]=this.id,this.sortData.random=Math.random();var e=this.layout.options.getSortData,t=this.layout._sorters;for(var i in e){var o=t[i];this.sortData[i]=o(this.element,this)}}};var a=i.destroy;return i.destroy=function(){a.apply(this,arguments),this.css({display:""})},t})),function(e,t){"function"==typeof define&&define.amd?define("isotope/js/layout-mode",["get-size/get-size","outlayer/outlayer"],t):"object"==typeof module&&module.exports?module.exports=t(require("get-size"),require("outlayer")):(e.Isotope=e.Isotope||{},e.Isotope.LayoutMode=t(e.getSize,e.Outlayer))}(window,(function(e,t){"use strict";function i(e){this.isotope=e,e&&(this.options=e.options[this.namespace],this.element=e.element,this.items=e.filteredItems,this.size=e.size)}var o=i.prototype;return["_resetLayout","_getItemLayoutPosition","_manageStamp","_getContainerSize","_getElementOffset","needsResizeLayout","_getOption"].forEach((function(e){o[e]=function(){return t.prototype[e].apply(this.isotope,arguments)}})),o.needsVerticalResizeLayout=function(){var t=e(this.isotope.element);return this.isotope.size&&t&&t.innerHeight!=this.isotope.size.innerHeight},o._getMeasurement=function(){this.isotope._getMeasurement.apply(this,arguments)},o.getColumnWidth=function(){this.getSegmentSize("column","Width")},o.getRowHeight=function(){this.getSegmentSize("row","Height")},o.getSegmentSize=function(e,t){var i=e+t,o="outer"+t;if(this._getMeasurement(i,o),!this[i]){var a=this.getFirstItemSize();this[i]=a&&a[o]||this.isotope.size["inner"+t]}},o.getFirstItemSize=function(){var t=this.isotope.filteredItems[0];return t&&t.element&&e(t.element)},o.layout=function(){this.isotope.layout.apply(this.isotope,arguments)},o.getSize=function(){this.isotope.getSize(),this.size=this.isotope.size},i.modes={},i.create=function(e,t){function a(){i.apply(this,arguments)}return a.prototype=Object.create(o),a.prototype.constructor=a,t&&(a.options=t),a.prototype.namespace=e,i.modes[e]=a,a},i})),function(e,t){"function"==typeof define&&define.amd?define("masonry/masonry",["outlayer/outlayer","get-size/get-size"],t):"object"==typeof module&&module.exports?module.exports=t(require("outlayer"),require("get-size")):e.Masonry=t(e.Outlayer,e.getSize)}(window,(function(e,t){var i=e.create("masonry");return i.compatOptions.fitWidth="isFitWidth",i.prototype._resetLayout=function(){this.getSize(),this._getMeasurement("columnWidth","outerWidth"),this._getMeasurement("gutter","outerWidth"),this.measureColumns(),this.colYs=[];for(var e=0;e<this.cols;e++)this.colYs.push(0);this.maxY=0},i.prototype.measureColumns=function(){if(this.getContainerWidth(),!this.columnWidth){var e=this.items[0],i=e&&e.element;this.columnWidth=i&&t(i).outerWidth||this.containerWidth}var o=this.columnWidth+=this.gutter,a=this.containerWidth+this.gutter,s=a/o,r=o-a%o;s=Math[r&&1>r?"round":"floor"](s),this.cols=Math.max(s,1)},i.prototype.getContainerWidth=function(){var e=this._getOption("fitWidth")?this.element.parentNode:this.element,i=t(e);this.containerWidth=i&&i.innerWidth},i.prototype._getItemLayoutPosition=function(e){e.getSize();var t=e.size.outerWidth%this.columnWidth,i=Math[t&&1>t?"round":"ceil"](e.size.outerWidth/this.columnWidth);i=Math.min(i,this.cols);for(var o=this._getColGroup(i),a=Math.min.apply(Math,o),s=o.indexOf(a),r={x:this.columnWidth*s,y:a},n=a+e.size.outerHeight,l=this.cols+1-o.length,c=0;l>c;c++)this.colYs[s+c]=n;return r},i.prototype._getColGroup=function(e){if(2>e)return this.colYs;for(var t=[],i=this.cols+1-e,o=0;i>o;o++){var a=this.colYs.slice(o,o+e);t[o]=Math.max.apply(Math,a)}return t},i.prototype._manageStamp=function(e){var i=t(e),o=this._getElementOffset(e),a=this._getOption("originLeft")?o.left:o.right,s=a+i.outerWidth,r=Math.floor(a/this.columnWidth);r=Math.max(0,r);var n=Math.floor(s/this.columnWidth);n-=s%this.columnWidth?0:1,n=Math.min(this.cols-1,n);for(var l=(this._getOption("originTop")?o.top:o.bottom)+i.outerHeight,c=r;n>=c;c++)this.colYs[c]=Math.max(l,this.colYs[c])},i.prototype._getContainerSize=function(){this.maxY=Math.max.apply(Math,this.colYs);var e={height:this.maxY};return this._getOption("fitWidth")&&(e.width=this._getContainerFitWidth()),e},i.prototype._getContainerFitWidth=function(){for(var e=0,t=this.cols;--t&&0===this.colYs[t];)e++;return(this.cols-e)*this.columnWidth-this.gutter},i.prototype.needsResizeLayout=function(){var e=this.containerWidth;return this.getContainerWidth(),e!=this.containerWidth},i})),function(e,t){"function"==typeof define&&define.amd?define("isotope/js/layout-modes/masonry",["../layout-mode","masonry/masonry"],t):"object"==typeof module&&module.exports?module.exports=t(require("../layout-mode"),require("masonry-layout")):t(e.Isotope.LayoutMode,e.Masonry)}(window,(function(e,t){"use strict";var i=e.create("masonry"),o=i.prototype,a={_getElementOffset:!0,layout:!0,_getMeasurement:!0};for(var s in t.prototype)a[s]||(o[s]=t.prototype[s]);var r=o.measureColumns;o.measureColumns=function(){this.items=this.isotope.filteredItems,r.call(this)};var n=o._getOption;return o._getOption=function(e){return"fitWidth"==e?void 0!==this.options.isFitWidth?this.options.isFitWidth:this.options.fitWidth:n.apply(this.isotope,arguments)},i})),function(e,t){"function"==typeof define&&define.amd?define("isotope/js/layout-modes/fit-rows",["../layout-mode"],t):"object"==typeof exports?module.exports=t(require("../layout-mode")):t(e.Isotope.LayoutMode)}(window,(function(e){"use strict";var t=e.create("fitRows"),i=t.prototype;return i._resetLayout=function(){this.x=0,this.y=0,this.maxY=0,this._getMeasurement("gutter","outerWidth")},i._getItemLayoutPosition=function(e){e.getSize();var t=e.size.outerWidth+this.gutter,i=this.isotope.size.innerWidth+this.gutter;0!==this.x&&t+this.x>i&&(this.x=0,this.y=this.maxY);var o={x:this.x,y:this.y};return this.maxY=Math.max(this.maxY,this.y+e.size.outerHeight),this.x+=t,o},i._getContainerSize=function(){return{height:this.maxY}},t})),function(e,t){"function"==typeof define&&define.amd?define("isotope/js/layout-modes/vertical",["../layout-mode"],t):"object"==typeof module&&module.exports?module.exports=t(require("../layout-mode")):t(e.Isotope.LayoutMode)}(window,(function(e){"use strict";var t=e.create("vertical",{horizontalAlignment:0}),i=t.prototype;return i._resetLayout=function(){this.y=0},i._getItemLayoutPosition=function(e){e.getSize();var t=(this.isotope.size.innerWidth-e.size.outerWidth)*this.options.horizontalAlignment,i=this.y;return this.y+=e.size.outerHeight,{x:t,y:i}},i._getContainerSize=function(){return{height:this.y}},t})),function(e,t){"function"==typeof define&&define.amd?define(["outlayer/outlayer","get-size/get-size","desandro-matches-selector/matches-selector","fizzy-ui-utils/utils","isotope/js/item","isotope/js/layout-mode","isotope/js/layout-modes/masonry","isotope/js/layout-modes/fit-rows","isotope/js/layout-modes/vertical"],(function(i,o,a,s,r,n){return t(e,i,o,a,s,r,n)})):"object"==typeof module&&module.exports?module.exports=t(e,require("outlayer"),require("get-size"),require("desandro-matches-selector"),require("fizzy-ui-utils"),require("isotope/js/item"),require("isotope/js/layout-mode"),require("isotope/js/layout-modes/masonry"),require("isotope/js/layout-modes/fit-rows"),require("isotope/js/layout-modes/vertical")):e.Isotope=t(e,e.Outlayer,e.getSize,e.matchesSelector,e.fizzyUIUtils,e.Isotope.Item,e.Isotope.LayoutMode)}(window,(function(e,t,i,o,a,s,r){var n=e.jQuery,l=String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(/^\s+|\s+$/g,"")},c=t.create("isotope",{layoutMode:"masonry",isJQueryFiltering:!0,sortAscending:!0});c.Item=s,c.LayoutMode=r;var d=c.prototype;d._create=function(){for(var e in this.itemGUID=0,this._sorters={},this._getSorters(),t.prototype._create.call(this),this.modes={},this.filteredItems=this.items,this.sortHistory=["original-order"],r.modes)this._initLayoutMode(e)},d.reloadItems=function(){this.itemGUID=0,t.prototype.reloadItems.call(this)},d._itemize=function(){for(var e=t.prototype._itemize.apply(this,arguments),i=0;i<e.length;i++){e[i].id=this.itemGUID++}return this._updateItemsSortData(e),e},d._initLayoutMode=function(e){var t=r.modes[e],i=this.options[e]||{};this.options[e]=t.options?a.extend(t.options,i):i,this.modes[e]=new t(this)},d.layout=function(){return!this._isLayoutInited&&this._getOption("initLayout")?void this.arrange():void this._layout()},d._layout=function(){var e=this._getIsInstant();this._resetLayout(),this._manageStamps(),this.layoutItems(this.filteredItems,e),this._isLayoutInited=!0},d.arrange=function(e){this.option(e),this._getIsInstant();var t=this._filter(this.items);this.filteredItems=t.matches,this._bindArrangeComplete(),this._isInstant?this._noTransition(this._hideReveal,[t]):this._hideReveal(t),this._sort(),this._layout()},d._init=d.arrange,d._hideReveal=function(e){this.reveal(e.needReveal),this.hide(e.needHide)},d._getIsInstant=function(){var e=this._getOption("layoutInstant"),t=void 0!==e?e:!this._isLayoutInited;return this._isInstant=t,t},d._bindArrangeComplete=function(){function e(){t&&i&&o&&a.dispatchEvent("arrangeComplete",null,[a.filteredItems])}var t,i,o,a=this;this.once("layoutComplete",(function(){t=!0,e()})),this.once("hideComplete",(function(){i=!0,e()})),this.once("revealComplete",(function(){o=!0,e()}))},d._filter=function(e){var t=this.options.filter;t=t||"*";for(var i=[],o=[],a=[],s=this._getFilterTest(t),r=0;r<e.length;r++){var n=e[r];if(!n.isIgnored){var l=s(n);l&&i.push(n),l&&n.isHidden?o.push(n):l||n.isHidden||a.push(n)}}return{matches:i,needReveal:o,needHide:a}},d._getFilterTest=function(e){return n&&this.options.isJQueryFiltering?function(t){return n(t.element).is(e)}:"function"==typeof e?function(t){return e(t.element)}:function(t){return o(t.element,e)}},d.updateSortData=function(e){var t;e?(e=a.makeArray(e),t=this.getItems(e)):t=this.items,this._getSorters(),this._updateItemsSortData(t)},d._getSorters=function(){var e=this.options.getSortData;for(var t in e){var i=e[t];this._sorters[t]=h(i)}},d._updateItemsSortData=function(e){for(var t=e&&e.length,i=0;t&&t>i;i++){e[i].updateSortData()}};var h=function(e){if("string"!=typeof e)return e;var t=l(e).split(" "),i=t[0],o=i.match(/^\[(.+)\]$/),a=function(e,t){return e?function(t){return t.getAttribute(e)}:function(e){var i=e.querySelector(t);return i&&i.textContent}}(o&&o[1],i),s=c.sortDataParsers[t[1]];return s?function(e){return e&&s(a(e))}:function(e){return e&&a(e)}};c.sortDataParsers={parseInt:function(e){return parseInt(e,10)},parseFloat:function(e){return parseFloat(e)}},d._sort=function(){var e=this.options.sortBy;if(e){var t=function(e,t){return function(i,o){for(var a=0;a<e.length;a++){var s=e[a],r=i.sortData[s],n=o.sortData[s];if(r>n||n>r)return(r>n?1:-1)*((void 0!==t[s]?t[s]:t)?1:-1)}return 0}}([].concat.apply(e,this.sortHistory),this.options.sortAscending);this.filteredItems.sort(t),e!=this.sortHistory[0]&&this.sortHistory.unshift(e)}},d._mode=function(){var e=this.options.layoutMode,t=this.modes[e];if(!t)throw new Error("No layout mode: "+e);return t.options=this.options[e],t},d._resetLayout=function(){t.prototype._resetLayout.call(this),this._mode()._resetLayout()},d._getItemLayoutPosition=function(e){return this._mode()._getItemLayoutPosition(e)},d._manageStamp=function(e){this._mode()._manageStamp(e)},d._getContainerSize=function(){return this._mode()._getContainerSize()},d.needsResizeLayout=function(){return this._mode().needsResizeLayout()},d.appended=function(e){var t=this.addItems(e);if(t.length){var i=this._filterRevealAdded(t);this.filteredItems=this.filteredItems.concat(i)}},d.prepended=function(e){var t=this._itemize(e);if(t.length){this._resetLayout(),this._manageStamps();var i=this._filterRevealAdded(t);this.layoutItems(this.filteredItems),this.filteredItems=i.concat(this.filteredItems),this.items=t.concat(this.items)}},d._filterRevealAdded=function(e){var t=this._filter(e);return this.hide(t.needHide),this.reveal(t.matches),this.layoutItems(t.matches,!0),t.matches},d.insert=function(e){var t=this.addItems(e);if(t.length){var i,o,a=t.length;for(i=0;a>i;i++)o=t[i],this.element.appendChild(o.element);var s=this._filter(t).matches;for(i=0;a>i;i++)t[i].isLayoutInstant=!0;for(this.arrange(),i=0;a>i;i++)delete t[i].isLayoutInstant;this.reveal(s)}};var m=d.remove;return d.remove=function(e){e=a.makeArray(e);var t=this.getItems(e);m.call(this,e);for(var i=t&&t.length,o=0;i&&i>o;o++){var s=t[o];a.removeFrom(this.filteredItems,s)}},d.shuffle=function(){for(var e=0;e<this.items.length;e++){this.items[e].sortData.random=Math.random()}this.options.sortBy="random",this._sort(),this._layout()},d._noTransition=function(e,t){var i=this.options.transitionDuration;this.options.transitionDuration=0;var o=e.apply(this,t);return this.options.transitionDuration=i,o},d.getFilteredItemElements=function(){return this.filteredItems.map((function(e){return e.element}))},c})),function(e,t){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",t):"object"==typeof module&&module.exports?module.exports=t():e.EvEmitter=t()}(this,(function(){function e(){}var t=e.prototype;return t.on=function(e,t){if(e&&t){var i=this._events=this._events||{},o=i[e]=i[e]||[];return-1==o.indexOf(t)&&o.push(t),this}},t.once=function(e,t){if(e&&t){this.on(e,t);var i=this._onceEvents=this._onceEvents||{};return(i[e]=i[e]||[])[t]=!0,this}},t.off=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){var o=i.indexOf(t);return-1!=o&&i.splice(o,1),this}},t.emitEvent=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){var o=0,a=i[o];t=t||[];for(var s=this._onceEvents&&this._onceEvents[e];a;){var r=s&&s[a];r&&(this.off(e,a),delete s[a]),a.apply(this,t),a=i[o+=r?0:1]}return this}},e})),function(e,t){"use strict";"function"==typeof define&&define.amd?define(["ev-emitter/ev-emitter"],(function(i){return t(e,i)})):"object"==typeof module&&module.exports?module.exports=t(e,require("ev-emitter")):e.imagesLoaded=t(e,e.EvEmitter)}(window,(function(e,t){function i(e,t){for(var i in t)e[i]=t[i];return e}function o(e,t,a){return this instanceof o?("string"==typeof e&&(e=document.querySelectorAll(e)),this.elements=function(e){var t=[];if(Array.isArray(e))t=e;else if("number"==typeof e.length)for(var i=0;i<e.length;i++)t.push(e[i]);else t.push(e);return t}(e),this.options=i({},this.options),"function"==typeof t?a=t:i(this.options,t),a&&this.on("always",a),this.getImages(),r&&(this.jqDeferred=new r.Deferred),void setTimeout(function(){this.check()}.bind(this))):new o(e,t,a)}function a(e){this.img=e}function s(e,t){this.url=e,this.element=t,this.img=new Image}var r=e.jQuery,n=e.console;o.prototype=Object.create(t.prototype),o.prototype.options={},o.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)},o.prototype.addElementImages=function(e){"IMG"==e.nodeName&&this.addImage(e),!0===this.options.background&&this.addElementBackgroundImages(e);var t=e.nodeType;if(t&&l[t]){for(var i=e.querySelectorAll("img"),o=0;o<i.length;o++){var a=i[o];this.addImage(a)}if("string"==typeof this.options.background){var s=e.querySelectorAll(this.options.background);for(o=0;o<s.length;o++){var r=s[o];this.addElementBackgroundImages(r)}}}};var l={1:!0,9:!0,11:!0};return o.prototype.addElementBackgroundImages=function(e){var t=getComputedStyle(e);if(t)for(var i=/url\((['"])?(.*?)\1\)/gi,o=i.exec(t.backgroundImage);null!==o;){var a=o&&o[2];a&&this.addBackground(a,e),o=i.exec(t.backgroundImage)}},o.prototype.addImage=function(e){var t=new a(e);this.images.push(t)},o.prototype.addBackground=function(e,t){var i=new s(e,t);this.images.push(i)},o.prototype.check=function(){function e(e,i,o){setTimeout((function(){t.progress(e,i,o)}))}var t=this;return this.progressedCount=0,this.hasAnyBroken=!1,this.images.length?void this.images.forEach((function(t){t.once("progress",e),t.check()})):void this.complete()},o.prototype.progress=function(e,t,i){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded,this.emitEvent("progress",[this,e,t]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,e),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&n&&n.log("progress: "+i,e,t)},o.prototype.complete=function(){var e=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(e,[this]),this.emitEvent("always",[this]),this.jqDeferred){var t=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[t](this)}},a.prototype=Object.create(t.prototype),a.prototype.check=function(){return this.getIsImageComplete()?void this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(this.proxyImage=new Image,this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),void(this.proxyImage.src=this.img.src))},a.prototype.getIsImageComplete=function(){return this.img.complete&&void 0!==this.img.naturalWidth},a.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.img,t])},a.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},a.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},a.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},a.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},s.prototype=Object.create(a.prototype),s.prototype.check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url,this.getIsImageComplete()&&(this.confirm(0!==this.img.naturalWidth,"naturalWidth"),this.unbindEvents())},s.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},s.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.element,t])},o.makeJQueryPlugin=function(t){(t=t||e.jQuery)&&((r=t).fn.imagesLoaded=function(e,t){return new o(this,e,t).jqDeferred.promise(r(this))})},o.makeJQueryPlugin(),o})),function(e,t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):e.lightbox=t(e.jQuery)}(this,(function(e){function t(t){this.album=[],this.currentImageIndex=void 0,this.init(),this.options=e.extend({},this.constructor.defaults),this.option(t)}return t.defaults={albumLabel:"Image %1 of %2",alwaysShowNavOnTouchDevices:!1,fadeDuration:500,fitImagesInViewport:!0,positionFromTop:50,resizeDuration:700,showImageNumberLabel:!0,wrapAround:!1,disableScrolling:!1},t.prototype.option=function(t){e.extend(this.options,t)},t.prototype.imageCountLabel=function(e,t){return this.options.albumLabel.replace(/%1/g,e).replace(/%2/g,t)},t.prototype.init=function(){this.enable(),this.build()},t.prototype.enable=function(){var t=this;e("body").on("click","a[rel^=lightbox], area[rel^=lightbox], a[data-lightbox], area[data-lightbox]",(function(i){return t.start(e(i.currentTarget)),!1}))},t.prototype.build=function(){var t=this;e('<div id="lightboxOverlay" class="lightboxOverlay"></div><div id="lightbox" class="lightbox"><div class="lb-outerContainer"><div class="lb-container"><img class="lb-image" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" /><div class="lb-nav"><a class="lb-prev" href="" ></a><a class="lb-next" href="" ></a></div><div class="lb-loader"><a class="lb-cancel"></a></div></div></div><div class="lb-dataContainer"><div class="lb-data"><div class="lb-details"><span class="lb-caption"></span><span class="lb-number"></span></div><div class="lb-closeContainer"><a class="lb-close"></a></div></div></div></div>').appendTo(e("body")),this.$lightbox=e("#lightbox"),this.$overlay=e("#lightboxOverlay"),this.$outerContainer=this.$lightbox.find(".lb-outerContainer"),this.$container=this.$lightbox.find(".lb-container"),this.containerTopPadding=parseInt(this.$container.css("padding-top"),10),this.containerRightPadding=parseInt(this.$container.css("padding-right"),10),this.containerBottomPadding=parseInt(this.$container.css("padding-bottom"),10),this.containerLeftPadding=parseInt(this.$container.css("padding-left"),10),this.$overlay.hide().on("click",(function(){return t.end(),!1})),this.$lightbox.hide().on("click",(function(i){return"lightbox"===e(i.target).attr("id")&&t.end(),!1})),this.$outerContainer.on("click",(function(i){return"lightbox"===e(i.target).attr("id")&&t.end(),!1})),this.$lightbox.find(".lb-prev").on("click",(function(){return 0===t.currentImageIndex?t.changeImage(t.album.length-1):t.changeImage(t.currentImageIndex-1),!1})),this.$lightbox.find(".lb-next").on("click",(function(){return t.currentImageIndex===t.album.length-1?t.changeImage(0):t.changeImage(t.currentImageIndex+1),!1})),this.$lightbox.find(".lb-loader, .lb-close").on("click",(function(){return t.end(),!1}))},t.prototype.start=function(t){var i=this,o=e(window);o.on("resize",e.proxy(this.sizeOverlay,this)),e("select, object, embed").css({visibility:"hidden"}),this.sizeOverlay(),this.album=[];var a=0;function s(e){i.album.push({link:e.attr("href"),title:e.attr("data-title")||e.attr("title")})}var r,n=t.attr("data-lightbox");if(n){r=e(t.prop("tagName")+'[data-lightbox="'+n+'"]');for(var l=0;l<r.length;l=++l)s(e(r[l])),r[l]===t[0]&&(a=l)}else if("lightbox"===t.attr("rel"))s(t);else{r=e(t.prop("tagName")+'[rel="'+t.attr("rel")+'"]');for(var c=0;c<r.length;c=++c)s(e(r[c])),r[c]===t[0]&&(a=c)}var d=o.scrollTop()+this.options.positionFromTop,h=o.scrollLeft();this.$lightbox.css({top:d+"px",left:h+"px"}).fadeIn(this.options.fadeDuration),this.options.disableScrolling&&e("body").addClass("lb-disable-scrolling"),this.changeImage(a)},t.prototype.changeImage=function(t){var i=this;this.disableKeyboardNav();var o=this.$lightbox.find(".lb-image");this.$overlay.fadeIn(this.options.fadeDuration),e(".lb-loader").fadeIn("slow"),this.$lightbox.find(".lb-image, .lb-nav, .lb-prev, .lb-next, .lb-dataContainer, .lb-numbers, .lb-caption").hide(),this.$outerContainer.addClass("animating");var a=new Image;a.onload=function(){var s,r,n,l,c,d;o.attr("src",i.album[t].link),e(a),o.width(a.width),o.height(a.height),i.options.fitImagesInViewport&&(d=e(window).width(),c=e(window).height(),l=d-i.containerLeftPadding-i.containerRightPadding-20,n=c-i.containerTopPadding-i.containerBottomPadding-120,i.options.maxWidth&&i.options.maxWidth<l&&(l=i.options.maxWidth),i.options.maxHeight&&i.options.maxHeight<l&&(n=i.options.maxHeight),(a.width>l||a.height>n)&&(a.width/l>a.height/n?(r=l,s=parseInt(a.height/(a.width/r),10),o.width(r),o.height(s)):(s=n,r=parseInt(a.width/(a.height/s),10),o.width(r),o.height(s)))),i.sizeContainer(o.width(),o.height())},a.src=this.album[t].link,this.currentImageIndex=t},t.prototype.sizeOverlay=function(){this.$overlay.width(e(document).width()).height(e(document).height())},t.prototype.sizeContainer=function(e,t){var i=this,o=this.$outerContainer.outerWidth(),a=this.$outerContainer.outerHeight(),s=e+this.containerLeftPadding+this.containerRightPadding,r=t+this.containerTopPadding+this.containerBottomPadding;function n(){i.$lightbox.find(".lb-dataContainer").width(s),i.$lightbox.find(".lb-prevLink").height(r),i.$lightbox.find(".lb-nextLink").height(r),i.showImage()}o!==s||a!==r?this.$outerContainer.animate({width:s,height:r},this.options.resizeDuration,"swing",(function(){n()})):n()},t.prototype.showImage=function(){this.$lightbox.find(".lb-loader").stop(!0).hide(),this.$lightbox.find(".lb-image").fadeIn("slow"),this.updateNav(),this.updateDetails(),this.preloadNeighboringImages(),this.enableKeyboardNav()},t.prototype.updateNav=function(){var e=!1;try{document.createEvent("TouchEvent"),e=!!this.options.alwaysShowNavOnTouchDevices}catch(e){}this.$lightbox.find(".lb-nav").show(),this.album.length>1&&(this.options.wrapAround?(e&&this.$lightbox.find(".lb-prev, .lb-next").css("opacity","1"),this.$lightbox.find(".lb-prev, .lb-next").show()):(this.currentImageIndex>0&&(this.$lightbox.find(".lb-prev").show(),e&&this.$lightbox.find(".lb-prev").css("opacity","1")),this.currentImageIndex<this.album.length-1&&(this.$lightbox.find(".lb-next").show(),e&&this.$lightbox.find(".lb-next").css("opacity","1"))))},t.prototype.updateDetails=function(){var t=this;if(void 0!==this.album[this.currentImageIndex].title&&""!==this.album[this.currentImageIndex].title&&this.$lightbox.find(".lb-caption").html(this.album[this.currentImageIndex].title).fadeIn("fast").find("a").on("click",(function(t){void 0!==e(this).attr("target")?window.open(e(this).attr("href"),e(this).attr("target")):location.href=e(this).attr("href")})),this.album.length>1&&this.options.showImageNumberLabel){var i=this.imageCountLabel(this.currentImageIndex+1,this.album.length);this.$lightbox.find(".lb-number").text(i).fadeIn("fast")}else this.$lightbox.find(".lb-number").hide();this.$outerContainer.removeClass("animating"),this.$lightbox.find(".lb-dataContainer").fadeIn(this.options.resizeDuration,(function(){return t.sizeOverlay()}))},t.prototype.preloadNeighboringImages=function(){this.album.length>this.currentImageIndex+1&&((new Image).src=this.album[this.currentImageIndex+1].link);this.currentImageIndex>0&&((new Image).src=this.album[this.currentImageIndex-1].link)},t.prototype.enableKeyboardNav=function(){e(document).on("keyup.keyboard",e.proxy(this.keyboardAction,this))},t.prototype.disableKeyboardNav=function(){e(document).off(".keyboard")},t.prototype.keyboardAction=function(e){var t=e.keyCode,i=String.fromCharCode(t).toLowerCase();27===t||i.match(/x|o|c/)?this.end():"p"===i||37===t?0!==this.currentImageIndex?this.changeImage(this.currentImageIndex-1):this.options.wrapAround&&this.album.length>1&&this.changeImage(this.album.length-1):"n"!==i&&39!==t||(this.currentImageIndex!==this.album.length-1?this.changeImage(this.currentImageIndex+1):this.options.wrapAround&&this.album.length>1&&this.changeImage(0))},t.prototype.end=function(){this.disableKeyboardNav(),e(window).off("resize",this.sizeOverlay),this.$lightbox.fadeOut(this.options.fadeDuration),this.$overlay.fadeOut(this.options.fadeDuration),e("select, object, embed").css({visibility:"visible"}),this.options.disableScrolling&&e("body").removeClass("lb-disable-scrolling")},new t})),$((function(){var e=$("body");function t(e){if($("div.progressContent").removeClass("hidden"),$("div.progressContent > div.progress > div.progress-bar").attr("aria-valuenow",0),$("div.progressContent > div.progress > div.progress-bar").css("width","0%"),$("div.progressContent > div.progress > span.status").html(""),e.lengthComputable){var t=e.total,i=100*e.loaded/t;$("div.progressContent > div.progress > div.progress-bar").attr("aria-valuenow",i),$("div.progressContent > div.progress > div.progress-bar").css("width",i+"%"),i>100?$("div.progressContent").addClass("hidden"):$("div.progressContent > div.progress > span.status").html(Math.round(i)+"%")}}e.on("submit","form.frmDocAddFile",(function(e){var i=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-id"),o=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-type"),a="form#"+i+"_"+o+"_frmDocUpload",s=$(a).data("upload-type"),r=new FormData($(a)[0]);$(a).data("savetype");r.append("docRelationType",o),r.append("relationId",i),r.append("docType",s),melisCoreTool.pending(".btn"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComDocument/saveDocument",data:r,processData:!1,cache:!1,contentType:!1,dataType:"json",xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",t,!1),e}}).done((function(e){if(e&&e.success){var t=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-type"),a=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-id");$("div.modal").modal("hide"),"file"==e.type?melisHelper.zoneReload(activeTabId+" #id_meliscommerce_documents_file_attachments_lists","meliscommerce_documents_file_attachments_lists",{docRelationType:t,docRelationId:a}):"image"==e.type&&melisHelper.zoneReload(activeTabId+" #id_meliscommerce_documents_image_lists","meliscommerce_documents_image_lists",{docRelationType:t,docRelationId:a}),melisCommerce.setUniqueId(melisCommerce.getUniqueId()),melisHelper.melisOkNotification(e.textTitle,e.textMessage)}else melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,i+"_"+o+"_frmDocUpload"),$("div.progressContent").addClass("hidden");melisCoreTool.done(".btn"),melisCore.flashMessenger()})).fail((function(){melisCoreTool.done(".btn"),melisHelper.melisKoNotification(translations.tr_meliscommerce_documents_Documents,translations.tr_meliscommerce_documents_save_fail,[],"closeByButtonOnly"),""!==$(a).find(".filestyle").val()&&("file"==s?melisHelper.zoneReload(activeTabId+" #id_meliscommerce_documents_file_attachments_lists","meliscommerce_documents_file_attachments_lists"):"image"==s&&melisHelper.zoneReload(activeTabId+" #id_meliscommerce_documents_image_lists","meliscommerce_documents_image_lists")),melisCore.flashMessenger()})),e.preventDefault()})),e.on("click",".deleteFileImageDocument",(function(e){var t=$(this),i=t.data("doc-id"),o=t.data("type"),a=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-id"),s=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-type");if("image"==o)var r=translations.tr_meliscommerce_documents_delete_image_title,n=translations.tr_meliscommerce_documents_delete_image_msg_confirm;else if("file"==o)r=translations.tr_meliscommerce_documents_delete_file_title,n=translations.tr_meliscommerce_documents_delete_file_msg_confirm;melisCoreTool.confirm(translations.tr_meliscommerce_documents_common_label_yes,translations.tr_meliscommerce_documents_common_label_no,r,n,(function(){$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComDocument/delete",data:{id:i,docType:o,formType:s,uniqueId:a},dataType:"json",encode:!0}).done((function(e){melisCoreTool.pending(".btn"),e&&e.success?("file"==o?melisHelper.zoneReload(activeTabId+" #id_meliscommerce_documents_file_attachments_lists","meliscommerce_documents_file_attachments_lists",{docRelationType:s,docRelationId:a}):"image"==o&&melisHelper.zoneReload(activeTabId+" #id_meliscommerce_documents_image_lists","meliscommerce_documents_image_lists",{docRelationType:s,docRelationId:a}),melisCore.flashMessenger(),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.done(".btn")})).fail((function(){$("div.modal").modal("hide"),melisCoreTool.done(".btn"),"file"==o?melisHelper.zoneReload(activeTabId+" #id_meliscommerce_documents_file_attachments_lists","meliscommerce_documents_file_attachments_lists"):"image"==o&&melisHelper.zoneReload(activeTabId+" #id_meliscommerce_documents_image_lists","meliscommerce_documents_image_lists"),melisCore.flashMessenger()}))}))})),e.on("click",".collapseAddImageType",(function(){var e=$("div.addImageType");$("form.frmDocAddFile");e.slideToggle(),$(".collapseAddImageType").find("i[data-class='iconAddImageType']").toggleClass("fa-angle-down")})),e.on("click",".btnDocAddImageType",(function(){var e=$(this),t=$("form.frmDocAddImageType").serialize(),i=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-id"),o=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-type"),a=$("form.frmDocAddImageType").data("upload-type"),s=e.parent().prev().parent().find("form.frmDocAddFile").serialize(),r=e.parent().prev().parent().find("img.imgDocThumbnail").attr("src");melisCommerce.postSave("melis/MelisCommerce/MelisComDocument/addImageType?typeUpload="+a,t,(function(e){e.success?(melisHelper.zoneReload("id_meliscommerce_documents_modal_form","meliscommerce_documents_modal_form",{typeUpload:"image",saveType:a,docRelationId:i,docRelationType:o}),melisHelper.melisOkNotification(e.textTitle,e.textMessage),setTimeout((function(){$(".btnDocAddImageType").parent().prev().parent().find("img.imgDocThumbnail").attr("src",r),$.each(s.split("&"),(function(e,t){var i=t.split("=");$("[name='"+i[0]+"']").val(i[1])}))}),2e3)):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"frmDocAddImageType")),melisCore.flashMessenger()}))})),e.on("click",".btnDocAddFileType",(function(){var e=$(this),t=$("form.frmDocAddImageType").serialize(),i=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-id"),o=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-type"),a=$("form.frmDocAddImageType").data("upload-type"),s=e.parent().prev().parent().find("form.frmDocAddFile").serialize();melisCommerce.postSave("melis/MelisCommerce/MelisComDocument/addFileType?typeUpload="+a,t,(function(e){e.success?(melisHelper.zoneReload("id_meliscommerce_documents_modal_form","meliscommerce_documents_modal_form",{typeUpload:"file",saveType:a,docRelationId:i,docRelationType:o}),melisHelper.melisOkNotification(e.textTitle,e.textMessage),setTimeout((function(){$.each(s.split("&"),(function(e,t){var i=t.split("=");$("[name='"+i[0]+"']").val(i[1])}))}),2e3)):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"frmDocAddImageType")),melisCore.flashMessenger()}))})),e.on("click",".updateFileDocument",(function(){var e=$(this),t=e.data("doc-id"),i=(e.data("type"),$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-id")),o=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-type");melisHelper.createModal("id_meliscommerce_documents_modal_form","meliscommerce_documents_modal_form",!1,{typeUpload:"file",docId:t,saveType:"updatefile",docRelationId:i,docRelationType:o},"/melis/MelisCommerce/MelisComDocument/renderDocumentGenericModalContainer")})),e.on("click",".editImageDocumentModal",(function(){var e=$(this).data("doc-id"),t=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-id"),i=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-type");melisHelper.createModal("id_meliscommerce_documents_modal_form","meliscommerce_documents_modal_form",!1,{typeUpload:"image",docId:e,saveType:"editimage",docRelationId:t,docRelationType:i},"/melis/MelisCommerce/MelisComDocument/renderDocumentGenericModalContainer")})),e.on("click",".addFileImageDocument",(function(e){var t=$(this).data("type"),i=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-id"),o=$("#"+activeTabId+" div.ecom-doc-container").data("doc-relation-type");melisCoreTool.pending(this),melisHelper.createModal("id_meliscommerce_documents_modal_form","meliscommerce_documents_modal_form",!1,{typeUpload:t,docRelationId:i,docRelationType:o},"/melis/MelisCommerce/MelisComDocument/renderDocumentGenericModalContainer",(function(){melisCoreTool.done(".addFileImageDocument")}))})),e.on("click","#btnDocFileAdd",(function(e){var t="#"+$(this).attr("form");$(t).trigger("submit"),e.preventDefault()}))})),window.initImageDocuments=function(e){var t=$.support.touch?"touchstart":"click",i=$(e).find("div.imageDocumentContainer");i.imagesLoaded((function(){i.isotope({itemSelector:".image"})})),filters={},$body.on(t,".filter-div-country .filter-key-values li a",(function(){var e=$(this).data("text");$(".filter-div-country .filter-dropdown").attr("data-value",e),$(".filter-div-country span.filter-key").text(e)})),$body.on(t,".filter-div-file-type .filter-key-values li a",(function(){var e=$(this).data("text");$(".filter-div-file-type .filter-dropdown").attr("data-value",e),$(".filter-div-file-type span.filter-key").text(e)})),$(".documentImageFilter a").on(t,(function(){var e=$(this),t=e.parents(".documentImageFilter"),o=t.attr("data-filter-group"),a=[];for(var s in $(".documentImageFilter .current").removeClass("current"),e.addClass("current"),t.find(".selected").removeClass("selected"),e.addClass("selected"),filters[o]=e.attr("data-filter-value"),filters)a.push(filters[s]);var r=a.join("");$grid=i.isotope({filter:r,animationOptions:{duration:750,easing:"linear",queue:!1}}),$grid.on("arrangeComplete",(function(e,t){$(".viewImageDocument").attr("data-lightbox","deselected-images"),$.each(t,(function(){$selectedImgElem=$(this.element).find(".viewImageDocument"),$selectedImgElem.attr("data-lightbox","selected-images")}))})),lightbox.option({resizeDuration:200,wrapAround:!0})})),$(".documentImageFilter a").on(t,(function(){var e=$(this),t=e.parents(".documentImageFilter"),o=t.attr("data-filter-group"),a=[];for(var s in $(".documentImageFilter .current").removeClass("current"),e.addClass("current"),t.find(".selected").removeClass("selected"),e.addClass("selected"),filters[o]=e.attr("data-filter-value"),filters)a.push(filters[s]);var r=a.join("");$grid=i.isotope({filter:r,animationOptions:{duration:750,easing:"linear",queue:!1}}),$grid.on("arrangeComplete",(function(e,t){$(".viewImageDocument").attr("data-lightbox","deselected-images"),$.each(t,(function(){$selectedImgElem=$(this.element).find(".viewImageDocument"),$selectedImgElem.attr("data-lightbox","selected-images")}))})),lightbox.option({resizeDuration:200,wrapAround:!0})})),lightbox.option({resizeDuration:200,wrapAround:!0})},window.updateFormId=function(){var e=$("form.frmDocAddFile");melisCommerce.getUniqueId()&&e.attr("id",melisCommerce.getUniqueId()+"_frmDocUpload")},window.imagePreview=function(e,t){if(t.files&&t.files[0]){var i=new FileReader;i.onload=function(t){$(e).attr("src",t.target.result)},i.readAsDataURL(t.files[0])}},function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof module&&module.exports?module.exports=e(require("jquery")):e(jQuery)}((function(e,t){"use strict";if(!e.jstree){var i=0,o=!1,a=!1,s=!1,r=[],n=e("script:last").attr("src"),l=window.document,c=window.setImmediate,d=window.Promise;!c&&d&&(c=function(e,t){d.resolve(t).then(e)}),e.jstree={version:"3.3.16",defaults:{plugins:[]},plugins:{},path:n&&-1!==n.indexOf("/")?n.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g,root:"#"},e.jstree.create=function(t,o){var a=new e.jstree.core(++i),s=o;return o=e.extend(!0,{},e.jstree.defaults,o),s&&s.plugins&&(o.plugins=s.plugins),e.each(o.plugins,(function(e,t){"core"!==e&&(a=a.plugin(t,o[t]))})),e(t).data("jstree",a),a.init(t,o),a},e.jstree.destroy=function(){e(".jstree:jstree").jstree("destroy"),e(l).off(".jstree")},e.jstree.core=function(e){this._id=e,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1,ellipsis:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},e.jstree.reference=function(t){var i=null,o=null;if(!t||!t.id||t.tagName&&t.nodeType||(t=t.id),!o||!o.length)try{o=e(t)}catch(o){}if(!o||!o.length)try{o=e("#"+t.replace(e.jstree.idregex,"\\$&"))}catch(o){}return o&&o.length&&(o=o.closest(".jstree")).length&&(o=o.data("jstree"))?i=o:e(".jstree").each((function(){var o=e(this).data("jstree");if(o&&o._model.data[t])return i=o,!1})),i},e.fn.jstree=function(i){var o="string"==typeof i,a=Array.prototype.slice.call(arguments,1),s=null;return!(!0===i&&!this.length)&&(this.each((function(){var r=e.jstree.reference(this),n=o&&r?r[i]:null;if(s=o&&n?n.apply(r,a):null,r||o||i!==t&&!e.isPlainObject(i)||e.jstree.create(this,i),null!==(s=r&&!o||!0===i?r||!1:s)&&s!==t)return!1})),null!==s&&s!==t?s:this)},e.expr.pseudos.jstree=e.expr.createPseudo((function(i){return function(i){return e(i).hasClass("jstree")&&e(i).data("jstree")!==t}})),e.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:e.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,ellipsis:!1,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0,loaded_state:!1,restore_focus:!0,compute_elements_positions:!1,keyboard:{"ctrl-space":function(t){t.type="click",e(t.currentTarget).trigger(t)},enter:function(t){t.type="click",e(t.currentTarget).trigger(t)},left:function(t){t.preventDefault(),this.is_open(t.currentTarget)?this.close_node(t.currentTarget):(t=this.get_parent(t.currentTarget))&&t.id!==e.jstree.root&&this.get_node(t,!0).children(".jstree-anchor").trigger("focus")},up:function(e){e.preventDefault(),(e=this.get_prev_dom(e.currentTarget))&&e.length&&e.children(".jstree-anchor").trigger("focus")},right:function(t){t.preventDefault(),this.is_closed(t.currentTarget)?this.open_node(t.currentTarget,(function(e){this.get_node(e,!0).children(".jstree-anchor").trigger("focus")})):!this.is_open(t.currentTarget)||(t=this.get_node(t.currentTarget,!0).children(".jstree-children")[0])&&e(this._firstChild(t)).children(".jstree-anchor").trigger("focus")},down:function(e){e.preventDefault(),(e=this.get_next_dom(e.currentTarget))&&e.length&&e.children(".jstree-anchor").trigger("focus")},"*":function(e){this.open_all()},home:function(t){t.preventDefault(),(t=this._firstChild(this.get_container_ul()[0]))&&e(t).children(".jstree-anchor").filter(":visible").trigger("focus")},end:function(e){e.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().trigger("focus")},f2:function(e){e.preventDefault(),this.edit(e.currentTarget)}},allow_reselect:!1},e.jstree.core.prototype={plugin:function(t,i){var o=e.jstree.plugins[t];return o?(this._data[t]={},o.prototype=this,new o(i,this)):this},init:function(t,i){this._model={data:{},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this.element=e(t).addClass("jstree jstree-"+this._id),this.settings=i,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0),this.element.attr("tabindex")||this.element.attr("tabindex","0"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter((function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))})).remove(),this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='none'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' role='treeitem' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"),this._data.core.li_height=this.get_container_ul().children("li").first().outerHeight()||24,this._data.core.node=this._create_prototype_node(),this.trigger("loading"),this.load_node(e.jstree.root)},destroy:function(e){if(this.trigger("destroy"),this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(e){}e||this.element.empty(),this.teardown()},_create_prototype_node:function(){var e,t,i=l.createElement("LI");return i.setAttribute("role","none"),(e=l.createElement("I")).className="jstree-icon jstree-ocl",e.setAttribute("role","presentation"),i.appendChild(e),(e=l.createElement("A")).className="jstree-anchor",e.setAttribute("href","#"),e.setAttribute("tabindex","-1"),e.setAttribute("role","treeitem"),(t=l.createElement("I")).className="jstree-icon jstree-themeicon",t.setAttribute("role","presentation"),e.appendChild(t),i.appendChild(e),e=t=null,i},_kbevent_to_func:function(e){var t={8:"Backspace",9:"Tab",13:"Enter",19:"Pause",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"Print",45:"Insert",46:"Delete",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9","-13":"NumpadEnter",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"Numlock",145:"Scrolllock",16:"Shift",17:"Ctrl",18:"Alt",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",111:"/",106:"*",173:"-"},i=[];if(e.ctrlKey&&i.push("ctrl"),e.altKey&&i.push("alt"),e.shiftKey&&i.push("shift"),i.push(t[e.which]?t[e.which].toLowerCase():e.which),"shift-shift"===(i=i.sort().join("-").toLowerCase())||"ctrl-ctrl"===i||"alt-alt"===i)return null;var o,a,s=this.settings.core.keyboard;for(o in s)if(s.hasOwnProperty(o)&&(a="-"!==(a=o)&&"+"!==a?(a=a.replace("--","-MINUS").replace("+-","-MINUS").replace("++","-PLUS").replace("-+","-PLUS")).split(/-|\+/).sort().join("-").replace("MINUS","-").replace("PLUS","+").toLowerCase():a)===i)return s[o];return null},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",(function(){return this.className.replace(/jstree[^ ]*|$/gi,"")})),this.element=null},bind:function(){var t="",i=null,o=0;this.element.on("dblclick.jstree",(function(e){if(e.target.tagName&&"input"===e.target.tagName.toLowerCase())return!0;if(l.selection&&l.selection.empty)l.selection.empty();else if(window.getSelection){e=window.getSelection();try{e.removeAllRanges(),e.collapse()}catch(e){}}})).on("mousedown.jstree",function(e){e.target===this.element[0]&&(e.preventDefault(),o=+new Date)}.bind(this)).on("mousedown.jstree",".jstree-ocl",(function(e){e.preventDefault()})).on("click.jstree",".jstree-ocl",function(e){this.toggle_node(e.target)}.bind(this)).on("dblclick.jstree",".jstree-anchor",function(e){if(e.target.tagName&&"input"===e.target.tagName.toLowerCase())return!0;this.settings.core.dblclick_toggle&&this.toggle_node(e.target)}.bind(this)).on("click.jstree",".jstree-anchor",function(t){t.preventDefault(),t.currentTarget!==l.activeElement&&e(t.currentTarget).trigger("focus"),this.activate_node(t.currentTarget,t)}.bind(this)).on("keydown.jstree",".jstree-anchor",function(e){if(e.target.tagName&&"input"===e.target.tagName.toLowerCase())return!0;this._data.core.rtl&&(37===e.which?e.which=39:39===e.which&&(e.which=37));var t=this._kbevent_to_func(e);if(t&&(!1===(e=t.call(this,e))||!0===e))return e}.bind(this)).on("load_node.jstree",function(t,i){i.status&&(i.node.id!==e.jstree.root||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){for(var t=[],i=0,o=this._data.core.selected.length;i<o;i++)t=t.concat(this._model.data[this._data.core.selected[i]].parents);for(i=0,o=(t=e.vakata.array_unique(t)).length;i<o;i++)this.open_node(t[i],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}}.bind(this),0))}.bind(this)).on("keypress.jstree",function(o){if(o.target.tagName&&"input"===o.target.tagName.toLowerCase())return!0;i&&clearTimeout(i),i=setTimeout((function(){t=""}),500);var a=String.fromCharCode(o.which).toLowerCase(),s=this.element.find(".jstree-anchor").filter(":visible"),r=(o=s.index(l.activeElement)||0,!1);if(1<(t+=a).length){if(s.slice(o).each(function(i,o){if(0===e(o).text().toLowerCase().indexOf(t))return e(o).trigger("focus"),!(r=!0)}.bind(this)),r)return;if(s.slice(0,o).each(function(i,o){if(0===e(o).text().toLowerCase().indexOf(t))return e(o).trigger("focus"),!(r=!0)}.bind(this)),r)return}new RegExp("^"+a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"+$").test(t)&&(s.slice(o+1).each(function(t,i){if(e(i).text().toLowerCase().charAt(0)===a)return e(i).trigger("focus"),!(r=!0)}.bind(this)),r||s.slice(0,o+1).each(function(t,i){if(e(i).text().toLowerCase().charAt(0)===a)return e(i).trigger("focus"),!(r=!0)}.bind(this)))}.bind(this)).on("init.jstree",function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots,this._data.core.themes.stripes=e.stripes,this._data.core.themes.icons=e.icons,this._data.core.themes.ellipsis=e.ellipsis,this.set_theme(e.name||"default",e.url),this.set_theme_variant(e.variant)}.bind(this)).on("loading.jstree",function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"](),this[this._data.core.themes.ellipsis?"show_ellipsis":"hide_ellipsis"]()}.bind(this)).on("blur.jstree",".jstree-anchor",function(t){this._data.core.focused=null,e(t.currentTarget).filter(".jstree-hovered").trigger("mouseleave"),this.element.attr("tabindex","0"),e(t.currentTarget).attr("tabindex","-1")}.bind(this)).on("focus.jstree",".jstree-anchor",function(t){var i=this.get_node(t.currentTarget);i&&(i.id||0===i.id)&&(this._data.core.focused=i.id),this.element.find(".jstree-hovered").not(t.currentTarget).trigger("mouseleave"),e(t.currentTarget).trigger("mouseenter"),this.element.attr("tabindex","-1"),e(t.currentTarget).attr("tabindex","0")}.bind(this)).on("focus.jstree",function(){var e;500<+new Date-o&&!this._data.core.focused&&this.settings.core.restore_focus&&(o=0,(e=this.get_node(this.element.attr("aria-activedescendant"),!0))&&e.find("> .jstree-anchor").trigger("focus"))}.bind(this)).on("mouseenter.jstree",".jstree-anchor",function(e){this.hover_node(e.currentTarget)}.bind(this)).on("mouseleave.jstree",".jstree-anchor",function(e){this.dehover_node(e.currentTarget)}.bind(this))},unbind:function(){this.element.off(".jstree"),e(l).off(".jstree-"+this._id)},trigger:function(e,t){((t=t||{}).instance=this).element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(t){var i=this.settings.core.strings;return e.vakata.is_function(i)?i.call(this,t):i&&i[t]?i[t]:t},_firstChild:function(e){for(e=e?e.firstChild:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_nextSibling:function(e){for(e=e?e.nextSibling:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_previousSibling:function(e){for(e=e?e.previousSibling:null;null!==e&&1!==e.nodeType;)e=e.previousSibling;return e},get_node:function(t,i){var o;(t=t&&(t.id||0===t.id)?t.id:t)instanceof e&&t.length&&t[0].id&&(t=t[0].id);try{if(this._model.data[t])t=this._model.data[t];else if("string"==typeof t&&this._model.data[t.replace(/^#/,"")])t=this._model.data[t.replace(/^#/,"")];else if("string"==typeof t&&(o=e("#"+t.replace(e.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[o.closest(".jstree-node").attr("id")])t=this._model.data[o.closest(".jstree-node").attr("id")];else if((o=this.element.find(t)).length&&this._model.data[o.closest(".jstree-node").attr("id")])t=this._model.data[o.closest(".jstree-node").attr("id")];else{if(!(o=this.element.find(t)).length||!o.hasClass("jstree"))return!1;t=this._model.data[e.jstree.root]}return i?t.id===e.jstree.root?this.element:e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element):t}catch(t){return!1}},get_path:function(t,i,o){if(!(t=t.parents?t:this.get_node(t))||t.id===e.jstree.root||!t.parents)return!1;var a,s,r=[];for(r.push(o?t.id:t.text),a=0,s=t.parents.length;a<s;a++)r.push(o?t.parents[a]:this.get_text(t.parents[a]));return r=r.reverse().slice(1),i?r.join(i):r},get_next_dom:function(t,i){var o;if((t=this.get_node(t,!0))[0]===this.element[0]){for(o=this._firstChild(this.get_container_ul()[0]);o&&0===o.offsetHeight;)o=this._nextSibling(o);return!!o&&e(o)}if(!t||!t.length)return!1;if(i){o=t[0];do{o=this._nextSibling(o)}while(o&&0===o.offsetHeight);return!!o&&e(o)}if(t.hasClass("jstree-open")){for(o=this._firstChild(t.children(".jstree-children")[0]);o&&0===o.offsetHeight;)o=this._nextSibling(o);if(null!==o)return e(o)}o=t[0];do{o=this._nextSibling(o)}while(o&&0===o.offsetHeight);return null!==o?e(o):t.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(t,i){var o;if((t=this.get_node(t,!0))[0]===this.element[0]){for(o=this.get_container_ul()[0].lastChild;o&&0===o.offsetHeight;)o=this._previousSibling(o);return!!o&&e(o)}if(!t||!t.length)return!1;if(i){o=t[0];do{o=this._previousSibling(o)}while(o&&0===o.offsetHeight);return!!o&&e(o)}o=t[0];do{o=this._previousSibling(o)}while(o&&0===o.offsetHeight);if(null===o)return!(!(o=t[0].parentNode.parentNode)||!o.className||-1===o.className.indexOf("jstree-node"))&&e(o);for(t=e(o);t.hasClass("jstree-open");)t=t.children(".jstree-children").first().children(".jstree-node:visible:last");return t},get_parent:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.parent},get_children_dom:function(e){return(e=this.get_node(e,!0))[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):!(!e||!e.length)&&e.children(".jstree-children").children(".jstree-node")},is_parent:function(e){return(e=this.get_node(e))&&(!1===e.state.loaded||0<e.children.length)},is_loaded:function(e){return(e=this.get_node(e))&&e.state.loaded},is_loading:function(e){return(e=this.get_node(e))&&e.state&&e.state.loading},is_open:function(e){return(e=this.get_node(e))&&e.state.opened},is_closed:function(e){return(e=this.get_node(e))&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(t,i){var o,a,s,r,n,l=this.get_node(t,!0);if(e.vakata.is_array(t))return this._load_nodes(t.slice(),i),!0;if(!(t=this.get_node(t)))return i&&i.call(this,t,!1),!1;if(t.state.loaded){for(t.state.loaded=!1,s=0,r=t.parents.length;s<r;s++)this._model.data[t.parents[s]].children_d=e.vakata.array_filter(this._model.data[t.parents[s]].children_d,(function(i){return-1===e.inArray(i,t.children_d)}));for(o=0,a=t.children_d.length;o<a;o++)this._model.data[t.children_d[o]].state.selected&&(n=!0),delete this._model.data[t.children_d[o]];n&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,(function(i){return-1===e.inArray(i,t.children_d)}))),t.children=[],t.children_d=[],n&&this.trigger("changed",{action:"load_node",node:t,selected:this._data.core.selected})}return t.state.failed=!1,t.state.loading=!0,(t.id!==e.jstree.root?l.children(".jstree-anchor"):l).attr("aria-busy",!0),l.addClass("jstree-loading"),this._load_node(t,function(o){(t=this._model.data[t.id]).state.loading=!1,t.state.loaded=o,t.state.failed=!t.state.loaded;for(var a=this.get_node(t,!0),s=0,r=this._model.data,n=!1,l=(s=0,t.children.length);s<l;s++)if(r[t.children[s]]&&!r[t.children[s]].state.hidden){n=!0;break}t.state.loaded&&a&&a.length&&(a.removeClass("jstree-closed jstree-open jstree-leaf"),n?"#"!==t.id&&a.addClass(t.state.opened?"jstree-open":"jstree-closed"):a.addClass("jstree-leaf")),(t.id!==e.jstree.root?a.children(".jstree-anchor"):a).attr("aria-busy",!1),a.removeClass("jstree-loading"),this.trigger("load_node",{node:t,status:o}),i&&i.call(this,t,o)}.bind(this)),!0},_load_nodes:function(e,t,i,o){for(var a=!0,s=function(){this._load_nodes(e,t,!0)},r=this._model.data,n=[],l=0,c=e.length;l<c;l++)r[e[l]]&&(!r[e[l]].state.loaded&&!r[e[l]].state.failed||!i&&o)&&(this.is_loading(e[l])||this.load_node(e[l],s),a=!1);if(a){for(l=0,c=e.length;l<c;l++)r[e[l]]&&r[e[l]].state.loaded&&n.push(e[l]);t&&!t.done&&(t.call(this,n),t.done=!0)}},load_all:function(t,i){if(t=t||e.jstree.root,!(t=this.get_node(t)))return!1;var o,a,s=[],r=this._model.data,n=r[t.id].children_d;for(t.state&&!t.state.loaded&&s.push(t.id),o=0,a=n.length;o<a;o++)r[n[o]]&&r[n[o]].state&&!r[n[o]].state.loaded&&s.push(n[o]);s.length?this._load_nodes(s,(function(){this.load_all(t,i)})):(i&&i.call(this,t),this.trigger("load_all",{node:t}))},_load_node:function(t,i){var o,a=this.settings.core.data,s=function(){return 3!==this.nodeType&&8!==this.nodeType};return a?e.vakata.is_function(a)?a.call(this,t,function(o){!1===o?i.call(this,!1):this["string"==typeof o?"_append_html_data":"_append_json_data"](t,"string"==typeof o?e(e.parseHTML(o)).filter(s):o,(function(e){i.call(this,e)}))}.bind(this)):"object"==typeof a?a.url?(a=e.extend(!0,{},a),e.vakata.is_function(a.url)&&(a.url=a.url.call(this,t)),e.vakata.is_function(a.data)&&(a.data=a.data.call(this,t)),e.ajax(a).done(function(o,a,r){var n=r.getResponseHeader("Content-Type");return n&&-1!==n.indexOf("json")||"object"==typeof o?this._append_json_data(t,o,(function(e){i.call(this,e)})):n&&-1!==n.indexOf("html")||"string"==typeof o?this._append_html_data(t,e(e.parseHTML(o)).filter(s),(function(e){i.call(this,e)})):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:r})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))}.bind(this)).fail(function(e){this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:e})},i.call(this,!1),this.settings.core.error.call(this,this._data.core.last_error)}.bind(this))):(o=e.vakata.is_array(a)?e.extend(!0,[],a):e.isPlainObject(a)?e.extend(!0,{},a):a,t.id===e.jstree.root?this._append_json_data(t,o,(function(e){i.call(this,e)})):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))):"string"==typeof a?t.id===e.jstree.root?this._append_html_data(t,e(e.parseHTML(a)).filter(s),(function(e){i.call(this,e)})):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1)):i.call(this,!1):t.id===e.jstree.root?this._append_html_data(t,this._data.core.original_container_html.clone(!0),(function(e){i.call(this,e)})):i.call(this,!1)},_node_changed:function(t){(t=this.get_node(t))&&-1===e.inArray(t.id,this._model.changed)&&this._model.changed.push(t.id)},_append_html_data:function(t,i,o){(t=this.get_node(t)).children=[],t.children_d=[];i=i.is("ul")?i.children():i;var a,s,r,n=t.id,l=[],c=[],d=this._model.data,h=d[n];t=this._data.core.selected.length;for(i.each(function(t,i){(a=this._parse_model_from_html(e(i),n,h.parents.concat()))&&(l.push(a),c.push(a),d[a].children_d.length&&(c=c.concat(d[a].children_d)))}.bind(this)),h.children=l,h.children_d=c,s=0,r=h.parents.length;s<r;s++)d[h.parents[s]].children_d=d[h.parents[s]].children_d.concat(c);this.trigger("model",{nodes:c,parent:n}),n!==e.jstree.root?(this._node_changed(n),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==t&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),o.call(this,!0)},_append_json_data:function(t,i,o,a){if(null!==this.element){(t=this.get_node(t)).children=[],t.children_d=[],i.d&&"string"==typeof(i=i.d)&&(i=JSON.parse(i)),e.vakata.is_array(i)||(i=[i]);var s=null,r={df:this._model.default_state,dat:i,par:t.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},n=this,l=function(e,t){var i,o,a,s,r=(e=e.data?e.data:e).dat,l=e.par,c=[],d=[],h=[],m=e.df,u=e.t_id,_=e.t_cnt,p=e.m,f=p[l],g=(e=e.sel,function(e,i,o){o=o?o.concat():[],i&&o.unshift(i);var a,s,r,n,l=e.id.toString(),c={id:l,text:e.text||"",icon:e.icon===t||e.icon,parent:i,parents:o,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(a in m)m.hasOwnProperty(a)&&(c.state[a]=m[a]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(c.icon=e.data.jstree.icon),c.icon!==t&&null!==c.icon&&""!==c.icon||(c.icon=!0),e&&e.data&&(c.data=e.data,e.data.jstree))for(a in e.data.jstree)e.data.jstree.hasOwnProperty(a)&&(c.state[a]=e.data.jstree[a]);if(e&&"object"==typeof e.state)for(a in e.state)e.state.hasOwnProperty(a)&&(c.state[a]=e.state[a]);if(e&&"object"==typeof e.li_attr)for(a in e.li_attr)e.li_attr.hasOwnProperty(a)&&(c.li_attr[a]=e.li_attr[a]);if(c.li_attr.id||(c.li_attr.id=l),e&&"object"==typeof e.a_attr)for(a in e.a_attr)e.a_attr.hasOwnProperty(a)&&(c.a_attr[a]=e.a_attr[a]);for(e&&e.children&&!0===e.children&&(c.state.loaded=!1,c.children=[],c.children_d=[]),a=0,s=(p[c.id]=c).children.length;a<s;a++)r=g(p[c.children[a]],c.id,o),n=p[r],c.children_d.push(r),n.children_d.length&&(c.children_d=c.children_d.concat(n.children_d));return delete e.data,delete e.children,p[c.id].original=e,c.state.selected&&h.push(c.id),c.id}),v=function(e,i,o){o=o?o.concat():[],i&&o.unshift(i);var a,s,r,n,l,c=!1;do{c="j"+u+"_"+ ++_}while(p[c]);for(a in l={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:i,parents:o,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},m)m.hasOwnProperty(a)&&(l.state[a]=m[a]);if(e&&(e.id||0===e.id)&&(l.id=e.id.toString()),e&&e.text&&(l.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),l.icon!==t&&null!==l.icon&&""!==l.icon||(l.icon=!0),e&&e.data&&(l.data=e.data,e.data.jstree))for(a in e.data.jstree)e.data.jstree.hasOwnProperty(a)&&(l.state[a]=e.data.jstree[a]);if(e&&"object"==typeof e.state)for(a in e.state)e.state.hasOwnProperty(a)&&(l.state[a]=e.state[a]);if(e&&"object"==typeof e.li_attr)for(a in e.li_attr)e.li_attr.hasOwnProperty(a)&&(l.li_attr[a]=e.li_attr[a]);if(l.li_attr.id&&!l.id&&0!==l.id&&(l.id=l.li_attr.id.toString()),l.id||0===l.id||(l.id=c),l.li_attr.id||(l.li_attr.id=l.id),e&&"object"==typeof e.a_attr)for(a in e.a_attr)e.a_attr.hasOwnProperty(a)&&(l.a_attr[a]=e.a_attr[a]);if(e&&e.children&&e.children.length){for(a=0,s=e.children.length;a<s;a++)r=v(e.children[a],l.id,o),n=p[r],l.children.push(r),n.children_d.length&&(l.children_d=l.children_d.concat(n.children_d));l.children_d=l.children_d.concat(l.children)}return e&&e.children&&!0===e.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),delete e.data,delete e.children,l.original=e,(p[l.id]=l).state.selected&&h.push(l.id),l.id};if(r.length&&r[0].id!==t&&r[0].parent!==t){for(o=0,a=r.length;o<a;o++)r[o].children||(r[o].children=[]),r[o].state||(r[o].state={}),p[r[o].id.toString()]=r[o];for(o=0,a=r.length;o<a;o++)p[r[o].parent.toString()]?(p[r[o].parent.toString()].children.push(r[o].id.toString()),f.children_d.push(r[o].id.toString())):void 0!==n&&(n._data.core.last_error={error:"parse",plugin:"core",id:"core_07",reason:"Node with invalid parent",data:JSON.stringify({id:r[o].id.toString(),parent:r[o].parent.toString()})},n.settings.core.error.call(n,n._data.core.last_error));for(o=0,a=f.children.length;o<a;o++)i=g(p[f.children[o]],l,f.parents.concat()),d.push(i),p[i].children_d.length&&(d=d.concat(p[i].children_d));for(o=0,a=f.parents.length;o<a;o++)p[f.parents[o]].children_d=p[f.parents[o]].children_d.concat(d);s={cnt:_,mod:p,sel:e,par:l,dpc:d,add:h}}else{for(o=0,a=r.length;o<a;o++)(i=v(r[o],l,f.parents.concat()))&&(c.push(i),d.push(i),p[i].children_d.length&&(d=d.concat(p[i].children_d)));for(f.children=c,f.children_d=d,o=0,a=f.parents.length;o<a;o++)p[f.parents[o]].children_d=p[f.parents[o]].children_d.concat(d);s={cnt:_,mod:p,sel:e,par:l,dpc:d,add:h}}if("undefined"!=typeof window&&void 0!==window.document)return s;postMessage(s)},d=function(t,i){if(null!==this.element){var a;for(a in this._cnt=t.cnt,h=this._model.data)h.hasOwnProperty(a)&&h[a].state&&h[a].state.loading&&t.mod[a]&&(t.mod[a].state.loading=!0);if(this._model.data=t.mod,i){var s,r=t.add,l=t.sel,d=this._data.core.selected.slice(),h=this._model.data;if(l.length!==d.length||e.vakata.array_unique(l.concat(d)).length!==l.length){for(a=0,s=l.length;a<s;a++)-1===e.inArray(l[a],r)&&-1===e.inArray(l[a],d)&&(h[l[a]].state.selected=!1);for(a=0,s=d.length;a<s;a++)-1===e.inArray(d[a],l)&&(h[d[a]].state.selected=!0)}}t.add.length&&(this._data.core.selected=this._data.core.selected.concat(t.add)),this.trigger("model",{nodes:t.dpc,parent:t.par}),t.par!==e.jstree.root?(this._node_changed(t.par),this.redraw()):this.redraw(!0),t.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),!i&&c?c((function(){o.call(n,!0)})):o.call(n,!0)}};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+l.toString()],{type:"text/javascript"}))),!this._data.core.working||a?(this._data.core.working=!0,(s=new window.Worker(this._wrk)).onmessage=function(e){d.call(this,e.data,!0);try{s.terminate(),s=null}catch(e){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}.bind(this),s.onerror=function(e){d.call(this,l(r),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}.bind(this),r.par?s.postMessage(r):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([t,i,o,!0])}catch(t){d.call(this,l(r),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else d.call(this,l(r),!1)}},_parse_model_from_html:function(i,o,a){a=a?[].concat(a):[],o&&a.unshift(o);var s,r,n,l,c=this._model.data,d={id:!1,text:!1,icon:!0,parent:o,parents:a,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(n in this._model.default_state)this._model.default_state.hasOwnProperty(n)&&(d.state[n]=this._model.default_state[n]);if(o=e.vakata.attributes(i,!0),e.each(o,(function(t,i){return!(i=e.vakata.trim(i)).length||(d.li_attr[t]=i,void("id"===t&&(d.id=i.toString())))})),(o=i.children("a").first()).length&&(o=e.vakata.attributes(o,!0),e.each(o,(function(t,i){(i=e.vakata.trim(i)).length&&(d.a_attr[t]=i)}))),(o=(i.children("a").first().length?i.children("a").first():i).clone()).children("ins, i, ul").remove(),o=o.html(),o=e("<div></div>").html(o),d.text=this.settings.core.force_text?o.text():o.html(),o=i.data(),d.data=o?e.extend(!0,{},o):null,d.state.opened=i.hasClass("jstree-open"),d.state.selected=i.children("a").hasClass("jstree-clicked"),d.state.disabled=i.children("a").hasClass("jstree-disabled"),d.data&&d.data.jstree)for(n in d.data.jstree)d.data.jstree.hasOwnProperty(n)&&(d.state[n]=d.data.jstree[n]);(o=i.children("a").children(".jstree-themeicon")).length&&(d.icon=!o.hasClass("jstree-themeicon-hidden")&&o.attr("rel")),d.state.icon!==t&&(d.icon=d.state.icon),d.icon!==t&&null!==d.icon&&""!==d.icon||(d.icon=!0),o=i.children("ul").children("li");do{l="j"+this._id+"_"+ ++this._cnt}while(c[l]);return d.id=d.li_attr.id?d.li_attr.id.toString():l,o.length?(o.each(function(t,i){s=this._parse_model_from_html(e(i),d.id,a),r=this._model.data[s],d.children.push(s),r.children_d.length&&(d.children_d=d.children_d.concat(r.children_d))}.bind(this)),d.children_d=d.children_d.concat(d.children)):i.hasClass("jstree-closed")&&(d.state.loaded=!1),d.li_attr.class&&(d.li_attr.class=d.li_attr.class.replace("jstree-closed","").replace("jstree-open","")),d.a_attr.class&&(d.a_attr.class=d.a_attr.class.replace("jstree-clicked","").replace("jstree-disabled","")),(c[d.id]=d).state.selected&&this._data.core.selected.push(d.id),d.id},_parse_model_from_flat_json:function(e,i,o){o=o?o.concat():[],i&&o.unshift(i);var a,s,r,n,l=e.id.toString(),c=this._model.data,d=this._model.default_state,h={id:l,text:e.text||"",icon:e.icon===t||e.icon,parent:i,parents:o,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(a in d)d.hasOwnProperty(a)&&(h.state[a]=d[a]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(h.icon=e.data.jstree.icon),h.icon!==t&&null!==h.icon&&""!==h.icon||(h.icon=!0),e&&e.data&&(h.data=e.data,e.data.jstree))for(a in e.data.jstree)e.data.jstree.hasOwnProperty(a)&&(h.state[a]=e.data.jstree[a]);if(e&&"object"==typeof e.state)for(a in e.state)e.state.hasOwnProperty(a)&&(h.state[a]=e.state[a]);if(e&&"object"==typeof e.li_attr)for(a in e.li_attr)e.li_attr.hasOwnProperty(a)&&(h.li_attr[a]=e.li_attr[a]);if(h.li_attr.id||(h.li_attr.id=l),e&&"object"==typeof e.a_attr)for(a in e.a_attr)e.a_attr.hasOwnProperty(a)&&(h.a_attr[a]=e.a_attr[a]);for(e&&e.children&&!0===e.children&&(h.state.loaded=!1,h.children=[],h.children_d=[]),a=0,s=(c[h.id]=h).children.length;a<s;a++)n=c[r=this._parse_model_from_flat_json(c[h.children[a]],h.id,o)],h.children_d.push(r),n.children_d.length&&(h.children_d=h.children_d.concat(n.children_d));return delete e.data,delete e.children,c[h.id].original=e,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_json:function(e,i,o){o=o?o.concat():[],i&&o.unshift(i);var a,s,r,n,l,c=!1,d=this._model.data,h=this._model.default_state;do{c="j"+this._id+"_"+ ++this._cnt}while(d[c]);for(a in l={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:i,parents:o,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},h)h.hasOwnProperty(a)&&(l.state[a]=h[a]);if(e&&(e.id||0===e.id)&&(l.id=e.id.toString()),e&&e.text&&(l.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),l.icon!==t&&null!==l.icon&&""!==l.icon||(l.icon=!0),e&&e.data&&(l.data=e.data,e.data.jstree))for(a in e.data.jstree)e.data.jstree.hasOwnProperty(a)&&(l.state[a]=e.data.jstree[a]);if(e&&"object"==typeof e.state)for(a in e.state)e.state.hasOwnProperty(a)&&(l.state[a]=e.state[a]);if(e&&"object"==typeof e.li_attr)for(a in e.li_attr)e.li_attr.hasOwnProperty(a)&&(l.li_attr[a]=e.li_attr[a]);if(l.li_attr.id&&!l.id&&0!==l.id&&(l.id=l.li_attr.id.toString()),l.id||0===l.id||(l.id=c),l.li_attr.id||(l.li_attr.id=l.id),e&&"object"==typeof e.a_attr)for(a in e.a_attr)e.a_attr.hasOwnProperty(a)&&(l.a_attr[a]=e.a_attr[a]);if(e&&e.children&&e.children.length){for(a=0,s=e.children.length;a<s;a++)n=d[r=this._parse_model_from_json(e.children[a],l.id,o)],l.children.push(r),n.children_d.length&&(l.children_d=l.children_d.concat(n.children_d));l.children_d=l.children.concat(l.children_d)}return e&&e.children&&!0===e.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),delete e.data,delete e.children,l.original=e,(d[l.id]=l).state.selected&&this._data.core.selected.push(l.id),l.id},_redraw:function(){for(var t,i=(this._model.force_full_redraw?this._model.data[e.jstree.root].children:this._model.changed).concat([]),o=l.createElement("UL"),a=this._data.core.focused,s=0,r=i.length;s<r;s++)(t=this.redraw_node(i[s],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&o.appendChild(t);this._model.force_full_redraw&&(o.className=this.get_container_ul()[0].className,o.setAttribute("role","presentation"),this.element.empty().append(o)),null!==a&&this.settings.core.restore_focus&&((t=this.get_node(a,!0))&&t.length&&t.children(".jstree-anchor")[0]!==l.activeElement?t.children(".jstree-anchor").trigger("focus"):this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:i})},redraw:function(e){e&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(t){var i=this.get_node(t),o=!1,a=!1,s=!1,r=l;if(!i)return!1;if(i.id===e.jstree.root)return this.redraw(!0);if(!(t=this.get_node(t,!0))||!t.length)return!1;if(t.children(".jstree-children").remove(),t=t[0],i.children.length&&i.state.loaded){for((s=r.createElement("UL")).setAttribute("role","group"),s.className="jstree-children",o=0,a=i.children.length;o<a;o++)s.appendChild(this.redraw_node(i.children[o],!0,!0));t.appendChild(s)}},redraw_node:function(t,i,o,a){var s=this.get_node(t),r=!1,n=!1,c=!1,d=!1,h=!1,m=!1,u="",_=l,p=this._model.data,f=!1,g=null,v=0,b=0,y=!1,C=!1;if(!s)return!1;if(s.id===e.jstree.root)return this.redraw(!0);if(i=i||0===s.children.length,t=l.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(s.id[0])?"\\3"+s.id[0]+" "+s.id.substr(1).replace(e.jstree.idregex,"\\$&"):s.id.replace(e.jstree.idregex,"\\$&"))):l.getElementById(s.id))t=e(t),o||((r=t.parent().parent()[0])===this.element[0]&&(r=null),n=t.index()),(i=!(i||!s.children.length||t.children(".jstree-children").length)||i)||(c=t.children(".jstree-children")[0]),f=t.children(".jstree-anchor")[0]===l.activeElement,t.remove();else if(i=!0,!o){if(!(null===(r=s.parent!==e.jstree.root?e("#"+s.parent.replace(e.jstree.idregex,"\\$&"),this.element)[0]:null)||r&&p[s.parent].state.opened))return!1;n=e.inArray(s.id,(null===r?p[e.jstree.root]:p[s.parent]).children)}for(d in t=this._data.core.node.cloneNode(!0),u="jstree-node ",s.li_attr)s.li_attr.hasOwnProperty(d)&&"id"!==d&&("class"!==d?t.setAttribute(d,s.li_attr[d]):u+=s.li_attr[d]);for(s.a_attr.id||(s.a_attr.id=s.id+"_anchor"),t.childNodes[1].setAttribute("aria-selected",!!s.state.selected),t.childNodes[1].setAttribute("aria-level",s.parents.length),this.settings.core.compute_elements_positions&&(t.childNodes[1].setAttribute("aria-setsize",p[s.parent].children.length),t.childNodes[1].setAttribute("aria-posinset",p[s.parent].children.indexOf(s.id)+1)),s.state.disabled&&t.childNodes[1].setAttribute("aria-disabled",!0),d=0,h=s.children.length;d<h;d++)if(!p[s.children[d]].state.hidden){y=!0;break}if(null!==s.parent&&p[s.parent]&&!s.state.hidden&&(d=e.inArray(s.id,p[s.parent].children),C=s.id,-1!==d))for(d++,h=p[s.parent].children.length;d<h&&(C=p[p[s.parent].children[d]].state.hidden?C:p[s.parent].children[d])===s.id;d++);for(h in s.state.hidden&&(u+=" jstree-hidden"),s.state.loading&&(u+=" jstree-loading"),s.state.loaded&&!y?u+=" jstree-leaf":(u+=s.state.opened&&s.state.loaded?" jstree-open":" jstree-closed",t.childNodes[1].setAttribute("aria-expanded",s.state.opened&&s.state.loaded)),C===s.id&&(u+=" jstree-last"),t.id=s.id,t.className=u,u=(s.state.selected?" jstree-clicked":"")+(s.state.disabled?" jstree-disabled":""),s.a_attr)s.a_attr.hasOwnProperty(h)&&("href"===h&&"#"===s.a_attr[h]||("class"!==h?t.childNodes[1].setAttribute(h,s.a_attr[h]):u+=" "+s.a_attr[h]));if(u.length&&(t.childNodes[1].className="jstree-anchor "+u),(s.icon&&!0!==s.icon||!1===s.icon)&&(!1===s.icon?t.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===s.icon.indexOf("/")&&-1===s.icon.indexOf(".")?t.childNodes[1].childNodes[0].className+=" "+s.icon+" jstree-themeicon-custom":(t.childNodes[1].childNodes[0].style.backgroundImage='url("'+s.icon+'")',t.childNodes[1].childNodes[0].style.backgroundPosition="center center",t.childNodes[1].childNodes[0].style.backgroundSize="auto",t.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?t.childNodes[1].appendChild(_.createTextNode(s.text)):t.childNodes[1].innerHTML+=s.text,i&&s.children.length&&(s.state.opened||a)&&s.state.loaded){for((m=_.createElement("UL")).setAttribute("role","group"),m.className="jstree-children",d=0,h=s.children.length;d<h;d++)m.appendChild(this.redraw_node(s.children[d],i,!0));t.appendChild(m)}if(c&&t.appendChild(c),!o){for(d=0,h=(r=r||this.element[0]).childNodes.length;d<h;d++)if(r.childNodes[d]&&r.childNodes[d].className&&-1!==r.childNodes[d].className.indexOf("jstree-children")){g=r.childNodes[d];break}g||((g=_.createElement("UL")).setAttribute("role","group"),g.className="jstree-children",r.appendChild(g)),n<(r=g).childNodes.length?r.insertBefore(t,r.childNodes[n]):r.appendChild(t),f&&(v=this.element[0].scrollTop,b=this.element[0].scrollLeft,t.childNodes[1].focus(),this.element[0].scrollTop=v,this.element[0].scrollLeft=b)}return s.state.opened&&!s.state.loaded&&(s.state.opened=!1,setTimeout(function(){this.open_node(s.id,!1,0)}.bind(this),0)),t},open_node:function(i,o,a){var s,r,n,l;if(e.vakata.is_array(i)){for(s=0,r=(i=i.slice()).length;s<r;s++)this.open_node(i[s],o,a);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root)&&(a=a===t?this.settings.core.animation:a,this.is_closed(i)?this.is_loaded(i)?(n=this.get_node(i,!0),l=this,n.length&&(a&&n.children(".jstree-children").length&&n.children(".jstree-children").stop(!0,!0),i.children.length&&!this._firstChild(n.children(".jstree-children")[0])&&this.draw_children(i),a?(this.trigger("before_open",{node:i}),n.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").children(".jstree-anchor").attr("aria-expanded",!0).end().children(".jstree-children").stop(!0,!0).slideDown(a,(function(){this.style.display="",l.element&&l.trigger("after_open",{node:i})}))):(this.trigger("before_open",{node:i}),n[0].className=n[0].className.replace("jstree-closed","jstree-open"),n[0].childNodes[1].setAttribute("aria-expanded",!0))),i.state.opened=!0,o&&o.call(this,i,!0),n.length||this.trigger("before_open",{node:i}),this.trigger("open_node",{node:i}),a&&n.length||this.trigger("after_open",{node:i}),!0):this.is_loading(i)?setTimeout(function(){this.open_node(i,o,a)}.bind(this),500):void this.load_node(i,(function(e,t){return t?this.open_node(e,o,a):!!o&&o.call(this,e,!1)})):(o&&o.call(this,i,!1),!1))},_open_to:function(t){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;for(var i=t.parents,o=0,a=i.length;o<a;o+=1)o!==e.jstree.root&&this.open_node(i[o],!1,0);return e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)},close_node:function(i,o){var a,s,r,n;if(e.vakata.is_array(i)){for(a=0,s=(i=i.slice()).length;a<s;a++)this.close_node(i[a],o);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root)&&!this.is_closed(i)&&(o=o===t?this.settings.core.animation:o,n=(r=this).get_node(i,!0),i.state.opened=!1,this.trigger("close_node",{node:i}),void(n.length?o?n.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").children(".jstree-anchor").attr("aria-expanded",!1).end().children(".jstree-children").stop(!0,!0).slideUp(o,(function(){this.style.display="",n.children(".jstree-children").remove(),r.element&&r.trigger("after_close",{node:i})})):(n[0].className=n[0].className.replace("jstree-open","jstree-closed"),n.children(".jstree-anchor").attr("aria-expanded",!1),n.children(".jstree-children").remove(),this.trigger("after_close",{node:i})):this.trigger("after_close",{node:i})))},toggle_node:function(t){var i,o;if(e.vakata.is_array(t)){for(i=0,o=(t=t.slice()).length;i<o;i++)this.toggle_node(t[i]);return!0}return this.is_closed(t)?this.open_node(t):this.is_open(t)?this.close_node(t):void 0},open_all:function(t,i,o){if(t=t||e.jstree.root,!(t=this.get_node(t)))return!1;var a,s,r,n=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0);if(!n.length){for(a=0,s=t.children_d.length;a<s;a++)this.is_closed(this._model.data[t.children_d[a]])&&(this._model.data[t.children_d[a]].state.opened=!0);return this.trigger("open_all",{node:t})}o=o||n,(n=(r=this).is_closed(t)?n.find(".jstree-closed").addBack():n.find(".jstree-closed")).each((function(){r.open_node(this,(function(e,t){t&&this.is_parent(e)&&this.open_all(e,i,o)}),i||0)})),0===o.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(o)})},close_all:function(t,i){if(t=t||e.jstree.root,!(t=this.get_node(t)))return!1;var o,a,s=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0),r=this;for(s.length&&(s=this.is_open(t)?s.find(".jstree-open").addBack():s.find(".jstree-open"),e(s.get().reverse()).each((function(){r.close_node(this,i||0)}))),o=0,a=t.children_d.length;o<a;o++)this._model.data[t.children_d[o]].state.opened=!1;this.trigger("close_all",{node:t})},is_disabled:function(e){return(e=this.get_node(e))&&e.state&&e.state.disabled},enable_node:function(t){var i,o;if(e.vakata.is_array(t)){for(i=0,o=(t=t.slice()).length;i<o;i++)this.enable_node(t[i]);return!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;t.state.disabled=!1,this.get_node(t,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1),this.trigger("enable_node",{node:t})},disable_node:function(t){var i,o;if(e.vakata.is_array(t)){for(i=0,o=(t=t.slice()).length;i<o;i++)this.disable_node(t[i]);return!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;t.state.disabled=!0,this.get_node(t,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0),this.trigger("disable_node",{node:t})},is_hidden:function(e){return!0===(e=this.get_node(e)).state.hidden},hide_node:function(t,i){var o,a;if(e.vakata.is_array(t)){for(o=0,a=(t=t.slice()).length;o<a;o++)this.hide_node(t[o],!0);return i||this.redraw(),!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;t.state.hidden||(t.state.hidden=!0,this._node_changed(t.parent),i||this.redraw(),this.trigger("hide_node",{node:t}))},show_node:function(t,i){var o,a;if(e.vakata.is_array(t)){for(o=0,a=(t=t.slice()).length;o<a;o++)this.show_node(t[o],!0);return i||this.redraw(),!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;t.state.hidden&&(t.state.hidden=!1,this._node_changed(t.parent),i||this.redraw(),this.trigger("show_node",{node:t}))},hide_all:function(t){var i,o=this._model.data,a=[];for(i in o)o.hasOwnProperty(i)&&i!==e.jstree.root&&!o[i].state.hidden&&(o[i].state.hidden=!0,a.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("hide_all",{nodes:a}),a},show_all:function(t){var i,o=this._model.data,a=[];for(i in o)o.hasOwnProperty(i)&&i!==e.jstree.root&&o[i].state.hidden&&(o[i].state.hidden=!1,a.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("show_all",{nodes:a}),a},activate_node:function(e,i){if(this.is_disabled(e))return!1;if(i&&"object"==typeof i||(i={}),this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==t?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&(!i.shiftKey||this._data.core.last_clicked&&this.get_parent(e)&&this.get_parent(e)===this._data.core.last_clicked.parent))if(i.shiftKey){for(var o=this.get_node(e).id,a=this._data.core.last_clicked.id,s=this.get_node(this._data.core.last_clicked.parent).children,r=!1,n=0,l=s.length;n<l;n+=1)s[n]===o&&(r=!r),s[n]===a&&(r=!r),this.is_disabled(s[n])||!r&&s[n]!==o&&s[n]!==a?i.ctrlKey||this.deselect_node(s[n],!0,i):this.is_hidden(s[n])||this.select_node(s[n],!0,!1,i);this.trigger("changed",{action:"select_node",node:this.get_node(e),selected:this._data.core.selected,event:i})}else this.is_selected(e)?this.deselect_node(e,!1,i):(i.ctrlKey&&(this._data.core.last_clicked=this.get_node(e)),this.select_node(e,!1,!1,i));else!this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&this.is_selected(e)?this.deselect_node(e,!1,i):(!this.settings.core.allow_reselect&&this.is_selected(e)&&1===this._data.core.selected.length||(this.deselect_all(!0),this.select_node(e,!1,!1,i)),this._data.core.last_clicked=this.get_node(e));this.trigger("activate_node",{node:this.get_node(e),event:i})},hover_node:function(e){if(!(e=this.get_node(e,!0))||!e.length||e.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),i=this.element;t&&t.length&&this.dehover_node(t),e.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(e)}),setTimeout((function(){i.attr("aria-activedescendant",e[0].id)}),0)},dehover_node:function(e){if(!(e=this.get_node(e,!0))||!e.length||!e.children(".jstree-hovered").length)return!1;e.children(".jstree-anchor").removeClass("jstree-hovered"),this.trigger("dehover_node",{node:this.get_node(e)})},select_node:function(t,i,o,a){var s,r,n;if(e.vakata.is_array(t)){for(r=0,n=(t=t.slice()).length;r<n;r++)this.select_node(t[r],i,o,a);return!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;s=this.get_node(t,!0),t.state.selected||(t.state.selected=!0,this._data.core.selected.push(t.id),(s=o?s:this._open_to(t))&&s.length&&s.children(".jstree-anchor").addClass("jstree-clicked").attr("aria-selected",!0),this.trigger("select_node",{node:t,selected:this._data.core.selected,event:a}),i||this.trigger("changed",{action:"select_node",node:t,selected:this._data.core.selected,event:a}))},deselect_node:function(t,i,o){var a,s,r;if(e.vakata.is_array(t)){for(a=0,s=(t=t.slice()).length;a<s;a++)this.deselect_node(t[a],i,o);return!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;r=this.get_node(t,!0),t.state.selected&&(t.state.selected=!1,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.id),r.length&&r.children(".jstree-anchor").removeClass("jstree-clicked").attr("aria-selected",!1),this.trigger("deselect_node",{node:t,selected:this._data.core.selected,event:o}),i||this.trigger("changed",{action:"deselect_node",node:t,selected:this._data.core.selected,event:o}))},select_all:function(t){var i,o,a=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data[e.jstree.root].children_d.concat(),i=0,o=this._data.core.selected.length;i<o;i++)this._model.data[this._data.core.selected[i]]&&(this._model.data[this._data.core.selected[i]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),t||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:a})},deselect_all:function(e){for(var t=this._data.core.selected.concat([]),i=0,o=this._data.core.selected.length;i<o;i++)this._model.data[this._data.core.selected[i]]&&(this._model.data[this._data.core.selected[i]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked").attr("aria-selected",!1),this.trigger("deselect_all",{selected:this._data.core.selected,node:t}),e||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:t})},is_selected:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.state.selected},get_selected:function(t){return t?e.map(this._data.core.selected,function(e){return this.get_node(e)}.bind(this)):this._data.core.selected.slice()},get_top_selected:function(t){for(var i,o,a=this.get_selected(!0),s={},r=0,n=a.length;r<n;r++)s[a[r].id]=a[r];for(r=0,n=a.length;r<n;r++)for(i=0,o=a[r].children_d.length;i<o;i++)s[a[r].children_d[i]]&&delete s[a[r].children_d[i]];for(r in a=[],s)s.hasOwnProperty(r)&&a.push(r);return t?e.map(a,function(e){return this.get_node(e)}.bind(this)):a},get_bottom_selected:function(t){for(var i=this.get_selected(!0),o=[],a=0,s=i.length;a<s;a++)i[a].children.length||o.push(i[a].id);return t?e.map(o,function(e){return this.get_node(e)}.bind(this)):o},get_state:function(){var t,i={core:{open:[],loaded:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}};for(t in this._model.data)this._model.data.hasOwnProperty(t)&&t!==e.jstree.root&&(this._model.data[t].state.loaded&&this.settings.core.loaded_state&&i.core.loaded.push(t),this._model.data[t].state.opened&&i.core.open.push(t),this._model.data[t].state.selected&&i.core.selected.push(t));return i},set_state:function(i,o){if(i){if(i.core&&i.core.selected&&i.core.initial_selection===t&&(i.core.initial_selection=this._data.core.selected.concat([]).sort().join(",")),i.core){var a,s;if(i.core.loaded)return this.settings.core.loaded_state&&e.vakata.is_array(i.core.loaded)&&i.core.loaded.length?this._load_nodes(i.core.loaded,(function(e){delete i.core.loaded,this.set_state(i,o)})):(delete i.core.loaded,this.set_state(i,o)),!1;if(i.core.open)return e.vakata.is_array(i.core.open)&&i.core.open.length?this._load_nodes(i.core.open,(function(e){this.open_node(e,!1,0),delete i.core.open,this.set_state(i,o)})):(delete i.core.open,this.set_state(i,o)),!1;if(i.core.scroll)return i.core.scroll&&i.core.scroll.left!==t&&this.element.scrollLeft(i.core.scroll.left),i.core.scroll&&i.core.scroll.top!==t&&this.element.scrollTop(i.core.scroll.top),delete i.core.scroll,this.set_state(i,o),!1;if(i.core.selected)return a=this,i.core.initial_selection!==t&&i.core.initial_selection!==this._data.core.selected.concat([]).sort().join(",")||(this.deselect_all(),e.each(i.core.selected,(function(e,t){a.select_node(t,!1,!0)}))),delete i.core.initial_selection,delete i.core.selected,this.set_state(i,o),!1;for(s in i)i.hasOwnProperty(s)&&"core"!==s&&-1===e.inArray(s,this.settings.plugins)&&delete i[s];if(e.isEmptyObject(i.core))return delete i.core,this.set_state(i,o),!1}return!e.isEmptyObject(i)||(i=null,o&&o.call(this),this.trigger("set_state"),!1)}return!1},refresh:function(t,i){this._data.core.state=!0===i?{}:this.get_state(),i&&e.vakata.is_function(i)&&(this._data.core.state=i.call(this,this._data.core.state)),this._cnt=0,this._model.data={},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this._data.core.selected=[],this._data.core.last_clicked=null,this._data.core.focused=null;var o=this.get_container_ul()[0].className;t||(this.element.html("<ul class='"+o+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='none' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' role='treeitem' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading")),this.load_node(e.jstree.root,(function(t,i){i&&(this.get_container_ul()[0].className=o,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(e.extend(!0,{},this._data.core.state),(function(){this.trigger("refresh")}))),this._data.core.state=null}))},refresh_node:function(t){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;var i=[],o=[],a=this._data.core.selected.concat([]);o.push(t.id),!0===t.state.opened&&i.push(t.id),this.get_node(t,!0).find(".jstree-open").each((function(){o.push(this.id),i.push(this.id)})),this._load_nodes(o,function(e){this.open_node(i,!1,0),this.select_node(a),this.trigger("refresh_node",{node:t,nodes:e})}.bind(this),!1,!0)},set_id:function(t,i){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;var o,a,s=this._model.data,r=t.id;for(i=i.toString(),s[t.parent].children[e.inArray(t.id,s[t.parent].children)]=i,o=0,a=t.parents.length;o<a;o++)s[t.parents[o]].children_d[e.inArray(t.id,s[t.parents[o]].children_d)]=i;for(o=0,a=t.children.length;o<a;o++)s[t.children[o]].parent=i;for(o=0,a=t.children_d.length;o<a;o++)s[t.children_d[o]].parents[e.inArray(t.id,s[t.children_d[o]].parents)]=i;return-1!==(o=e.inArray(t.id,this._data.core.selected))&&(this._data.core.selected[o]=i),(o=this.get_node(t.id,!0))&&(o.attr("id",i),this.element.attr("aria-activedescendant")===t.id&&this.element.attr("aria-activedescendant",i)),delete s[t.id],t.id=i,s[t.li_attr.id=i]=t,this.trigger("set_id",{node:t,new:t.id,old:r}),!0},get_text:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.text},set_text:function(t,i){var o,a;if(e.vakata.is_array(t)){for(o=0,a=(t=t.slice()).length;o<a;o++)this.set_text(t[o],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root||(t.text=i,this.get_node(t,!0).length&&this.redraw_node(t.id),this.trigger("set_text",{obj:t,text:i}),0))},get_json:function(t,i,o){if(!(t=this.get_node(t||e.jstree.root)))return!1;i&&i.flat&&!o&&(o=[]);var a,s,r={id:t.id,text:t.text,icon:this.get_icon(t),li_attr:e.extend(!0,{},t.li_attr),a_attr:e.extend(!0,{},t.a_attr),state:{},data:(!i||!i.no_data)&&e.extend(!0,e.vakata.is_array(t.data)?[]:{},t.data)};if(i&&i.flat?r.parent=t.parent:r.children=[],i&&i.no_state)delete r.state;else for(a in t.state)t.state.hasOwnProperty(a)&&(r.state[a]=t.state[a]);if(i&&i.no_li_attr&&delete r.li_attr,i&&i.no_a_attr&&delete r.a_attr,i&&i.no_id&&(delete r.id,r.li_attr&&r.li_attr.id&&delete r.li_attr.id,r.a_attr&&r.a_attr.id&&delete r.a_attr.id),i&&i.flat&&t.id!==e.jstree.root&&o.push(r),!i||!i.no_children)for(a=0,s=t.children.length;a<s;a++)i&&i.flat?this.get_json(t.children[a],i,o):r.children.push(this.get_json(t.children[a],i));return i&&i.flat?o:t.id===e.jstree.root?r.children:r},create_node:function(i,o,a,s,r){if(null===i&&(i=e.jstree.root),!(i=this.get_node(i)))return!1;if(!(a=a===t?"last":a).toString().match(/^(before|after)$/)&&!r&&!this.is_loaded(i))return this.load_node(i,(function(){this.create_node(i,o,a,s,!0)}));var n,l,c,d;switch((o="string"==typeof(o=o||{text:this.get_string("New node")})?{text:o}:e.extend(!0,{},o)).text===t&&(o.text=this.get_string("New node")),a=i.id===e.jstree.root&&"after"===(a="before"===a?"first":a)?"last":a){case"before":n=this.get_node(i.parent),a=e.inArray(i.id,n.children),i=n;break;case"after":n=this.get_node(i.parent),a=e.inArray(i.id,n.children)+1,i=n;break;case"inside":case"first":a=0;break;case"last":a=i.children.length;break;default:a=a||0}if(a>i.children.length&&(a=i.children.length),o.id===t&&(o.id=!0),!this.check("create_node",o,i,a))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!0===o.id&&delete o.id,!(o=this._parse_model_from_json(o,i.id,i.parents.concat())))return!1;for(n=this.get_node(o),(l=[]).push(o),l=l.concat(n.children_d),this.trigger("model",{nodes:l,parent:i.id}),i.children_d=i.children_d.concat(l),c=0,d=i.parents.length;c<d;c++)this._model.data[i.parents[c]].children_d=this._model.data[i.parents[c]].children_d.concat(l);for(o=n,n=[],c=0,d=i.children.length;c<d;c++)n[a<=c?c+1:c]=i.children[c];return n[a]=o.id,i.children=n,this.redraw_node(i,!0),this.trigger("create_node",{node:this.get_node(o),parent:i.id,position:a}),s&&s.call(this,this.get_node(o)),o.id},rename_node:function(t,i){var o,a,s;if(e.vakata.is_array(t)){for(o=0,a=(t=t.slice()).length;o<a;o++)this.rename_node(t[o],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root||(s=t.text,this.check("rename_node",t,this.get_parent(t),i)?(this.set_text(t,i),this.trigger("rename_node",{node:t,text:i,old:s}),0):(this.settings.core.error.call(this,this._data.core.last_error),1)))},delete_node:function(t){var i,o,a,s,r,n,l,c,d,h,m;if(e.vakata.is_array(t)){for(i=0,o=(t=t.slice()).length;i<o;i++)this.delete_node(t[i]);return!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;if(a=this.get_node(t.parent),m=e.inArray(t.id,a.children),d=!1,!this.check("delete_node",t,a,m))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==m&&(a.children=e.vakata.array_remove(a.children,m)),(s=t.children_d.concat([])).push(t.id),r=0,n=t.parents.length;r<n;r++)this._model.data[t.parents[r]].children_d=e.vakata.array_filter(this._model.data[t.parents[r]].children_d,(function(t){return-1===e.inArray(t,s)}));for(l=0,c=s.length;l<c;l++)if(this._model.data[s[l]].state.selected){d=!0;break}for(d&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,(function(t){return-1===e.inArray(t,s)}))),this.trigger("delete_node",{node:t,parent:a.id}),d&&this.trigger("changed",{action:"delete_node",node:t,selected:this._data.core.selected,parent:a.id}),l=0,c=s.length;l<c;l++)delete this._model.data[s[l]];return-1!==e.inArray(this._data.core.focused,s)&&(this._data.core.focused=null,h=this.element[0].scrollTop,m=this.element[0].scrollLeft,a.id===e.jstree.root?this._model.data[e.jstree.root].children[0]&&this.get_node(this._model.data[e.jstree.root].children[0],!0).children(".jstree-anchor").trigger("focus"):this.get_node(a,!0).children(".jstree-anchor").trigger("focus"),this.element[0].scrollTop=h,this.element[0].scrollLeft=m),this.redraw_node(a,!0),!0},check:function(t,i,o,a,s){i=i&&i.id?i:this.get_node(i),o=o&&o.id?o:this.get_node(o);var r=t.match(/^(move_node|copy_node|create_node)$/i)?o:i,n=this.settings.core.check_callback;if("move_node"===t||"copy_node"===t){if(!(s&&s.is_multi||"move_node"!==t||e.inArray(i.id,o.children)!==a))return!(this._data.core.last_error={error:"check",plugin:"core",id:"core_08",reason:"Moving node to its current position",data:JSON.stringify({chk:t,pos:a,obj:!(!i||!i.id)&&i.id,par:!(!o||!o.id)&&o.id})});if(!(s&&s.is_multi||i.id!==o.id&&("move_node"!==t||e.inArray(i.id,o.children)!==a)&&-1===e.inArray(o.id,i.children_d)))return!(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:t,pos:a,obj:!(!i||!i.id)&&i.id,par:!(!o||!o.id)&&o.id})})}return(r=r&&r.data?r.data:r)&&r.functions&&(!1===r.functions[t]||!0===r.functions[t])?(!1===r.functions[t]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+t,data:JSON.stringify({chk:t,pos:a,obj:!(!i||!i.id)&&i.id,par:!(!o||!o.id)&&o.id})}),r.functions[t]):!(!1===n||e.vakata.is_function(n)&&!1===n.call(this,t,i,o,a,s)||n&&!1===n[t])||!(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+t,data:JSON.stringify({chk:t,pos:a,obj:!(!i||!i.id)&&i.id,par:!(!o||!o.id)&&o.id})})},last_error:function(){return this._data.core.last_error},move_node:function(i,o,a,s,r,n,l){var c,d,h,m,u,_,p,f,g,v,b,y,C,k;if(o=this.get_node(o),a=a===t?0:a,!o)return!1;if(!a.toString().match(/^(before|after)$/)&&!r&&!this.is_loaded(o))return this.load_node(o,(function(){this.move_node(i,o,a,s,!0,!1,l)}));if(e.vakata.is_array(i)){if(1!==i.length){for(c=0,d=i.length;c<d;c++)(g=this.move_node(i[c],o,a,s,r,!1,l))&&(o=g,a="after");return this.redraw(),!0}i=i[0]}if(!(i=i&&i.id!==t?i:this.get_node(i))||i.id===e.jstree.root)return!1;if(h=(i.parent||e.jstree.root).toString(),u=a.toString().match(/^(before|after)$/)&&o.id!==e.jstree.root?this.get_node(o.parent):o,p=!(_=l||(this._model.data[i.id]?this:e.jstree.reference(i.id)))||!_._id||this._id!==_._id,m=_&&_._id&&h&&_._model.data[h]&&_._model.data[h].children?e.inArray(i.id,_._model.data[h].children):-1,_&&_._id&&(i=_._model.data[i.id]),p)return!!(g=this.copy_node(i,o,a,s,r,!1,l))&&(_&&_.delete_node(i),g);switch(a=o.id===e.jstree.root&&"after"===(a="before"===a?"first":a)?"last":a){case"before":a=e.inArray(o.id,u.children);break;case"after":a=e.inArray(o.id,u.children)+1;break;case"inside":case"first":a=0;break;case"last":a=u.children.length;break;default:a=a||0}if(a>u.children.length&&(a=u.children.length),!this.check("move_node",i,u,a,{core:!0,origin:l,is_multi:_&&_._id&&_._id!==this._id,is_foreign:!_||!_._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(i.parent===u.id){for(f=u.children.concat(),-1!==(g=e.inArray(i.id,f))&&(f=e.vakata.array_remove(f,g),g<a&&a--),g=[],v=0,b=f.length;v<b;v++)g[a<=v?v+1:v]=f[v];g[a]=i.id,u.children=g,this._node_changed(u.id),this.redraw(u.id===e.jstree.root)}else{for((g=i.children_d.concat()).push(i.id),v=0,b=i.parents.length;v<b;v++){for(f=[],y=0,C=(k=_._model.data[i.parents[v]].children_d).length;y<C;y++)-1===e.inArray(k[y],g)&&f.push(k[y]);_._model.data[i.parents[v]].children_d=f}for(_._model.data[h].children=e.vakata.array_remove_item(_._model.data[h].children,i.id),v=0,b=u.parents.length;v<b;v++)this._model.data[u.parents[v]].children_d=this._model.data[u.parents[v]].children_d.concat(g);for(f=[],v=0,b=u.children.length;v<b;v++)f[a<=v?v+1:v]=u.children[v];for(f[a]=i.id,u.children=f,u.children_d.push(i.id),u.children_d=u.children_d.concat(i.children_d),i.parent=u.id,(g=u.parents.concat()).unshift(u.id),k=i.parents.length,g=(i.parents=g).concat(),v=0,b=i.children_d.length;v<b;v++)this._model.data[i.children_d[v]].parents=this._model.data[i.children_d[v]].parents.slice(0,-1*k),Array.prototype.push.apply(this._model.data[i.children_d[v]].parents,g);h!==e.jstree.root&&u.id!==e.jstree.root||(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(h),this._node_changed(u.id)),n||this.redraw()}return s&&s.call(this,i,u,a),this.trigger("move_node",{node:i,parent:u.id,position:a,old_parent:h,old_position:m,is_multi:_&&_._id&&_._id!==this._id,is_foreign:!_||!_._id,old_instance:_,new_instance:this}),i.id},copy_node:function(i,o,a,s,r,n,l){var c,d,h,m,u,_,p,f,g,v;if(o=this.get_node(o),a=a===t?0:a,!o)return!1;if(!a.toString().match(/^(before|after)$/)&&!r&&!this.is_loaded(o))return this.load_node(o,(function(){this.copy_node(i,o,a,s,!0,!1,l)}));if(e.vakata.is_array(i)){if(1!==i.length){for(c=0,d=i.length;c<d;c++)(m=this.copy_node(i[c],o,a,s,r,!0,l))&&(o=m,a="after");return this.redraw(),!0}i=i[0]}if(!(i=i&&i.id!==t?i:this.get_node(i))||i.id===e.jstree.root)return!1;switch(f=(i.parent||e.jstree.root).toString(),g=a.toString().match(/^(before|after)$/)&&o.id!==e.jstree.root?this.get_node(o.parent):o,!(v=l||(this._model.data[i.id]?this:e.jstree.reference(i.id)))||!v._id||this._id!==v._id,v&&v._id&&(i=v._model.data[i.id]),a=o.id===e.jstree.root&&"after"===(a="before"===a?"first":a)?"last":a){case"before":a=e.inArray(o.id,g.children);break;case"after":a=e.inArray(o.id,g.children)+1;break;case"inside":case"first":a=0;break;case"last":a=g.children.length;break;default:a=a||0}if(a>g.children.length&&(a=g.children.length),!this.check("copy_node",i,g,a,{core:!0,origin:l,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!(p=v?v.get_json(i,{no_id:!0,no_data:!0,no_state:!0}):i))return!1;if(!0===p.id&&delete p.id,!(p=this._parse_model_from_json(p,g.id,g.parents.concat())))return!1;for(m=this.get_node(p),i&&i.state&&!1===i.state.loaded&&(m.state.loaded=!1),(h=[]).push(p),h=h.concat(m.children_d),this.trigger("model",{nodes:h,parent:g.id}),u=0,_=g.parents.length;u<_;u++)this._model.data[g.parents[u]].children_d=this._model.data[g.parents[u]].children_d.concat(h);for(h=[],u=0,_=g.children.length;u<_;u++)h[a<=u?u+1:u]=g.children[u];return h[a]=m.id,g.children=h,g.children_d.push(m.id),g.children_d=g.children_d.concat(m.children_d),g.id===e.jstree.root&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(g.id),n||this.redraw(g.id===e.jstree.root),s&&s.call(this,m,g,a),this.trigger("copy_node",{node:m,original:i,parent:g.id,position:a,old_parent:f,old_position:v&&v._id&&f&&v._model.data[f]&&v._model.data[f].children?e.inArray(i.id,v._model.data[f].children):-1,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id,old_instance:v,new_instance:this}),m.id},cut:function(t){if(t=t||this._data.core.selected.concat(),!(t=e.vakata.is_array(t)?t:[t]).length)return!1;for(var i,r=[],n=0,l=t.length;n<l;n++)(i=this.get_node(t[n]))&&(i.id||0===i.id)&&i.id!==e.jstree.root&&r.push(i);if(!r.length)return!1;o=r,a="move_node",(s=this).trigger("cut",{node:t})},copy:function(i){if(i=i||this._data.core.selected.concat(),!(i=e.vakata.is_array(i)?i:[i]).length)return!1;for(var r,n=[],l=0,c=i.length;l<c;l++)(r=this.get_node(i[l]))&&r.id!==t&&r.id!==e.jstree.root&&n.push(r);if(!n.length)return!1;o=n,a="copy_node",(s=this).trigger("copy",{node:i})},get_buffer:function(){return{mode:a,node:o,inst:s}},can_paste:function(){return!1!==a&&!1!==o},paste:function(e,t){if(!((e=this.get_node(e))&&a&&a.match(/^(copy_node|move_node)$/)&&o))return!1;this[a](o,e,t,!1,!1,!1,s)&&this.trigger("paste",{parent:e.id,node:o,mode:a}),s=a=o=!1},clear_buffer:function(){s=a=o=!1,this.trigger("clear_buffer")},edit:function(t,i,o){var a,s,r,n,c,d,h,m,u=!1;return!!(t=this.get_node(t))&&(this.check("edit",t,this.get_parent(t))?(m=t,i="string"==typeof i?i:t.text,this.set_text(t,""),t=this._open_to(t),m.text=i,h=this._data.core.rtl,a=this.element.width(),this._data.core.focused=m.id,s=t.children(".jstree-anchor").trigger("focus"),r=e("<span></span>"),n=i,c=e("<div></div>",{css:{position:"absolute",top:"-200px",left:h?"0px":"-1000px",visibility:"hidden"}}).appendTo(l.body),d=e("<input />",{value:n,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:function(i){i.stopImmediatePropagation(),i.preventDefault();var a=r.children(".jstree-rename-input").val();i=this.settings.core.force_text;""===a&&(a=n),c.remove(),r.replaceWith(s),r.remove(),n=i?n:e("<div></div>").append(e.parseHTML(n)).html(),t=this.get_node(t),this.set_text(t,n),(i=!!this.rename_node(t,i?e("<div></div>").text(a).text():e("<div></div>").append(e.parseHTML(a)).html()))||this.set_text(t,n),this._data.core.focused=m.id,setTimeout(function(){var e=this.get_node(m.id,!0);e.length&&(this._data.core.focused=m.id,e.children(".jstree-anchor").trigger("focus"))}.bind(this),0),o&&o.call(this,m,i,u,a),d=null}.bind(this),keydown:function(e){var t=e.which;27===t&&(u=!0,this.value=n),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){d.width(Math.min(c.text("pW"+this.value).width(),a))},keypress:function(e){if(13===e.which)return!1}}),h={fontFamily:s.css("fontFamily")||"",fontSize:s.css("fontSize")||"",fontWeight:s.css("fontWeight")||"",fontStyle:s.css("fontStyle")||"",fontStretch:s.css("fontStretch")||"",fontVariant:s.css("fontVariant")||"",letterSpacing:s.css("letterSpacing")||"",wordSpacing:s.css("wordSpacing")||""},r.attr("class",s.attr("class")).append(s.contents().clone()).append(d),s.replaceWith(r),c.css(h),d.css(h).width(Math.min(c.text("pW"+d[0].value).width(),a))[0].select(),void e(l).one("mousedown.jstree touchstart.jstree dnd_start.vakata",(function(t){d&&t.target!==d&&e(d).trigger("blur")}))):(this.settings.core.error.call(this,this._data.core.last_error),!1))},set_theme:function(t,i){if(!t)return!1;(i=!0===i?(this.settings.core.themes.dir||e.jstree.path+"/themes")+"/"+t+"/style.css":i)&&-1===e.inArray(i,r)&&(e("head").append('<link rel="stylesheet" href="'+i+'" type="text/css" />'),r.push(i)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=t,this.element.addClass("jstree-"+t),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+t+"-responsive"),this.trigger("set_theme",{theme:t})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),(this._data.core.themes.variant=e)&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped"),this.trigger("show_stripes")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped"),this.trigger("hide_stripes")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots"),this.trigger("show_dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots"),this.trigger("hide_dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons"),this.trigger("show_icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons"),this.trigger("hide_icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},show_ellipsis:function(){this._data.core.themes.ellipsis=!0,this.get_container_ul().addClass("jstree-ellipsis"),this.trigger("show_ellipsis")},hide_ellipsis:function(){this._data.core.themes.ellipsis=!1,this.get_container_ul().removeClass("jstree-ellipsis"),this.trigger("hide_ellipsis")},toggle_ellipsis:function(){this._data.core.themes.ellipsis?this.hide_ellipsis():this.show_ellipsis()},set_icon:function(i,o){var a,s,r,n;if(e.vakata.is_array(i)){for(a=0,s=(i=i.slice()).length;a<s;a++)this.set_icon(i[a],o);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root||(n=i.icon,i.icon=!0===o||null===o||o===t||""===o||o,r=this.get_node(i,!0).children(".jstree-anchor").children(".jstree-themeicon"),!1===o?(r.removeClass("jstree-themeicon-custom "+n).css("background","").removeAttr("rel"),this.hide_icon(i)):(!0===o||null===o||o===t||""===o?r.removeClass("jstree-themeicon-custom "+n).css("background","").removeAttr("rel"):-1===o.indexOf("/")&&-1===o.indexOf(".")?(r.removeClass(n).css("background",""),r.addClass(o+" jstree-themeicon-custom").attr("rel",o)):(r.removeClass(n).css("background",""),r.addClass("jstree-themeicon-custom").css("background","url('"+o+"') center center no-repeat").attr("rel",o)),!1===n&&this.show_icon(i)),0))},get_icon:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.icon},hide_icon:function(t){var i,o;if(e.vakata.is_array(t)){for(i=0,o=(t=t.slice()).length;i<o;i++)this.hide_icon(t[i]);return!0}return!(!(t=this.get_node(t))||t===e.jstree.root||(t.icon=!1,this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),0))},show_icon:function(t){var i,o,a;if(e.vakata.is_array(t)){for(i=0,o=(t=t.slice()).length;i<o;i++)this.show_icon(t[i]);return!0}return!(!(t=this.get_node(t))||t===e.jstree.root||(a=this.get_node(t,!0),t.icon=!a.length||a.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"),t.icon||(t.icon=!0),a.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),0))}},e.vakata={},e.vakata.attributes=function(t,i){t=e(t)[0];var o=i?{}:[];return t&&t.attributes&&e.each(t.attributes,(function(t,a){-1===e.inArray(a.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==a.value&&""!==e.vakata.trim(a.value)&&(i?o[a.name]=a.value:o.push(a.name))})),o},e.vakata.array_unique=function(e){for(var i=[],o={},a=0,s=e.length;a<s;a++)o[e[a]]===t&&(i.push(e[a]),o[e[a]]=!0);return i},e.vakata.array_remove=function(e,t){return e.splice(t,1),e},e.vakata.array_remove_item=function(t,i){return-1!==(i=e.inArray(i,t))?e.vakata.array_remove(t,i):t},e.vakata.array_filter=function(e,t,i,o,a){if(e.filter)return e.filter(t,i);for(a in o=[],e)~~a+""==a+""&&0<=a&&t.call(i,e[a],+a,e)&&o.push(e[a]);return o},e.vakata.trim=function(e){return String.prototype.trim?String.prototype.trim.call(e.toString()):e.toString().replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},e.vakata.is_function=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},e.vakata.is_array=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Function.prototype.bind||(Function.prototype.bind=function(){var e=this,t=arguments[0],i=Array.prototype.slice.call(arguments,1);if("function"!=typeof e)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");return function(){var o=i.concat(Array.prototype.slice.call(arguments));return e.apply(t,o)}}),e.jstree.plugins.changed=function(e,t){var i=[];this.trigger=function(e,o){if(o=o||{},"changed"===e.replace(".jstree","")){o.changed={selected:[],deselected:[]};for(var a={},s=0,r=i.length;s<r;s++)a[i[s]]=1;for(s=0,r=o.selected.length;s<r;s++)a[o.selected[s]]?a[o.selected[s]]=2:o.changed.selected.push(o.selected[s]);for(s=0,r=i.length;s<r;s++)1===a[i[s]]&&o.changed.deselected.push(i[s]);i=o.selected.slice()}t.trigger.call(this,e,o)},this.refresh=function(e,o){return i=[],t.refresh.apply(this,arguments)}};var h,m,u,_,p,f,g,v,b=l.createElement("I");b.className="jstree-icon jstree-checkbox",b.setAttribute("role","presentation"),e.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0,cascade_to_disabled:!0,cascade_to_hidden:!0},e.jstree.plugins.checkbox=function(i,o){this.bind=function(){o.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")}.bind(this)).on("loading.jstree",function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()}.bind(this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(this._undetermined.bind(this),50)}.bind(this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",function(e,t){for(var i=this._model.data,o=(i[t.parent],t.nodes),a=0,s=o.length;a<s;a++)i[o[a]].state.checked=i[o[a]].state.checked||i[o[a]].original&&i[o[a]].original.state&&i[o[a]].original.state.checked,i[o[a]].state.checked&&this._data.checkbox.selected.push(o[a])}.bind(this)),-1===this.settings.checkbox.cascade.indexOf("up")&&-1===this.settings.checkbox.cascade.indexOf("down")||this.element.on("model.jstree",function(t,i){var o,a,s,r,n,l,c=this._model.data,d=c[i.parent],h=i.nodes,m=[],u=(i=this.settings.checkbox.cascade,this.settings.checkbox.tie_selection);if(-1!==i.indexOf("down"))if(d.state[u?"selected":"checked"]){for(a=0,s=h.length;a<s;a++)c[h[a]].state[u?"selected":"checked"]=!0;this._data[u?"core":"checkbox"].selected=this._data[u?"core":"checkbox"].selected.concat(h)}else for(a=0,s=h.length;a<s;a++)if(c[h[a]].state[u?"selected":"checked"]){for(r=0,n=c[h[a]].children_d.length;r<n;r++)c[c[h[a]].children_d[r]].state[u?"selected":"checked"]=!0;this._data[u?"core":"checkbox"].selected=this._data[u?"core":"checkbox"].selected.concat(c[h[a]].children_d)}if(-1!==i.indexOf("up")){for(a=0,s=d.children_d.length;a<s;a++)c[d.children_d[a]].children.length||m.push(c[d.children_d[a]].parent);for(r=0,n=(m=e.vakata.array_unique(m)).length;r<n;r++)for(d=c[m[r]];d&&d.id!==e.jstree.root;){for(a=o=0,s=d.children.length;a<s;a++)o+=c[d.children[a]].state[u?"selected":"checked"];if(o!==s)break;d.state[u?"selected":"checked"]=!0,this._data[u?"core":"checkbox"].selected.push(d.id),(l=this.get_node(d,!0))&&l.length&&l.children(".jstree-anchor").attr("aria-selected",!0).addClass(u?"jstree-clicked":"jstree-checked"),d=this.get_node(d.parent)}}this._data[u?"core":"checkbox"].selected=e.vakata.array_unique(this._data[u?"core":"checkbox"].selected)}.bind(this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",function(t,i){var o,a,s=i.node,r=this._model.data,n=this.get_node(s.parent),l=(i=this.settings.checkbox.cascade,this.settings.checkbox.tie_selection),c={},d=this._data[l?"core":"checkbox"].selected;for(u=0,_=d.length;u<_;u++)c[d[u]]=!0;if(-1!==i.indexOf("down"))for(var h=this._cascade_new_checked_state(s.id,!0),m=s.children_d.concat(s.id),u=0,_=m.length;u<_;u++)-1<h.indexOf(m[u])?c[m[u]]=!0:delete c[m[u]];if(-1!==i.indexOf("up"))for(;n&&n.id!==e.jstree.root;){for(u=o=0,_=n.children.length;u<_;u++)o+=r[n.children[u]].state[l?"selected":"checked"];if(o!==_)break;n.state[l?"selected":"checked"]=!0,c[n.id]=!0,(a=this.get_node(n,!0))&&a.length&&a.children(".jstree-anchor").attr("aria-selected",!0).addClass(l?"jstree-clicked":"jstree-checked"),n=this.get_node(n.parent)}for(u in d=[],c)c.hasOwnProperty(u)&&d.push(u);this._data[l?"core":"checkbox"].selected=d}.bind(this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",function(t,i){for(var o,a=this.get_node(e.jstree.root),s=this._model.data,r=0,n=a.children_d.length;r<n;r++)(o=s[a.children_d[r]])&&o.original&&o.original.state&&o.original.state.undetermined&&(o.original.state.undetermined=!1)}.bind(this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",function(t,i){var o,a,s,r,n=i.node,l=(this.get_node(n,!0),this.settings.checkbox.cascade),c=this.settings.checkbox.tie_selection,d=(i=this._data[c?"core":"checkbox"].selected,n.children_d.concat(n.id));if(-1!==l.indexOf("down")&&(r=this._cascade_new_checked_state(n.id,!1),i=e.vakata.array_filter(i,(function(e){return-1===d.indexOf(e)||-1<r.indexOf(e)}))),-1!==l.indexOf("up")&&-1===i.indexOf(n.id)){for(o=0,a=n.parents.length;o<a;o++)(s=this._model.data[n.parents[o]]).state[c?"selected":"checked"]=!1,s&&s.original&&s.original.state&&s.original.state.undetermined&&(s.original.state.undetermined=!1),(s=this.get_node(n.parents[o],!0))&&s.length&&s.children(".jstree-anchor").attr("aria-selected",!1).removeClass(c?"jstree-clicked":"jstree-checked");i=e.vakata.array_filter(i,(function(e){return-1===n.parents.indexOf(e)}))}this._data[c?"core":"checkbox"].selected=i}.bind(this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",function(t,i){for(var o,a,s,r,n=this.get_node(i.parent),l=this._model.data,c=this.settings.checkbox.tie_selection;n&&n.id!==e.jstree.root&&!n.state[c?"selected":"checked"];){for(o=s=0,a=n.children.length;o<a;o++)s+=l[n.children[o]].state[c?"selected":"checked"];if(!(0<a&&s===a))break;n.state[c?"selected":"checked"]=!0,this._data[c?"core":"checkbox"].selected.push(n.id),(r=this.get_node(n,!0))&&r.length&&r.children(".jstree-anchor").attr("aria-selected",!0).addClass(c?"jstree-clicked":"jstree-checked"),n=this.get_node(n.parent)}}.bind(this)).on("move_node.jstree",function(t,i){var o,a,s,r,n,l=i.is_multi,c=i.old_parent,d=(i=this.get_node(i.parent),this._model.data),h=this.settings.checkbox.tie_selection;if(!l)for(o=this.get_node(c);o&&o.id!==e.jstree.root&&!o.state[h?"selected":"checked"];){for(s=a=0,r=o.children.length;s<r;s++)a+=d[o.children[s]].state[h?"selected":"checked"];if(!(0<r&&a===r))break;o.state[h?"selected":"checked"]=!0,this._data[h?"core":"checkbox"].selected.push(o.id),(n=this.get_node(o,!0))&&n.length&&n.children(".jstree-anchor").attr("aria-selected",!0).addClass(h?"jstree-clicked":"jstree-checked"),o=this.get_node(o.parent)}for(o=i;o&&o.id!==e.jstree.root;){for(s=a=0,r=o.children.length;s<r;s++)a+=d[o.children[s]].state[h?"selected":"checked"];if(a===r)o.state[h?"selected":"checked"]||(o.state[h?"selected":"checked"]=!0,this._data[h?"core":"checkbox"].selected.push(o.id),(n=this.get_node(o,!0))&&n.length&&n.children(".jstree-anchor").attr("aria-selected",!0).addClass(h?"jstree-clicked":"jstree-checked"));else{if(!o.state[h?"selected":"checked"])break;o.state[h?"selected":"checked"]=!1,this._data[h?"core":"checkbox"].selected=e.vakata.array_remove_item(this._data[h?"core":"checkbox"].selected,o.id),(n=this.get_node(o,!0))&&n.length&&n.children(".jstree-anchor").attr("aria-selected",!1).removeClass(h?"jstree-clicked":"jstree-checked")}o=this.get_node(o.parent)}}.bind(this))},this.get_undetermined=function(i){if(-1===this.settings.checkbox.cascade.indexOf("undetermined"))return[];for(var o,a,s={},r=this._model.data,n=this.settings.checkbox.tie_selection,l=this._data[n?"core":"checkbox"].selected,c=[],d=this,h=[],m=0,u=l.length;m<u;m++)if(r[l[m]]&&r[l[m]].parents)for(o=0,a=r[l[m]].parents.length;o<a&&s[r[l[m]].parents[o]]===t;o++)r[l[m]].parents[o]!==e.jstree.root&&(s[r[l[m]].parents[o]]=!0,c.push(r[l[m]].parents[o]));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each((function(){var i,n=d.get_node(this);if(n)if(n.state.loaded){for(m=0,u=n.children_d.length;m<u;m++)if(!(i=r[n.children_d[m]]).state.loaded&&i.original&&i.original.state&&i.original.state.undetermined&&!0===i.original.state.undetermined)for(s[i.id]===t&&i.id!==e.jstree.root&&(s[i.id]=!0,c.push(i.id)),o=0,a=i.parents.length;o<a;o++)s[i.parents[o]]===t&&i.parents[o]!==e.jstree.root&&(s[i.parents[o]]=!0,c.push(i.parents[o]))}else if(n.original&&n.original.state&&n.original.state.undetermined&&!0===n.original.state.undetermined)for(s[n.id]===t&&n.id!==e.jstree.root&&(s[n.id]=!0,c.push(n.id)),o=0,a=n.parents.length;o<a;o++)s[n.parents[o]]===t&&n.parents[o]!==e.jstree.root&&(s[n.parents[o]]=!0,c.push(n.parents[o]))})),m=0,u=c.length;m<u;m++)r[c[m]].state[n?"selected":"checked"]||h.push(i?r[c[m]]:c[m]);return h},this._undetermined=function(){if(null!==this.element){var e,t,i,o=this.get_undetermined(!1);for(this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),e=0,t=o.length;e<t;e++)(i=this.get_node(o[e],!0))&&i.length&&i.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")}},this.redraw_node=function(e,t,i,a){if(e=o.redraw_node.apply(this,arguments)){for(var s=null,r=null,n=0,l=e.childNodes.length;n<l;n++)if(e.childNodes[n]&&e.childNodes[n].className&&-1!==e.childNodes[n].className.indexOf("jstree-anchor")){s=e.childNodes[n];break}s&&(!this.settings.checkbox.tie_selection&&this._model.data[e.id].state.checked&&(s.className+=" jstree-checked"),r=b.cloneNode(!1),this._model.data[e.id].state.checkbox_disabled&&(r.className+=" jstree-checkbox-disabled"),s.insertBefore(r,s.childNodes[0]))}return i||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(this._undetermined.bind(this),50)),e},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(t){t=this.get_node(t);var i,o,a=this.settings.checkbox.cascade,s=this.settings.checkbox.tie_selection,r=this._data[s?"core":"checkbox"].selected,n=this._model.data;if(!t||!0===t.state[s?"selected":"checked"]||-1===a.indexOf("undetermined")||-1===a.indexOf("down")&&-1===a.indexOf("up"))return!1;if(!t.state.loaded&&!0===t.original.state.undetermined)return!0;for(i=0,o=t.children_d.length;i<o;i++)if(-1!==e.inArray(t.children_d[i],r)||!n[t.children_d[i]].state.loaded&&n[t.children_d[i]].original.state.undetermined)return!0;return!1},this.disable_checkbox=function(t){var i,o,a;if(e.vakata.is_array(t)){for(i=0,o=(t=t.slice()).length;i<o;i++)this.disable_checkbox(t[i]);return!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;a=this.get_node(t,!0),t.state.checkbox_disabled||(t.state.checkbox_disabled=!0,a&&a.length&&a.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-checkbox-disabled"),this.trigger("disable_checkbox",{node:t}))},this.enable_checkbox=function(t){var i,o,a;if(e.vakata.is_array(t)){for(i=0,o=(t=t.slice()).length;i<o;i++)this.enable_checkbox(t[i]);return!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;a=this.get_node(t,!0),t.state.checkbox_disabled&&(t.state.checkbox_disabled=!1,a&&a.length&&a.children(".jstree-anchor").children(".jstree-checkbox").removeClass("jstree-checkbox-disabled"),this.trigger("enable_checkbox",{node:t}))},this.activate_node=function(t,i){return!e(i.target).hasClass("jstree-checkbox-disabled")&&(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||e(i.target).hasClass("jstree-checkbox"))&&(i.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!e(i.target).hasClass("jstree-checkbox")?o.activate_node.call(this,t,i):!this.is_disabled(t)&&(this.is_checked(t)?this.uncheck_node(t,i):this.check_node(t,i),void this.trigger("activate_node",{node:this.get_node(t)})))},this.delete_node=function(t){if(this.settings.checkbox.tie_selection||e.vakata.is_array(t))return o.delete_node.call(this,t);var i,a,s,r=!1;if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;for((i=t.children_d.concat([])).push(t.id),a=0,s=i.length;a<s;a++)if(this._model.data[i[a]].state.checked){r=!0;break}return r&&(this._data.checkbox.selected=e.vakata.array_filter(this._data.checkbox.selected,(function(t){return-1===e.inArray(t,i)}))),o.delete_node.call(this,t)},this._cascade_new_checked_state=function(e,t){var i,o,a=this.settings.checkbox.tie_selection,s=this._model.data[e],r=[],n=[];if(!this.settings.checkbox.cascade_to_disabled&&s.state.disabled||!this.settings.checkbox.cascade_to_hidden&&s.state.hidden)c=this.get_checked_descendants(e),s.state[a?"selected":"checked"]&&c.push(s.id),r=r.concat(c);else{if(s.children)for(i=0,o=s.children.length;i<o;i++){var l=s.children[i],c=this._cascade_new_checked_state(l,t);r=r.concat(c);-1<c.indexOf(l)&&n.push(l)}var d=this.get_node(s,!0);e=0<n.length&&n.length<s.children.length;s.original&&s.original.state&&s.original.state.undetermined&&(s.original.state.undetermined=e),!e&&t&&n.length===s.children.length?(s.state[a?"selected":"checked"]=t,r.push(s.id),d.children(".jstree-anchor").attr("aria-selected",!0).addClass(a?"jstree-clicked":"jstree-checked")):(s.state[a?"selected":"checked"]=!1,d.children(".jstree-anchor").attr("aria-selected",!1).removeClass(a?"jstree-clicked":"jstree-checked"))}return r},this.get_checked_descendants=function(t){var i=this,o=i.settings.checkbox.tie_selection;t=i._model.data[t];return e.vakata.array_filter(t.children_d,(function(e){return i._model.data[e].state[o?"selected":"checked"]}))},this.check_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.select_node(t,!1,!0,i);var o,a,s;if(e.vakata.is_array(t)){for(a=0,s=(t=t.slice()).length;a<s;a++)this.check_node(t[a],i);return!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;o=this.get_node(t,!0),t.state.checked||(t.state.checked=!0,this._data.checkbox.selected.push(t.id),o&&o.length&&o.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:t,selected:this._data.checkbox.selected,event:i}))},this.uncheck_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.deselect_node(t,!1,i);var o,a,s;if(e.vakata.is_array(t)){for(o=0,a=(t=t.slice()).length;o<a;o++)this.uncheck_node(t[o],i);return!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;s=this.get_node(t,!0),t.state.checked&&(t.state.checked=!1,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,t.id),s.length&&s.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:t,selected:this._data.checkbox.selected,event:i}))},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var t,i;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data[e.jstree.root].children_d.concat(),t=0,i=this._data.checkbox.selected.length;t<i;t++)this._model.data[this._data.checkbox.selected[t]]&&(this._model.data[this._data.checkbox.selected[t]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();for(var e=this._data.checkbox.selected.concat([]),t=0,i=this._data.checkbox.selected.length;t<i;t++)this._model.data[this._data.checkbox.selected[t]]&&(this._model.data[this._data.checkbox.selected[t]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:e})},this.is_checked=function(t){return this.settings.checkbox.tie_selection?this.is_selected(t):!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.state.checked},this.get_checked=function(t){return this.settings.checkbox.tie_selection?this.get_selected(t):t?e.map(this._data.checkbox.selected,function(e){return this.get_node(e)}.bind(this)):this._data.checkbox.selected.slice()},this.get_top_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_top_selected(t);for(var i,o,a=this.get_checked(!0),s={},r=0,n=a.length;r<n;r++)s[a[r].id]=a[r];for(r=0,n=a.length;r<n;r++)for(i=0,o=a[r].children_d.length;i<o;i++)s[a[r].children_d[i]]&&delete s[a[r].children_d[i]];for(r in a=[],s)s.hasOwnProperty(r)&&a.push(r);return t?e.map(a,function(e){return this.get_node(e)}.bind(this)):a},this.get_bottom_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(t);for(var i=this.get_checked(!0),o=[],a=0,s=i.length;a<s;a++)i[a].children.length||o.push(i[a].id);return t?e.map(o,function(e){return this.get_node(e)}.bind(this)):o},this.load_node=function(t,i){var a,s,r;if(!e.vakata.is_array(t)&&!this.settings.checkbox.tie_selection&&(r=this.get_node(t))&&r.state.loaded)for(a=0,s=r.children_d.length;a<s;a++)this._model.data[r.children_d[a]].state.checked&&(this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,r.children_d[a]));return o.load_node.apply(this,arguments)},this.get_state=function(){var e=o.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection||(e.checkbox=this._data.checkbox.selected.slice()),e},this.set_state=function(t,i){var a,s=o.set_state.apply(this,arguments);return s&&t.checkbox?(this.settings.checkbox.tie_selection||(this.uncheck_all(),a=this,e.each(t.checkbox,(function(e,t){a.check_node(t)}))),delete t.checkbox,this.set_state(t,i),!1):s},this.refresh=function(e,t){return this.settings.checkbox.tie_selection&&(this._data.checkbox.selected=[]),o.refresh.apply(this,arguments)}},e.jstree.defaults.conditionalselect=function(){return!0},e.jstree.plugins.conditionalselect=function(e,t){this.activate_node=function(e,i){if(this.settings.conditionalselect.call(this,this.get_node(e),i))return t.activate_node.call(this,e,i)}},e.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(t,i){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(t){var i=e.jstree.reference(t.reference);t=i.get_node(t.reference);i.create_node(t,{},"last",(function(e){try{i.edit(e)}catch(t){setTimeout((function(){i.edit(e)}),0)}}))}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(t){var i=e.jstree.reference(t.reference);t=i.get_node(t.reference);i.edit(t)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(t){var i=e.jstree.reference(t.reference);t=i.get_node(t.reference);i.is_selected(t)?i.delete_node(i.get_selected()):i.delete_node(t)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(t){var i=e.jstree.reference(t.reference);t=i.get_node(t.reference);i.is_selected(t)?i.cut(i.get_top_selected()):i.cut(t)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(t){var i=e.jstree.reference(t.reference);t=i.get_node(t.reference);i.is_selected(t)?i.copy(i.get_top_selected()):i.copy(t)}},paste:{separator_before:!1,icon:!1,_disabled:function(t){return!e.jstree.reference(t.reference).can_paste()},separator_after:!1,label:"Paste",action:function(t){var i=e.jstree.reference(t.reference);t=i.get_node(t.reference);i.paste(t)}}}}}}},e.jstree.plugins.contextmenu=function(i,o){this.bind=function(){o.bind.call(this);var t,i,a=0,s=null;this.element.on("init.jstree loading.jstree ready.jstree",function(){this.get_container_ul().addClass("jstree-contextmenu")}.bind(this)).on("contextmenu.jstree",".jstree-anchor",function(e,t){"input"!==e.target.tagName.toLowerCase()&&(e.preventDefault(),a=e.ctrlKey?+new Date:0,(t||s)&&(a=+new Date+1e4),s&&clearTimeout(s),this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e))}.bind(this)).on("click.jstree",".jstree-anchor",function(t){this._data.contextmenu.visible&&(!a||250<+new Date-a)&&e.vakata.context.hide(),a=0}.bind(this)).on("touchstart.jstree",".jstree-anchor",(function(o){o.originalEvent&&o.originalEvent.changedTouches&&o.originalEvent.changedTouches[0]&&(t=o.originalEvent.changedTouches[0].clientX,i=o.originalEvent.changedTouches[0].clientY,s=setTimeout((function(){e(o.currentTarget).trigger("contextmenu",!0)}),750))})).on("touchmove.vakata.jstree",(function(o){s&&o.originalEvent&&o.originalEvent.changedTouches&&o.originalEvent.changedTouches[0]&&(10<Math.abs(t-o.originalEvent.changedTouches[0].clientX)||10<Math.abs(i-o.originalEvent.changedTouches[0].clientY))&&(clearTimeout(s),e.vakata.context.hide())})).on("touchend.vakata.jstree",(function(e){s&&clearTimeout(s)})),e(l).on("context_hide.vakata.jstree",function(t,i){this._data.contextmenu.visible=!1,e(i.reference).removeClass("jstree-context")}.bind(this))},this.teardown=function(){this._data.contextmenu.visible&&e.vakata.context.hide(),e(l).off("context_hide.vakata.jstree"),o.teardown.call(this)},this.show_contextmenu=function(i,o,a,s){if(!(i=this.get_node(i))||i.id===e.jstree.root)return!1;var r=this.settings.contextmenu,n=this.get_node(i,!0).children(".jstree-anchor"),l=!1,c=!1;!r.show_at_node&&o!==t&&a!==t||(l=n.offset(),o=l.left,a=l.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(i)&&this.activate_node(i,s),c=r.items,e.vakata.is_function(c)&&(c=c.call(this,i,function(e){this._show_contextmenu(i,o,a,e)}.bind(this))),e.isPlainObject(c)&&this._show_contextmenu(i,o,a,c)},this._show_contextmenu=function(t,i,o,a){var s=this.get_node(t,!0).children(".jstree-anchor");e(l).one("context_show.vakata.jstree",function(t,i){var o="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";e(i.element).addClass(o),s.addClass("jstree-context")}.bind(this)),this._data.contextmenu.visible=!0,e.vakata.context.show(s,{x:i,y:o},a),this.trigger("show_contextmenu",{node:t,x:i,y:o})}},u={element:m=!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1},(h=e).vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(e){h(l).triggerHandler("context_"+e+".vakata",{reference:u.reference,element:u.element,position:{x:u.position_x,y:u.position_y}})},_execute:function(e){return!(!(e=u.items[e])||e._disabled&&(!h.vakata.is_function(e._disabled)||e._disabled({item:e,reference:u.reference,element:u.element}))||!e.action)&&e.action.call(null,{item:e,reference:u.reference,element:u.element,position:{x:u.position_x,y:u.position_y}})},_parse:function(e,t){if(!e)return!1;t||(u.html="",u.items=[]);var i,o="",a=!1;return t&&(o+="<ul>"),h.each(e,(function(e,t){return!t||(u.items.push(t),!a&&t.separator_before&&(o+="<li class='vakata-context-separator'><a href='#' "+(h.vakata.context.settings.icons?"":'class="vakata-context-no-icons"')+">&#160;</a></li>"),a=!1,o+="<li class='"+(t._class||"")+(!0===t._disabled||h.vakata.is_function(t._disabled)&&t._disabled({item:t,reference:u.reference,element:u.element})?" vakata-contextmenu-disabled ":"")+"' "+(t.shortcut?" data-shortcut='"+t.shortcut+"' ":"")+">",o+="<a href='#' rel='"+(u.items.length-1)+"' "+(t.title?"title='"+t.title+"'":"")+">",h.vakata.context.settings.icons&&(o+="<i ",t.icon&&(-1!==t.icon.indexOf("/")||-1!==t.icon.indexOf(".")?o+=" style='background:url(\""+t.icon+"\") center center no-repeat' ":o+=" class='"+t.icon+"' "),o+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),o+=(h.vakata.is_function(t.label)?t.label({item:e,reference:u.reference,element:u.element}):t.label)+(t.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+t.shortcut+'">'+(t.shortcut_label||"")+"</span>":"")+"</a>",t.submenu&&(i=h.vakata.context._parse(t.submenu,!0))&&(o+=i),o+="</li>",void(t.separator_after&&(o+="<li class='vakata-context-separator'><a href='#' "+(h.vakata.context.settings.icons?"":'class="vakata-context-no-icons"')+">&#160;</a></li>",a=!0)))})),o=o.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),t&&(o+="</ul>"),t||(u.html=o,h.vakata.context._trigger("parse")),10<o.length&&o},_show_submenu:function(e){var t,i,o,a,s,r,n,l;(e=h(e)).length&&e.children("ul").length&&(t=e.children("ul"),o=(i=e.offset().left)+e.outerWidth(),a=e.offset().top,s=t.width(),r=t.height(),n=h(window).width()+h(window).scrollLeft(),l=h(window).height()+h(window).scrollTop(),m?e[o-(s+10+e.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):e[n<o+s&&n-o<i?"addClass":"removeClass"]("vakata-context-right"),l<a+r+10&&t.css("bottom","-1px"),e.hasClass("vakata-context-right")?i<s&&t.css("margin-right",i-s):n-o<s&&t.css("margin-left",n-o-s),t.show())},show:function(e,t,i){var o,a,s,r,n,c,d;switch(u.element&&u.element.length&&u.element.width(""),!0){case!t&&!e:return!1;case!!t&&!!e:u.reference=e,u.position_x=t.x,u.position_y=t.y;break;case!t&&!!e:o=(u.reference=e).offset(),u.position_x=o.left+e.outerHeight(),u.position_y=o.top;break;case!!t&&!e:u.position_x=t.x,u.position_y=t.y}e&&!i&&h(e).data("vakata_contextmenu")&&(i=h(e).data("vakata_contextmenu")),h.vakata.context._parse(i)&&u.element.html(u.html),u.items.length&&(u.element.appendTo(l.body),a=u.element,s=u.position_x,r=u.position_y,n=a.width(),c=a.height(),d=h(window).width()+h(window).scrollLeft(),i=h(window).height()+h(window).scrollTop(),m&&(s-=a.outerWidth()-h(e).outerWidth())<h(window).scrollLeft()+20&&(s=h(window).scrollLeft()+20),u.element.css({left:s=d<s+n+20?d-(n+20):s,top:r=i<r+c+20?i-(c+20):r}).show().find("a").first().trigger("focus").parent().addClass("vakata-context-hover"),u.is_visible=!0,h.vakata.context._trigger("show"))},hide:function(){u.is_visible&&(u.element.hide().find("ul").hide().end().find(":focus").trigger("blur").end().detach(),u.is_visible=!1,h.vakata.context._trigger("hide"))}},h((function(){m="rtl"===h(l.body).css("direction");var e=!1;u.element=h("<ul class='vakata-context'></ul>"),u.element.on("mouseenter","li",(function(t){t.stopImmediatePropagation(),h.contains(this,t.relatedTarget)||(e&&clearTimeout(e),u.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),h(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),h.vakata.context._show_submenu(this))})).on("mouseleave","li",(function(e){h.contains(this,e.relatedTarget)||h(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")})).on("mouseleave",(function(t){h(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),h.vakata.context.settings.hide_onmouseleave&&(e=setTimeout((this,function(){h.vakata.context.hide()}),h.vakata.context.settings.hide_onmouseleave))})).on("click","a",(function(e){e.preventDefault(),h(this).trigger("blur").parent().hasClass("vakata-context-disabled")||!1===h.vakata.context._execute(h(this).attr("rel"))||h.vakata.context.hide()})).on("keydown","a",(function(e){var t=null;switch(e.which){case 13:case 32:e.type="click",e.preventDefault(),h(e.currentTarget).trigger(e);break;case 37:u.is_visible&&(u.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").trigger("focus"),e.stopImmediatePropagation(),e.preventDefault());break;case 38:u.is_visible&&((t=(t=u.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first()).length?t:u.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()).addClass("vakata-context-hover").children("a").trigger("focus"),e.stopImmediatePropagation(),e.preventDefault());break;case 39:u.is_visible&&(u.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").trigger("focus"),e.stopImmediatePropagation(),e.preventDefault());break;case 40:u.is_visible&&((t=(t=u.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first()).length?t:u.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()).addClass("vakata-context-hover").children("a").trigger("focus"),e.stopImmediatePropagation(),e.preventDefault());break;case 27:h.vakata.context.hide(),e.preventDefault()}})).on("keydown",(function(e){e.preventDefault(),(e=u.element.find(".vakata-contextmenu-shortcut-"+e.which).parent()).parent().not(".vakata-context-disabled")&&e.trigger("click")})),h(l).on("mousedown.vakata.jstree",(function(e){u.is_visible&&u.element[0]!==e.target&&!h.contains(u.element[0],e.target)&&h.vakata.context.hide()})).on("context_show.vakata.jstree",(function(e,t){u.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),m&&u.element.addClass("vakata-context-rtl").css("direction","rtl"),u.element.find("ul").hide().end()}))})),e.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1,use_html5:!1,blank_space_drop:!1},e.jstree.plugins.dnd=function(t,i){this.init=function(e,t){i.init.call(this,e,t),this.settings.dnd.use_html5=this.settings.dnd.use_html5&&"draggable"in l.createElement("span")},this.bind=function(){i.bind.call(this),this.element.on(this.settings.dnd.use_html5?"dragstart.jstree":"mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",function(t){if(this.settings.dnd.large_drag_target&&e(t.target).closest(".jstree-node")[0]!==t.currentTarget)return!0;if("touchstart"===t.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))return!0;var i=this.get_node(t.target),o=this.is_selected(i)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,a=1<o?o+" "+this.get_string("nodes"):this.get_text(t.currentTarget);if(this.settings.core.force_text&&(a=e.vakata.html.escape(a)),i&&(i.id||0===i.id)&&i.id!==e.jstree.root&&(1===t.which||"touchstart"===t.type||"dragstart"===t.type)&&(!0===this.settings.dnd.is_draggable||e.vakata.is_function(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,1<o?this.get_top_selected(!0):[i],t))){if(_={jstree:!0,origin:this,obj:this.get_node(i,!0),nodes:1<o?this.get_top_selected():[i.id]},p=t.currentTarget,!this.settings.dnd.use_html5)return this.element.trigger("mousedown.jstree"),e.vakata.dnd.start(t,_,'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+a+'<ins class="jstree-copy">+</ins></div>');e.vakata.dnd._trigger("start",t,{helper:e(),element:p,data:_})}}.bind(this)),this.settings.dnd.use_html5&&this.element.on("dragover.jstree",(function(t){return t.preventDefault(),e.vakata.dnd._trigger("move",t,{helper:e(),element:p,data:_}),!1})).on("drop.jstree",function(t){return t.preventDefault(),e.vakata.dnd._trigger("stop",t,{helper:e(),element:p,data:_}),!1}.bind(this))},this.redraw_node=function(e,t,o,a){if((e=i.redraw_node.apply(this,arguments))&&this.settings.dnd.use_html5)if(this.settings.dnd.large_drag_target)e.setAttribute("draggable",!0);else{for(var s=null,r=0,n=e.childNodes.length;r<n;r++)if(e.childNodes[r]&&e.childNodes[r].className&&-1!==e.childNodes[r].className.indexOf("jstree-anchor")){s=e.childNodes[r];break}s&&s.setAttribute("draggable",!0)}return e}},e((function(){var i=!1,o=!1,a=!1,s=!1,r=e('<div id="jstree-marker">&#160;</div>').hide();e(l).on("dragover.vakata.jstree",(function(t){p&&e.vakata.dnd._trigger("move",t,{helper:e(),element:p,data:_})})).on("drop.vakata.jstree",(function(t){p&&(e.vakata.dnd._trigger("stop",t,{helper:e(),element:p,data:_}),_=p=null)})).on("dnd_start.vakata.jstree",(function(e,t){a=i=!1,t&&t.data&&t.data.jstree&&r.appendTo(l.body)})).on("dnd_move.vakata.jstree",(function(n,l){var c=l.event.target!==a.target;if(s&&(l.event&&"dragover"===l.event.type&&!c||clearTimeout(s)),l&&l.data&&l.data.jstree&&(!l.event.target.id||"jstree-marker"!==l.event.target.id)){a=l.event;var d,h,m,u,_,p,f,g,v,b,y,C,k,x,w,$,T,j=e.jstree.reference(l.event.target),I=!1,S=!1,M=!1;if(j&&j._data&&j._data.dnd)if(r.attr("class","jstree-"+j.get_theme()+(j.settings.core.themes.responsive?" jstree-dnd-responsive":"")),w=l.data.origin&&(l.data.origin.settings.dnd.always_copy||l.data.origin.settings.dnd.copy&&(l.event.metaKey||l.event.ctrlKey)),l.helper.children().attr("class","jstree-"+j.get_theme()+" jstree-"+j.get_theme()+"-"+j.get_theme_variant()+" "+(j.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[w?"show":"hide"](),l.event.target!==j.element[0]&&l.event.target!==j.get_container_ul()[0]||0!==j.get_container_ul().children().length&&!j.settings.dnd.blank_space_drop){if((I=j.settings.dnd.large_drop_target?e(l.event.target).closest(".jstree-node").children(".jstree-anchor"):e(l.event.target).closest(".jstree-anchor"))&&I.length&&I.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(S=I.offset(),M=(l.event.pageY!==t?l.event:l.event.originalEvent).pageY-S.top,m=I.outerHeight(),p=M<m/3?["b","i","a"]:m-m/3<M?["a","i","b"]:m/2<M?["i","a","b"]:["i","b","a"],e.each(p,(function(t,a){switch(a){case"b":d=S.left-6,h=S.top,u=j.get_parent(I),_=I.parent().index(),T="jstree-below";break;case"i":k=j.settings.dnd.inside_pos,x=j.get_node(I.parent()),d=S.left-2,h=S.top+m/2+1,u=x.id,_="first"===k?0:"last"===k?x.children.length:Math.min(k,x.children.length),T="jstree-inside";break;case"a":d=S.left-6,h=S.top+m,u=j.get_parent(I),_=I.parent().index()+1,T="jstree-above"}for(f=!0,g=0,v=l.data.nodes.length;g<v;g++)if(b=l.data.origin&&(l.data.origin.settings.dnd.always_copy||l.data.origin.settings.dnd.copy&&(l.event.metaKey||l.event.ctrlKey))?"copy_node":"move_node",y=_,"move_node"==b&&"a"===a&&l.data.origin&&l.data.origin===j&&u===j.get_parent(l.data.nodes[g])&&(C=j.get_node(u),y>e.inArray(l.data.nodes[g],C.children)&&--y),!(f=f&&(j&&j.settings&&j.settings.dnd&&!1===j.settings.dnd.check_while_dragging||j.check(b,l.data.origin&&l.data.origin!==j?l.data.origin.get_node(l.data.nodes[g]):l.data.nodes[g],u,y,{dnd:!0,ref:j.get_node(I.parent()),pos:a,origin:l.data.origin,is_multi:l.data.origin&&l.data.origin!==j,is_foreign:!l.data.origin})))){j&&j.last_error&&(o=j.last_error());break}var n,M;if("i"===a&&I.parent().is(".jstree-closed")&&j.settings.dnd.open_timeout&&(l.event&&"dragover"===l.event.type&&!c||(s&&clearTimeout(s),s=setTimeout((M=I,function(){n.open_node(M)}),(n=j).settings.dnd.open_timeout))),f)return($=j.get_node(u,!0)).hasClass(".jstree-dnd-parent")||(e(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),$.addClass("jstree-dnd-parent")),i={ins:j,par:u,pos:"i"!==a||"last"!==k||0!==_||j.is_loaded(x)?_:"last"},r.css({left:d+"px",top:h+"px"}).show(),r.removeClass("jstree-above jstree-inside jstree-below").addClass(T),l.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),l.event.originalEvent&&l.event.originalEvent.dataTransfer&&(l.event.originalEvent.dataTransfer.dropEffect=w?"copy":"move"),o={},!(p=!0)})),!0===p))return}else{for(f=!0,g=0,v=l.data.nodes.length;g<v&&(f=f&&j.check(l.data.origin&&(l.data.origin.settings.dnd.always_copy||l.data.origin.settings.dnd.copy&&(l.event.metaKey||l.event.ctrlKey))?"copy_node":"move_node",l.data.origin&&l.data.origin!==j?l.data.origin.get_node(l.data.nodes[g]):l.data.nodes[g],e.jstree.root,"last",{dnd:!0,ref:j.get_node(e.jstree.root),pos:"i",origin:l.data.origin,is_multi:l.data.origin&&l.data.origin!==j,is_foreign:!l.data.origin}));g++);if(f)return i={ins:j,par:e.jstree.root,pos:"last"},r.hide(),l.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),void(l.event.originalEvent&&l.event.originalEvent.dataTransfer&&(l.event.originalEvent.dataTransfer.dropEffect=w?"copy":"move"))}e(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),i=!1,l.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),l.event.originalEvent&&l.event.originalEvent.dataTransfer,r.hide()}})).on("dnd_scroll.vakata.jstree",(function(e,t){t&&t.data&&t.data.jstree&&(r.hide(),a=i=!1,t.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))})).on("dnd_stop.vakata.jstree",(function(t,n){if(e(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),s&&clearTimeout(s),n&&n.data&&n.data.jstree){r.hide().detach();var l,c,d=[];if(i){for(l=0,c=n.data.nodes.length;l<c;l++)d[l]=n.data.origin?n.data.origin.get_node(n.data.nodes[l]):n.data.nodes[l];i.ins[n.data.origin&&(n.data.origin.settings.dnd.always_copy||n.data.origin.settings.dnd.copy&&(n.event.metaKey||n.event.ctrlKey))?"copy_node":"move_node"](d,i.par,i.pos,!1,!1,!1,n.data.origin)}else(l=e(n.event.target).closest(".jstree")).length&&o&&o.error&&"check"===o.error&&(l=l.jstree(!0))&&l.settings.core.error.call(this,o);i=a=!1}})).on("keyup.jstree keydown.jstree",(function(t,n){(n=e.vakata.dnd._get())&&n.data&&n.data.jstree&&("keyup"===t.type&&27===t.which?(s&&clearTimeout(s),s=a=o=i=!1,r.hide().detach(),e.vakata.dnd._clean()):(n.helper.find(".jstree-copy").first()[n.data.origin&&(n.data.origin.settings.dnd.always_copy||n.data.origin.settings.dnd.copy&&(t.metaKey||t.ctrlKey))?"show":"hide"](),a&&(a.metaKey=t.metaKey,a.ctrlKey=t.ctrlKey,e.vakata.dnd._trigger("move",a))))}))})),g={element:!((f=e).vakata.html={div:f("<div></div>"),escape:function(e){return f.vakata.html.div.text(e).html()},strip:function(e){return f.vakata.html.div.empty().append(f.parseHTML(e)).text()}}),target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},f.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:10},_trigger:function(e,i,o){(o=o===t?f.vakata.dnd._get():o).event=i,f(l).triggerHandler("dnd_"+e+".vakata",o)},_get:function(){return{data:g.data,element:g.element,helper:g.helper}},_clean:function(){g.helper&&g.helper.remove(),g.scroll_i&&(clearInterval(g.scroll_i),g.scroll_i=!1),g={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},p=null,f(l).off("mousemove.vakata.jstree touchmove.vakata.jstree",f.vakata.dnd.drag),f(l).off("mouseup.vakata.jstree touchend.vakata.jstree",f.vakata.dnd.stop)},_scroll:function(e){if(!g.scroll_e||!g.scroll_l&&!g.scroll_t)return g.scroll_i&&(clearInterval(g.scroll_i),g.scroll_i=!1),!1;if(!g.scroll_i)return g.scroll_i=setInterval(f.vakata.dnd._scroll,100),!1;if(!0===e)return!1;var t=g.scroll_e.scrollTop();e=g.scroll_e.scrollLeft();g.scroll_e.scrollTop(t+g.scroll_t*f.vakata.dnd.settings.scroll_speed),g.scroll_e.scrollLeft(e+g.scroll_l*f.vakata.dnd.settings.scroll_speed),t===g.scroll_e.scrollTop()&&e===g.scroll_e.scrollLeft()||f.vakata.dnd._trigger("scroll",g.scroll_e)},start:function(e,t,i){"touchstart"===e.type&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e.target=l.elementFromPoint(e.originalEvent.changedTouches[0].pageX-window.pageXOffset,e.originalEvent.changedTouches[0].pageY-window.pageYOffset)),g.is_drag&&f.vakata.dnd.stop({});try{e.currentTarget.unselectable="on",e.currentTarget.onselectstart=function(){return!1},e.currentTarget.style&&(e.currentTarget.style.touchAction="none",e.currentTarget.style.msTouchAction="none",e.currentTarget.style.MozUserSelect="none")}catch(e){}return g.init_x=e.pageX,g.init_y=e.pageY,g.data=t,g.is_down=!0,g.element=e.currentTarget,g.target=e.target,g.is_touch="touchstart"===e.type,!1!==i&&(g.helper=f("<div id='vakata-dnd'></div>").html(i).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),f(l).on("mousemove.vakata.jstree touchmove.vakata.jstree",f.vakata.dnd.drag),f(l).on("mouseup.vakata.jstree touchend.vakata.jstree",f.vakata.dnd.stop),!1},drag:function(e){if("touchmove"===e.type&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e.target=l.elementFromPoint(e.originalEvent.changedTouches[0].pageX-window.pageXOffset,e.originalEvent.changedTouches[0].pageY-window.pageYOffset)),g.is_down){if(!g.is_drag){if(!(Math.abs(e.pageX-g.init_x)>(g.is_touch?f.vakata.dnd.settings.threshold_touch:f.vakata.dnd.settings.threshold)||Math.abs(e.pageY-g.init_y)>(g.is_touch?f.vakata.dnd.settings.threshold_touch:f.vakata.dnd.settings.threshold)))return;g.helper&&(g.helper.appendTo(l.body),g.helper_w=g.helper.outerWidth()),g.is_drag=!0,f(g.target).one("click.vakata",!1),f.vakata.dnd._trigger("start",e)}var t=!1,i=!1,o=!1,a=!1,s=!1,r=!1,n=!1,c=!1,d=!1,h=!1;return g.scroll_t=0,g.scroll_l=0,g.scroll_e=!1,f(f(e.target).parentsUntil("body").addBack().get().reverse()).filter((function(){return this.ownerDocument&&/^auto|scroll$/.test(f(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)})).each((function(){var t=f(this),i=t.offset();if(this.scrollHeight>this.offsetHeight&&(i.top+t.height()-e.pageY<f.vakata.dnd.settings.scroll_proximity&&(g.scroll_t=1),e.pageY-i.top<f.vakata.dnd.settings.scroll_proximity&&(g.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(i.left+t.width()-e.pageX<f.vakata.dnd.settings.scroll_proximity&&(g.scroll_l=1),e.pageX-i.left<f.vakata.dnd.settings.scroll_proximity&&(g.scroll_l=-1)),g.scroll_t||g.scroll_l)return g.scroll_e=f(this),!1})),g.scroll_e||(t=f(l),i=f(window),o=t.height(),a=i.height(),s=t.width(),r=i.width(),n=t.scrollTop(),c=t.scrollLeft(),a<o&&e.pageY-n<f.vakata.dnd.settings.scroll_proximity&&(g.scroll_t=-1),a<o&&a-(e.pageY-n)<f.vakata.dnd.settings.scroll_proximity&&(g.scroll_t=1),r<s&&e.pageX-c<f.vakata.dnd.settings.scroll_proximity&&(g.scroll_l=-1),r<s&&r-(e.pageX-c)<f.vakata.dnd.settings.scroll_proximity&&(g.scroll_l=1),(g.scroll_t||g.scroll_l)&&(g.scroll_e=t)),g.scroll_e&&f.vakata.dnd._scroll(!0),g.helper&&(d=parseInt(e.pageY+f.vakata.dnd.settings.helper_top,10),h=parseInt(e.pageX+f.vakata.dnd.settings.helper_left,10),s&&h+g.helper_w>s&&(h=s-(g.helper_w+2)),g.helper.css({left:h+"px",top:(d=o&&o<d+25?o-50:d)+"px"})),f.vakata.dnd._trigger("move",e),!1}},stop:function(e){var t;return"touchend"===e.type&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e.target=l.elementFromPoint(e.originalEvent.changedTouches[0].pageX-window.pageXOffset,e.originalEvent.changedTouches[0].pageY-window.pageYOffset)),g.is_drag?(e.target!==g.target&&f(g.target).off("click.vakata"),f.vakata.dnd._trigger("stop",e)):"touchend"===e.type&&e.target===g.target&&(t=setTimeout((function(){f(e.target).trigger("click")}),100),f(e.target).one("click",(function(){t&&clearTimeout(t)}))),f.vakata.dnd._clean(),!1}},e.jstree.defaults.massload=null,e.jstree.plugins.massload=function(t,i){this.init=function(e,t){this._data.massload={},i.init.call(this,e,t)},this._load_nodes=function(t,o,a,s){var r,n,l,c=this.settings.massload,d=[],h=this._model.data;if(!a){for(r=0,n=t.length;r<n;r++)h[t[r]]&&(h[t[r]].state.loaded||h[t[r]].state.failed)&&!s||(d.push(t[r]),(l=this.get_node(t[r],!0))&&l.length&&l.addClass("jstree-loading").attr("aria-busy",!0));if(this._data.massload={},d.length){if(e.vakata.is_function(c))return c.call(this,d,function(e){var r,n;if(e)for(r in e)e.hasOwnProperty(r)&&(this._data.massload[r]=e[r]);for(r=0,n=t.length;r<n;r++)(l=this.get_node(t[r],!0))&&l.length&&l.removeClass("jstree-loading").attr("aria-busy",!1);i._load_nodes.call(this,t,o,a,s)}.bind(this));if("object"==typeof c&&c&&c.url)return c=e.extend(!0,{},c),e.vakata.is_function(c.url)&&(c.url=c.url.call(this,d)),e.vakata.is_function(c.data)&&(c.data=c.data.call(this,d)),e.ajax(c).done(function(e,r,n){var c,d;if(e)for(c in e)e.hasOwnProperty(c)&&(this._data.massload[c]=e[c]);for(c=0,d=t.length;c<d;c++)(l=this.get_node(t[c],!0))&&l.length&&l.removeClass("jstree-loading").attr("aria-busy",!1);i._load_nodes.call(this,t,o,a,s)}.bind(this)).fail(function(e){i._load_nodes.call(this,t,o,a,s)}.bind(this))}}return i._load_nodes.call(this,t,o,a,s)},this._load_node=function(t,o){var a,s=null;return(a=this._data.massload[t.id])?(s=this["string"==typeof a?"_append_html_data":"_append_json_data"](t,"string"==typeof a?e(e.parseHTML(a)).filter((function(){return 3!==this.nodeType})):a,(function(e){o.call(this,e)})),(a=this.get_node(t.id,!0))&&a.length&&a.removeClass("jstree-loading").attr("aria-busy",!1),delete this._data.massload[t.id],s):i._load_node.call(this,t,o)}},e.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},e.jstree.plugins.search=function(i,o){this.bind=function(){o.bind.call(this),this._data.search.str="",this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this._data.search.smc=!1,this._data.search.hdn=[],this.element.on("search.jstree",function(t,i){if(this._data.search.som&&i.res.length){for(var o,a,s=this._model.data,r=[],n=0,l=i.res.length;n<l;n++)if(s[i.res[n]]&&!s[i.res[n]].state.hidden&&(r.push(i.res[n]),r=r.concat(s[i.res[n]].parents),this._data.search.smc))for(o=0,a=s[i.res[n]].children_d.length;o<a;o++)s[s[i.res[n]].children_d[o]]&&!s[s[i.res[n]].children_d[o]].state.hidden&&r.push(s[i.res[n]].children_d[o]);r=e.vakata.array_remove_item(e.vakata.array_unique(r),e.jstree.root),this._data.search.hdn=this.hide_all(!0),this.show_node(r,!0),this.redraw(!0)}}.bind(this)).on("clear_search.jstree",function(e,t){this._data.search.som&&t.res.length&&(this.show_node(this._data.search.hdn,!0),this.redraw(!0))}.bind(this))},this.search=function(i,o,a,s,r,n){if(!1===i||""===e.vakata.trim(i.toString()))return this.clear_search();s=(s=this.get_node(s))&&(s.id||0===s.id)?s.id:null,i=i.toString();var l,c,d=this.settings.search,h=d.ajax||!1,m=this._model.data,u=null,_=[],p=[];if(this._data.search.res.length&&!r&&this.clear_search(),a===t&&(a=d.show_only_matches),n===t&&(n=d.show_only_matches_children),!o&&!1!==h)return e.vakata.is_function(h)?h.call(this,i,function(t){t&&t.d&&(t=t.d),this._load_nodes(e.vakata.is_array(t)?e.vakata.array_unique(t):[],(function(){this.search(i,!0,a,s,r,n)}))}.bind(this),s):((h=e.extend({},h)).data||(h.data={}),h.data.str=i,s&&(h.data.inside=s),this._data.search.lastRequest&&this._data.search.lastRequest.abort(),this._data.search.lastRequest=e.ajax(h).fail(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(h)},this.settings.core.error.call(this,this._data.core.last_error)}.bind(this)).done(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.vakata.is_array(t)?e.vakata.array_unique(t):[],(function(){this.search(i,!0,a,s,r,n)}))}.bind(this)),this._data.search.lastRequest);if(r||(this._data.search.str=i,this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=a,this._data.search.smc=n),u=new e.vakata.search(i,!0,{caseSensitive:d.case_sensitive,fuzzy:d.fuzzy}),e.each(m[s||e.jstree.root].children_d,(function(e,t){var o=m[t];o.text&&!o.state.hidden&&(!d.search_leaves_only||o.state.loaded&&0===o.children.length)&&(d.search_callback&&d.search_callback.call(this,i,o)||!d.search_callback&&u.search(o.text).isMatch)&&(_.push(t),p=p.concat(o.parents))})),_.length){for(l=0,c=(p=e.vakata.array_unique(p)).length;l<c;l++)p[l]!==e.jstree.root&&m[p[l]]&&!0===this.open_node(p[l],null,0)&&this._data.search.opn.push(p[l]);r?(this._data.search.dom=this._data.search.dom.add(e(this.element[0].querySelectorAll("#"+e.map(_,(function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")})).join(", #")))),this._data.search.res=e.vakata.array_unique(this._data.search.res.concat(_))):(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(_,(function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")})).join(", #"))),this._data.search.res=_),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:i,res:this._data.search.res,show_only_matches:a})},this.clear_search=function(){this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.res.length&&(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(this._data.search.res,(function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")})).join(", #"))),this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search")),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=e()},this.redraw_node=function(t,i,a,s){if((t=o.redraw_node.apply(this,arguments))&&-1!==e.inArray(t.id,this._data.search.res)){for(var r=null,n=0,l=t.childNodes.length;n<l;n++)if(t.childNodes[n]&&t.childNodes[n].className&&-1!==t.childNodes[n].className.indexOf("jstree-anchor")){r=t.childNodes[n];break}r&&(r.className+=" jstree-search")}return t}},(v=e).vakata.search=function(e,t,i){i=i||{},!1!==(i=v.extend({},v.vakata.search.defaults,i)).fuzzy&&(i.fuzzy=!0),e=i.caseSensitive?e:e.toLowerCase();var o,a,s,r,n=i.location,l=i.distance,c=i.threshold,d=e.length;return 32<d&&(i.fuzzy=!1),i.fuzzy&&(o=1<<d-1,a=function(){var t={},i=0;for(i=0;i<d;i++)t[e.charAt(i)]=0;for(i=0;i<d;i++)t[e.charAt(i)]|=1<<d-i-1;return t}(),s=function(e,t){e/=d,t=Math.abs(n-t);return l?e+t/l:t?1:e}),r=function(t){if(t=i.caseSensitive?t.toString():t.toString().toLowerCase(),e===t||-1!==t.indexOf(e))return{isMatch:!0,score:0};if(!i.fuzzy)return{isMatch:!1,score:1};var r,l,h,m,u,_,p,f,g,v=t.length,b=c,y=t.indexOf(e,n),C=d+v,k=1,x=[];for(-1!==y&&(b=Math.min(s(0,y),b),-1!==(y=t.lastIndexOf(e,n+d))&&(b=Math.min(s(0,y),b))),y=-1,r=0;r<d;r++){for(h=0,m=C;h<m;)s(r,n+m)<=b?h=m:C=m,m=Math.floor((C-h)/2+h);for(C=m,_=Math.max(1,n-m+1),p=Math.min(n+m,v)+d,(f=new Array(p+2))[p+1]=(1<<r)-1,l=p;_<=l;l--)if(g=a[t.charAt(l-1)],f[l]=0===r?(f[l+1]<<1|1)&g:(f[l+1]<<1|1)&g|(u[l+1]|u[l])<<1|1|u[l+1],f[l]&o&&(k=s(r,l-1))<=b){if(b=k,x.push(y=l-1),!(n<y))break;_=Math.max(1,2*n-y)}if(s(r+1,n)>b)break;u=f}return{isMatch:0<=y,score:k}},!0===t?{search:r}:r(t)},v.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,caseSensitive:!1},e.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1};var y=!(e.jstree.plugins.sort=function(e,t){this.bind=function(){t.bind.call(this),this.element.on("model.jstree",function(e,t){this.sort(t.parent,!0)}.bind(this)).on("rename_node.jstree create_node.jstree",function(e,t){this.sort(t.parent||t.node.parent,!1),this.redraw_node(t.parent||t.node.parent,!0)}.bind(this)).on("move_node.jstree copy_node.jstree",function(e,t){this.sort(t.parent,!1),this.redraw_node(t.parent,!0)}.bind(this))},this.sort=function(e,t){var i,o;if((e=this.get_node(e))&&e.children&&e.children.length&&(e.children.sort(this.settings.sort.bind(this)),t))for(i=0,o=e.children_d.length;i<o;i++)this.sort(e.children_d[i],!1)}});e.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1,preserve_loaded:!1},e.jstree.plugins.state=function(t,i){this.bind=function(){i.bind.call(this);var e=function(){this.element.on(this.settings.state.events,function(){y&&clearTimeout(y),y=setTimeout(function(){this.save_state()}.bind(this),100)}.bind(this)),this.trigger("state_ready")}.bind(this);this.element.on("ready.jstree",function(t,i){this.element.one("restore_state.jstree",e),this.restore_state()||e()}.bind(this))},this.save_state=function(){var t=this.get_state();this.settings.state.preserve_loaded||delete t.core.loaded;t={state:t,ttl:this.settings.state.ttl,sec:+new Date};e.vakata.storage.set(this.settings.state.key,JSON.stringify(t))},this.restore_state=function(){var t=e.vakata.storage.get(this.settings.state.key);if(t)try{t=JSON.parse(t)}catch(e){return!1}return!(t&&t.ttl&&t.sec&&+new Date-t.sec>t.ttl||!(t=(t=t&&t.state?t.state:t)&&e.vakata.is_function(this.settings.state.filter)?this.settings.state.filter.call(this,t):t)||(this.settings.state.preserve_loaded||delete t.core.loaded,this.element.one("set_state.jstree",(function(i,o){o.instance.trigger("restore_state",{state:e.extend(!0,{},t)})})),this.set_state(t),0))},this.clear_state=function(){return e.vakata.storage.del(this.settings.state.key)}},e.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}},e.jstree.defaults.types={default:{}},e.jstree.defaults.types[e.jstree.root]={},e.jstree.plugins.types=function(i,o){this.init=function(i,a){var s,r;if(a&&a.types&&a.types.default)for(s in a.types)if("default"!==s&&s!==e.jstree.root&&a.types.hasOwnProperty(s))for(r in a.types.default)a.types.default.hasOwnProperty(r)&&a.types[s][r]===t&&(a.types[s][r]=a.types.default[r]);o.init.call(this,i,a),this._model.data[e.jstree.root].type=e.jstree.root},this.refresh=function(t,i){o.refresh.call(this,t,i),this._model.data[e.jstree.root].type=e.jstree.root},this.bind=function(){this.element.on("model.jstree",function(i,o){for(var a,s=this._model.data,r=o.nodes,n=this.settings.types,l="default",c=0,d=r.length;c<d;c++){if(l="default",s[r[c]].original&&s[r[c]].original.type&&n[s[r[c]].original.type]&&(l=s[r[c]].original.type),s[r[c]].data&&s[r[c]].data.jstree&&s[r[c]].data.jstree.type&&n[s[r[c]].data.jstree.type]&&(l=s[r[c]].data.jstree.type),s[r[c]].type=l,!0===s[r[c]].icon&&n[l].icon!==t&&(s[r[c]].icon=n[l].icon),n[l].li_attr!==t&&"object"==typeof n[l].li_attr)for(a in n[l].li_attr)n[l].li_attr.hasOwnProperty(a)&&"id"!==a&&(s[r[c]].li_attr[a]===t?s[r[c]].li_attr[a]=n[l].li_attr[a]:"class"===a&&(s[r[c]].li_attr.class=n[l].li_attr.class+" "+s[r[c]].li_attr.class));if(n[l].a_attr!==t&&"object"==typeof n[l].a_attr)for(a in n[l].a_attr)n[l].a_attr.hasOwnProperty(a)&&"id"!==a&&(s[r[c]].a_attr[a]===t?s[r[c]].a_attr[a]=n[l].a_attr[a]:"href"===a&&"#"===s[r[c]].a_attr[a]?s[r[c]].a_attr.href=n[l].a_attr.href:"class"===a&&(s[r[c]].a_attr.class=n[l].a_attr.class+" "+s[r[c]].a_attr.class))}s[e.jstree.root].type=e.jstree.root}.bind(this)),o.bind.call(this)},this.get_json=function(t,i,a){var s,r,n=this._model.data,l=i?e.extend(!0,{},i,{no_id:!1}):{},c=o.get_json.call(this,t,l,a);if(!1===c)return!1;if(e.vakata.is_array(c))for(s=0,r=c.length;s<r;s++)c[s].type=(c[s].id||0===c[s].id)&&n[c[s].id]&&n[c[s].id].type?n[c[s].id].type:"default",i&&i.no_id&&(delete c[s].id,c[s].li_attr&&c[s].li_attr.id&&delete c[s].li_attr.id,c[s].a_attr&&c[s].a_attr.id&&delete c[s].a_attr.id);else c.type=(c.id||0===c.id)&&n[c.id]&&n[c.id].type?n[c.id].type:"default",i&&i.no_id&&(c=this._delete_ids(c));return c},this._delete_ids=function(t){if(e.vakata.is_array(t)){for(var i=0,o=t.length;i<o;i++)t[i]=this._delete_ids(t[i]);return t}return delete t.id,t.li_attr&&t.li_attr.id&&delete t.li_attr.id,t.a_attr&&t.a_attr.id&&delete t.a_attr.id,t.children&&e.vakata.is_array(t.children)&&(t.children=this._delete_ids(t.children)),t},this.check=function(i,a,s,r,n){if(!1===o.check.call(this,i,a,s,r,n))return!1;a=a&&(a.id||0===a.id)?a:this.get_node(a),s=s&&(s.id||0===s.id)?s:this.get_node(s);var l,c,d,h,m=(m=a&&(a.id||0===a.id)?n&&n.origin?n.origin:e.jstree.reference(a.id):null)&&m._model&&m._model.data?m._model.data:null;switch(i){case"create_node":case"move_node":case"copy_node":if("move_node"!==i||-1===e.inArray(a.id,s.children)){if((l=this.get_rules(s)).max_children!==t&&-1!==l.max_children&&l.max_children===s.children.length)return!(this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+i,data:JSON.stringify({chk:i,pos:r,obj:!(!a||!a.id&&0!==a.id)&&a.id,par:!(!s||!s.id&&0!==s.id)&&s.id})});if(l.valid_children!==t&&-1!==l.valid_children&&-1===e.inArray(a.type||"default",l.valid_children))return!(this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+i,data:JSON.stringify({chk:i,pos:r,obj:!(!a||!a.id&&0!==a.id)&&a.id,par:!(!s||!s.id&&0!==s.id)&&s.id})});if(m&&a.children_d&&a.parents){for(d=c=0,h=a.children_d.length;d<h;d++)c=Math.max(c,m[a.children_d[d]].parents.length);c=c-a.parents.length+1}(c<=0||c===t)&&(c=1);do{if(l.max_depth!==t&&-1!==l.max_depth&&l.max_depth<c)return!(this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+i,data:JSON.stringify({chk:i,pos:r,obj:!(!a||!a.id&&0!==a.id)&&a.id,par:!(!s||!s.id&&0!==s.id)&&s.id})});s=this.get_node(s.parent),l=this.get_rules(s),c++}while(s)}}return!0},this.get_rules=function(e){return!!(e=this.get_node(e))&&((e=this.get_type(e,!0)).max_depth===t&&(e.max_depth=-1),e.max_children===t&&(e.max_children=-1),e.valid_children===t&&(e.valid_children=-1),e)},this.get_type=function(t,i){return!!(t=this.get_node(t))&&(i?e.extend({type:t.type},this.settings.types[t.type]):t.type)},this.set_type=function(i,o){var a,s,r,n,l,c,d,h,m=this._model.data;if(e.vakata.is_array(i)){for(s=0,r=(i=i.slice()).length;s<r;s++)this.set_type(i[s],o);return!0}if(a=this.settings.types,i=this.get_node(i),!a[o]||!i)return!1;if((d=this.get_node(i,!0))&&d.length&&(h=d.children(".jstree-anchor")),n=i.type,l=this.get_icon(i),i.type=o,!0!==l&&a[n]&&(a[n].icon===t||l!==a[n].icon)||this.set_icon(i,a[o].icon===t||a[o].icon),a[n]&&a[n].li_attr!==t&&"object"==typeof a[n].li_attr)for(c in a[n].li_attr)a[n].li_attr.hasOwnProperty(c)&&"id"!==c&&("class"===c?(m[i.id].li_attr.class=(m[i.id].li_attr.class||"").replace(a[n].li_attr[c],""),d&&d.removeClass(a[n].li_attr[c])):m[i.id].li_attr[c]===a[n].li_attr[c]&&(m[i.id].li_attr[c]=null,d&&d.removeAttr(c)));if(a[n]&&a[n].a_attr!==t&&"object"==typeof a[n].a_attr)for(c in a[n].a_attr)a[n].a_attr.hasOwnProperty(c)&&"id"!==c&&("class"===c?(m[i.id].a_attr.class=(m[i.id].a_attr.class||"").replace(a[n].a_attr[c],""),h&&h.removeClass(a[n].a_attr[c])):m[i.id].a_attr[c]===a[n].a_attr[c]&&("href"===c?(m[i.id].a_attr[c]="#",h&&h.attr("href","#")):(delete m[i.id].a_attr[c],h&&h.removeAttr(c))));if(a[o].li_attr!==t&&"object"==typeof a[o].li_attr)for(c in a[o].li_attr)a[o].li_attr.hasOwnProperty(c)&&"id"!==c&&(m[i.id].li_attr[c]===t?(m[i.id].li_attr[c]=a[o].li_attr[c],d&&("class"===c?d.addClass(a[o].li_attr[c]):d.attr(c,a[o].li_attr[c]))):"class"===c&&(m[i.id].li_attr.class=a[o].li_attr[c]+" "+m[i.id].li_attr.class,d&&d.addClass(a[o].li_attr[c])));if(a[o].a_attr!==t&&"object"==typeof a[o].a_attr)for(c in a[o].a_attr)a[o].a_attr.hasOwnProperty(c)&&"id"!==c&&(m[i.id].a_attr[c]===t?(m[i.id].a_attr[c]=a[o].a_attr[c],h&&("class"===c?h.addClass(a[o].a_attr[c]):h.attr(c,a[o].a_attr[c]))):"href"===c&&"#"===m[i.id].a_attr[c]?(m[i.id].a_attr.href=a[o].a_attr.href,h&&h.attr("href",a[o].a_attr.href)):"class"===c&&(m[i.id].a_attr.class=a[o].a_attr.class+" "+m[i.id].a_attr.class,h&&h.addClass(a[o].a_attr[c])));return!0}},e.jstree.defaults.unique={case_sensitive:!1,trim_whitespace:!1,duplicate:function(e,t){return e+" ("+t+")"}},e.jstree.plugins.unique=function(i,o){this.check=function(t,i,a,s,r){if(!1===o.check.call(this,t,i,a,s,r))return!1;if(i=i&&(i.id||0===i.id)?i:this.get_node(i),!(a=a&&(a.id||0===a.id)?a:this.get_node(a))||!a.children)return!0;for(var n,l="rename_node"===t?s:i.text,c=[],d=this.settings.unique.case_sensitive,h=this.settings.unique.trim_whitespace,m=this._model.data,u=0,_=a.children.length;u<_;u++)n=m[a.children[u]].text,d||(n=n.toLowerCase()),h&&(n=n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),c.push(n);switch(d||(l=l.toLowerCase()),h&&(l=l.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),t){case"delete_node":return!0;case"rename_node":return n=i.text||"",d||(n=n.toLowerCase()),h&&(n=n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),(u=-1===e.inArray(l,c)||i.text&&n===l)||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id&&0!==i.id)&&i.id,par:!(!a||!a.id&&0!==a.id)&&a.id})}),u;case"create_node":return(u=-1===e.inArray(l,c))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id&&0!==i.id)&&i.id,par:!(!a||!a.id&&0!==a.id)&&a.id})}),u;case"copy_node":return(u=-1===e.inArray(l,c))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id&&0!==i.id)&&i.id,par:!(!a||!a.id&&0!==a.id)&&a.id})}),u;case"move_node":return(u=i.parent===a.id&&(!r||!r.is_multi)||-1===e.inArray(l,c))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id&&0!==i.id)&&i.id,par:!(!a||!a.id&&0!==a.id)&&a.id})}),u}return!0},this.create_node=function(i,a,s,r,n){if(!a||"object"==typeof a&&a.text===t){if(null===i&&(i=e.jstree.root),!(i=this.get_node(i)))return o.create_node.call(this,i,a,s,r,n);if(!(s=s===t?"last":s).toString().match(/^(before|after)$/)&&!n&&!this.is_loaded(i))return o.create_node.call(this,i,a,s,r,n);a=a||{};for(var l,c,d=this._model.data,h=this.settings.unique.case_sensitive,m=this.settings.unique.trim_whitespace,u=this.settings.unique.duplicate,_=l=this.get_string("New node"),p=[],f=0,g=i.children.length;f<g;f++)c=d[i.children[f]].text,h||(c=c.toLowerCase()),m&&(c=c.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),p.push(c);for(f=1,c=_,h||(c=c.toLowerCase()),m&&(c=c.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""));-1!==e.inArray(c,p);)c=_=u.call(this,l,++f).toString(),h||(c=c.toLowerCase()),m&&(c=c.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""));a.text=_}return o.create_node.call(this,i,a,s,r,n)}};var C=l.createElement("DIV");if(C.setAttribute("unselectable","on"),C.setAttribute("role","presentation"),C.className="jstree-wholerow",C.innerHTML="&#160;",e.jstree.plugins.wholerow=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("ready.jstree set_state.jstree",function(){this.hide_dots()}.bind(this)).on("init.jstree loading.jstree ready.jstree",function(){this.get_container_ul().addClass("jstree-wholerow-ul")}.bind(this)).on("deselect_all.jstree",function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")}.bind(this)).on("changed.jstree",function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");for(var i=!1,o=0,a=t.selected.length;o<a;o++)(i=this.get_node(t.selected[o],!0))&&i.length&&i.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")}.bind(this)).on("open_node.jstree",function(e,t){this.get_node(t.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")}.bind(this)).on("hover_node.jstree dehover_node.jstree",function(e,t){"hover_node"===e.type&&this.is_disabled(t.node)||this.get_node(t.node,!0).children(".jstree-wholerow")["hover_node"===e.type?"addClass":"removeClass"]("jstree-wholerow-hovered")}.bind(this)).on("contextmenu.jstree",".jstree-wholerow",function(t){var i;this._data.contextmenu&&(t.preventDefault(),i=e.Event("contextmenu",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,pageX:t.pageX,pageY:t.pageY}),e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i))}.bind(this)).on("click.jstree",".jstree-wholerow",(function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).trigger("focus")})).on("dblclick.jstree",".jstree-wholerow",(function(t){t.stopImmediatePropagation();var i=e.Event("dblclick",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).trigger("focus")})).on("click.jstree",".jstree-leaf > .jstree-ocl",function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).trigger("focus")}.bind(this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",function(e){return e.stopImmediatePropagation(),this.is_disabled(e.currentTarget)||this.hover_node(e.currentTarget),!1}.bind(this)).on("mouseleave.jstree",".jstree-node",function(e){this.dehover_node(e.currentTarget)}.bind(this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),i.teardown.call(this)},this.redraw_node=function(t,o,a,s){var r;return(t=i.redraw_node.apply(this,arguments))&&(r=C.cloneNode(!0),-1!==e.inArray(t.id,this._data.core.selected)&&(r.className+=" jstree-wholerow-clicked"),this._data.core.focused&&this._data.core.focused===t.id&&(r.className+=" jstree-wholerow-hovered"),t.insertBefore(r,t.childNodes[0])),t}},window.customElements&&Object&&Object.create){(n=Object.create(HTMLElement.prototype)).createdCallback=function(){var t,i={core:{},plugins:[]};for(t in e.jstree.plugins)e.jstree.plugins.hasOwnProperty(t)&&this.attributes[t]&&(i.plugins.push(t),this.getAttribute(t)&&JSON.parse(this.getAttribute(t))&&(i[t]=JSON.parse(this.getAttribute(t))));for(t in e.jstree.defaults.core)e.jstree.defaults.core.hasOwnProperty(t)&&this.attributes[t]&&(i.core[t]=JSON.parse(this.getAttribute(t))||this.getAttribute(t));e(this).jstree(i)};try{window.customElements.define("vakata-jstree",(function(){}),{prototype:n})}catch(n){}}}})),function(e){"use strict";e.fn.bootstrapSwitch=function(t){var i='input[type!="hidden"]',o={init:function(){return this.each((function(){var t,o,a,s,r,n,l=e(this),c=l.closest("form"),d="",h=l.attr("class"),m="ON",u="OFF",_=!1,p=!1;e.each(["switch-mini","switch-small","switch-large"],(function(e,t){h.indexOf(t)>=0&&(d=t)})),l.addClass("has-switch"),void 0!==l.data("on")&&(r="switch-"+l.data("on")),void 0!==l.data("on-label")&&(m=l.data("on-label")),void 0!==l.data("off-label")&&(u=l.data("off-label")),void 0!==l.data("label-icon")&&(_=l.data("label-icon")),void 0!==l.data("text-label")&&(p=l.data("text-label")),o=e("<span>").addClass("switch-left").addClass(d).addClass(r).html(m),r="",void 0!==l.data("off")&&(r="switch-"+l.data("off")),a=e("<span>").addClass("switch-right").addClass(d).addClass(r).html(u),s=e("<label>").html("&nbsp;").addClass(d).attr("for",l.find(i).attr("id")),_&&s.html('<i class="icon '+_+'"></i>'),p&&s.html(""+p),t=l.find(i).wrap(e("<div>")).parent().data("animated",!1),!1!==l.data("animated")&&t.addClass("switch-animate").data("animated",!0),t.append(o).append(s).append(a),l.find(">div").addClass(l.find(i).is(":checked")?"switch-on":"switch-off"),l.find(i).is(":disabled")&&e(this).addClass("deactivate");var f=function(e){l.parent("label").is(".label-change-switch")||e.siblings("label").trigger("mousedown").trigger("mouseup").trigger("click")};l.on("keydown",(function(t){32===t.keyCode&&(t.stopImmediatePropagation(),t.preventDefault(),f(e(t.target).find("span:first")))})),o.on("click",(function(t){f(e(this))})),a.on("click",(function(t){f(e(this))})),l.find(i).on("change",(function(t,i){var o=e(this),a=o.parent(),s=o.is(":checked"),r=a.is(".switch-off");if(t.preventDefault(),a.css("left",""),r===s){if(s?a.removeClass("switch-off").addClass("switch-on"):a.removeClass("switch-on").addClass("switch-off"),!1!==a.data("animated")&&a.addClass("switch-animate"),"boolean"==typeof i&&i)return;a.parent().trigger("switch-change",{el:o,value:s})}})),l.find("label").on("mousedown touchstart",(function(t){var i=e(this);n=!1,t.preventDefault(),t.stopImmediatePropagation(),i.closest("div").removeClass("switch-animate"),i.closest(".has-switch").is(".deactivate")||i.closest(".switch-on").parent().is(".radio-no-uncheck")?i.off("click"):(i.on("mousemove touchmove",(function(t){var i=e(this).closest(".make-switch"),o=((t.pageX||t.originalEvent.targetTouches[0].pageX)-i.offset().left)/i.width()*100;n=!0,o<25?o=25:o>75&&(o=75),i.find(">div").css("left",o-75+"%")})),i.on("click touchend",(function(t){var i=e(this),o=e(t.target).siblings("input");t.stopImmediatePropagation(),t.preventDefault(),i.off("mouseleave"),n?o.prop("checked",!(parseInt(i.parent().css("left"))<-25)):o.prop("checked",!o.is(":checked")),n=!1,o.trigger("change")})),i.on("mouseleave",(function(t){var i=e(this),o=i.siblings("input");t.preventDefault(),t.stopImmediatePropagation(),i.off("mouseleave"),i.trigger("mouseup"),o.prop("checked",!(parseInt(i.parent().css("left"))<-25)).trigger("change")})),i.on("mouseup",(function(t){t.stopImmediatePropagation(),t.preventDefault(),e(this).off("mousemove")})))})),"injected"!==c.data("bootstrapSwitch")&&(c.on("reset",(function(){setTimeout((function(){c.find(".make-switch").each((function(){var t=e(this).find(i);t.prop("checked",t.is(":checked")).trigger("change")}))}),1)})),c.data("bootstrapSwitch","injected"))}))},toggleActivation:function(){var t=e(this);t.toggleClass("deactivate"),t.find(i).prop("disabled",t.is(".deactivate"))},isActive:function(){return!e(this).hasClass("deactivate")},setActive:function(t){var o=e(this);t?(o.removeClass("deactivate"),o.find(i).prop("disabled",!1)):(o.addClass("deactivate"),o.find(i).attr("disabled","disabled"))},toggleState:function(t){var i=e(this).find(":checkbox");i.prop("checked",!i.is(":checked")).trigger("change",t)},toggleRadioState:function(t){var i=e(this).find(":radio");i.not(":checked").prop("checked",!i.is(":checked")).trigger("change",t)},toggleRadioStateAllowUncheck:function(t,i){var o=e(this).find(":radio");t?o.not(":checked").trigger("change",i):o.not(":checked").prop("checked",!o.is(":checked")).trigger("change",i)},setState:function(t,o){e(this).find(i).prop("checked",t).trigger("change",o)},setOnLabel:function(t){e(this).find(".switch-left").html(t)},setOffLabel:function(t){e(this).find(".switch-right").html(t)},setOnClass:function(t){var i=e(this).find(".switch-left"),o="";void 0!==t&&(void 0!==e(this).attr("data-on")&&(o="switch-"+e(this).attr("data-on")),i.removeClass(o),o="switch-"+t,i.addClass(o))},setOffClass:function(t){var i=e(this).find(".switch-right"),o="";void 0!==t&&(void 0!==e(this).attr("data-off")&&(o="switch-"+e(this).attr("data-off")),i.removeClass(o),o="switch-"+t,i.addClass(o))},setAnimated:function(t){var o=e(this).find(i).parent();void 0===t&&(t=!1),o.data("animated",t),o.attr("data-animated",t),!1!==o.data("animated")?o.addClass("switch-animate"):o.removeClass("switch-animate")},setSizeClass:function(t){var i=e(this),o=i.find(".switch-left"),a=i.find(".switch-right"),s=i.find("label");e.each(["switch-mini","switch-small","switch-large"],(function(e,i){i!==t?(o.removeClass(i),a.removeClass(i),s.removeClass(i)):(o.addClass(i),a.addClass(i),s.addClass(i))}))},status:function(){return e(this).find(i).is(":checked")},destroy:function(){var t,i=e(this),o=i.find("div"),a=i.closest("form");return o.find(":not(input)").remove(),(t=o.children()).unwrap().unwrap(),t.off("change"),a&&(a.off("reset"),a.removeData("bootstrapSwitch")),t}};return o[t]?o[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist!"):o.init.apply(this,arguments)}}(jQuery),melisCore.screenSize>=768&&$(window).on("scroll click resize",(function(e){$("#id_meliscommerce_categories_category_header").css("width","100%");var t=$("#"+activeTabId+" #id_meliscommerce_categories_category"),i=$("#id_meliscommerce_categories_category_tabs .widget-head ul li.active a.search.active");t.length&&(t.position().top<$(window).scrollTop()-10&&1!==i.length?($("#id_meliscommerce_categories_category").addClass("fix-cat"),$("#saveCategory").css("margin-top","10px"),$("#id_meliscommerce_categories_category_header").width($("#id_meliscommerce_categories_list").width())):($("#id_meliscommerce_categories_category").removeClass("fix-cat"),$("#categoryInfoPanel").css("padding-top","0"),$("#saveCategory").css("margin-top","0")))}));var categoryOpeningItemFlag=!0;$((function(){var e=$("body");e.on("click",".addCategory",(function(e){$("#categoryTreeViewPanel").collapse("hide");var t="id_meliscommerce_categories_category",i=$("#categoryTreeView").jstree(!0).get_selected(),o="";i.length>=1&&(o=parseInt(i[0])),$("#"+t).removeClass("hidden"),melisHelper.zoneReload(t,"meliscommerce_categories_category",{catId:0,catFatherId:o}),melisCommerce.setUniqueId(0)})),e.on("click",".addCatalog",(function(e){$("#categoryTreeViewPanel").collapse("hide");var t="id_meliscommerce_categories_category";$("#"+t).removeClass("hidden"),melisHelper.zoneReload(t,"meliscommerce_categories_category",{catId:0,catFatherId:-1}),melisCommerce.setUniqueId(0)})),e.on("click","#saveCategory",(function(){var e=$(this),t=e.data("catid"),o=new Array;e.attr("disabled","disabled"),(o=$("#id_meliscommerce_categories_category form").not(".category_"+t+"_seo_form, .cat_trans_form").serializeArray()).push({name:"cat_id",value:t}),o=melisCommerceSeo.serializeSeo("category",t,o);var a=e.data("catfatherid");o.push({name:"cat_father_cat_id",value:a});var s=0;$('input[name="cat_status"]').is(":checked")&&(s=1),o.push({name:"cat_status",value:s}),$("form.cat_trans_form").each((function(){var e=$(this);langLocale=e.data("locale"),langId=e.data("langid"),catDataString=e.serializeArray(),$.each(catDataString,(function(){o.push({name:"cat_trans["+langId+"]["+this.name+"]",value:this.value})}))})),$("form.categoriesPriceDiscountForm").each((function(){var e=$(this),t=e.data("countryid"),i=e.data("groupid"),a=e.serializeArray();$.each(a,(function(){""!==this.value&&o.push({name:"price_discount["+t+"]["+i+"]["+this.name+"]",value:this.value})}))})),o=$.param(o),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComCategory/saveCategory",data:o,dataType:"json",encode:!0,cache:!1}).done((function(e){$("body");if($("#saveCategory").removeAttr("disabled"),e.success){$("#categoryTreeViewPanel").collapse("show"),$("body").animate({scrollTop:0},1e3),melisCore.flashMessenger(),melisHelper.melisOkNotification(e.textTitle,e.textMessage);var o=$("#categoryTreeView").jstree(!0),s=o.settings.core.data.url,r="";if(0==t){var n=o.get_node(a),l=new Array;if(nodeParentsStr="",l.push(a),"object"==typeof n&&n.parents.length>1)for(i=0;i<n.parents.length-1;i++)l.push(n.parents[i]);nodeParentsStr="&openStateParent="+l.join(),r=e.cat_id}else{n=o.get_node(t),l=new Array;if(nodeParentsStr="",!1!==n){if(n.parents.length>1){for(i=0;i<n.parents.length-1;i++)l.push(n.parents[i]);nodeParentsStr="&openStateParent="+l.join()}o.get_node(t).state.selected=!0}r=t}o.settings.core.data.url=s+"&selected="+r+nodeParentsStr,o.deselect_all(),$("#categoryTreeView ul li div").removeClass("jstree-wholerow-clicked"),o.refresh(),o.settings.core.data.url=s;melisHelper.zoneReload("id_meliscommerce_categories_category","meliscommerce_categories_category",{catId:r}),melisCommerce.setUniqueId(r),$("#categoryTreeView #"+r+" div").first().addClass("jstree-wholerow-clicked")}else melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"id_meliscommerce_categories_category_form_transalations");melisCore.flashMessenger()})).fail((function(){$("#saveCategory").removeAttr("disabled"),alert(translations.tr_meliscore_error_message)}))})),e.on("click",".category-tree-view-lang.commerce-category-tree-view-lang li a",(function(){var e=$(this),t=e.text(),i=e.data("locale");categoryOpeningItemFlag=!1,$(".cat-tree-view-languages.commerce-category-tree-view-languages span.filter-key").text(t),$("#categoryTreeView").data("langlocale",i),$("#categoryTreeView").jstree(!0).settings.core.data.data=[{name:"langlocale",value:i}],$("#categoryTreeView").jstree(!0).refresh()})),e.on("keyup","#categoryTreeViewSearchInput",(function(e){var t=$(this).val().trim(),i=$("#categoryTreeView").jstree("search",t);categoryOpeningItemFlag=!1,setTimeout((function(){0==$(i).find(".jstree-search").length&&""!=t?($("#searchNoResult").removeClass("hidden"),$("#searchNoResult").find("strong").text(t)):$("#searchNoResult").addClass("hidden")}),1500)})),e.on("keyup keypress","#categoryTreeViewSearchForm",(function(e){if(13===(e.keyCode||e.which))return e.preventDefault(),!1})),e.on("click","#clearSearchInputBtn",(function(e){$("#categoryTreeView").jstree(!0);categoryOpeningItemFlag=!1,$("#categoryTreeViewSearchInput").val(""),$("#categoryTreeView").jstree("search","")})),e.on("click","#expandCategoryTreeViewBtn",(function(e){categoryOpeningItemFlag=!1,$("#categoryTreeView").jstree("open_all")})),e.on("click","#collapseCategoryTreeViewBtn",(function(e){categoryOpeningItemFlag=!1,$("#categoryTreeView").jstree("close_all")})),e.on("click","#refreshCategoryTreeView",(function(e){categoryOpeningItemFlag=!1;var t=$("#categoryTreeView").jstree(!0);t.deselect_all(),t.refresh(),$("#categoryTreeViewSearchInput").val(""),$("#categoryTreeView").jstree("search","")})),e.on("click",".ecom-coutries-checkbox",(function(e){var t=$(this);t.find(".fa").hasClass("fa-check-square-o")?(t.find(".fa").removeClass("fa-check-square-o"),t.find(".fa").addClass("fa-square-o"),t.find('input[type="checkbox"]').removeAttr("checked"),t.find(".check-all").hasClass("fa-square-o")&&($(".ecom-coutries-checkbox .fa").not(".check-all").addClass("fa-square-o"),$(".ecom-coutries-checkbox .fa").not(".check-all").removeClass("fa-check-square-o"),$(".ecom-coutries-checkbox .fa").not(".check-all").next('input[type="checkbox"]').removeAttr("checked"))):(t.find(".fa").removeClass("fa-square-o"),t.find(".fa").addClass("fa-check-square-o"),t.find('input[type="checkbox"]').attr("checked","checked")),$(".ecom-coutries-checkbox .fa").not(".check-all").length==$(".ecom-coutries-checkbox .fa.fa-check-square-o").not(".check-all").next('input[type="checkbox"]:checked').length||t.find(".check-all").hasClass("fa-check-square-o")?($(".ecom-coutries-checkbox .fa").not(".check-all").removeClass("fa-square-o"),$(".ecom-coutries-checkbox .fa").not(".check-all").addClass("fa-check-square-o"),$(".ecom-coutries-checkbox .fa").not(".check-all").next('input[type="checkbox"]').removeAttr("checked"),$(".ecom-coutries-checkbox .fa.check-all").removeClass("fa-square-o"),$(".ecom-coutries-checkbox .fa.check-all").addClass("fa-check-square-o"),$(".ecom-coutries-checkbox .fa.check-all").next('input[type="checkbox"]').attr("checked","checked")):($(".ecom-coutries-checkbox .fa.fa-check-square-o").not(".check-all").next('input[type="checkbox"]').attr("checked","checked"),$(".ecom-coutries-checkbox .fa.check-all").addClass("fa-square-o"),$(".ecom-coutries-checkbox .fa.check-all").removeClass("fa-check-square-o"),$(".ecom-coutries-checkbox .fa.check-all").next('input[type="checkbox"]').removeAttr("checked")),e.stopPropagation(),e.preventDefault()})),e.on("switch-change","#cat_status",(function(e,t){var i=$(this);1==t.value?i.find('input[type="checkbox"]').attr("checked","checked"):i.find('input[type="checkbox"]').removeAttr("checked")})),e.on("click",".categoryProductsRefresh",(function(e,t){var i=$("#categoryProductListTbl").data("catid");melisHelper.zoneReload("id_meliscommerce_categories_category_tab_products","meliscommerce_categories_category_tab_products",{catId:i,activateTab:!0})})),e.on("click",".categoryProductsRemove",(function(){var e=$(this).parents("tr").attr("id"),t=$("#categoryProductListTbl").data("catid"),i=$("#saveCategory").data("catfatherid"),o=translations.tr_meliscommerce_categories_category_product_remove,a=translations.tr_meliscommerce_categories_category_product_remove_confirm_msg;"-1"==i&&(o=translations.tr_meliscommerce_categories_catalog_product_remove,a=translations.tr_meliscommerce_categories_catalog_product_remove_confirm_msg),melisCoreTool.confirm(translations.tr_meliscommerce_categories_common_label_yes,translations.tr_meliscommerce_categories_common_label_no,o,a,(function(){var o=new Array;o.push({name:"pcat_id",value:e}),o.push({name:"parent_id",value:i}),o.push({name:"cat_id",value:t}),o=$.param(o),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComCategory/removeCategoryProduct",data:o,dataType:"json",encode:!0}).done((function(e){e.success?melisHelper.zoneReload("id_meliscommerce_categories_category_tab_products","meliscommerce_categories_category_tab_products",{catId:t,activateTab:!0}):alert(translations.tr_meliscore_error_message),melisCore.flashMessenger(),melisHelper.melisOkNotification(e.textTitle,e.textMessage)})).fail((function(){alert(translations.tr_meliscore_error_message)}))}))})),e.on("click",".categoryProductsView",(function(){var e=$(this),t=e.closest("tr").data("productid"),i=e.closest("tr").data("productname"),o="id_meliscommerce_product_list_container";melisHelper.tabOpen(translations.tr_meliscommerce_products_Products,"fa icon-shippment fa-2x","id_meliscommerce_product_list_container","meliscommerce_product_list_container");var a=$("body #melis-id-nav-bar-tabs li a.tab-element[data-id='"+o+"']"),s=setInterval((function(){a.length&&(melisCommerce.openProductPage(t,i,o),melisCommerce.setUniqueId(t),clearInterval(s))}),500)})),e.on("dblclick","#categoryTreeViewPanel .jstree-node",(function(e){e.stopPropagation(),e.preventDefault(),$("#categoryTreeViewPanel").collapse("hide");var t=$(this),i=parseInt(t.attr("id"),10),o="id_meliscommerce_categories_category";$("#"+o).removeClass("hidden"),melisHelper.zoneReload(o,"meliscommerce_categories_category",{catId:i}),$("#categoryTreeView #"+i+" div").first().addClass("jstree-wholerow-clicked"),melisCommerce.setUniqueId(i)})),e.on("click","#categoryTreeView .jstree-clicked",(function(){var e=$("#"+activeTabId+" .addCategory");e.attr("disabled",!1),e.attr("title",null)})),e.on("click",".cat-div .jstree-node .jstree-icon",(function(){categoryOpeningItemFlag=!0})),e.on("mouseenter mouseleave","#categoryProductListTbl .toolTipHoverEvent",(function(e){var t=$(this).data("productid");loaderText='<div class="qtipLoader"><hr/><span class="text-center col-lg-12">Loading...</span><br/></div>',$(".thClassColId").attr("style",""),$.each($("table#catProductTable"+t+" thead").nextAll(),(function(e,t){$(t).remove()})),$(loaderText).insertAfter("table#catProductTable"+t+" thead"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComProductList/getToolTip",data:{productId:t},dataType:"json",encode:!0}).done((function(e){$("div.qtipLoader").remove(),0===e.content.length?$('<div class="qtipLoader"><hr/><span class="text-center col-lg-12">'+translations.tr_meliscommerce_product_tooltip_no_variants+"</span><br/></div>").insertAfter("table.qtipTable thead"):($.each($("table#catProductTable"+t+" thead").nextAll(),(function(e,t){$(t).remove()})),$.each(e.content.reverse(),(function(e,i){$(i).insertAfter("table#catProductTable"+t+" thead")})))})).fail((function(e,t,i){alert(translations.tr_meliscore_error_message)}))})),e.on("click","#categoryInfoPanel .widget-head .nav-tabs li a.shopping_cart",(function(){melisCore.screenSize<=767&&$("#id_meliscommerce_categories_category_tab_products").find(".categoryProductsRefresh").trigger("click")}))})),window.enableDisableAddCategoryBtn=function(e){var t=$(".addCategory");"enable"==e?(t.attr("disabled",!1),t.attr("title",null)):"disable"==e&&(t.attr("disabled",!0),t.attr("title",translations.tr_meliscommerce_categories_category_no_selected_catalog_category))},window.initCategoryTreeView=function(){$(this);var e=$("body"),t=$("#categoryTreeView");e.on("click","#categoryTreeView",(function(e){$("#categoryTreeView ul li div").removeClass("jstree-wholerow-clicked"),e.stopPropagation(),e.preventDefault()})),t.on("changed.jstree",(function(e,t){enableDisableAddCategoryBtn("enable")})).on("refresh.jstree",(function(e,t){enableDisableAddCategoryBtn("disable")})).on("loading.jstree",(function(e,t){melisCommerce.pendingZoneStart("meliscommerce_categories_list_search_input")})).on("loaded.jstree",(function(e,t){melisCommerce.pendingZoneDone("meliscommerce_categories_list_search_input"),$("ul.jstree-container-ul > li > a").each((function(){var e=$(this),t=e.data("fathericon"),i=e.find("i");e.html(i.get(0).outerHTML+"<strong>"+t+" "+e.text()+"</strong>")}))})).on("refresh.jstree",(function(e,t){$("ul.jstree-container-ul > li > a").each((function(){var e=$(this),t=e.data("fathericon"),i=e.find("i");e.html(i.get(0).outerHTML+"<strong>"+t+" "+e.text()+"</strong>")}))})).on("ready.jstree",(function(e,t){})).on("load_node.jstree",(function(e,t){})).on("open_node.jstree",(function(e,t){1==categoryOpeningItemFlag&&$(".cat-div").length&&$(".cat-div #"+t.node.id).offset().top+$(".cat-div #"+t.node.id).height()>$(".cat-div").offset().top+$(".cat-div").height()&&($timeOut=setTimeout((function(){var e=$(".cat-div").scrollTop(),i=$(".cat-div #"+t.node.id).innerHeight();$(".cat-div").animate({scrollTop:e+i},"slow")}),1e3))})).on("after_open.jstree",(function(e,t){$.each(t.node.children_d,(function(e,t){var i=$("#"+t+"_anchor").data("textlang"),o=$("#"+t+"_anchor").data("numprods"),a='<span title="'+translations.tr_meliscommerce_categories_list_tree_view_product_num+'">('+o+")</span>",s=$("#"+t+"_anchor").data("seopage");s&&(a=a+' - <span class="fa fa-file-o"></span> '+s),i&&(a=" "+i+a),$("#"+t+"_anchor").hasClass("updatedText")||($("#"+t+"_anchor").append(a),$("#"+t+"_anchor").addClass("updatedText"))}))})).on("move_node.jstree",(function(e,t){var i=t.node.id,o="#"==t.parent?"-1":t.parent,a="#"==t.old_parent?"-1":t.old_parent,s=t.position+1,r=new Array;r.push({name:"cat_id",value:parseInt(i,10)}),r.push({name:"cat_father_cat_id",value:parseInt(o,10)}),r.push({name:"cat_order",value:s}),r.push({name:"old_parent",value:parseInt(a,10)}),r=$.param(r),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComCategoryList/saveCategoryTreeView",data:r,dataType:"json",encode:!0}).done((function(e){e.success?($currentCategoryId=$("body #saveCategory").data("catid"),$currentCategoryId==parseInt(i,10)&&$("body #saveCategory").data("catfatherid",parseInt(o,10))):alert(translations.tr_meliscore_error_message)})).fail((function(){alert(translations.tr_meliscore_error_message)}))})).jstree({contextmenu:{items:function(e){return{Add:{label:translations.tr_meliscommerce_categories_common_btn_add,icon:"fa fa-plus",action:function(t){var i=parseInt(e.id),o=e.children.length+1;$("#categoryTreeViewPanel").collapse("hide");melisHelper.zoneReload("id_meliscommerce_categories_category","meliscommerce_categories_category",{catId:0,catFatherId:i,catOrder:o})}},Update:{label:translations.tr_meliscommerce_categories_common_btn_update,icon:"fa fa-edit",action:function(t){var i=parseInt(e.id,10);melisHelper.zoneReload("id_meliscommerce_categories_category","meliscommerce_categories_category",{catId:i}),$("#categoryTreeViewPanel").collapse("hide")}},Delete:{label:translations.tr_meliscommerce_categories_common_btn_delete,icon:"fa fa-trash-o",action:function(t){var i=new Array,o="#"==e.parent?"-1":parseInt(e.parent,10);i.push({name:"cat_father_cat_id",value:o});var a=parseInt(e.id);i.push({name:"cat_id",value:a}),i=$.param(i);var s=translations.tr_meliscommerce_categories_category_delete,r=translations.tr_meliscommerce_categories_category_delete_confirm_msg;"-1"==o&&(s=translations.tr_meliscommerce_categories_catalog_delete,r=translations.tr_meliscommerce_categories_catalog_delete_confirm_msg),melisCoreTool.confirm(translations.tr_meliscommerce_categories_common_label_yes,translations.tr_meliscommerce_categories_common_label_no,s,r,(function(){$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComCategory/deleteCategory",data:i,dataType:"json",encode:!0}).done((function(e){if(e.success){if($("#categoryTreeView").jstree(!0).delete_node(a+"_categoryId_anchor"),$("#saveCategory").data("catid")==a){melisHelper.zoneReload("id_meliscommerce_categories_category","meliscommerce_categories_category")}melisCore.flashMessenger(),melisHelper.melisOkNotification(e.textTitle,e.textMessage)}else melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors)})).fail((function(){alert(translations.tr_meliscore_error_message)}))}))}}}}},core:{multiple:!1,check_callback:!0,animation:500,themes:{name:"proton",responsive:!1},dblclick_toggle:!1,data:{cache:!1,url:"/melis/MelisCommerce/MelisComCategoryList/getCategoryTreeView?langlocale="+$("#categoryTreeView").data("langlocale")}},types:{"#":{valid_children:["catalog"]},catalog:{valid_children:["category"]},category:{valid_children:["category"]}},plugins:["contextmenu","changed","dnd","search","types"]}),e.on("click",".categoryProductsExport",(function(){melisCoreTool.isTableEmpty("categoryProductListTbl")||melisCoreTool.exportData("/melis/MelisCommerce/MelisComCategory/productsExportToCsv?catId="+$(this).data("catid"))}))},window.initCategoryStatus=function(){$("#cat_status").bootstrapSwitch()},window.initCategoryProducts=function(e,t){var i=$("#"+t.sTableId).data("catid");e.catId=i;var o=$("#categoryTreeView").data("langlocale");e.catLangLocale=o,$("#categoryProductListTbl").on("row-reorder.dt",(function(e,t,i){i.triggerRow.data()[1];for(var o=0,a=t.length;o<a;o++){$categoryProductListTbl.row(t[o].node).data()[1]+" updated to be in position "+t[o].newData+" (was "+t[o].oldData+")<br>"}if(!$.isEmptyObject(t)){var s=new Array,r=new Array;$.each(t,(function(){r.push(this.node.id+"-"+this.newPosition)})),s.push({name:"catPrdOrderData",value:r.join()}),s=$.param(s),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComCategory/reOrderCategoryProducts",data:s,dataType:"json",encode:!0}).done((function(e){e.success||alert(translations.tr_meliscore_error_message)})).fail((function(){alert(translations.tr_meliscore_error_message)}))}}))},window.initCategoryProductsImgs=function(){lightbox.option({resizeDuration:200,wrapAround:!0})},$((function(){var e=$("body");e.on("keyup keydown change","input[name='eseo_meta_title']",{limit:60},seoCharCounter),e.on("keyup keydown change","textarea[name='eseo_meta_description']",{limit:160},seoCharCounter)})),window.preSeoCharCounter=function(){$("form.seoForm").each((function(){var e=$(this),t=e.find("input[name='eseo_meta_title']"),i=e.find("textarea[name='eseo_meta_description']");t.trigger("keyup"),i.trigger("keyup")}))},window.seoCharCounter=function(e){var t=$(this),i=t.val().length,o=t.prev("label"),a=e.data.limit;o.find(".label-text span").length?0===i?(o.removeClass("limit"),o.find(".label-text span").remove()):(o.find(".label-text span").html('<i class="fa fa-text-width"></i>('+i+")"),i>a?(o.addClass("limit"),o.find(".label-text span").addClass("limit")):(o.removeClass("limit"),o.find(".label-text span").removeClass("limit"))):0!==i&&(o.find(".label-text").append("<span class='text-counter-indicator'><i class='fa fa-text-width'></i>("+i+")</span>"),i>a&&(o.addClass("limit"),o.find(".label-text span").addClass("limit")))};var melisCommerceSeo=(window,{serializeSeo:function(e,t,i){var o=new Array;return $("form."+e+"_"+t+"_seo_form").each((function(){langId=$(this).data("langid"),o=$(this).serializeArray(),$.each(o,(function(){i.push({name:e+"_seo["+langId+"]["+this.name+"]",value:this.value})}))})),i}}),catTreeConfig=function(){var e=$("body"),t="",i="",o="",a=!0;function s(e){var i=t.jstree().get_node(e);i&&($("#"+i.id).css("color","#72af46"),i.children.forEach((function(e){s(e)})))}function r(e,t,i,o){o=void 0===o?null:o;var a=i.jstree().get_node(t);a&&(a.state.selected||("enable"==e?($("#"+a.id).css("color","#72af46"),i.jstree("enable_node",a)):(i.jstree("disable_node",a),i.jstree("uncheck_node",a)),a.children.forEach((function(t){r(e,t,i)})))),null!==o&&o()}return e.on("click","#catTreeFilterPluginConfig ul li",(function(e){if(a){var s=$(this);if(s.find("a").attr("id")===$(e.target).attr("id")){var n="#"+s.attr("id");if(i!=n)r("enable",n,t,(function(){t.jstree("deselect_node",i),function(e,i){var o=i.replace("#",""),a=t.jstree().get_node(e);-1===jQuery.inArray(o,a.children)&&-1===jQuery.inArray(o,a.children_d)&&t.jstree("close_node",e);""==t.jstree().get_node(i).parent.replace("#","")?(r("enable",e,t),t.jstree("uncheck_node",e)):r("disable",e,t);-1!==jQuery.inArray(o,a.parents)&&r("enable",e,t)}(i,n),t.jstree("select_node",n),t.jstree("open_node",n),t.jstree("check_node",n),r("enable",n,t),i=n}));else t.jstree().get_node(n).state.selected?(t.jstree("deselect_node",n),r("disable",n,t),$(o+"_form input[name='m_box_root_category_tree_id']").val("")):r("enable",n,t,(function(){t.jstree("select_node",n),t.jstree("check_node",n)}))}}})),{setCategoryTreeConfig:function(e,n,l,c,d){d=null==d||d,a=c=null==c||c,i="#"+l+"_categoryId",o=(t=e).selector;var h="_categoryId";if(jQuery.isEmptyObject(n)||$.each(n,(function(e,i){var o="#"+i+h;t.jstree("open_node",o),t.jstree("check_node",o),setTimeout((function(){s(o)}),50)})),0!=l){var m="#"+l+h;t.jstree("select_node",m)}d&&function(e,t){var i=t.jstree("get_json");i.forEach((function(i){r(e,i,t)}))}("disable",t)}}}();window.initProductSwitch=function(){setOnOff(),allLoaded()},window.initProductCategoryList=function(e,t){if(void 0===t&&(t=melisLangId),$("#"+e+"_productCategoryList").length){var i=$("#"+e+"_productCategoryList");t!==melisLangId&&i.data("langlocale",t),i.jstree("destroy");var o=new Array;o.push({name:"productId",value:e}),o.push({name:"idAndNameOnly",value:!0}),o.push({name:"langlocale",value:i.data("langlocale")}),$("div#"+e+"_product_category_area > span.prod-cat-values").each((function(){o.push({name:"categoriesChecked[]",value:$(this).data("pcat-cat-id")})})),o=$.param(o),i.on("loading.jstree",(function(e,t){melisCommerce.pendingZoneStart("productCategorySearchZone")})).on("loaded.jstree",(function(e,t){melisCommerce.pendingZoneDone("productCategorySearchZone"),setProductCategoryFilter($(this).attr("id")),openCheckedCategoryFilter($(this).attr("id"))})).jstree({types:{default:{icon:"fa fa-circle text-success"},selected:{select_node:!1}},core:{check_callback:!0,animation:500,themes:{name:"proton",responsive:!1},dblclick_toggle:!1,data:{cache:!0,url:"/melis/MelisCommerce/MelisComCategoryList/getCategoryTreeView?"+o}},checkbox:{three_state:!1,whole_node:!1,tie_selection:!1},plugins:["search","changed","types","checkbox"]})}},window.initAttribute=function(e){null!=melisCommerce.getCurrentProductId()&&(e||populateAttribList(e))},window.populateAttribList=function(e){1===$("#"+activeTabId).length&&melisCommerce.enableAllTabs()},window.initProductTextTinyMce=function(e){var t="#"+e+"_id_meliscommerce_products_page textarea.product-text-mce[data-display='true']";$(t).length?$(t).each((function(t,i){var o=$(this),a=Math.random().toString(36).substring(2,9)+"_"+e+"_"+i.name;o.attr("id",a);var s={height:400,relative_urls:!1,language:"en",menubar:!1,mini_templates_url:"/melis/MelisCore/MelisTinyMce/getTinyTemplates",forced_root_block:"p",image_uploadtab:!1,cleanup:!1,verify_html:!1,plugins:["advlist","autolink","lists","link","image","charmap","preview","anchor","emoticons","help","nonbreaking","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","table","minitemplate"],external_plugins:{minitemplate:"/MelisCore/js/minitemplate/plugin.min.js"},image_advtab:!0,promotion:!1,toolbar:"insertfile undo redo | blocks | forecolor | bold italic strikethrough underline | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image media | minitemplate code",toolbar_mode:"sliding",init_instance_callback:productTextTinyMCECallback(o,e)};melisTinyMCE.createTinyMCE("tool",'[id="'+a+'"]',s)})):$("#"+e+"_id_meliscommerce_products_page .notifTinyMcePreloaInfo").fadeOut("slow")},window.productTextTinyMCECallback=function(e,t){$("#"+e.id).parents("div.form-group").attr("data-tinymce","true"),$("#"+t+"_id_meliscommerce_products_page .notifTinyMcePreloaInfo").fadeOut("slow")},window.allLoaded=function(){melisCommerce.enableAllTabs()},window.reInitProductTextTypeSelect=function(e){var t=[],i=$("#"+e+"_id_meliscommerce_products_page .product-text-forms > .custom-field-type");$.each(i,(function(e,i){$.each($(i).find("input#ptt_id"),(function(e,i){t.push($(i).val())}))}));var o=$("form[data-modalform='"+melisCommerce.getCurrentProductId()+"_productTextForm'] select#ptxt_type");$.each(t,(function(e,t){o.find("option[value='"+t+"']").remove()}))};var productTableFilterSelectedCategoryIds=[];$((function(){var e=$("body");e.on("click",".productCategoryList",(function(){var e=$(this),t=e.data("productid");e.attr("disabled",!0),zoneId="id_meliscommerce_products_main_tab_categories_modal",melisKey="meliscommerce_products_main_tab_categories_modal",modalUrl="/melis/MelisCommerce/MelisComProduct/renderProductModal",melisHelper.createModal(zoneId,melisKey,!1,{productId:t},modalUrl,(function(){e.attr("disabled",!1)}))})),e.on("click",".addProductCategory",(function(){var e=$(this).data("productid"),t=new Array;$.each($("#"+e+"_productCategoryList").jstree().get_checked(!0),(function(){t.push(parseInt(this.id))}));var i=new Array,o=new Array;$("#"+e+"_product_category_area span[data-pcat-cat-id]").each((function(){var e=$(this),a=parseInt(e.data("pcat-cat-id"));-1!==t.indexOf(a)?o.push(a):(i.push(a),$("span.prod-cat-values[data-pcat-cat-id='"+a+"']").remove())})),$.each($("#"+e+"_productCategoryList").jstree().get_checked(!0),(function(){var t=parseInt(this.id);if(-1===i.indexOf(t)&&-1===o.indexOf(t)){var a=this.text.split(" - ")[1];$.get("/melis/MelisCommerce/MelisComProduct/getProductCategoryLastOrderNum",{catId:t,prodId:e},(function(i){$("#"+e+"_product_category_area").append('<span class="prod-cat-values" data-pcat-id="'+i.id+'" data-pcat-cat-id="'+t+'" data-pcat-order="'+i.order+'"><span class="ab-attr">'+a+'<i class="prdDelCat fa fa-times"></i></span></span>')}))}})),t.length?$("p#"+e+"_no_categories").hide():$("p#"+e+"_no_categories").show(),$("#id_meliscommerce_products_main_tab_categories_modal_container").modal("hide")})),e.on("click",".productCategoryFilter",(function(){zoneId="id_meliscommerce_products_main_tab_categories_modal",melisKey="meliscommerce_products_main_tab_categories_modal",modalUrl="/melis/MelisCommerce/MelisComProduct/renderProductModal",melisHelper.createModal(zoneId,melisKey,!1,{productId:0,isFilter:!0},modalUrl)})),e.on("click",".filterProductCategory",(function(){productTableFilterSelectedCategoryIds=[];var e=[],t=translations.tr_meliscommerce_products_text_filter+": ";$.each($("#0_productCategoryList").jstree().get_checked(!0),(function(){var t=this.text.split("-")[1].trim();productTableFilterSelectedCategoryIds.push(parseInt(this.id)),e.push(t)})),t+=e.join(", "),$("#id_meliscommerce_products_main_tab_categories_modal_container").modal("hide"),$("#tableProductList").DataTable().ajax.reload(),productTableFilterSelectedCategoryIds.length>0?($("#product-category-filter-tooltip").removeClass("hidden"),$("#product-category-filter-tooltip").attr("data-original-title",t)):$("#product-category-filter-tooltip").hasClass("hidden")||$("#product-category-filter-tooltip").addClass("hidden")})),e.on("click",".product-list-table-filter-refresh a.melis-refreshTable",(function(){productTableFilterSelectedCategoryIds=[]})),e.on("click",'.close.close-tab[data-id="id_meliscommerce_product_list_container"]',(function(){productTableFilterSelectedCategoryIds=[]})),e.on("click",".product-category-tree-view-lang li a",(function(){var e=$(this),t=e.text(),i=e.data("locale"),o=$(".productCategoryLangDropdown").data("productid");$(".productCategoryLangDropdown span.filter-key").text(t),initProductCategoryList(o,i)})),e.on("click",".productTextForm .deleteTextInput",(function(){var e=$(this),t=e.parent().attr("data-text-identifier"),i=e.parents("form"),o=$("form[data-modalform='"+melisCommerce.getCurrentProductId()+"_productTextForm'] select#ptxt_type");melisCoreTool.pending(".deleteTextInput"),melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_meliscommerce_product_confirm_remove_title,translations.tr_meliscommerce_product_confirm_remove_test,(function(){$.each(i,(function(e,t){var i=$(t).find("a[data-text-identifier]").attr("data-text-identifier"),a=$(t).find("input#ptt_id").val();o.find("option[value='"+a+"']").length||o.prepend($("<option>",{value:a,text:i}))})),$("#"+activeTabId+" .productTextForm .deleteTextInput").closest("a[data-text-identifier='"+t+"']").closest("form").remove()})),melisCoreTool.done(".deleteTextInput")})),e.on("click",".btnProductListEdit",(function(){var e=$(this),t=e.parents("tr").attr("id"),i=e.parents("tr").find("td span").data("productname"),o="id_meliscommerce_product_list_container";$("body #melis-id-nav-bar-tabs li a.tab-element[data-id='id_meliscommerce_product_list_container']").length>0?(melisCommerce.disableAllTabs(),melisCommerce.openProductPage(t,i,o),melisCommerce.setUniqueId(t)):melisHelper.tabOpen("Products","icon-shipment","id_meliscommerce_product_list_container","meliscommerce_product_list_container","",o,(function(){melisCommerce.disableAllTabs(),melisCommerce.openProductPage(t,i,o),melisCommerce.setUniqueId(t)}))})),e.on("click","#btnAddProduct",(function(){melisCommerce.openProductPage(0,translations.tr_meliscommerce_products_page_new_product,"id_meliscommerce_product_list_container"),melisCommerce.setUniqueId(0)})),e.on("click","#addProdTextType",(function(){var e=$(this),t=(e.data("productid"),$("form#productTextTypeForm").serialize()),i=e.closest(".panel").find(".panel-heading .panel-title a"),o=e.closest(".panel").find(".panel-collapse");melisCoreTool.pending("#addProdTextType"),$.ajax({type:"POST",data:t,url:"/melis/MelisCommerce/MelisComProduct/addProductTextType",dataType:"json",encode:!0}).done((function(e){e.success?(melisCoreTool.clearForm("productTextTypeForm"),i.addClass("collapsed"),i.attr("aria-expanded",!1),o.removeClass("in"),o.attr("aria-expanded",!1),melisHelper.zoneReload(melisCommerce.getCurrentProductId()+"_id_meliscommerce_products_page_content_tab_product_text_modal_form","meliscommerce_products_page_content_tab_product_text_modal_form",{productId:melisCommerce.getCurrentProductId()},(function(){setTimeout((function(){reInitProductTextTypeSelect(melisCommerce.getCurrentProductId())}),500)}))):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"productTextTypeForm")),melisCore.flashMessenger(),melisCoreTool.done("#addProdTextType")})).fail((function(){alert(translations.tr_meliscore_error_message)}))})),e.on("click",".btnAddText",(function(){var e=$(this).data("productid"),t=$("#"+e+"_id_meliscommerce_products_page_content_tab_product_text_modal_form").find("select#ptxt_type"),i=$("#"+e+"_id_meliscommerce_products_page_content_tab_product_text_modal_form").find("select#ptxt_type option:selected").text();typeId=t.val(),melisCoreTool.pending(this),$.ajax({type:"GET",url:"/melis/MelisCommerce/MelisComProduct/getEmptyProductTextForm?textTypeId="+typeId+"&text="+i,dataType:"json",encode:!0}).done((function(t){var o=$("#"+e+"_id_meliscommerce_products_page .product-text-forms > .custom-field-type");o.length&&$("#"+e+"_id_meliscommerce_products_page .notifTinyMcePreloaInfo").fadeIn("slow"),$.each(o,(function(o,a){var s=$(a).data("lang-id"),r=$("#"+e+"_id_meliscommerce_products_page .product-text-tab li#languageList").length;$("#"+e+"_id_meliscommerce_products_page .productTextForm a[data-text='"+i+"']").length<r?($(a).find(".custom-field-type-area").append(t.content).data("text-lang-id",s),$(a).find("form[name='productTextForm']").attr("data-text-lang-id",s),$(a).find("form[name='productTextForm'] input#ptxt_lang_id").val(s),initProductTextTinyMce(e),bootstrap.Modal.getOrCreateInstance("div[data-modalname='genericProductTextModal']").hide(),$("div[data-class='addTextFieldNotif']").html("").attr("class","")):melisCoreTool.alertDanger("div[data-class='addTextFieldNotif']","",translations.tr_meliscommerce_product_text_add_exists)})),melisCoreTool.done(".btnAddText")})).fail((function(){alert(translations.tr_meliscore_error_message)}))})),e.on("click",".save_product",(function(){var e=$(this),t=e.data("productid"),i=$("#"+melisCommerce.getCurrentProductId()+"_id_meliscommerce_products_page form"),o=[],a=0,s=0,r=e.closest(".container-level-a"),n=$(r).find("#"+t+"_id_meliscommerce_settings_tabs_content_main_details_left form"),l=$(r).find(".alert-email-values"),c="",d="",h="";Array.prototype.push.apply(o,$(n).serializeArray()),l.each((function(){var e=$(this);c=e.data("seaid"),d=e.data("alertemail"),h=e.data("userid"),o.push({name:"recipients["+s+"][sea_id]",value:c}),o.push({name:"recipients["+s+"][sea_email]",value:d}),o.push({name:"recipients["+s+"][sea_user_id]",value:h}),void 0!==t&&o.push({name:"recipients["+s+"][sea_prd_id]",value:t}),s++})),s=0,i.each((function(){var e=$(this),t=e.attr("name"),i=e.serializeArray();for(a=i.length,j=0;j<a;j++)o.push({name:t+"["+s+"]["+i[j].name+"]",value:i[j].value});s++})),$("#"+t+"_id_meliscommerce_products_page").find(".make-switch div").each((function(){var e=$(this).find("input").attr("name");if(void 0!==e&&!1!==e){var t="product[0]["+$(this).find("input").attr("name")+"]",i=0;$(this).hasClass("switch-on")&&(i=1),o.push({name:t,value:i})}})),o.push({name:"productId",value:t}),(o=melisCommerceSeo.serializeSeo("product",t,o)).push({name:"product[0][prd_id]",value:t}),s=0,$("div#"+melisCommerce.getCurrentProductId()+"_attribute_area > span.attr-values").each((function(){var e=$(this);o.push({name:"attributes["+s+"][patt_id]",value:e.data("patt-id")}),o.push({name:"attributes["+s+"][patt_attribute_id]",value:e.data("patt-attribute-id")}),s++})),s=0,$("div#"+melisCommerce.getCurrentProductId()+"_product_category_area > span.prod-cat-values").each((function(){var e=$(this);o.push({name:"categories["+s+"][pcat_id]",value:e.data("pcat-id")}),o.push({name:"categories["+s+"][pcat_cat_id]",value:e.data("pcat-cat-id")}),o.push({name:"categories["+s+"][pcat_order]",value:e.data("pcat-order")}),s++})),s=0,$("div#"+melisCommerce.getCurrentProductId()+"_deleted_product_category_area > span").each((function(){var e=$(this);o.push({name:"delcategories["+s+"][pcat_id]",value:e.data("pcat-id")}),s++})),s=0,melisCoreTool.pending(".save_product"),melisCommerce.disableAllTabs(),$.ajax({type:"POST",data:o,url:"/melis/MelisCommerce/MelisComProduct/saveProduct",dataType:"json",encode:!0}).done((function(e){if(e.success){var t=$('.tab-element[data-id="'+e.chunk.productId+'_id_meliscommerce_products_page"]').parent();if(melisCommerce.closeCurrentProductPage(),melisCommerce.openProductPage(e.chunk.productId,e.chunk.prodName,"id_meliscommerce_product_list_container"),melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload("id_meliscommerce_product_list_content","meliscommerce_product_list_content"),melisCommerce.setUniqueId(e.chunk.productId),t.hasClass("has-sub")){var i=t.find(".nav-group-dropdown").prop("outerHTML");$('.tab-element[data-id="'+e.chunk.productId+'_id_meliscommerce_products_page"]').parent().addClass("has-sub").append(i)}}else melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,activeTabId+" form");melisCoreTool.done(".save_product"),melisCore.flashMessenger(),melisCommerce.enableAllTabs()})).fail((function(){alert(translations.tr_meliscore_error_message)}))})),e.on("click","a[data-meliskey='meliscommerce_products_page_header_save_product_cancel']",(function(){melisCommerce.closeCurrentProductPage()})),e.on("click",".add-attribute",(function(){var e=$("#"+melisCommerce.getCurrentProductId()+"_prodAttribInput"),t=$("#"+activeTabId+" #select2-"+melisCommerce.getCurrentProductId()+"_prodAttribInput-container"),i=$("#"+activeTabId+" #"+melisCommerce.getCurrentProductId()+"_id_meliscommerce_products_main_tab_attributes_add span.select2");$("div#"+activeTabId+" select.dropdown-input"+melisCommerce.getCurrentProductId());if(e.val()){var o=e.val(),a=$("#"+melisCommerce.getCurrentProductId()+"_prodAttribInput option[value='"+o+"']").html(),s=$("#"+melisCommerce.getCurrentProductId()+"_prodAttribInput option[value='"+o+"']");if(0===$("#"+melisCommerce.getCurrentProductId()+"_attribute_area").find("span[data-patt-attribute-id='"+o+"']").length){$("#"+melisCommerce.getCurrentProductId()+"_attribute_area").append('<span class="attr-values" data-patt-attribute-id="'+o+'"><span class="ab-attr"><span class="attrib-value">'+a+'</span><i class="prdDelAttr fa fa-times"></i></span>'),$("p#"+melisCommerce.getCurrentProductId()+"_no_attributes").hide();var r=0,n=new Object;$.each(e.find("option"),(function(e,t){o!==$(t).val()&&(n[r]={id:$(t).val(),value:$(t).html()},r++)})),s.remove(),t.html("").attr("title","")}t.css("color","#444"),i.css("border","none")}else t.css("color","#e80e05"),i.css("border","1px solid #e80e05")})),e.on("click",".prdDelAttr",(function(){var e=$(this),t=$("#"+melisCommerce.getCurrentProductId()+"_prodAttribInput"),i=e.parent().parent(),o=e.parents("span.attr-values").attr("data-patt-attribute-id"),a=e.parent().find("span.attrib-value").html();$.ajax({type:"GET",url:"/melis/MelisCommerce/MelisComProduct/checkAttributeOnVariant",data:{productId:melisCommerce.getCurrentProductId(),patt_attr_id:o},dataType:"json",encode:!0,beforeSend:function(){e.removeClass("fa-times"),e.addClass("fa-spinner fa-pulse")}}).done((function(s){if(s.attribute_is_used)e.removeClass("fa-spinner fa-pulse"),e.addClass("fa-times"),melisHelper.melisKoNotification(translations.tr_meliscommerce_attribute_delete_product_attr_title,translations.tr_meliscommerce_attribute_delete_product_attr_title_msg);else{var r=$("<option selected></option>");r.val(o),r.text(a),r.val(o),r.text(a),t.append(r),t.val(""),t.select2({placeholder:translations.tr_meliscommerce_products_main_tab_attributes_content_label,val:""}),t.val(""),i.fadeOut("fast").remove();$("#"+activeTabId+" #select2-"+melisCommerce.getCurrentProductId()+"_prodAttribInput-container");setTimeout((function(){}),1),setTimeout((function(){melisCoreTool.pending(".prdDelAttr")}),1e3),t.css("border","1px solid #e5e5e5"),0===$(".prdDelAttr").length&&$("p#"+melisCommerce.getCurrentProductId()+"_no_attributes").show()}})).fail((function(){alert(translations.tr_meliscore_error_message)}))})),e.on("click",".prdDelCat",(function(){var e=$(this).parent().parent();$("#"+melisCommerce.getCurrentProductId()+"_deleted_product_category_area").append('<span data-pcat-id="'+e.data("pcat-id")+'" data-pcat-cat-id="'+e.data("pcat-cat-id")+'"></span>'),e.fadeOut("slow").remove(),0===$(".prdDelCat").length&&$("p#"+melisCommerce.getCurrentProductId()+"_no_categories").show()})),e.on("keyup","#productCategorySearch",(function(e){var t=$(this),i=t.data("productid"),o=t.val();$("#"+i+"_productCategoryList").jstree("search",o)})),e.on("click","#clearPrdCatSearchInputBtn",(function(e){var t=$(this).data("productid"),i=$("#"+t+"_productCategoryList");categoryOpeningItemFlag=!1,$("#productCategorySearch").val(""),i.jstree("search","")})),e.on("click","#expandPrdCatTreeViewBtn",(function(e){var t=$(this).data("productid");$("#"+t+"_productCategoryList").jstree("open_all")})),e.on("click","#collapsePrdCatTreeViewBtn",(function(e){var t=$(this).data("productid");prdCatTree=$("#"+t+"_productCategoryList"),prdCatTree.jstree("close_all")})),e.on("click","#refreshPrdCatTreeView",(function(e){var t=$(this).data("productid"),i=$("#"+t+"_productCategoryList");i.jstree(!0).refresh("forget_state",!0),i.jstree("search",""),$("#productCategorySearch").val("")})),e.on("click",".btnProductListDelete",(function(){var e=$(this).closest("tr").attr("id");melisCoreTool.pending(".btnProductListDelete"),melisCoreTool.confirm(translations.tr_meliscommerce_documents_common_label_yes,translations.tr_meliscommerce_documents_common_label_no,translations.tr_meliscommerce_product_remove_title,translations.tr_meliscommerce_product_remove_confirm,(function(){$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComProduct/delete",data:{productId:e},dataType:"json",encode:!0}).done((function(t){t.success&&($("#"+activeTabId+" .melis-refreshTable").trigger("click"),melisHelper.tabClose(e+"_id_meliscommerce_products_page"),melisCore.flashMessenger(),melisHelper.melisOkNotification(t.textTitle,t.textMessage))})).fail((function(){alert(translations.tr_meliscore_error_message)}))})),melisCoreTool.done(".btnProductListDelete")})),e.on("click",".toggleformCreateTextTypeContainer",(function(){$("div.formCreateTextTypeContainer").slideToggle()})),e.on("mouseenter mouseout",".toolTipHoverEvent",(function(e){var t=$(this).data("productid");loaderText='<div class="qtipLoader"><hr/><span class="text-center col-lg-12">Loading...</span><br/></div>',$(".thClassColId").attr("style",""),$.each($("table#productTable"+t+" thead").nextAll(),(function(e,t){$(t).remove()})),$(loaderText).insertAfter("table#productTable"+t+" thead"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComProductList/getToolTip",data:{productId:t},dataType:"json",encode:!0}).done((function(e){$("div.qtipLoader").remove(),0===e.content.length?$('<div class="qtipLoader"><hr/><span class="text-center col-lg-12">'+translations.tr_meliscommerce_product_tooltip_no_variants+"</span><br/></div>").insertAfter("table.qtipTable thead"):($.each($("table#productTable"+t+" thead").nextAll(),(function(e,t){$(t).remove()})),$.each(e.content.reverse(),(function(e,i){$(i).insertAfter("table#productTable"+t+" thead")})))})).fail((function(){alert(translations.tr_meliscore_error_message)}))})),e.on("click",".add-product-text",(function(){var e=$(this).data("bs-target");$("div[data-class='addTextFieldNotif']").html("").attr("class","addTextFieldNotif"),melisHelper.zoneReload(melisCommerce.getCurrentProductId()+"_id_meliscommerce_products_page_content_tab_product_text_modal_form_product_type_text","meliscommerce_products_page_content_tab_product_text_modal_form_product_type_text",{productId:melisCommerce.getCurrentProductId()}),reInitProductTextTypeSelect(melisCommerce.getCurrentProductId());bootstrap.Modal.getOrCreateInstance(e,{show:!0,keyboard:!1,backdrop:!0}).show()})),e.on("click",".openVariant",(function(){var e=$(this),t=e.data("product-id"),i=e.data("product-name"),o=t+"_id_meliscommerce_products_page";melisCommerce.openProductPage(t,i,"id_meliscommerce_product_list_container",(function(){var i=e.parent().siblings(":first").text(),a=e.parent().parent().find("td:nth-child(4)").text();melisCommerce.disableAllTabs(),melisHelper.tabOpen(a,"icon-tag-2",i+"_id_meliscommerce_variants_page","meliscommerce_variants_page",{variantId:i,productId:t},o),melisCommerce.setUniqueId(i),melisCommerce.enableAllTabs()}))})),e.on("click","#prod_page_assoc1_btn span",(function(){var e=$(this).closest("form").attr("id");melisLinkTree.createInputTreeModal("#"+e+" #prod_page_assoc_1")})),e.on("click","#prod_page_assoc2_btn span",(function(){var e=$(this).closest("form").attr("id");melisLinkTree.createInputTreeModal("#"+e+" #prod_page_assoc_2")})),e.on("click","#prod_page_assoc3_btn span",(function(){var e=$(this).closest("form").attr("id");melisLinkTree.createInputTreeModal("#"+e+" #prod_page_assoc_3")})),e.on("click",".product-text-accordion-toggle",(function(e){var t=e.target,i=$(t).attr("href");$(i).collapse("toggle"),$('[href$="'+i+'"]').hasClass("collapsed")?$('[href$="'+i+'"]').removeClass("collapsed"):$('[href$="'+i+'"]').addClass("collapsed")}))})),window.initProductsTableData=function(e){e.selectedCategories=productTableFilterSelectedCategoryIds},window.setProductCategoryFilter=function(e){"0_productCategoryList"==e&&$.each(productTableFilterSelectedCategoryIds,(function(e,t){$("#0_productCategoryList").jstree().check_node(t+"_categoryId")}))},window.openCheckedCategoryFilter=function(e){"0_productCategoryList"==e&&$.each(productTableFilterSelectedCategoryIds,(function(e,t){$("#0_productCategoryList").jstree()._open_to(t+"_categoryId")}))},$((function(){var e=$("body");e.on("keyup keydown change","input[name='eseo_meta_title']",{limit:60},seoCharCounter),e.on("keyup keydown change","textarea[name='eseo_meta_description']",{limit:160},seoCharCounter)})),window.preSeoCharCounter=function(){$("form.seoForm").each((function(){var e=$(this),t=e.find("input[name='eseo_meta_title']"),i=e.find("textarea[name='eseo_meta_description']");t.trigger("keyup"),i.trigger("keyup")}))},window.seoCharCounter=function(e){var t=$(this),i=t.val().length,o=t.prev("label"),a=e.data.limit;o.find(".label-text span").length?0===i?(o.removeClass("limit"),o.find(".label-text span").remove()):(o.find(".label-text span").html('<i class="fa fa-text-width"></i>('+i+")"),i>a?(o.addClass("limit"),o.find(".label-text span").addClass("limit")):(o.removeClass("limit"),o.find(".label-text span").removeClass("limit"))):0!==i&&(o.find(".label-text").append("<span class='text-counter-indicator'><i class='fa fa-text-width'></i>("+i+")</span>"),i>a&&(o.addClass("limit"),o.find(".label-text span").addClass("limit")))};window,melisCommerceSeo={serializeSeo:function(e,t,i){var o=new Array;return $("form."+e+"_"+t+"_seo_form").each((function(){langId=$(this).data("langid"),o=$(this).serializeArray(),$.each(o,(function(){i.push({name:e+"_seo["+langId+"]["+this.name+"]",value:this.value})}))})),i}};$((function(){var e=$("body");e.on("click",".editvariant",(function(){var e=$(this),t=e.closest("tr").attr("id"),i=e.closest("tr").find("td a").data("variantname"),o=e.closest(".container-level-a").attr("id").replace(/[^0-9]/g,""),a=o+"_id_meliscommerce_products_page";melisCommerce.disableAllTabs(),melisHelper.tabOpen(i.toString(),"icon-tag-2",t+"_id_meliscommerce_variants_page","meliscommerce_variants_page",{variantId:t,productId:o},a),melisCommerce.setUniqueId(t),melisCommerce.enableAllTabs()})),e.on("click",".add-variant",(function(){var e=$(this).closest(".container-level-a").attr("id").replace(/[^0-9]/g,""),t=e+"_id_meliscommerce_products_page";melisCoreTool.processingActiveTabId(),melisHelper.tabOpen(translations.tr_meliscommerce_variant_main_information_sku_new,"icon-tag-2","id_meliscommerce_variants_page","meliscommerce_variants_page",{productId:e,page:"newvar"},t),melisCommerce.setUniqueId(0),setTimeout((function(){melisCoreTool.processDone()}),1e3)})),e.on("click",".save-add-variant",(function(){$(this).closest(".container-level-a").attr("id")})),e.on("click",".country-price-tab li a",(function(){var e=$(this),t=e.data("country"),i=e.data("symbol"),o=$("[data-meliskey='meliscommerce_prices_tab_country_header'] .cur-symbol");""!=i?o.removeClass("fa fa-dollar").text(i).css("font-weight","600"):o.hasClass("fa")||o.empty().addClass("fa fa-dollar").prop("style",null),$(".country-price-label").text(t+" "+translations.tr_meliscommerce_variant_tab_prices_pricing)})),e.on("click",".country-stock-tab li a",(function(){var e=$(this).data("country");"fr_FR"==melisLangId?$(".country-stock-label").text(translations.tr_meliscommerce_variant_tab_stocks_header+" "+e):$(".country-stock-label").text(e+" "+translations.tr_meliscommerce_variant_tab_stocks_header)})),e.on("click",".productvariant-refresh",(function(){var e=melisCommerce.getCurrentProductId();melisHelper.zoneReload(e+"_id_meliscommerce_products_page_content_tab_variant_content_container","meliscommerce_products_page_content_tab_variant_content_container",{productId:e})})),e.on("click",".deletevariant",(function(){var e=this,t=$(e).closest("tr").attr("id"),i=[];i.push({name:"var_id",value:t}),melisCoreTool.pending(e),melisCoreTool.confirm(translations.tr_meliscommerce_documents_common_label_yes,translations.tr_meliscommerce_documents_common_label_no,translations.tr_meliscommerce_variants_delete_title,translations.tr_meliscommerce_variants_delete_confirm,(function(){melisCommerce.postSave("melis/MelisCommerce/MelisComVariant/deleteVariant",i,(function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload(melisCommerce.getCurrentProductId()+"_id_meliscommerce_products_page_content_tab_variant_content_container","meliscommerce_products_page_content_tab_variant_content_container",{productId:melisCommerce.getCurrentProductId()}),melisHelper.tabClose(t+"_id_meliscommerce_variants_page")):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCore.flashMessenger()}),(function(e){console.log(e)}))})),melisCoreTool.done(e)})),e.on("click",".save-variant",(function(){melisCoreTool.pending(".save-variant");var e,t,i=$(this),o=i.closest(".container-level-a").data("prodid"),a=o+"_id_meliscommerce_products_page",s=i.closest(".container-level-a").attr("id"),r=isNaN(parseInt(s,10))?"":parseInt(s,10),n=isNaN(parseInt(s,10))?"":parseInt(s,10)+"_",l=i.closest(".container-level-a").find("form"),c=[];t=0,l.each((function(){var i=$(this),o=i.attr("name"),a=i.serializeArray();for(e=a.length,j=0;j<e;j++)c.push({name:o+"["+t+"]["+a[j].name+"]",value:a[j].value});t++})),c.push({name:"variantId",value:r}),(c=melisCommerceSeo.serializeSeo("variant",r,c)).push({name:"variant[0][var_id]",value:r},{name:"variant[0][var_prd_id]",value:o}),$("#"+s).find(".make-switch div").each((function(){var e=$(this),t="variant[0]["+e.find("input").attr("name")+"]",i=0;e.hasClass("switch-on")&&(i=1),c.push({name:t,value:i})})),melisCommerce.postSave("/melis/MelisCommerce/MelisComVariant/saveVariant",c,(function(e){if(e.success)melisHelper.tabClose(n+"id_meliscommerce_variants_page"),melisHelper.tabOpen(e.chunk.varSku,"icon-tag-2",e.chunk.variantId+"_id_meliscommerce_variants_page","meliscommerce_variants_page",{variantId:e.chunk.variantId,productId:o},a),melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload(o+"_id_meliscommerce_products_page_content_tab_variant_content_container","meliscommerce_products_page_content_tab_variant_content_container",{productId:o}),melisCommerce.setUniqueId(e.chunk.variantId),melisCore.flashMessenger();else{melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors);var t="id_meliscommerce_variant_content";e.chunk.variantId&&(t=e.chunk.variantId+"id_meliscommerce_variant_content"),melisCoreTool.highlightErrors(0,e.errors,t)}melisCoreTool.done(".save-variant"),melisCore.flashMessenger()}),(function(e){console.log(e),alert(translations.tr_meliscore_error_message)}))})),e.on("mouseenter mouseleave",".toolTipVarHoverEvent",(function(e){var t=$(this),i=t.data("variantid"),o=t.closest(".container-level-a").attr("id").replace(/[^0-9]/g,"");$.each($("table#variantTable"+i+" thead").nextAll(),(function(e,t){$(t).remove()})),$('<div class="qtipLoader"><hr/><span class="text-center col-lg-12">Loading...</span><br/></div>').insertAfter("table#variantTable"+i+" thead"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComProductList/getToolTip",data:{variantId:i,productId:o},dataType:"json",encode:!0}).done((function(e){$("div.qtipLoader").remove(),0===e.content.length?$('<div class="qtipLoader"><hr/><span class="text-center col-lg-12">'+translations.tr_meliscommerce_product_tooltip_no_variants+"</span><br/></div>").insertAfter("table.qtipTable thead"):($.each($("table#variantTable"+i+" thead").nextAll(),(function(e,t){$(t).remove()})),$.each(e.content.reverse(),(function(e,t){$(t).insertAfter("table#variantTable"+i+" thead")})))})).fail((function(){alert(translations.tr_meliscore_error_message)}))})),e.on("click",".updateVariantStatus",(function(){var e=$(this),t="",i={},o="",a="",s="",r=e.closest("tr").attr("id"),n=e.closest("tr").attr("var_status"),l=e.closest(".container-level-a").attr("id").replace(/[^0-9]/g,"");0==n?(o=1,a="text-success",s="btn-danger",t=translations.tr_meliscommerce_variants_deactivate_status_title):(o=0,a="text-danger",s="btn-success",t=translations.tr_meliscommerce_variants_activate_status_title),i.id=r,i.var_status=o,$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComVariantList/updateVariantStatus",data:$.param(i),beforeSend:function(){e.addClass("disabled").attr("disabled",!0),e.find(".variant-update-icon-rotate").removeClass((function(e,t){return(t.match(/(^|\s)fa-\S+/g)||[]).join(" ")})).addClass("fa-spinner fa-pulse fa-fw")}}).done((function(i){i.success&&(e.closest("tr").attr("var_status",o),e.find(".variant-update-icon-rotate").removeClass((function(e,t){return(t.match(/(^|\s)fa-\S+/g)||[]).join(" ")})).addClass("fa-arrow-circle-up"),e.removeClass((function(e,t){return(t.match(/(^|\s)btn-\S+/g)||[]).join(" ")})).addClass(s),e.closest("tr").find(".var-status-indicator").removeClass((function(e,t){return(t.match(/(^|\s)text-\S+/g)||[]).join(" ")})).addClass(a),e.find(".variant-update-icon-rotate").toggleClass("down"),$("#"+r+"_id_meliscommerce_variant_tab_main_header_container").length&&melisHelper.zoneReload(r+"_id_meliscommerce_variant_tab_main_header_container","meliscommerce_variant_tab_main_header_container",{productId:l,variantId:r}),e.attr("title",t)),e.removeClass("disabled").attr("disabled",!1)})).fail((function(){alert(translations.tr_meliscore_error_message)}))})),e.on("click",".tabs-label li a",(function(){var e=$(this),t=e.attr("href");"meliscommerce_products_page_content_tab_variants"===e.closest("li").data("meliskey")&&$(t).find(".refresh-attribute-lists").trigger("click")}))})),window.initProductVariant=function(e,t){var i=$("#"+t.sTableId).data("prodid");e.prodId=i},window.variantLoaded=function(){$(this);var e=$(".tab-pane#"+activeTabId).data("prodid")+"_id_meliscommerce_products_page";melisCommerce.enableTab(e)},window.checkVarStatus=function(){var e="",t="";e=null!=$(".updateVariantStatus").closest(".container-level-a.active").attr("id")?$(".updateVariantStatus").closest(".container-level-a.active").attr("id").replace(/[^0-9]/g,""):$(".save-variant").closest(".container-level-a.active").data("prodid"),$("#"+e+"_tableProductVariantList tbody tr").each((function(){var e=$(this).attr("var_status");if(null!=e){var i="btn-danger",o=$(this).find(".variant-update-icon-rotate");0==e?(i="btn-success",t=translations.tr_meliscommerce_variants_activate_status_title):(o.toggleClass("down"),t=translations.tr_meliscommerce_variants_deactivate_status_title),o.closest("a").removeClass((function(e,t){return(t.match(/(^|\s)btn-\S+/g)||[]).join(" ")})).addClass(i).attr("title",t)}}))},$((function(){var e=$("body");e.on("keyup keydown change","input[name='eseo_meta_title']",{limit:60},seoCharCounter),e.on("keyup keydown change","textarea[name='eseo_meta_description']",{limit:160},seoCharCounter)})),window.preSeoCharCounter=function(){$("form.seoForm").each((function(){var e=$(this),t=e.find("input[name='eseo_meta_title']"),i=e.find("textarea[name='eseo_meta_description']");t.trigger("keyup"),i.trigger("keyup")}))},window.seoCharCounter=function(e){var t=$(this),i=t.val().length,o=t.prev("label"),a=e.data.limit;o.find(".label-text span").length?0===i?(o.removeClass("limit"),o.find(".label-text span").remove()):(o.find(".label-text span").html('<i class="fa fa-text-width"></i>('+i+")"),i>a?(o.addClass("limit"),o.find(".label-text span").addClass("limit")):(o.removeClass("limit"),o.find(".label-text span").removeClass("limit"))):0!==i&&(o.find(".label-text").append("<span class='text-counter-indicator'><i class='fa fa-text-width'></i>("+i+")</span>"),i>a&&(o.addClass("limit"),o.find(".label-text span").addClass("limit")))};window,melisCommerceSeo={serializeSeo:function(e,t,i){var o=new Array;return $("form."+e+"_"+t+"_seo_form").each((function(){langId=$(this).data("langid"),o=$(this).serializeArray(),$.each(o,(function(){i.push({name:e+"_seo["+langId+"]["+this.name+"]",value:this.value})}))})),i}};function viewClientOrder(e,t){melisHelper.tabOpen(translations.tr_meliscommerce_orders_Orders,"fa fa fa-cart-plus fa-2x","id_meliscommerce_order_list_page","meliscommerce_order_list_page");var i=$("body #melis-id-nav-bar-tabs li a.tab-element[data-id='id_meliscommerce_order_list_page']"),o=setInterval((function(){i.length&&(melisHelper.tabOpen(t,"fa fa fa-cart-plus fa-2x",e+"_id_meliscommerce_orders_page","meliscommerce_orders_page",{orderId:e},"id_meliscommerce_order_list_page"),clearInterval(o))}),500)}function melisClientKoNotification(e,t,i,o){void 0===o&&(o="closeByButtonOnly"),o="closeByButtonOnly"!==o?"overlay-hideonclick":"";var a="<h3>"+melisHelper.melisTranslator(e)+"</h3>";a+="<h4>"+melisHelper.melisTranslator(t)+"</h4>",$.each(i,(function(e,t){if("label"!==e){a+='<p class="modal-error-cont"><b>'+(null==i[e].label?null==i.label?e:i.label:i[e].label)+": </b>  ";try{$.each(t,(function(e,t){"label"!==e&&"form"!==e&&($errMsg="",$errMsg=t instanceof Object?t[0]:t,a+='<span><i class="fa fa-circle"></i>'+$errMsg+"</span>")}))}catch(i){"label"!==e&&"form"!==e&&(a+='<span><i class="fa fa-circle"></i>'+t+"</span>")}a+="</p>"}}));var s="<div class='melis-modaloverlay "+o+"'></div>";s+="<div class='melis-modal-cont KOnotif'>  <div class='modal-content'>"+a+" <span class='btn btn-block btn-primary'>"+translations.tr_meliscore_notification_modal_Close+"</span></div> </div>",$body.append(s)}function addNewOrderCallback(e,t){void 0!==e&&e!=t&&melisHelper.zoneReload("id_meliscommerce_order_checkout","meliscommerce_order_checkout",{clientId:t})}$((function(){var e=$("body");function t(e,t,o){var a=$(".test-results .results ul").empty(),s=$(".test-results .results p").empty();i(0),$("#account-list-import-accounts").hide(),$.ajax({type:"POST",url:t,data:e,cache:!1,contentType:!1,processData:!1,beforeSend:function(){i(20),$("#importAccounts").attr("disabled",!0)}}).done((function(e){i(90),setTimeout((function(){i(100),e.success?(s.text(e.textMessage),"import"==o?(melisHelper.zoneReload("id_meliscommerce_clients_list_page","meliscommerce_clients_list_page"),$("#id_meliscommerce_client_list_import_accounts_form_container").modal("hide"),melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisCore.flashMessenger(),melisHelper.zoneReload("id_meliscommerce_clients_list_widgets_num_clients","meliscommerce_clients_list_widgets_num_clients"),melisHelper.zoneReload("id_meliscommerce_clients_list_widgets_month_clients","meliscommerce_clients_list_widgets_month_clients"),melisHelper.zoneReload("id_meliscommerce_clients_list_widgets_avg_clients","meliscommerce_clients_list_widgets_avg_clients")):$("#importAccounts").attr("disabled",!1)):("test"==o&&$("#account-list-import-accounts").show(),s.text(e.textMessage),e.errors&&$.each(e.errors,(function(e,t){a.append("<li>"+t+"</li>")})))}),500)})).fail((function(){alert(translations.tr_meliscore_error_message)}))}function i(e){$(".accounts-import-progress prog_percent").text(e),$("div#accountsImportProgressBar").attr("arial-valuenow",e).css("width",e+"%").parent().parent().parent().removeClass("hidden")}e.on("click",(function(e){var t=$("#id_meliscommerce_client_modal_address_form_container"),i=$("#id_meliscommerce_client_modal_contact_address_form_container");$(e.target).hasClass("modal")&&(t.modal("hide"),i.modal("hide"),t.modal("hide"))})),e.on("click",".viewCleintInfo",(function(){var e=$(this).parents("tr").attr("id"),t=new Array;t.push({name:"accountId",value:e}),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComClient/getAccountName",data:t,dataType:"json",encode:!0,cache:!1}).done((function(t){if($("#saveClientContact").removeAttr("disabled"),t.success){var i="id_meliscommerce_clients_list_page";$("#id_meliscommerce_clients_list_page").length>0?melisHelper.tabOpen(t.accountName,"fa fa-user",e+"_id_meliscommerce_client_page","meliscommerce_client_page",{clientId:e},i):melisHelper.tabOpen(translations.tr_meliscommerce_clients_Clients,"fa fa-users fa-2x","id_meliscommerce_clients_list_page","meliscommerce_clients_list_page",{},null,(function(){melisHelper.tabOpen(t.accountName,"fa fa-user",e+"_id_meliscommerce_client_page","meliscommerce_client_page",{clientId:e},i)}))}else melisHelper.melisKoNotification(t.textTitle,t.textMessage,t.errors)})).fail((function(){$("#saveClientContact").removeAttr("disabled"),alert(translations.tr_meliscore_error_message)}))})),e.on("click",".addNewContact",(function(){var e=$(this).data("clientid");$(".addNewContact").attr("disabled","disabled"),zoneId="id_meliscommerce_client_modal_contact_form",melisKey="meliscommerce_client_modal_contact_form",modalUrl="/melis/MelisCommerce/MelisComClient/renderClientModal",melisHelper.createModal(zoneId,melisKey,!1,{clientId:e},modalUrl,(function(){$(".addNewContact").removeAttr("disabled")}))})),e.on("click",".addNewAddress",(function(){var e=$(this).data("clientid");$(".addNewAddress").attr("disabled","disabled"),zoneId="id_meliscommerce_client_modal_address_form",melisKey="meliscommerce_client_modal_address_form",modalUrl="/melis/MelisCommerce/MelisComClient/renderClientModal",melisHelper.createModal(zoneId,melisKey,!1,{clientId:e},modalUrl,(function(){$(".addNewAddress").removeAttr("disabled")}))})),e.on("click","#saveClientAddress",(function(){var e=$(this).data("clientid");dataString=$("#melisCommerceClientAddressFormModal").serializeArray(),dataString.push({name:"clientId",value:e}),dataString=$.param(dataString),$("#saveClientAddress").attr("disabled","disabled"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComClient/addClientAddress",data:dataString,dataType:"json",encode:!0}).done((function(t){$("#saveClientAddress").removeAttr("disabled"),t.success?($("#"+e+"_client_address_tab_nav").append(t.clientAddressDom.tabNav),$("#"+e+"_client_address_tab_content").append(t.clientAddressDom.tabContent),$("#nav_add_"+t.clientAddressDom.addressId).tab("show"),$("#id_meliscommerce_client_modal_address_form_container").modal("hide")):(melisHelper.melisKoNotification(t.textTitle,t.textMessage,t.errors),melisCoreTool.highlightErrors(t.success,t.errors,"melisCommerceClientAddressFormModal"))})).fail((function(){$("#saveClientAddress").removeAttr("disabled"),alert(translations.tr_meliscore_error_message)}))})),e.on("click",".deleteClientCotactAddress",(function(){var e=$(this),t=e.data("addressid"),i=e.data("addressaccordionid"),o=e.data("isnewadded");melisCoreTool.confirm(translations.tr_meliscommerce_clients_common_label_yes,translations.tr_meliscommerce_clients_common_label_no,translations.tr_meliscommerce_client_delete_address,translations.tr_meliscommerce_client_delete_address_confirm_msg,(function(){0==o&&$("#deletedClientAddress").append("<input name='deletedaddresses[]' value='"+t+"'>"),$("#"+i+"_contact_address_content").remove()}))})),e.on("click",".deleteClientAddress",(function(){var e=$(this),t=e.data("addressid"),i=e.data("tabclass"),o=e.data("isnewadded");melisCoreTool.confirm(translations.tr_meliscommerce_clients_common_label_yes,translations.tr_meliscommerce_clients_common_label_no,translations.tr_meliscommerce_client_delete_address,translations.tr_meliscommerce_client_delete_address_confirm_msg,(function(){0==o&&$("#deletedClientAddress").append("<input name='deletedaddresses[]' value='"+t+"'>"),$("."+i+":first").hasClass("active")&&($("."+i+":first").next().find("a").length?$("."+i+":first").next().find("a").tab("show"):$("."+i+":first").prev().find("a")&&$("."+i+":first").prev().find("a").tab("show")),$("."+i).remove()}))})),e.on("click",".clientMainContact",(function(){var e=$(this),t=e.data("clientid"),i=e.data("tabid");e.hasClass("fa-star-o")?($("#"+t+"_client_contact_tab_content .clientMainContact").removeClass("fa-star"),$("#"+t+"_client_contact_tab_content .clientMainContact").addClass("fa-star-o"),e.addClass("fa-star"),e.removeClass("fa-star-o"),$("#"+t+"_client_contact_tab_content").find('form input[name="cper_is_main_person"]').val(0),$("#"+i).find("form input[name='cper_is_main_person']").val(1)):(e.removeClass("fa-star"),e.addClass("fa-star-o"),$("#"+i).find("form input[name='cper_is_main_person']").val(0))})),e.on("switch-change",".clientContactStatus",(function(){var e=$(this),t=(e.data("clientid"),e.data("tabid"));e.find(".switch-animate").hasClass("switch-on")?(e.find(".switch-animate").removeClass("switch-off").addClass("switch-on"),$("#"+t).find("form input[name='cper_status']").val(1)):$("#"+t).find("form input[name='cper_status']").val(0)})),e.on("switch-change",".modalClientContactStatus",(function(){var e=$(this),t=(e.data("clientid"),$("#melisCommerceClientContactFormModal").find("input[name='cper_status']"));e.find(".switch-animate").hasClass("switch-on")?(e.find(".switch-animate").removeClass("switch-off").addClass("switch-on"),t.val(1)):t.val(0)})),e.on("click",".deleteClientContactAddress",(function(){var e=$(this).data("tabclass");melisCoreTool.confirm(translations.tr_meliscommerce_clients_common_label_yes,translations.tr_meliscommerce_clients_common_label_no,translations.tr_meliscommerce_client_delete_new_contact,translations.tr_meliscommerce_client_delete_new_contact_confirm_msg,(function(){var t=$("."+e+"_client_contact:first"),i=$("."+e+"_client_contact");t.hasClass("active")&&(t.next().find("a").length?t.next().find("a").tab("show"):t.prev().find("a")&&t.prev().find("a").tab("show")),i.remove()}))})),e.on("click",".saveClientInfo",(function(){var e=$(this),t=e.data("clientid"),i=new Array;i=$("#"+t+"_id_meliscommerce_client_page form").not(".clientContactForm, .clientContactAddressForm, .clientAddressForm").serializeArray(),$("#"+t+"_id_meliscommerce_client_page form.clientContactForm").addClass(t+"_clientContactForm"),$("."+t+"_clientContactForm").each((function(){var e=$(this),t=e.data("tabid"),o=e.serializeArray();$.each(o,(function(){i.push({name:"clientContacts["+t+"]["+this.name+"]",value:this.value})})),$("#"+t+"_contact_address form").each((function(){var e=$(this),o=e.data("contactaddressid"),a=e.serializeArray();$.each(a,(function(){i.push({name:"clientContacts["+t+"][contact_address]["+o+"]["+this.name+"]",value:this.value})}))}))})),$("#"+t+"_id_meliscommerce_client_page form.clientAddressForm").addClass(t+"_clientAddressForm"),$("."+t+"_clientAddressForm").each((function(){var e=$(this),t=e.data("addressid"),o=e.serializeArray();$.each(o,(function(){i.push({name:"clientAddresses["+t+"]["+this.name+"]",value:this.value})}))})),i.push({name:"clientId",value:t});var o=0;$("#"+t+"_cli_status input").is(":checked")&&(o=1),i.push({name:"cli_status",value:o});var a=e.closest(".tab-pane").find('#id_meliscommerce_clients_company_form input[type="file"]').prop("files")[0],s=new FormData;void 0!==a&&s.append("ccomp_logo",a),$.each(i,(function(e,t){s.append(t.name,t.value)})),e.attr("disabled","disabled"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComClient/saveClient",data:s,cache:!1,contentType:!1,processData:!1}).done((function(e){if(e.success){melisHelper.tabClose(t+"_id_meliscommerce_client_page"),melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.tabOpen(e.clientName,"fa fa-user",e.clientId+"_id_meliscommerce_client_page","meliscommerce_client_page",{clientId:e.clientId},"id_meliscommerce_clients_list_page"),melisHelper.zoneReload("id_meliscommerce_clients_list_content","meliscommerce_clients_list_content"),melisHelper.zoneReload("id_meliscommerce_clients_list_widgets_num_clients","meliscommerce_clients_list_widgets_num_clients"),melisHelper.zoneReload("id_meliscommerce_clients_list_widgets_month_clients","meliscommerce_clients_list_widgets_month_clients"),melisHelper.zoneReload("id_meliscommerce_clients_list_widgets_avg_clients","meliscommerce_clients_list_widgets_avg_clients")}else melisClientKoNotification(e.textTitle,e.textMessage,e.errors),clientHighlightErrors(e.success,e.errors,activeTabId+" form");melisCore.flashMessenger()})).fail((function(){alert(translations.tr_meliscore_error_message)})).always((function(){e.removeAttr("disabled")}))})),e.on("click",".clientOrderView",(function(){viewClientOrder($(this).closest("tr").attr("id"),$(this).closest("tr").find("td:nth-child(2) a").text())})),e.on("click",".clientOrderListRefresh",(function(){var e=$(this).data("clientid");melisHelper.zoneReload(e+"_id_meliscommerce_client_page_tab_orders","meliscommerce_client_page_tab_orders",{clientId:e,activateTab:!0})})),e.on("click",".clientsExport",(function(){melisCoreTool.isTableEmpty("clientListTbl")||(zoneId="id_meliscommerce_client_list_content_export_form",melisKey="meliscommerce_client_list_content_export_form",modalUrl="/melis/MelisCommerce/MelisComClientList/renderClientListModal",melisHelper.createModal(zoneId,melisKey,!1,{},modalUrl,(function(){melisCoreTool.done(this)})))})),e.on("click",".clientsExportAccounts",(function(){melisCoreTool.isTableEmpty("clientListTbl")||(zoneId="id_meliscommerce_client_list_export_accounts_form",melisKey="meliscommerce_client_list_export_accounts_form",modalUrl="/melis/MelisCommerce/MelisComClientList/renderClientListModal",melisHelper.createModal(zoneId,melisKey,!1,{},modalUrl,(function(){melisCoreTool.done(this)})))})),e.on("click","#exportAccounts",(function(e){e.preventDefault();var t=$(this),i={},o=$("form#client-list-export-accounts").serializeArray();i.groupId=$("#clientsGroupSelect").val(),i.status=$("#clientsStatusSelect").val(),i.search=$("#clientListTbl_filter input[type='search']").val(),$.each(o,(function(e,t){i[t.name]=t.value})),$.ajax({url:"/melis/MelisCommerce/MelisComClientList/exportAccounts",data:$.param(i),type:"GET",beforeSend:function(){t.attr("disabled",!0)}}).done((function(e,i,o){var a=o.getResponseHeader("fileName");a=decodeURIComponent(escape(a));for(var s=o.getResponseHeader("Content-Type"),r="",n=0;n<e.length;n++)r+=String.fromCharCode(255&e.charCodeAt(n));var l=new Uint8Array(r.length);for(n=0;n<r.length;n++)l[n]=r.charCodeAt(n);var c=new Blob([l],{type:s});saveAs(c,a),t.attr("disabled",!1),$("#id_meliscommerce_client_list_export_accounts_form_container").modal("hide")})).fail((function(){alert(translations.tr_meliscore_error_message)}))})),e.on("click","#exportClients",(function(){var e=$(this),t=e.closest("#id_meliscommerce_client_list_content_export_form").find("form").serializeArray();melisCoreTool.pending(e),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComClientList/clientsExportValidate",data:t,dataType:"json",encode:!0}).done((function(e){e.success?(melisCoreTool.exportData("/melis/MelisCommerce/MelisComClientList/clientsExportToCsv"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(0,e.errors,"id_meliscommerce_client_list_content_export_form"),$(".date_start").prev("label").css("color","#686868"),$(".date_end").prev("label").css("color","#686868"),$.each(e.errors,(function(e,t){"date_start"==e&&$(".date_start").prev("label").css("color","red"),"date_end"==e&&$(".date_end").prev("label").css("color","red")})))})),melisCoreTool.done(e)})),e.on("click",".shopping_cart",(function(){var e=$(this).attr("href"),t=$(e);melisCore.screenSize<768&&t.find(".clientOrderListRefresh").trigger("click")})),e.on("change","#clientsGroupSelect",(function(){$("#clientListTbl").DataTable().ajax.reload()})),e.on("click",".delete-client-email",(function(e){e.preventDefault(),e.stopPropagation();var t=$(this).closest(".client-email-dropdown"),i=$(this).closest("ul"),o=$(this).closest("li"),a=$(this).data("id");melisCoreTool.confirm(translations.tr_meliscommerce_clients_common_label_yes,translations.tr_meliscommerce_clients_common_label_no,translations.tr_meliscommerce_clients_delete_email,translations.tr_meliscommerce_clients_delete_email_message,(function(){$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComClient/deleteClientPersonEmail",data:{cpmail_id:a},dataType:"json",encode:!0}).done((function(e){1==e.success&&(o.remove(),1==i.find("li").length&&t.remove(),melisCore.flashMessenger(),melisHelper.melisOkNotification(e.textTitle,e.textMessage))}))}))})),e.on("click",".client-email-dropdown-item",(function(e){e.preventDefault(),$(this).closest(".form-group").find("input").val($(this).text().trim())})),e.on("mouseenter",".client-email-dropdown",(function(){$(this).addClass("show"),$(this).find(".client-email-dropdown-content").addClass("show")})),e.on("mouseleave",".client-email-dropdown",(function(){$(this).removeClass("show"),$(this).find(".client-email-dropdown-content").removeClass("show")})),e.on("change","#clientsStatusSelect",(function(){$("#clientListTbl").DataTable().ajax.reload()})),e.on("mouseenter mouseout",".clientOrderRefToolTipHoverEvent",(function(e){var t=$(this).data("orderid"),i=$(this).text();$("table#orderBasketTable"+t).attr("data-orderid",t),$("table#orderBasketTable"+t).attr("data-ref",i),$(".thClassColId").attr("style",""),$.each($("table#orderBasketTable"+t+" thead").nextAll(),(function(e,t){$(t).remove()})),$('<div class="qtipLoader"><hr/><span class="text-center col-lg-12">Loading...</span><br/></div>').insertAfter("table#orderBasketTable"+t+" thead"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComOrderList/getOrderBasketToolTip",data:{orderId:t},dataType:"json",encode:!0}).done((function(e){$("div.qtipLoader").remove(),0===e.content.length?$('<div class="qtipLoader"><hr/><span class="text-center col-lg-12">'+translations.tr_meliscommerce_product_tooltip_no_variants+"</span><br/></div>").insertAfter("table.qtipTable thead"):($.each($("table#orderBasketTable"+t+" thead").nextAll(),(function(e,t){$(t).remove()})),$.each(e.content.reverse(),(function(e,i){$(i).insertAfter("table#orderBasketTable"+t+" thead")})))})).fail((function(){alert(translations.tr_meliscore_error_message)}))})),e.on("click","[id^='orderBasketTable']",(function(){viewClientOrder($(this).attr("data-orderid"),$(this).attr("data-ref"))})),e.on("click",".addNewClientOrder",(function(){var e=$(this).attr("data-clientid");melisHelper.tabOpen(translations.tr_meliscommerce_orders_Orders,"fa fa fa-cart-plus fa-2x","id_meliscommerce_order_list_page","meliscommerce_order_list_page");var t=$("body #melis-id-nav-bar-tabs li a.tab-element[data-id='id_meliscommerce_order_list_page']"),i=setInterval((function(){if(t.length){var o=$("#id_meliscommerce_order_checkout").data("clientid");melisHelper.tabOpen(translations.tr_meliscommerce_order_checkout_title,"fa fa fa-plus fa-2x","id_meliscommerce_order_checkout","meliscommerce_order_checkout",{clientId:e},"id_meliscommerce_order_list_page",addNewOrderCallback(o,e)),clearInterval(i)}}),500)})),e.on("click",".deleteClient",(function(){var e=$(this).parents("tr");e.hasClass("child")&&(e=e.prev());var t=e.attr("id");melisCoreTool.confirm(translations.tr_meliscommerce_clients_common_label_yes,translations.tr_meliscommerce_clients_common_label_no,translations.tr_meliscommerce_client_delete_account,translations.tr_meliscommerce_client_delete_account_msg,(function(){$.ajax({url:"/melis/MelisCommerce/MelisComClient/deleteAccount",data:{accountId:t},type:"POST"}).done((function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload("id_meliscommerce_clients_list_page","meliscommerce_clients_list_page"),melisHelper.zoneReload("id_meliscommerce_clients_list_widgets_num_clients","meliscommerce_clients_list_widgets_num_clients"),melisHelper.zoneReload("id_meliscommerce_clients_list_widgets_month_clients","meliscommerce_clients_list_widgets_month_clients"),melisHelper.zoneReload("id_meliscommerce_clients_list_widgets_avg_clients","meliscommerce_clients_list_widgets_avg_clients")):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.error),melisCore.flashMessenger()}))}))})),e.on("click",".accountContactUnlink",(function(){var e=$(this).parents("tr");e.hasClass("child")&&(e=e.prev());var t=e.attr("data-accountid"),i=e.attr("id");melisCoreTool.confirm(translations.tr_meliscommerce_clients_common_label_yes,translations.tr_meliscommerce_clients_common_label_no,translations.tr_meliscommerce_client_unlink_contact,translations.tr_meliscommerce_client_unlink_contact_msg,(function(){$.ajax({url:"/melis/MelisCommerce/MelisComClient/unlinkAccountContact",data:{accountId:t,contactId:i},type:"POST"}).done((function(e){e.success?($("#"+e.accountId+"_accountContactList").DataTable().ajax.reload(),melisHelper.melisOkNotification(e.textTitle,e.textMessage),$("#id_meliscommerce_contact_list_page").length>0&&$("#"+i+"_id_meliscommerce_contact_page_content_tab_association").length>0&&(melisHelper.zoneReload(i+"_id_meliscommerce_contact_page_content_tab_association","meliscommerce_contact_page_content_tab_association",{contactId:i,activateTab:!0}),accountToolSelectedContact=i,accountToolInitContactAutoSuggest=!0)):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.error)}))}))})),e.on("click",".accountContactLink",(function(){var e=$("#"+activeTabId+" input.link-contact-data"),t=e.data("contactid"),i=e.data("accountid");$(this).attr("disabled",!0),$.ajax({url:"/melis/MelisCommerce/MelisComClient/linkAccountContact",data:{accountId:i,contactId:t},type:"POST"}).done((function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload(i+"_id_meliscommerce_client_page_tab_contact","meliscommerce_client_page_tab_contact",{clientId:i,activateTab:!0}),$("#id_meliscommerce_contact_list_page").length>0&&$("#"+t+"_id_meliscommerce_contact_page_content_tab_association").length>0&&(melisHelper.zoneReload(t+"_id_meliscommerce_contact_page_content_tab_association","meliscommerce_contact_page_content_tab_association",{contactId:t,activateTab:!0}),accountToolSelectedContact=t,accountToolInitContactAutoSuggest=!0)):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.error),$(this).attr("disabled",!1)}))})),e.on("click",".accountsImport",(function(){zoneId="id_meliscommerce_client_list_import_accounts_form",melisKey="meliscommerce_client_list_import_accounts_form",modalUrl="/melis/MelisCommerce/MelisComContact/renderContactListModal",melisHelper.createModal(zoneId,melisKey,!1,{},modalUrl,(function(){melisCoreTool.done(this)}))})),e.on("click",".updateDefaultContact",(function(){var e=$(this).parents("tr");e.hasClass("child")&&(e=e.prev());var t=$(this),i=e.attr("data-carid"),o=t.data("accountid"),a=t.data("vdata");e.attr("id");$.ajax({url:"/melis/MelisCommerce/MelisComClient/updateDefaultContact",data:{accountId:o,carId:i,car_default_person:a},type:"POST"}).done((function(e){e.success?($("#"+o+"_accountContactList").DataTable().ajax.reload(),melisHelper.melisOkNotification(e.textTitle,e.textMessage),$("#id_meliscommerce_contact_list_page").length>0&&$("li[data-tool-id='id_meliscommerce_contact_list_page'] .nav-group-dropdown li").each((function(){var e=$(this).data("tool-id").replace("_id_meliscommerce_contact_page","");melisHelper.zoneReload(e+"_id_meliscommerce_contact_page_content_tab_association","meliscommerce_contact_page_content_tab_association",{contactId:e,activateTab:!0},(function(){accountToolSelectedContact=e,accountToolInitContactAutoSuggest=!0}))})),$("#clientListTbl").DataTable().ajax.reload()):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.error)}))})),e.on("click","#testImportAccounts, #importAccounts",(function(e){var i=$("#account-list-import-accounts"),o=new FormData(i[0]),a=$(this).attr("data-action");$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComClient/validateAccountsImportsForm",data:o,cache:!1,contentType:!1,processData:!1,beforeSend:function(){}}).done((function(e){e.success?t(o,"import"==a?"/melis/MelisCommerce/MelisComClient/importAccounts":"/melis/MelisCommerce/MelisComClient/testImportAccounts",a):(melisHelper.melisKoNotification(e.title,e.message,e.errors),melisHelper.highlightMultiErrors(e.success,e.errors,"#account-list-import-accounts"))})).fail((function(){alert(translations.tr_meliscore_error_message)})),e.preventDefault()})),e.on("mouseover","table tbody td",(function(){null!=$(this).find("span.td-tooltip")&&$(this).find("span.td-tooltip").removeClass("d-none").css("left",$(this).position().left+87)})),e.on("mouseout","table tbody td",(function(){$(this).find("span.td-tooltip").addClass("d-none")})),$("body").on("click",".remove-company-image",(function(){$(this).closest("form#id_meliscommerce_clients_company_form").find("input[name='ccomp_logo']").val(""),$("#"+activeTabId+" .client-company-preview").css("display","none"),$("#"+activeTabId+" .client-company-preview img").attr("src",""),$("#"+activeTabId+" .bootstrap-filestyle input").val("")})),e.on("click","#downloadAccountImportTemplate",(function(e){e.preventDefault(),$.ajax({url:"/melis/download-account-template",data:{},type:"GET",beforeSend:function(){}}).done((function(e,t,i){var o=i.getResponseHeader("fileName");o=decodeURIComponent(escape(o));for(var a=i.getResponseHeader("Content-Type"),s="",r=0;r<e.length;r++)s+=String.fromCharCode(255&e.charCodeAt(r));var n=new Uint8Array(s.length);for(r=0;r<s.length;r++)n[r]=s.charCodeAt(r);var l=new Blob([n],{type:a});saveAs(l,o)})).fail((function(){alert(translations.tr_meliscore_error_message)}))})),$(document).on("click","#addContactAccount",(function(){var e="id_meliscommerce_client_modal_contact_form",t="meliscommerce_client_modal_contact_form",i="/melis/MelisCommerce/MelisComClient/renderClientModal";$("#id_meliscommerce_contact_list_page").length>0?(melisHelper.tabSwitch("id_meliscommerce_contact_list_page"),melisHelper.createModal(e,t,!1,{},i,(function(){$(".addNewContact").removeAttr("disabled")}))):melisHelper.tabOpen(translations.tr_meliscommerce_contact,"fa fa-user fa-2x","id_meliscommerce_contact_list_page","meliscommerce_contact_list_page",{},null,(function(){melisHelper.createModal(e,t,!1,{},i,(function(){$(".addNewContact").removeAttr("disabled")}))}))}))})),window.clientHighlightErrors=function(e,t,i){0===e?(""!==i&&$("#"+i+" .form-group label").css("color","#686868"),$.each(t,(function(e,t){"form"in t?$.each(this.form,(function(t,i){$("#"+i+" .form-control[name='"+e+"']").prev("label").css("color","red"),$("#"+i+" h4."+e).css("color","red")})):""!==i&&($("#"+i+" .form-control[name='"+e+"']").prev("label").css("color","red"),$("#"+i+" h4."+e).css("color","red"))}))):($("#"+i+" .form-group label").css("color","#686868"),$("#"+i+" h4").css("color","#686868"))},window.setClientId=function(e){e.clientId=""!=contactToolSelectedAccount?contactToolSelectedAccount:activeTabId.replace("_id_meliscommerce_client_page","")},window.initClientStatus=function(){$("#cli_status").bootstrapSwitch()},window.initClientOrderList=function(e,t){clientId=$("#"+t.sTableId).data("clientid"),e.clientId=clientId,e.osta_id=$("#"+clientId+"_id_meliscommerce_client_page_tab_orders .orderFilterStatus").val(),e.startDate=$("#"+clientId+"_tableClientOrderList").data("dStartDate"),e.endDate=$("#"+clientId+"_tableClientOrderList").data("dEndDate");t.iDraw>1&&(dateSelectionContent=translations.tr_meliscore_datepicker_select_date+"<i class=\"glyphicon glyphicon-calendar fa fa-calendar\"></i> <span class='sdate'>"+dStartDate+" - "+dEndDate+'</span> <b class="caret"></b>',$("#"+clientId+"_tableClientOrderList_wrapper .dt_orderdatepicker .dt_dateInfo").html(dateSelectionContent)),dStartDate="",dEndDate=""},window.initClientListTitle=function(){$("#"+clientId+"_tableClientOrderList .icon-shippment").parent("th").attr("title",translations.tr_meliscommerce_clients_list_col_products),$("#"+clientId+"_tableClientOrderList .fa-usd").parent("th").attr("title",translations.tr_meliscommerce_clients_list_col_price_title)},window.initClientContactAddressForm=function(){var e=$("#saveClientContactAddress").data("tabid"),t=$("#melisCommerceClientContactAddressFormModal");t.find("#cadd_civility").val($("#"+e+"_contact_form").find("#cper_civility").val()),t.find("#cadd_firstname").val($("#"+e+"_contact_form").find("#cper_firstname").val()),t.find("#cadd_name").val($("#"+e+"_contact_form").find("#cper_name").val()),t.find("#cadd_middle_name").val($("#"+e+"_contact_form").find("#cper_middle_name").val())},window.companyLogoPreview=function(e,t){if(t.files&&t.files[0]){$("#"+activeTabId+" .client-company-preview").css("display","");var i=new FileReader;i.onload=function(t){$("#"+activeTabId+" "+e).attr("src",t.target.result)},i.readAsDataURL(t.files[0])}else""!==$("#"+activeTabId+" "+e).data("img")?$("#"+activeTabId+" "+e).attr("src",$("#"+activeTabId+" "+e).data("img")):$("#"+activeTabId+" .client-company-preview").css("display","none")},window.initClientsFilters=function(e){$("#clientsGroupSelect").length&&(e.cgroup_id=$("#clientsGroupSelect").val()),$("#clientsStatusSelect").length?e.cli_status=$("#clientsStatusSelect").val():e.cli_status=1},window.initOrderToolTip=function(){$(".tooltipTable").each((function(){$(this).qtip({content:{text:$(this).next(".tooltiptext")},overwrite:!1,style:{classes:"qtip-tipsy qtip-shadow",width:"auto"},hide:{fixed:!0,delay:300,event:"mouseleave"},position:{target:"mouse",adjust:{mouse:!1},my:"center center",at:"center center"}})}))},window.accountsTableCallback=function(){$("#clientListTbl tbody").find("tr[data-hasorder='1']").each((function(){$(this).find("td").find(".deleteClient").addClass("d-none")}))},window.accountAssocContactListTblCallback=function(){var e=activeTabId.replace("_id_meliscommerce_client_page",""),t=$("#"+e+"_accountContactList tbody");t.find("tr");t.find("tr[data-accountid='0']").each((function(){$(this).find("td").find(".accountContactUnlink").addClass("d-none"),$(this).find("td").find(".updateDefaultContact").addClass("d-none")})),$("#0_accountContactList_wrapper").find(".meliscommerce-account-contact-list-tbl-search").addClass("d-none"),$("#"+e+"_accountContactList tbody tr").each((function(){var e=$(this),t=e.data("isdefault");e.data("isdefaultaccount");1==t&&(e.find("button.updateDefaultContact").removeClass("btn-info"),e.find("button.updateDefaultContact").addClass("btn-danger"),e.find("button.updateDefaultContact").attr("title",translations.tr_meliscommerce_contact_remove_default),e.find("button.updateDefaultContact").data("vdata",0),e.find(".ico-set-default").removeClass("fa-check"),e.find(".ico-set-default").addClass("fa-times"),e.find("button.updateDefaultContact").addClass("d-none"))})),contactToolSelectedAccount="",contactToolInitAccountAutoSuggest=!1},window.initContactAutoSuggesst=function(e){let t={url:function(t){return"/melis/MelisCommerce/MelisComContact/fetchAllContact?phrase="+t+"&accountId="+$(e).attr("data-accountid")},getValue:function(e){var t=e.cper_firstname;return null!=e.cper_name&&(t+=" "+e.cper_name),t},ajaxSettings:{dataType:"json",method:"GET",data:{dataType:"json"}},requestDelay:300,list:{maxNumberOfElements:20,onChooseEvent:function(){var t=$(e).getSelectedItemData();$(e).attr("data-contactid",t.cper_id),$("#"+activeTabId+" button.accountContactLink").attr("disabled",!1)}}};$(e).easyAutocomplete(t)},$((function(){var e=$("body");$(".a-accordion");function t(e,t){melisHelper.tabOpen(e,"fa fa fa-cart-plus fa-2x",t+"_id_meliscommerce_orders_page","meliscommerce_orders_page",{orderId:t},"id_meliscommerce_order_list_page")}e.on("click",(function(e){$(e.target).hasClass("modal")&&($("#id_meliscommerce_order_list_content_status_form_container").modal("hide"),$("#id_meliscommerce_order_modal_content_shipping_form_container").modal("hide"))})),e.on("click",".orderInfo",(function(e){var i=$(this),o=i.closest("tr").attr("id"),a=i.closest("tr").find("td:nth-child(2)").text(),s="";i[0].classList[2];s=a.length>0?a:o,melisHelper.tabOpen(translations.tr_meliscommerce_orders_Orders,"fa fa fa-cart-plus fa-2x","id_meliscommerce_order_list_page","meliscommerce_order_list_page");var r=$("body #melis-id-nav-bar-tabs li a.tab-element[data-id='id_meliscommerce_order_list_page']"),n=setInterval((function(){r.length&&(t(translations.tr_meliscommerce_orders_Order+" "+s,o),clearInterval(n))}),500)})),e.on("click",".addMessage",(function(){$(this).closest(".container-level-a").find(".add-message").slideToggle()})),e.on("click",".addReturnMessage",(function(){$(this).closest(".container-level-a").find(".add-return-message").slideToggle()})),e.on("click",".orderListRefresh",(function(){if(melisHelper.zoneReload("id_meliscommerce_order_list_page","meliscommerce_order_list_page"),"coupon"==$("#"+activeTabId).data("pageid")){var e=activeTabId.split("_")[0];melisHelper.zoneReload(e+"_id_meliscommerce_coupon_tabs_content_orders_details_table","meliscommerce_coupon_tabs_content_orders_details_table",{couponId:e})}})),e.on("click",".orderStatusRefresh",(function(){melisHelper.zoneReload("id_meliscommerce_order_status_content_table","meliscommerce_order_status_content_table")})),e.on("click",".addNewOrderStatus",(function(){var e=$(this).closest("tr").attr("id");zoneId="id_meliscommerce_order_status_form",melisKey="meliscommerce_order_status_form",modalUrl="/melis/MelisCommerce/MelisComOrderStatus/renderOrderStatusModal",melisHelper.createModal(zoneId,melisKey,!1,{ostaId:e},modalUrl,(function(){}))})),e.on("click",".orderBasketRefresh",(function(){var e=$(this).closest(".container-level-a").attr("id"),t=isNaN(parseInt(e,10))?"":parseInt(e,10);melisHelper.zoneReload(t+"_id_meliscommerce_orders_content_tabs_content_baskets_details_list","meliscommerce_orders_content_tabs_content_baskets_details_list",{orderId:t})})),e.on("click",".orderList",(function(){melisHelper.tabOpen(translations.tr_meliscommerce_orders_Orders,"fa fa fa-cart-plus fa-2x","id_meliscommerce_order_list_page","meliscommerce_order_list_page")})),e.on("click",".saveOrder",(function(){var e,i=$(this),o="melis/MelisCommerce/MelisComOrder/saveOrder",a=i.closest(".container-level-a").attr("id"),s=isNaN(parseInt(a,10))?"":parseInt(a,10),r=i.closest(".container-level-a").find("form"),n=[],l=0,c=i.closest(".container-level-a").find(".selectedStatus").data("statusid"),d=i.closest(".container-level-a").find("input[name=ord_reference]").val(),h=i.data("orderstatus");melisCoreTool.pending(".saveOrder"),r.each((function(){var t=$(this),i=t.attr("name"),o=t.serializeArray();for(e=o.length,j=0;j<e;j++)n.push({name:i+"["+l+"]["+o[j].name+"]",value:o[j].value});l++})),n.push({name:"orderId",value:s}),n.push({name:"order[0][ord_status]",value:c}),n.push({name:"lastStatus",value:h}),5==c&&5!=h?melisCoreTool.confirm(translations.tr_meliscommerce_order_common_label_yes,translations.tr_meliscommerce_order_common_label_no,d,translations.tr_meliscommerce_order_save_status_canceled_confirm,(function(){melisCommerce.postSave(o,n,(function(e){e.success?(melisHelper.tabClose(s+"_id_meliscommerce_orders_page"),t(translations.tr_meliscommerce_orders_Order+" "+e.chunk.order.ord_reference,e.chunk.order.ord_id),melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload("id_meliscommerce_order_list_page","meliscommerce_order_list_page"),melisCore.flashMessenger(),e.clientId+40&&melisHelper.zoneReload(e.clientId+"_id_meliscommerce_client_page_tab_orders","meliscommerce_client_page_tab_orders",{clientId:e.clientId,activateTab:!0})):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,s+"_id_meliscommerce_orders_page"))}),(function(e){console.log(e)}))})):melisCommerce.postSave(o,n,(function(e){e.success?(melisHelper.tabClose(s+"_id_meliscommerce_orders_page"),t(translations.tr_meliscommerce_orders_Order+" "+e.chunk.order.ord_reference,e.chunk.order.ord_id),melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload("id_meliscommerce_order_list_page","meliscommerce_order_list_page"),melisCore.flashMessenger(),e.clientId+40&&melisHelper.zoneReload(e.clientId+"_id_meliscommerce_client_page_tab_orders","meliscommerce_client_page_tab_orders",{clientId:e.clientId,activateTab:!0})):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,s+"_id_meliscommerce_orders_page"))}),(function(e){console.log(e)})),melisCoreTool.done(".saveOrder")})),e.on("click",".add-order-message",(function(){var e=$(this),t=e.data("type"),i=e.closest(".container-level-a").attr("id"),o=isNaN(parseInt(i,10))?"":parseInt(i,10),a=e.closest("div").find("form").serializeArray();a.push({name:"orderId",value:o}),a.push({name:"omsg_type",value:t}),melisCoreTool.pending(this),melisCommerce.postSave("melis/MelisCommerce/MelisComOrder/saveOrderMessage",a,(function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload(o+"_id_meliscommerce_orders_content_tabs_content_messages_details","meliscommerce_orders_content_tabs_content_messages_details",{orderId:o})):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,o+"_id_meliscommerce_orders_page"))}),(function(e){console.log(e)})),melisCoreTool.done(this)})),e.on("click",".add-order-return-message",(function(){var e=$(this),t=e.closest(".container-level-a").attr("id"),i=isNaN(parseInt(t,10))?"":parseInt(t,10),o=e.closest("div").find("form").serializeArray();o.push({name:"orderId",value:i}),o.push({name:"omsg_type",value:"RETURN"}),melisCoreTool.pending(this),melisCommerce.postSave("melis/MelisCommerce/MelisComOrder/saveOrderMessage",o,(function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload(i+"_id_meliscommerce_orders_content_tabs_content_return_products_content_message_timeline","meliscommerce_orders_content_tabs_content_return_products_content_message_timeline",{orderId:i})):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,i+"_id_meliscommerce_orders_page"))}),(function(e){console.log(e)})),melisCoreTool.done(this)})),e.on("click",".updateListStatus",(function(e){var t=$(this).data("orderid");e.preventDefault(),melisCoreTool.pending(this),zoneId="id_meliscommerce_order_list_content_status_form",melisKey="meliscommerce_order_list_content_status_form",modalUrl="/melis/MelisCommerce/MelisComOrderList/renderOrderListModal",melisHelper.createModal(zoneId,melisKey,!1,{orderId:t},modalUrl,(function(){melisCoreTool.done(this)}))})),e.on("click",".addShipping",(function(){var e=$(this).closest("tr").attr("id");melisCoreTool.pending(this),zoneId="id_meliscommerce_order_modal_content_shipping_form",melisKey="meliscommerce_order_modal_content_shipping_form",modalUrl="/melis/MelisCommerce/MelisComOrder/renderOrderModal",melisHelper.createModal(zoneId,melisKey,!1,{orderId:e},modalUrl,(function(){})),melisCoreTool.done(this)})),e.on("click","#saveOrderStatus",(function(){var e=$(this),t=e.closest("#id_meliscommerce_order_list_content_status_form").find("form").serializeArray(),i="melis/MelisCommerce/MelisComOrderList/saveOrderStatus",o=$('#id_meliscommerce_order_list_content_status_form select[name="ord_status"]').val(),a=translations.tr_meliscommerce_orders_Order+" "+e.data("reference");melisCoreTool.pending(this),5==o?melisCoreTool.confirm(translations.tr_meliscommerce_order_common_label_yes,translations.tr_meliscommerce_order_common_label_no,a,translations.tr_meliscommerce_order_save_status_canceled_confirm,(function(){melisCommerce.postSave(i,t,(function(e){if(e.success){if(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload("id_meliscommerce_order_list_page","meliscommerce_order_list_page"),e.clientId+40&&melisHelper.zoneReload(e.clientId+"_id_meliscommerce_client_page_tab_orders","meliscommerce_client_page_tab_orders",{clientId:e.clientId,activateTab:!0}),"coupon"==$("#"+activeTabId).data("pageid")){var t=activeTabId.split("_")[0];melisHelper.zoneReload(t+"_id_meliscommerce_coupon_tabs_content_orders_details_table","meliscommerce_coupon_tabs_content_orders_details_table",{couponId:t})}melisCore.flashMessenger()}else melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"id_meliscommerce_order_list_content_status_form")}),(function(e){console.log(e)}))})):melisCommerce.postSave(i,t,(function(e){if(e.success){if(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload("id_meliscommerce_order_list_page","meliscommerce_order_list_page"),e.clientId+40&&melisHelper.zoneReload(e.clientId+"_id_meliscommerce_client_page_tab_orders","meliscommerce_client_page_tab_orders",{clientId:e.clientId,activateTab:!0}),"coupon"==$("#"+activeTabId).data("pageid")){var t=activeTabId.split("_")[0];melisHelper.zoneReload(t+"_id_meliscommerce_coupon_tabs_content_orders_details_table","meliscommerce_coupon_tabs_content_orders_details_table",{couponId:t})}melisCore.flashMessenger()}else melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"id_meliscommerce_order_list_content_status_form")}),(function(e){console.log(e)})),melisCoreTool.done(this),$("#id_meliscommerce_order_list_content_status_form_container").modal("hide")})),e.on("click","#saveOrderShipping",(function(){var e,t=$(this).closest("#id_meliscommerce_order_modal_content_shipping_form").find("form"),i=$("#"+activeTabId+" input[name=ord_reference]").val(),o=$("#"+activeTabId+" .selectedStatus").data("statusid"),a=$("#"+activeTabId).attr("id"),s=isNaN(parseInt(a,10))?"":parseInt(a,10),r=[],n=0;melisCoreTool.pending(this),t.each((function(){var t=$(this),i=t.attr("name"),o=t.serializeArray();for(e=o.length,j=0;j<e;j++)r.push({name:i+"["+n+"]["+o[j].name+"]",value:o[j].value});n++})),r.push({name:"order[0][ord_id]",value:s}),r.push({name:"order[0][ord_reference]",value:i}),r.push({name:"order[0][ord_status]",value:o}),r.push({name:"orderId",value:s}),melisCommerce.postSave("melis/MelisCommerce/MelisComOrder/saveOrder",r,(function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),e.clientId+40&&melisHelper.zoneReload(e.clientId+"_id_meliscommerce_client_page_tab_orders","meliscommerce_client_page_tab_orders",{clientId:e.clientId,activateTab:!0}),$("#id_meliscommerce_order_modal_content_shipping_form_container").modal("hide"),melisHelper.zoneReload(s+"_id_meliscommerce_orders_content_tabs_content_shipping_details","meliscommerce_orders_content_tabs_content_shipping_details",{orderId:s}),melisCore.flashMessenger()):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"id_meliscommerce_order_modal_content_shipping_form"),$("#id_meliscommerce_order_modal_content_shipping_form .shippingDate").prev("label").css("color","#686868"),$.each(e.errors,(function(e,t){"oship_date_sent"==e&&$("#id_meliscommerce_order_modal_content_shipping_form .shippingDate").prev("label").css("color","red")})))}),(function(e){console.log(e)})),melisCoreTool.done(this)})),e.on("click",".mainOrderStatus",(function(){var e=$(this),t=e.find("span"),i=t.css("border-top-color");e.parent().find(".mainOrderStatus").each((function(){var e=$(this),t=e.find("span"),i=t.css("border-top-color");e.removeClass("selectedStatus"),t.css("color",i),t.css("background","#fff")})),e.addClass("selectedStatus"),t.css("color","#fff"),t.css("background",i)})),e.on("apply.daterangepicker",".dt_orderdatepicker",(function(e,t){var i=$(this).parents().eq(5).find("table").attr("id");$("#"+i).data("dStartDate",dStartDate),$("#"+i).data("dEndDate",dEndDate),$("#"+i).DataTable().ajax.reload()})),e.on("change",".orderFilterStatus",(function(){var e=$(this).parents().eq(6).find("table").attr("id");$("#"+e).DataTable().ajax.reload()})),e.on("click",".variantInfo",(function(){var e=$(this),t=e.closest("tr").data("variantid"),i=e.closest("tr").data("sku"),o=e.closest("tr").data("productid"),a=e.closest("tr").find("td:nth-child(3)").text(),s=o+"_id_meliscommerce_products_page",r="id_meliscommerce_product_list_container";$("body #melis-id-nav-bar-tabs li a.tab-element[data-id='id_meliscommerce_product_list_container']").length>0?(melisCommerce.disableAllTabs(),melisCommerce.openProductPage(o,a,r,(function(){melisCommerce.setUniqueId(o),melisHelper.tabOpen(i,"icon-tag-2",t+"_id_meliscommerce_variants_page","meliscommerce_variants_page",{variantId:t,productId:o},s),melisCommerce.setUniqueId(t),melisCommerce.enableAllTabs()}))):melisHelper.tabOpen("Products","icon-shippment","id_meliscommerce_product_list_container","meliscommerce_product_list_container","",r,(function(){melisCommerce.disableAllTabs(),melisCommerce.openProductPage(o,a,r,(function(){melisCommerce.setUniqueId(o),melisHelper.tabOpen(i,"icon-tag-2",t+"_id_meliscommerce_variants_page","meliscommerce_variants_page",{variantId:t,productId:o},s),melisCommerce.setUniqueId(t),melisCommerce.enableAllTabs()}))}))})),e.on("click",".ordersExport",(function(){melisCoreTool.isTableEmpty("tableOrderList")||(zoneId="id_meliscommerce_order_list_content_export_form",melisKey="meliscommerce_order_list_content_export_form",modalUrl="/melis/MelisCommerce/MelisComOrderList/renderOrderListModal",melisHelper.createModal(zoneId,melisKey,!1,{},modalUrl,(function(){melisCoreTool.done(this)})))})),e.on("click","#exportOrders",(function(){var e=$(this),t=e.closest("#id_meliscommerce_order_list_content_export_form").find("form").serializeArray();melisCoreTool.pending(e),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComOrderList/ordersExportValidate",data:t,dataType:"json",encode:!0}).done((function(e){e.success?(melisCoreTool.exportData("/melis/MelisCommerce/MelisComOrderList/ordersExportToCsv"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(0,e.errors,"id_meliscommerce_order_list_content_export_form"),$(".date_start").prev("label").css("color","#686868"),$(".date_end").prev("label").css("color","#686868"),$.each(e.errors,(function(e,t){"date_start"==e&&$(".date_start").prev("label").css("color","red"),"date_end"==e&&$(".date_end").prev("label").css("color","red")})))})),melisCoreTool.done(e)})),e.on("click","#saveOrderStatusForm",(function(){var e,t=$(this).data("statusid"),i=$("#id_meliscommerce_order_status_form_container .make-switch div").hasClass("switch-on"),o=$("#id_meliscommerce_order_status_form_container").find("form"),a=[],s=0,r=0;i&&(r=1),o.each((function(){var t=$(this),i=t.attr("name"),o=t.serializeArray();for(e=o.length,j=0;j<e;j++)a.push({name:i+"["+s+"]["+o[j].name+"]",value:o[j].value});s++})),a.push({name:"statusId",value:t}),a.push({name:"order_status[0][osta_status]",value:r}),melisCoreTool.pending(this),melisCommerce.postSave("melis/MelisCommerce/MelisComOrderStatus/saveOrderStatus",a,(function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload("id_meliscommerce_order_status_content_table","meliscommerce_order_status_content_table"),melisCoreTool.hideModal("id_meliscommerce_order_status_form_container")):(melisCoreTool.highlightErrors(e.success,e.errors,"id_meliscommerce_order_status_form_container"),$.each(e.errors,(function(e,t){"osta_color_code"==e&&$(".osta_color_code").prev("label").css("color","red")})),melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors)),melisCore.flashMessenger()}),(function(e){console.log(e)})),melisCoreTool.done(this)})),e.on("click",".orderStatusDelete",(function(){var e=$(this).closest("tr").attr("id"),t=[];t.push({name:"ostaId",value:e}),melisCoreTool.pending(this),melisCoreTool.confirm(translations.tr_meliscommerce_documents_common_label_yes,translations.tr_meliscommerce_documents_common_label_no,translations.tr_meliscommerce_order_status_tool_leftmenu,translations.tr_meliscommerce_order_status_delete_confirm,(function(){melisCommerce.postSave("melis/MelisCommerce/MelisComOrderStatus/deleteOrderStatus",t,(function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload("id_meliscommerce_order_status_content_table","meliscommerce_order_status_content_table")):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCore.flashMessenger()}),(function(e){console.log(e)}))})),melisCoreTool.done(this)})),e.on("click",".a-accordion",(function(){var e=$(this),t=e.attr("href");e.hasClass("collapsed")?e.removeClass("collapsed"):e.toggleClass("collapsed"),$(t).collapse("toggle")})),e.on("click",".tabs-label li a",(function(){var e=$(this),t=e.attr("href");if(melisCore.screenSize<768)if(e.hasClass("shopping_bag"))$(t).find(".orderBasketRefresh").trigger("click");else if(e.hasClass("cart_out")){var i=activeTabId.match(/\d+/g);$("#"+i+"_tableOrderProductReturnList").DataTable().ajax.reload()}}))})),window.initOrderBasket=function(e,t){var i=$("#"+t.sTableId).data("orderid");e.orderId=i},window.hideBasketButton=function(e,t){$(".variantInfo").each((function(){var e=$(this);variantId=e.closest("tr").data("variantid"),productId=e.closest("tr").data("productid"),null!=variantId&&null!=productId||e.hide()}))},window.initOrderList=function(e,t){e.osta_id=$("#id_meliscommerce_order_list_content_table .orderFilterStatus").val(),e.startDate=$("#tableOrderList").data("dStartDate"),e.endDate=$("#tableOrderList").data("dEndDate");t.iDraw>1&&(dateSelectionContent=translations.tr_meliscore_datepicker_select_date+"<i class=\"glyphicon glyphicon-calendar fa fa-calendar\"></i> <span class='sdate'>"+dStartDate+" - "+dEndDate+'</span> <b class="caret"></b>',$("#tableOrderList_wrapper .dt_orderdatepicker .dt_dateInfo").html(dateSelectionContent)),dStartDate="",dEndDate=""},window.initOrderListTitle=function(){$("#tableOrderList .icon-shippment").parent("th").attr("title",translations.tr_meliscommerce_order_list_col_products),$("#tableOrderList .fa-usd").parent("th").attr("title",translations.tr_meliscommerce_order_list_col_price_title)},window.initCheckPermStatus=function(e){$("tr.primeStatus td").find(".orderStatusDelete").remove()},window.initClientIdForNewOrder=function(e){var t=$("#id_meliscommerce_order_checkout_choose_contact_step_content").data("clientid");null!=typeof t&&(e.clientId=t)},function(e,t){"function"==typeof define&&define.amd?define(["jquery"],(function(e){return t(e)})):"object"==typeof exports?module.exports=t(require("jquery")):jQuery&&!jQuery.fn.colorpicker&&t(jQuery)}(0,(function(e){"use strict";var t=function(i,o,a,s,r){this.fallbackValue=a?a&&void 0!==a.h?a:this.value={h:0,s:0,b:0,a:1}:null,this.fallbackFormat=s||"rgba",this.hexNumberSignPrefix=!0===r,this.value=this.fallbackValue,this.origFormat=null,this.predefinedColors=o||{},this.colors=e.extend({},t.webColors,this.predefinedColors),i&&(void 0!==i.h?this.value=i:this.setColor(String(i))),this.value||(this.value={h:0,s:0,b:0,a:1})};t.webColors={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32",transparent:"transparent"},t.prototype={constructor:t,colors:{},predefinedColors:{},getValue:function(){return this.value},setValue:function(e){this.value=e},_sanitizeNumber:function(e){return"number"==typeof e?e:isNaN(e)||null===e||""===e||void 0===e?1:""===e?0:void 0!==e.toLowerCase?(e.match(/^\./)&&(e="0"+e),Math.ceil(100*parseFloat(e))/100):1},isTransparent:function(e){return!(!e||!("string"==typeof e||e instanceof String))&&("transparent"===(e=e.toLowerCase().trim())||e.match(/#?00000000/)||e.match(/(rgba|hsla)\(0,0,0,0?\.?0\)/))},rgbaIsTransparent:function(e){return 0===e.r&&0===e.g&&0===e.b&&0===e.a},setColor:function(e){if(e=e.toLowerCase().trim()){if(this.isTransparent(e))return this.value={h:0,s:0,b:0,a:0},!0;var t=this.parse(e);t?(this.value=this.value={h:t.h,s:t.s,b:t.b,a:t.a},this.origFormat||(this.origFormat=t.format)):this.fallbackValue&&(this.value=this.fallbackValue)}return!1},setHue:function(e){this.value.h=1-e},setSaturation:function(e){this.value.s=e},setBrightness:function(e){this.value.b=1-e},setAlpha:function(e){this.value.a=Math.round(parseInt(100*(1-e),10)/100*100)/100},toRGB:function(e,t,i,o){var a,s,r,n,l;return 0===arguments.length&&(e=this.value.h,t=this.value.s,i=this.value.b,o=this.value.a),e=(e*=360)%360/60,a=s=r=i-(l=i*t),a+=[l,n=l*(1-Math.abs(e%2-1)),0,0,n,l][e=~~e],s+=[n,l,l,n,0,0][e],r+=[0,0,n,l,l,n][e],{r:Math.round(255*a),g:Math.round(255*s),b:Math.round(255*r),a:o}},toHex:function(e,t,i,o){0===arguments.length&&(e=this.value.h,t=this.value.s,i=this.value.b,o=this.value.a);var a=this.toRGB(e,t,i,o);return this.rgbaIsTransparent(a)?"transparent":(this.hexNumberSignPrefix?"#":"")+((1<<24)+(parseInt(a.r)<<16)+(parseInt(a.g)<<8)+parseInt(a.b)).toString(16).slice(1)},toHSL:function(e,t,i,o){0===arguments.length&&(e=this.value.h,t=this.value.s,i=this.value.b,o=this.value.a);var a=e,s=(2-t)*i,r=t*i;return r/=s>0&&s<=1?s:2-s,s/=2,r>1&&(r=1),{h:isNaN(a)?0:a,s:isNaN(r)?0:r,l:isNaN(s)?0:s,a:isNaN(o)?0:o}},toAlias:function(e,t,i,o){var a,s=0===arguments.length?this.toHex():this.toHex(e,t,i,o),r="alias"===this.origFormat?s:this.toString(this.origFormat,!1);for(var n in this.colors)if((a=this.colors[n].toLowerCase().trim())===s||a===r)return n;return!1},RGBtoHSB:function(e,t,i,o){var a,s,r,n;return e/=255,t/=255,i/=255,a=((a=0===(n=(r=Math.max(e,t,i))-Math.min(e,t,i))?null:r===e?(t-i)/n:r===t?(i-e)/n+2:(e-t)/n+4)+360)%6*60/360,s=0===n?0:n/r,{h:this._sanitizeNumber(a),s:s,b:r,a:this._sanitizeNumber(o)}},HueToRGB:function(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e},HSLtoRGB:function(e,t,i,o){var a;t<0&&(t=0);var s=2*i-(a=i<=.5?i*(1+t):i+t-i*t),r=e+1/3,n=e,l=e-1/3;return[Math.round(255*this.HueToRGB(s,a,r)),Math.round(255*this.HueToRGB(s,a,n)),Math.round(255*this.HueToRGB(s,a,l)),this._sanitizeNumber(o)]},parse:function(t){if(0===arguments.length)return!1;var i,o,a=this,s=!1,r=void 0!==this.colors[t];return r&&(t=this.colors[t].toLowerCase().trim()),e.each(this.stringParsers,(function(e,n){var l=n.re.exec(t);return!(i=l&&n.parse.apply(a,[l]))||(s={},o=r?"alias":n.format?n.format:a.getValidFallbackFormat(),(s=o.match(/hsla?/)?a.RGBtoHSB.apply(a,a.HSLtoRGB.apply(a,i)):a.RGBtoHSB.apply(a,i))instanceof Object&&(s.format=o),!1)})),s},getValidFallbackFormat:function(){var e=["rgba","rgb","hex","hsla","hsl"];return this.origFormat&&-1!==e.indexOf(this.origFormat)?this.origFormat:this.fallbackFormat&&-1!==e.indexOf(this.fallbackFormat)?this.fallbackFormat:"rgba"},toString:function(e,i){i=i||!1;var o=!1;switch(e=e||this.origFormat||this.fallbackFormat){case"rgb":return o=this.toRGB(),this.rgbaIsTransparent(o)?"transparent":"rgb("+o.r+","+o.g+","+o.b+")";case"rgba":return"rgba("+(o=this.toRGB()).r+","+o.g+","+o.b+","+o.a+")";case"hsl":return o=this.toHSL(),"hsl("+Math.round(360*o.h)+","+Math.round(100*o.s)+"%,"+Math.round(100*o.l)+"%)";case"hsla":return o=this.toHSL(),"hsla("+Math.round(360*o.h)+","+Math.round(100*o.s)+"%,"+Math.round(100*o.l)+"%,"+o.a+")";case"hex":return this.toHex();case"alias":return!1===(o=this.toAlias())?this.toString(this.getValidFallbackFormat()):i&&!(o in t.webColors)&&o in this.predefinedColors?this.predefinedColors[o]:o;default:return o}},stringParsers:[{re:/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*?\)/,format:"rgb",parse:function(e){return[e[1],e[2],e[3],1]}},{re:/rgb\(\s*(\d*(?:\.\d+)?)\%\s*,\s*(\d*(?:\.\d+)?)\%\s*,\s*(\d*(?:\.\d+)?)\%\s*?\)/,format:"rgb",parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],1]}},{re:/rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d*(?:\.\d+)?)\s*)?\)/,format:"rgba",parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba\(\s*(\d*(?:\.\d+)?)\%\s*,\s*(\d*(?:\.\d+)?)\%\s*,\s*(\d*(?:\.\d+)?)\%\s*(?:,\s*(\d*(?:\.\d+)?)\s*)?\)/,format:"rgba",parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/hsl\(\s*(\d*(?:\.\d+)?)\s*,\s*(\d*(?:\.\d+)?)\%\s*,\s*(\d*(?:\.\d+)?)\%\s*?\)/,format:"hsl",parse:function(e){return[e[1]/360,e[2]/100,e[3]/100,e[4]]}},{re:/hsla\(\s*(\d*(?:\.\d+)?)\s*,\s*(\d*(?:\.\d+)?)\%\s*,\s*(\d*(?:\.\d+)?)\%\s*(?:,\s*(\d*(?:\.\d+)?)\s*)?\)/,format:"hsla",parse:function(e){return[e[1]/360,e[2]/100,e[3]/100,e[4]]}},{re:/#?([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,format:"hex",parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),1]}},{re:/#?([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,format:"hex",parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),1]}}],colorNameToHex:function(e){return void 0!==this.colors[e.toLowerCase()]&&this.colors[e.toLowerCase()]}};var i={horizontal:!1,inline:!1,color:!1,format:!1,input:"input",container:!1,component:".add-on, .input-group-addon",fallbackColor:!1,fallbackFormat:"hex",hexNumberSignPrefix:!0,sliders:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setHue"},alpha:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setAlpha"}},slidersHorz:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:100,maxTop:0,callLeft:"setHue",callTop:!1},alpha:{maxLeft:100,maxTop:0,callLeft:"setAlpha",callTop:!1}},template:'<div class="colorpicker dropdown-menu"><div class="colorpicker-saturation"><i><b></b></i></div><div class="colorpicker-hue"><i></i></div><div class="colorpicker-alpha"><i></i></div><div class="colorpicker-color"><div /></div><div class="colorpicker-selectors"></div></div>',align:"right",customClass:null,colorSelectors:null},o=function(t,o){this.element=e(t).addClass("colorpicker-element"),this.options=e.extend(!0,{},i,this.element.data(),o),this.component=this.options.component,this.component=!1!==this.component&&this.element.find(this.component),this.component&&0===this.component.length&&(this.component=!1),this.container=!0===this.options.container?this.element:this.options.container,this.container=!1!==this.container&&e(this.container),this.input=this.element.is("input")?this.element:!!this.options.input&&this.element.find(this.options.input),this.input&&0===this.input.length&&(this.input=!1),this.color=this.createColor(!1!==this.options.color?this.options.color:this.getValue()),this.format=!1!==this.options.format?this.options.format:this.color.origFormat,!1!==this.options.color&&(this.updateInput(this.color),this.updateData(this.color));var a=this.picker=e(this.options.template);if(this.options.customClass&&a.addClass(this.options.customClass),this.options.inline?a.addClass("colorpicker-inline colorpicker-visible"):a.addClass("colorpicker-hidden"),this.options.horizontal&&a.addClass("colorpicker-horizontal"),-1===["rgba","hsla","alias"].indexOf(this.format)&&!1!==this.options.format&&"transparent"!==this.getValue()||a.addClass("colorpicker-with-alpha"),"right"===this.options.align&&a.addClass("colorpicker-right"),!0===this.options.inline&&a.addClass("colorpicker-no-arrow"),this.options.colorSelectors){var s=this,r=s.picker.find(".colorpicker-selectors");r.length>0&&(e.each(this.options.colorSelectors,(function(t,i){var o=e("<i />").addClass("colorpicker-selectors-color").css("background-color",i).data("class",t).data("alias",t);o.on("mousedown.colorpicker touchstart.colorpicker",(function(t){t.preventDefault(),s.setValue("alias"===s.format?e(this).data("alias"):e(this).css("background-color"))})),r.append(o)})),r.show().addClass("colorpicker-visible"))}a.on("mousedown.colorpicker touchstart.colorpicker",e.proxy((function(e){e.target===e.currentTarget&&e.preventDefault()}),this)),a.find(".colorpicker-saturation, .colorpicker-hue, .colorpicker-alpha").on("mousedown.colorpicker touchstart.colorpicker",e.proxy(this.mousedown,this)),a.appendTo(this.container?this.container:e("body")),!1!==this.input&&(this.input.on({"keyup.colorpicker":e.proxy(this.keyup,this)}),this.input.on({"change.colorpicker":e.proxy(this.change,this)}),!1===this.component&&this.element.on({"focus.colorpicker":e.proxy(this.show,this)}),!1===this.options.inline&&this.element.on({"focusout.colorpicker":e.proxy(this.hide,this)})),!1!==this.component&&this.component.on({"click.colorpicker":e.proxy(this.show,this)}),!1===this.input&&!1===this.component&&this.element.on({"click.colorpicker":e.proxy(this.show,this)}),!1!==this.input&&!1!==this.component&&"color"===this.input.attr("type")&&this.input.on({"click.colorpicker":e.proxy(this.show,this),"focus.colorpicker":e.proxy(this.show,this)}),this.update(),e(e.proxy((function(){this.element.trigger("create")}),this))};o.Color=t,o.prototype={constructor:o,destroy:function(){this.picker.remove(),this.element.removeData("colorpicker","color").off(".colorpicker"),!1!==this.input&&this.input.off(".colorpicker"),!1!==this.component&&this.component.off(".colorpicker"),this.element.removeClass("colorpicker-element"),this.element.trigger({type:"destroy"})},reposition:function(){if(!1!==this.options.inline||this.options.container)return!1;var e=this.container&&this.container[0]!==window.document.body?"position":"offset",t=this.component||this.element,i=t[e]();"right"===this.options.align&&(i.left-=this.picker.outerWidth()-t.outerWidth()),this.picker.css({top:i.top+t.outerHeight(),left:i.left})},show:function(t){this.isDisabled()||(this.picker.addClass("colorpicker-visible").removeClass("colorpicker-hidden"),this.reposition(),e(window).on("resize.colorpicker",e.proxy(this.reposition,this)),!t||this.hasInput()&&"color"!==this.input.attr("type")||t.stopPropagation&&t.preventDefault&&(t.stopPropagation(),t.preventDefault()),!this.component&&this.input||!1!==this.options.inline||e(window.document).on({"mousedown.colorpicker":e.proxy(this.hide,this)}),this.element.trigger({type:"showPicker",color:this.color}))},hide:function(t){if(void 0!==t&&t.target&&(e(t.currentTarget).parents(".colorpicker").length>0||e(t.target).parents(".colorpicker").length>0))return!1;this.picker.addClass("colorpicker-hidden").removeClass("colorpicker-visible"),e(window).off("resize.colorpicker",this.reposition),e(window.document).off({"mousedown.colorpicker":this.hide}),this.update(),this.element.trigger({type:"hidePicker",color:this.color})},updateData:function(e){return e=e||this.color.toString(this.format,!1),this.element.data("color",e),e},updateInput:function(e){return e=e||this.color.toString(this.format,!1),!1!==this.input&&(this.input.prop("value",e),this.input.trigger("change")),e},updatePicker:function(e){void 0!==e&&(this.color=this.createColor(e));var t=!1===this.options.horizontal?this.options.sliders:this.options.slidersHorz,i=this.picker.find("i");if(0!==i.length)return!1===this.options.horizontal?(t=this.options.sliders,i.eq(1).css("top",t.hue.maxTop*(1-this.color.value.h)).end().eq(2).css("top",t.alpha.maxTop*(1-this.color.value.a))):(t=this.options.slidersHorz,i.eq(1).css("left",t.hue.maxLeft*(1-this.color.value.h)).end().eq(2).css("left",t.alpha.maxLeft*(1-this.color.value.a))),i.eq(0).css({top:t.saturation.maxTop-this.color.value.b*t.saturation.maxTop,left:this.color.value.s*t.saturation.maxLeft}),this.picker.find(".colorpicker-saturation").css("backgroundColor",(this.options.hexNumberSignPrefix?"":"#")+this.color.toHex(this.color.value.h,1,1,1)),this.picker.find(".colorpicker-alpha").css("backgroundColor",(this.options.hexNumberSignPrefix?"":"#")+this.color.toHex()),this.picker.find(".colorpicker-color, .colorpicker-color div").css("backgroundColor",this.color.toString(this.format,!0)),e},updateComponent:function(e){var t;if(t=void 0!==e?this.createColor(e):this.color,!1!==this.component){var i=this.component.find("i").eq(0);i.length>0?i.css({backgroundColor:t.toString(this.format,!0)}):this.component.css({backgroundColor:t.toString(this.format,!0)})}return t.toString(this.format,!1)},update:function(e){var t;return!1===this.getValue(!1)&&!0!==e||(t=this.updateComponent(),this.updateInput(t),this.updateData(t),this.updatePicker()),t},setValue:function(e){this.color=this.createColor(e),this.update(!0),this.element.trigger({type:"changeColor",color:this.color,value:e})},createColor:function(e){return new t(e||null,this.options.colorSelectors,this.options.fallbackColor?this.options.fallbackColor:this.color,this.options.fallbackFormat,this.options.hexNumberSignPrefix)},getValue:function(e){var t;return e=void 0===e?this.options.fallbackColor:e,void 0!==(t=this.hasInput()?this.input.val():this.element.data("color"))&&""!==t&&null!==t||(t=e),t},hasInput:function(){return!1!==this.input},isDisabled:function(){return!!this.hasInput()&&!0===this.input.prop("disabled")},disable:function(){return!!this.hasInput()&&(this.input.prop("disabled",!0),this.element.trigger({type:"disable",color:this.color,value:this.getValue()}),!0)},enable:function(){return!!this.hasInput()&&(this.input.prop("disabled",!1),this.element.trigger({type:"enable",color:this.color,value:this.getValue()}),!0)},currentSlider:null,mousePointer:{left:0,top:0},mousedown:function(t){!t.pageX&&!t.pageY&&t.originalEvent&&t.originalEvent.touches&&(t.pageX=t.originalEvent.touches[0].pageX,t.pageY=t.originalEvent.touches[0].pageY),t.stopPropagation(),t.preventDefault();var i=e(t.target).closest("div"),o=this.options.horizontal?this.options.slidersHorz:this.options.sliders;if(!i.is(".colorpicker")){if(i.is(".colorpicker-saturation"))this.currentSlider=e.extend({},o.saturation);else if(i.is(".colorpicker-hue"))this.currentSlider=e.extend({},o.hue);else{if(!i.is(".colorpicker-alpha"))return!1;this.currentSlider=e.extend({},o.alpha)}var a=i.offset();this.currentSlider.guide=i.find("i")[0].style,this.currentSlider.left=t.pageX-a.left,this.currentSlider.top=t.pageY-a.top,this.mousePointer={left:t.pageX,top:t.pageY},e(window.document).on({"mousemove.colorpicker":e.proxy(this.mousemove,this),"touchmove.colorpicker":e.proxy(this.mousemove,this),"mouseup.colorpicker":e.proxy(this.mouseup,this),"touchend.colorpicker":e.proxy(this.mouseup,this)}).trigger("mousemove")}return!1},mousemove:function(e){!e.pageX&&!e.pageY&&e.originalEvent&&e.originalEvent.touches&&(e.pageX=e.originalEvent.touches[0].pageX,e.pageY=e.originalEvent.touches[0].pageY),e.stopPropagation(),e.preventDefault();var t=Math.max(0,Math.min(this.currentSlider.maxLeft,this.currentSlider.left+((e.pageX||this.mousePointer.left)-this.mousePointer.left))),i=Math.max(0,Math.min(this.currentSlider.maxTop,this.currentSlider.top+((e.pageY||this.mousePointer.top)-this.mousePointer.top)));return this.currentSlider.guide.left=t+"px",this.currentSlider.guide.top=i+"px",this.currentSlider.callLeft&&this.color[this.currentSlider.callLeft].call(this.color,t/this.currentSlider.maxLeft),this.currentSlider.callTop&&this.color[this.currentSlider.callTop].call(this.color,i/this.currentSlider.maxTop),!1!==this.options.format||"setAlpha"!==this.currentSlider.callTop&&"setAlpha"!==this.currentSlider.callLeft||(1!==this.color.value.a?(this.format="rgba",this.color.origFormat="rgba"):(this.format="hex",this.color.origFormat="hex")),this.update(!0),this.element.trigger({type:"changeColor",color:this.color}),!1},mouseup:function(t){return t.stopPropagation(),t.preventDefault(),e(window.document).off({"mousemove.colorpicker":this.mousemove,"touchmove.colorpicker":this.mousemove,"mouseup.colorpicker":this.mouseup,"touchend.colorpicker":this.mouseup}),!1},change:function(e){this.keyup(e)},keyup:function(e){38===e.keyCode?(this.color.value.a<1&&(this.color.value.a=Math.round(100*(this.color.value.a+.01))/100),this.update(!0)):40===e.keyCode?(this.color.value.a>0&&(this.color.value.a=Math.round(100*(this.color.value.a-.01))/100),this.update(!0)):(this.color=this.createColor(this.input.val()),this.color.origFormat&&!1===this.options.format&&(this.format=this.color.origFormat),!1!==this.getValue(!1)&&(this.updateData(),this.updateComponent(),this.updatePicker())),this.element.trigger({type:"changeColor",color:this.color,value:this.input.val()})}},e.colorpicker=o,e.fn.colorpicker=function(t){var i=Array.prototype.slice.call(arguments,1),a=1===this.length,s=null,r=this.each((function(){var a=e(this),r=a.data("colorpicker");r||(r=new o(this,"object"==typeof t?t:{}),a.data("colorpicker",r)),"string"==typeof t?e.isFunction(r[t])?s=r[t].apply(r,i):(i.length&&(r[t]=i[0]),s=r[t]):s=a}));return a?s:r},e.fn.colorpicker.constructor=o})),$((function(){var e=$("body");e.on("keyup keydown change","input[name='eseo_meta_title']",{limit:60},seoCharCounter),e.on("keyup keydown change","textarea[name='eseo_meta_description']",{limit:160},seoCharCounter)})),window.preSeoCharCounter=function(){$("form.seoForm").each((function(){var e=$(this),t=e.find("input[name='eseo_meta_title']"),i=e.find("textarea[name='eseo_meta_description']");t.trigger("keyup"),i.trigger("keyup")}))},window.seoCharCounter=function(e){var t=$(this),i=t.val().length,o=t.prev("label"),a=e.data.limit;o.find(".label-text span").length?0===i?(o.removeClass("limit"),o.find(".label-text span").remove()):(o.find(".label-text span").html('<i class="fa fa-text-width"></i>('+i+")"),i>a?(o.addClass("limit"),o.find(".label-text span").addClass("limit")):(o.removeClass("limit"),o.find(".label-text span").removeClass("limit"))):0!==i&&(o.find(".label-text").append("<span class='text-counter-indicator'><i class='fa fa-text-width'></i>("+i+")</span>"),i>a&&(o.addClass("limit"),o.find(".label-text span").addClass("limit")))};window,melisCommerceSeo={serializeSeo:function(e,t,i){var o=new Array;return $("form."+e+"_"+t+"_seo_form").each((function(){langId=$(this).data("langid"),o=$(this).serializeArray(),$.each(o,(function(){i.push({name:e+"_seo["+langId+"]["+this.name+"]",value:this.value})}))})),i}};function melisSKUKoNotification(e,t,i,o){void 0===o&&(o="closeByButtonOnly"),o="closeByButtonOnly"!==o?"overlay-hideonclick":"";var a="<h3>"+melisHelper.melisTranslator(e)+"</h3>";a+="<h4>"+melisHelper.melisTranslator(t)+"</h4>",$.each(i,(function(e,t){if("label"!==e){a+='<p class="modal-error-cont"><strong>'+(null==i[e].label?null==i.label?e:i.label:i[e].label)+": </strong>  ";try{$.each(t,(function(e,t){"label"!==e&&"form"!==e&&($errMsg="",$errMsg=t instanceof Object?t[0]:t,a+='<span><i class="fa fa-circle"></i>'+$errMsg+"</span>")}))}catch(i){"label"!==e&&"form"!==e&&(a+='<span><i class="fa fa-circle"></i>'+t+"</span>")}a+="</p>"}}));var s="<div class='melis-modaloverlay "+o+"'></div>";s+="<div class='melis-modal-cont KOnotif'>  <div class='modal-content'>"+a+" <span class='btn btn-block btn-primary'>"+translations.tr_meliscore_notification_modal_Close+"</span></div> </div>",$body.append(s)}function highlightSKUErrors(e,t,i){$(".duplicate-table-label").css("color","inherit"),0===e&&$.each(t,(function(e,t){"form"in t&&$.each(this.form,(function(e,t){$("#"+t+"_label").css("color","red")}))}))}$((function(){var e=$("body");function t(e){var t=activeTabId.split("_")[0];e.push({name:"ccli_coupon_id",value:t}),melisCommerce.postSave("/melis/MelisCommerce/MelisComCoupon/couponClientManagement",e,(function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload(t+"_id_meliscommerce_coupon_tabs_content_assign_details","meliscommerce_coupon_tabs_content_assign_details",{couponId:t}),melisHelper.zoneReload(t+"_id_meliscommerce_coupon_tabs_content_assigned_details_table","meliscommerce_coupon_tabs_content_assigned_details_table",{couponId:t})):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCore.flashMessenger()}),(function(e){console.log(e),alert(translations.tr_meliscore_error_message)})),$("#"+t+"_id_meliscommerce_coupon_tabs_content_assign_details").addClass("active")}function i(e,t,i){var o=i;melisHelper.tabOpen(e,"fa fa-ticket",t+"_id_meliscommerce_coupon_page","meliscommerce_coupon_page",{couponId:t},o)}function o(e){var t=activeTabId.split("_")[0];e.push({name:"cprod_coupon_id",value:t}),melisCommerce.postSave("/melis/MelisCommerce/MelisComCoupon/couponProductManagement",e,(function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload(t+"_id_meliscommerce_coupon_tabs_content_assign_product_details_table","meliscommerce_coupon_tabs_content_assign_product_details_table",{couponId:t}),melisHelper.zoneReload(t+"_id_meliscommerce_coupon_tabs_content_assigned_product_details_table","meliscommerce_coupon_tabs_content_assigned_product_details_table",{couponId:t})):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCore.flashMessenger()}),(function(e){console.log(e)}))}e.on("click",".orderPaymentCouponLink",(function(){var e=$(this),t=e.data("couponid"),o=e.data("couponname"),a=$("body #melis-id-nav-bar-tabs li a.tab-element[data-id='id_meliscommerce_coupon_list_page']");melisHelper.tabOpen(translations.tr_meliscommerce_coupon_list_page,"fa fa-ticket","id_meliscommerce_coupon_list_page","meliscommerce_coupon_list_page",{},"");var s=setInterval((function(){a.length&&(i(o,t,"id_meliscommerce_coupon_list_page"),clearInterval(s))}),500)})),e.on("click",".couponListRefresh",(function(){melisHelper.zoneReload("id_meliscommerce_coupon_list_content_table","meliscommerce_coupon_list_content_table")})),e.on("click",".couponAssignedClientListRefresh",(function(){var e=activeTabId.split("_")[0];melisHelper.zoneReload(e+"_id_meliscommerce_coupon_tabs_content_assigned_details_table","meliscommerce_coupon_tabs_content_assigned_details_table",{couponId:e})})),e.on("click",".couponClientListRefresh",(function(){var e=$(this),t=e.parents().eq(5).attr("id"),i=e.parents().eq(5).data("meliskey"),o=activeTabId.split("_")[0];melisHelper.zoneReload(t,i,{couponId:o})})),e.on("click",".addNewCoupon",(function(){melisHelper.tabOpen(translations.tr_meliscommerce_coupon_list_add_coupon,"fa fa-ticket","0_id_meliscommerce_coupon_page","meliscommerce_coupon_page",{},"id_meliscommerce_coupon_list_page")})),e.on("click",".removeCouponFromClient",(function(){var e=$(this),i=e.closest("tr").attr("id"),o=[],a=e.closest("td").prev().find("a").data("ccli_id");melisCoreTool.pending(this),o.push({name:"ccli_client_id",value:i}),o.push({name:"method",value:"remove"}),o.push({name:"ccliId",value:a}),t(o),melisCoreTool.done(this)})),e.on("click",".addCouponToClient",(function(){var e=$(this).closest("tr").attr("id"),i=[];melisCoreTool.pending(this),i.push({name:"ccli_client_id",value:e}),i.push({name:"method",value:"add"}),t(i),melisCoreTool.done(this)})),e.on("click",".saveCoupon",(function(){melisCoreTool.pending(this);var e,t=activeTabId.split("_")[0],o=$(this).closest(".container-level-a").find("form"),a=[];o.each((function(){var t=0,i=$(this).attr("name"),o=$(this).serializeArray();for(e=o.length,j=0;j<e;j++)a.push({name:i+"["+t+"]["+o[j].name+"]",value:o[j].value});t++})),a.push({name:"couponId",value:t}),$("#"+activeTabId+" .make-switch div").each((function(){var e="switch["+$(this).find("input").attr("name")+"]",t=0;$(this).hasClass("switch-on")&&(t=1),a.push({name:e,value:t})})),melisCommerce.postSave("/melis/MelisCommerce/MelisComCoupon/saveCouponData",a,(function(e){e.success?(melisHelper.tabClose(t+"_id_meliscommerce_coupon_page",!0),i(translations.tr_meliscommerce_coupon_page+" "+e.chunk.coup_code,e.chunk.couponId,"id_meliscommerce_coupon_list_page"),melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload("id_meliscommerce_coupon_list_content_table","meliscommerce_coupon_list_content_table")):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,t+"_id_meliscommerce_coupon_page"),$(".couponEnd").prev("label").css("color","#686868"),$.each(e.errors,(function(e,i){"coup_date_valid_end"==e&&$(".couponEnd").prev("label").css("color","red"),"values"==e&&($("#"+t+"_id_meliscommerce_coupon_page .form-control[name='coup_percentage']").prev("label").css("color","red"),$("#"+t+"_id_meliscommerce_coupon_page .form-control[name='coup_discount_value']").prev("label").css("color","red"))}))),melisCore.flashMessenger()}),(function(e){console.log(e)})),melisCoreTool.done(this)})),e.on("click",".couponInfo",(function(){var e=$(this),t=e.closest("tr").attr("id"),o=e.closest("tr").find("td:nth-child(3)").text(),a=t;o.length>0&&(a=o),i(translations.tr_meliscommerce_coupon_page+" "+a,t,"id_meliscommerce_coupon_list_page")})),e.on("click",".couponDelete",(function(){var e=$(this).closest("tr").attr("id"),t=[];t.push({name:"couponId",value:e}),melisCoreTool.pending(this),melisCoreTool.confirm(translations.tr_meliscommerce_documents_common_label_yes,translations.tr_meliscommerce_documents_common_label_no,translations.tr_meliscommerce_coupon_list_page_coupon,translations.tr_meliscommerce_coupon_delete_confirm,(function(){melisCommerce.postSave("/melis/MelisCommerce/MelisComCouponList/deleteCoupon",t,(function(t){t.success?(melisHelper.melisOkNotification(t.textTitle,t.textMessage),melisHelper.zoneReload("id_meliscommerce_coupon_list_content_table","meliscommerce_coupon_list_content_table"),melisHelper.tabClose(e+"_id_meliscommerce_coupon_page")):melisHelper.melisKoNotification(t.textTitle,t.textMessage,t.errors),melisCore.flashMessenger()}),(function(e){console.log(e)}))})),melisCoreTool.done(this)})),e.on("click",".couponAssignedDelete",(function(){var e=$(this),t=e.closest("tr").attr("id"),i=e.closest("tr").data("couponid"),o=[];o.push({name:"couponId",value:i}),o.push({name:"clientId",value:t}),melisCoreTool.pending(this),melisCoreTool.confirm(translations.tr_meliscommerce_documents_common_label_yes,translations.tr_meliscommerce_documents_common_label_no,translations.tr_meliscommerce_coupon_list_page_coupon,translations.tr_meliscommerce_coupon_delete_confirm_remove,(function(){melisCommerce.postSave("/melis/MelisCommerce/MelisComCoupon/deleteAssignedCoupon",o,(function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload(i+"_id_meliscommerce_coupon_tabs_content_assign_details","meliscommerce_coupon_tabs_content_assign_details",{couponId:i}),melisHelper.zoneReload(i+"_id_meliscommerce_coupon_tabs_content_assigned_details_table","meliscommerce_coupon_tabs_content_assigned_details_table",{couponId:i})):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCore.flashMessenger()}),(function(e){console.log(e)}))})),$("#"+i+"_id_meliscommerce_coupon_tabs_content_assign_details").addClass("active"),melisCoreTool.done(this)})),e.on("click",".addCouponToProduct",(function(){var e=$(this).closest("tr").attr("id"),t=[];melisCoreTool.pending(this),t.push({name:"cprod_product_id",value:e}),t.push({name:"method",value:"add"}),o(t),melisCoreTool.done(this)})),e.on("click",".couponAssignedProductDelete",(function(){var e=$(this).closest("tr").attr("id"),t=[];melisCoreTool.pending(this),t.push({name:"cprod_product_id",value:e}),t.push({name:"method",value:"remove"}),melisCoreTool.confirm(translations.tr_meliscommerce_documents_common_label_yes,translations.tr_meliscommerce_documents_common_label_no,translations.tr_meliscommerce_coupon_list_page_coupon,translations.tr_meliscommerce_coupon_delete_confirm_remove_product,(function(){o(t)})),melisCoreTool.done(this)})),e.on("click",".user_add",(function(){var e=$(this).attr("href"),t=e.match(/\d+/);$(e).find(".couponClientListRefresh").trigger("click");var i=setTimeout((function(){$("#"+t+"_clientList").length&&$("#"+t+"_clientList tbody tr").length>1&&($("#"+t+"_clientList tbody tr td:first-child").addClass("dtr-control"),clearTimeout(i))}),2e3)})),e.on("click",".more_items",(function(e){var t=$(this).attr("href");$(t).find(".couponClientListRefresh").trigger("click")})),e.on("click",".shopping_cart",(function(e){var t=$(this).attr("href");$(t).find(".orderListRefresh").trigger("click")}))})),window.initCouponClient=function(e,t){var i=$("#"+t.sTableId).data("couponid");e.couponId=i},window.initCouponClientTable=function(){$(".couponNoAddButton .addCouponToClient").remove(),$(".couponNoAddButton .assignedClients").show()},window.initCouponProductTable=function(){$(".couponProductNoAddButton .addCouponToProduct").remove(),$(".couponProductNoAddButton .assignedProduct").show()},window.initCouponOrder=function(e,t){var i=$("#"+t.sTableId).data("couponid");e.couponId=i,e.osta_id=$("#"+i+"_id_meliscommerce_coupon_tabs_content_orders_details_table .orderFilterStatus").val(),e.startDate=$("#"+i+"_couponOrderList").data("dStartDate"),e.endDate=$("#"+i+"_couponOrderList").data("dEndDate");t.iDraw>1&&(dateSelectionContent=translations.tr_meliscore_datepicker_select_date+"<i class=\"glyphicon glyphicon-calendar fa fa-calendar\"></i> <span class='sdate'>"+dStartDate+" - "+dEndDate+'</span> <strong class="caret"></strong>',$("#"+i+"_couponOrderList_wrapper .dt_orderdatepicker .dt_dateInfo").html(dateSelectionContent)),dStartDate="",dEndDate=""},window.drawCouponClient=function(){},window.initCheckUsedCoupon=function(){$("#tableCouponList tr.couponUsed td").find(".couponDelete").remove(),$(".couponListNoDeleteButton .couponDelete").remove()},window.initCheckClientUsedCoupon=function(e){$("tr.couponAssigned td").find(".couponAssignedDelete").remove()},window.initMelisCommerceCouponTbl=function(){$(".commerce-coupon-percent").attr("title",translations.tr_meliscommerce_coupon_list_col_percent),$(".commerce-coupon-value").attr("title",translations.tr_meliscommerce_coupon_list_col_money)},window.initMelisCouponProduct=function(e,t){var i=$("#"+t.sTableId).data("couponid"),o=$("#"+t.sTableId).data("assign");e.couponId=i,e.assign=o},$(document).ready((function(){var e=$("body");e.on("click",".addNewOrder",(function(){var e=$("#id_meliscommerce_order_checkout").data("clientid");melisHelper.tabOpen(translations.tr_meliscommerce_order_checkout_title,"fa fa fa-plus fa-2x","id_meliscommerce_order_checkout","meliscommerce_order_checkout","","id_meliscommerce_order_list_page",addNewOrderCallback(e,""))})),e.on("click",".orderCheckoutProduListViewVariant",(function(){var e=$(this).closest("tr"),t=$orderCheckoutProductListTbl.row(e),i=e.attr("id");if(t.child.isShown())t.child.hide(),e.removeClass("shown");else{var o=i+"_id_meliscommerce_order_checkout_product_variant_list",a="meliscommerce_order_checkout_product_variant_list",s='<div class="checkout-product-variant-list" id="'+o+'" melisKey="'+a+'"></div>';t.child(s).show(),e.addClass("shown"),$(".checkout-product-variant-list").attr("style","margin-bottom: 10px;"),melisHelper.zoneReload(o,a,{productId:i})}})),e.on("change","#orderCheckoutCountries",(function(){var e=$(this),t=new Array;$countryId=e.val(),t.push({name:"countryId",value:$countryId}),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComOrderCheckout/orderCheckoutSetCountry",data:t,dataType:"json",encode:!0}).done((function(e){e.success?(melisHelper.zoneReload("id_meliscommerce_order_checkout_product_list","meliscommerce_order_checkout_product_list"),melisHelper.zoneReload("id_meliscommerce_order_checkout_product_bakset","meliscommerce_order_checkout_product_bakset")):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors)})).fail((function(){alert(translations.tr_meliscore_error_message)}))})),e.on("click",".orderCheckoutVariantAddBasket",(function(){var e=$(this).data("variantid");dataString=new Array,dataString.push({name:"var_id",value:e}),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComOrderCheckout/addBasket",data:dataString,dataType:"json",encode:!0}).done((function(e){if(e.success){melisHelper.zoneReload("id_meliscommerce_order_checkout_product_bakset","meliscommerce_order_checkout_product_bakset"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)}else melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors)})).fail((function(){alert(translations.tr_meliscore_error_message)}))})),e.on("change",".orderBasketVariantQty",(function(){var e=$(this),t=e.data("variantid"),i=parseInt(e.data("quantity")),o=parseInt(e.val());i<o?updateVariantbasket("add",t,o):updateVariantbasket("deduct",t,o)})),e.on("keydown",".orderBasketVariantQty",(function(e){-1!==$.inArray(e.keyCode,[46,8,9,27,13,110,190])||65===e.keyCode&&(!0===e.ctrlKey||!0===e.metaKey)||e.keyCode>=35&&e.keyCode<=40||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()})),e.on("click",".qty-plus",(function(){var e=$(this).data("variantid"),t=$("#"+e+"_orderBasketVariantQty");variantQty=parseInt(t.val())+1,t.val(variantQty),updateVariantbasket("add",e,variantQty)})),e.on("click",".qty-minus",(function(){var e=$(this).data("variantid"),t=$("#"+e+"_orderBasketVariantQty");$varQty=t.val(),parseInt($varQty)>0&&(variantQty=parseInt(t.val())-1,t.val(variantQty),updateVariantbasket("deduct",e,variantQty))})),e.on("click",".orderCheckoutFirstStepBtn",(function(){var e=$(this),t=e.data("tabid");e.attr("disabled","disabled"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComOrderCheckout/checkBasket",dataType:"json",encode:!0}).done((function(i){i.success?melisCommerce.switchOrderTab(t):melisHelper.melisKoNotification(i.textTitle,i.textMessage,i.errors),e.removeAttr("disabled")})).fail((function(){e.removeAttr("disabled"),alert(translations.tr_meliscore_error_message)}))})),e.on("click",".orderCheckoutNextStep",(function(){var e=$("html, body"),t=$("#id_meliscommerce_order_checkout_choose_contact_step"),i=t.find(".orderCheckoutContactListRefresh");e.stop().animate({scrollTop:0},"500","swing"),setTimeout((function(){t.hasClass("active")&&i.length>0&&melisCore.screenSize<768&&i.trigger("click")}),3e3)})),e.on("click",".orderCheckoutPrevStep",(function(){var e=$(this).data("tabid"),t=$("html, body");melisCommerce.switchOrderTab(e),"#id_meliscommerce_order_checkout_select_addresses_step_nav"==e&&(melisHelper.zoneReload("id_meliscommerce_order_checkout_billing_address","meliscommerce_order_checkout_billing_address"),melisHelper.zoneReload("id_meliscommerce_order_checkout_delivery_address","meliscommerce_order_checkout_delivery_address")),t.stop().animate({scrollTop:0},"500","swing")})),e.on("click",".orderCheckoutSelectContact",(function(){var e=$(this),t=e.closest("tr").attr("id"),i=e.data("tabid"),o=new Array;e.attr("disabled",!0),o.push({name:"contactId",value:t}),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComOrderCheckout/selectContact",data:o,dataType:"json",encode:!0}).done((function(o){o.success?(melisCommerce.switchOrderTab(i),setTimeout((function(){melisHelper.zoneReload("id_meliscommerce_order_checkout_choose_contact_account_step_content","meliscommerce_order_checkout_choose_contact_account_step_content",{contactId:t})}),300)):melisHelper.melisKoNotification(o.textTitle,o.textMessage,o.errors),e.attr("disabled",!1)})).fail((function(){e.attr("disabled",!1),alert(translations.tr_meliscore_error_message)}))})),e.on("click",".orderCheckoutSelectContactAccount",(function(){var e=$(this),t=e.closest("tr").attr("id"),i=e.data("tabid"),o=new Array;e.attr("disabled",!0),o.push({name:"accountId",value:t}),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComOrderCheckout/selectContactAccount",data:o,dataType:"json",encode:!0}).done((function(t){t.success?(melisCommerce.switchOrderTab(i),setTimeout((function(){melisHelper.zoneReload("id_meliscommerce_order_checkout_product_list","meliscommerce_order_checkout_product_list"),melisHelper.zoneReload("id_meliscommerce_order_checkout_product_bakset","meliscommerce_order_checkout_product_bakset"),melisHelper.zoneReload("id_meliscommerce_order_checkout_billing_address","meliscommerce_order_checkout_billing_address"),melisHelper.zoneReload("id_meliscommerce_order_checkout_delivery_address","meliscommerce_order_checkout_delivery_address")}),300)):melisHelper.melisKoNotification(t.textTitle,t.textMessage,t.errors),e.attr("disabled",!1)})).fail((function(){e.attr("disabled",!1),alert(translations.tr_meliscore_error_message)}))})),e.on("click",".orderCheckoutContactListRefresh",(function(){melisHelper.zoneReload("id_meliscommerce_order_checkout_choose_contact_step_content","meliscommerce_order_checkout_choose_contact_step_content")})),e.on("click",".orderCheckoutContactAccountListRefresh",(function(){var e=$(this).closest("#id_meliscommerce_order_checkout_choose_contact_account_step_content").data("contactid");melisHelper.zoneReload("id_meliscommerce_order_checkout_choose_contact_account_step_content","meliscommerce_order_checkout_choose_contact_account_step_content",{contactId:e})})),e.on("change","#orderCheckoutBillingSelect",(function(){var e=$(this).val();melisHelper.zoneReload("id_meliscommerce_order_checkout_billing_address","meliscommerce_order_checkout_billing_address",{cadd_id:e,action:1})})),e.on("change","#order-checkout-billing-address-same",(function(){var e=$(this),t=$("#order-checkout-billing-form-zone");e.is(":checked")?t.addClass("hidden"):t.removeClass("hidden")})),e.on("change","#orderCheckoutDeliverySelect",(function(){var e=$(this).val();melisHelper.zoneReload("id_meliscommerce_order_checkout_delivery_address","meliscommerce_order_checkout_delivery_address",{cadd_id:e})})),e.on("click","#orderCheckoutCreateBillingAdd",(function(){melisHelper.zoneReload("id_meliscommerce_order_checkout_billing_address","meliscommerce_order_checkout_billing_address",{emptyBillingAddress:1})})),e.on("click","#orderCheckoutCreateDeliveryAdd",(function(){melisHelper.zoneReload("id_meliscommerce_order_checkout_delivery_address","meliscommerce_order_checkout_delivery_address",{emptyDeliveryAddress:1})})),e.on("click",".orderCheckoutValidateAddresses",(function(){var e=$(this),t=new Array,i=e.data("tabid");$("#id_meliscommerce_order_checkout_delivery_address form").each((function(){var e=$(this).serializeArray();$.each(e,(function(){t.push({name:"delivery["+this.name+"]",value:this.value})}))})),$("#deliveryAddressOrderCheckoutForm").hasClass("hidden")&&t.push({name:"delivery[noSelected]",value:!0}),$("#id_meliscommerce_order_checkout_billing_address form").each((function(){var e=$(this).serializeArray();$.each(e,(function(){t.push({name:"billing["+this.name+"]",value:this.value})}))})),$("#billingAddressOrderCheckoutForm").hasClass("hidden")&&t.push({name:"billing[noSelected]",value:!0});var o=0;$("#order-checkout-billing-address-same").is(":checked")&&(o=1),t.push({name:"billing[sameAddress]",value:o}),e.attr("disabled",!0),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComOrderCheckout/selectAddresses",data:t,dataType:"json",encode:!0}).done((function(t){t.success?(melisCommerce.switchOrderTab(i),melisHelper.zoneReload("id_meliscommerce_order_checkout_summary_basket","meliscommerce_order_checkout_summary_basket"),melisHelper.zoneReload("id_meliscommerce_order_checkout_summary_billing_address","meliscommerce_order_checkout_summary_billing_address"),melisHelper.zoneReload("id_meliscommerce_order_checkout_summary_delivery_address","meliscommerce_order_checkout_summary_delivery_address")):(melisHelper.melisMultiKoNotification(t.textTitle,t.textMessage,t.errors),melisHelper.highlightMultiErrors(t.success,t.errors,activeTabId+" form")),e.attr("disabled",!1)})).fail((function(){e.attr("disabled",!1),alert(translations.tr_meliscore_error_message)}))})),e.on("click","#orderCheckoutValidateCoupon",(function(){var e=$("#orderCheckoutCouponCode").val();""!=e&&melisHelper.zoneReload("id_meliscommerce_order_checkout_summary_basket","meliscommerce_order_checkout_summary_basket",{couponCode:e})})),e.on("click",".orderValidCoupons i",(function(){var e=$(this).closest(".orderValidCoupons").data("couponcode");""!=e&&melisHelper.zoneReload("id_meliscommerce_order_checkout_summary_basket","meliscommerce_order_checkout_summary_basket",{removeCoupon:e})})),e.on("change",".orderSummaryBasketVariantQty",(function(){var e=$(this),t=e.data("variantid"),i=parseInt(e.data("quantity")),o=parseInt(e.val());i<o?updateSummaryVariantbasket("add",t,o):updateSummaryVariantbasket("deduct",t,o)})),e.on("keydown",".orderSummaryBasketVariantQty",(function(e){-1!==$.inArray(e.keyCode,[46,8,9,27,13,110,190])||65===e.keyCode&&(!0===e.ctrlKey||!0===e.metaKey)||e.keyCode>=35&&e.keyCode<=40||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()})),e.on("click",".summary-qty-plus",(function(){var e=$(this).data("variantid"),t=$("#"+e+"_orderSummaryBasketVariantQty");variantQty=parseInt(t.val())+1,t.val(variantQty),updateSummaryVariantbasket("add",e,variantQty)})),e.on("click",".summary-qty-minus",(function(){var e=$(this).data("variantid"),t=$("#"+e+"_orderSummaryBasketVariantQty");$varQty=t.val(),parseInt($varQty)>0&&(variantQty=parseInt(t.val())-1,t.val(variantQty),updateSummaryVariantbasket("deduct",e,variantQty))})),e.on("click",".orderCheckoutConfirmSummary",(function(){var e=$(this),t=e.data("tabid"),i=new Array;i.push({name:"couponCode",value:$("#orderCheckoutCouponCode").length?$("#orderCheckoutCouponCode").val():""}),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComOrderCheckout/confirmOrderCheckoutSummary",data:i,dataType:"json",encode:!0}).done((function(i){i.success?(melisCommerce.switchOrderTab(t),melisHelper.zoneReload("id_meliscommerce_order_checkout_payment_step_content","meliscommerce_order_checkout_payment_step_content")):melisHelper.melisMultiKoNotification(i.textTitle,i.textMessage,i.errors),e.attr("disabled",!1)})).fail((function(){e.attr("disabled",!1),alert(translations.tr_meliscore_error_message)}))})),e.on("click",".orderCheckoutConfirmPayment",(function(){var e=$(this).data("tabid");melisCommerce.switchOrderTab(e),melisHelper.zoneReload("id_meliscommerce_order_checkout_confirmation_step","meliscommerce_order_checkout_confirmation_step",{activateTab:!0}),melisHelper.zoneReload("id_meliscommerce_order_list_content_table","meliscommerce_order_list_content_table")})),e.on("change","#orderCheckoutCouponCode",(function(){var e=$(this);""==e.val()&&e.parent(".input-group").next().fadeOut("slow")}))})),window.productNextButtonState=function(){var e=$(".orderCheckoutFirstStepBtn");$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComOrderCheckout/checkBasket",dataType:"json",encode:!0}).done((function(t){t.success?(e.attr("disabled",!1),e.attr("title","")):(e.attr("disabled",!0),e.attr("title",translations.tr_meliscommerce_order_checkout_product_basket_empty))})).fail((function(){alert(translations.tr_meliscore_error_message)}))},window.updateSummaryVariantbasket=function(e,t,i){var o=$("#orderCheckoutCouponCode").val();""==o&&(o=null),melisHelper.zoneReload("id_meliscommerce_order_checkout_summary_basket","meliscommerce_order_checkout_summary_basket",{action:e,variantId:t,variantQty:i,couponCode:o}),setTimeout((function(){melisHelper.zoneReload("id_meliscommerce_order_checkout_product_bakset","meliscommerce_order_checkout_product_bakset")}),3e3)},window.updateVariantbasket=function(e,t,i){melisHelper.zoneReload("id_meliscommerce_order_checkout_product_bakset","meliscommerce_order_checkout_product_bakset",{action:e,variantId:t,variantQty:i})},window.initCheckoutSelectContactTable=function(){$(".checkoutSelectContactOrderHeader").attr("title",translations.tr_meliscommerce_checkout_tbl_cper_num_orders)},$((function(){var e=$("body"),t="id_meliscommerce_currency_content_modal_form",i="meliscommerce_currency_content_modal_form",o="/melis/MelisCommerce/MelisComCurrency/renderCurrencyModalContainer";e.on("switch-change",".make-switch",(function(e,t){var i=$(this);if(i.find("#cur_status").length&&!1===t.value){var o=i.closest("form").find("#id_cur_id").val(),a=$(".make-switch");a.bootstrapSwitch("setActive",!1),a.bootstrapSwitch("toggleState",!0,!0),melisCoreTool.pending("#btnComSaveCurrency"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComCurrency/getCountriesUsingCurrency",data:{currencyId:o},dataType:"json",encode:!0}).done((function(e){if(e.countries.length>0){var t='<ul class="container">';$.each(e.countries,(function(e,i){t+="<li>"+i.ctry_name+"</li>"})),t+="</ul>",BootstrapDialog.show({title:translations.tr_meliscommerce_currency,message:translations.tr_meliscommerce_currency_prompt_are_you_sure+"<br><br>"+translations.tr_meliscommerce_currency_prompt_is_used+"<br>"+t,type:BootstrapDialog.TYPE_WARNING,closable:!0,buttons:[{label:translations.tr_meliscore_common_no,cssClass:"btn-danger float-left",action:function(e){a.bootstrapSwitch("setActive",!0),melisCoreTool.done("#btnComSaveCurrency"),e.close()}},{label:translations.tr_meliscore_common_yes,cssClass:"btn-success",action:function(e){a.bootstrapSwitch("setActive",!0),a.bootstrapSwitch("toggleState",!0,!0),melisCoreTool.done("#btnComSaveCurrency"),e.close()}}]})}else a.bootstrapSwitch("setActive",!0),a.bootstrapSwitch("toggleState",!0,!0),melisCoreTool.done("#btnComSaveCurrency")})).fail((function(){a.bootstrapSwitch("setActive",!0),melisCoreTool.done("#btnComSaveCurrency"),alert(translations.tr_meliscore_error_message)}))}})),e.on("click","#btnComAddCurrency",(function(){melisCoreTool.pending("#btnComAddCurrency"),melisHelper.createModal(t,i,!1,{curId:null,saveType:"new"},o,(function(){melisCoreTool.done("#btnComAddCurrency")}))})),e.on("click",(function(e){$(e.target).hasClass("modal")&&$("#id_meliscommerce_currency_content_modal_form_container").modal("hide")})),e.on("click",".btnEditComCurrency",(function(){var e=$(this);id=e.parents("tr").attr("id"),melisCoreTool.pending(".btnEditComCurrency"),melisHelper.createModal(t,i,!1,{curId:id,saveType:"edit"},o,(function(){melisCoreTool.done(".btnEditComCurrency")}))})),e.on("click","#btnComSaveCurrency",(function(){var e=$("form#ecomCurrencyForm"),t=e.serializeArray(),i=e.data("savetype"),o=0;$("#cur_status").parent().hasClass("switch-on")&&(o=1),t.push({name:"cur_status",value:o}),t.push({name:"saveType",value:i}),t=$.param(t),melisCoreTool.pending("#btnComSaveCurrency"),melisCommerce.postSave("/melis/MelisCommerce/MelisComCurrency/save",t,(function(e){e.success?($("div.modal").modal("hide"),$("#"+activeTabId+" .melis-refreshTable").trigger("click"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"id_meliscommerce_currency_content_modal_form form#ecomCurrencyForm")),melisCore.flashMessenger(),melisCoreTool.done("#btnComSaveCurrency")}),(function(){melisCoreTool.done("#btnComSaveCurrency"),alert(translations.tr_meliscore_error_message)}))})),e.on("click",".btnComCurrencyDelete",(function(){var e=$(this).parents("tr").attr("id");melisCoreTool.pending(".btnComCountryDelete"),melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_meliscommerce_currency_delete_currency,translations.tr_meliscommerce_currency_delete_confirm,(function(){$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComCurrency/delete",data:{id:e},dataType:"json",encode:!0}).done((function(e){melisCoreTool.pending(".btnComCurrencyDelete"),e.success?($("#"+activeTabId+" .melis-refreshTable").trigger("click"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.done(".btnComCurrencyDelete"),melisCore.flashMessenger()})).fail((function(){alert(translations.tr_meliscore_error_message)}))})),melisCoreTool.done(".btnComCurrencyDelete")})),e.on("click",".btnComCurrencyMakeDefault",(function(){var e=$(this).parents("tr").attr("id");melisCoreTool.pending(".btnComCurrencyMakeDefault"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComCurrency/setDefaultCurrency",data:{id:e},dataType:"json",encode:!0}).done((function(e){e.success?($("#"+activeTabId+" .melis-refreshTable").trigger("click"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.done(".btnComCurrencyMakeDefault"),melisCore.flashMessenger()})).fail((function(){melisCoreTool.done(".btnComCurrencyMakeDefault"),alert(translations.tr_meliscore_error_message)}))}))})),window.reInitTableEcomCurrency=function(){$("tr.defaultEcomCurrency").find(".btnComCurrencyDelete").remove(),$("tr.defaultEcomCurrency").find(".btnComCurrencyMakeDefault").remove()},$((function(){var e=$("body");function t(e,t){melisHelper.tabOpen(e,"fa fa-cubes",t+"_id_meliscommerce_attribute_page","meliscommerce_attribute_page",{attributeId:t},"id_meliscommerce_attribute_list_page")}e.on("click",".attributeListRefresh",(function(){melisHelper.zoneReload("id_meliscommerce_attribute_list_content_table","meliscommerce_attribute_list_content_table")})),e.on("click",(function(e){$(e.target).hasClass("modal")&&$("#id_meliscommerce_attribute_value_modal_value_form_container").modal("hide")})),e.on("click",".attributeValueRefresh",(function(){var e=activeTabId.split("_")[0];melisHelper.zoneReload(e+"_id_meliscommerce_attributes_tabs_content_values_details_table","meliscommerce_attributes_tabs_content_values_details_table",{attributeId:e})})),e.on("click",".addNewAttribute",(function(){t(translations.tr_meliscommerce_attribute_page_new_attribute,0)})),e.on("click",".attributeInfo",(function(){var e=$(this),i=e.closest("tr").attr("id"),o=e.closest("tr").find("td:nth-child(5)").text(),a=i;o.length>0&&(a=o),t(translations.tr_meliscommerce_attribute_page+" "+a,i)})),e.on("click",".attributeHeading a",(function(){melisHelper.tabOpen(translations.tr_meliscommerce_attribute_list_page,"fa fa-cubes","id_meliscommerce_attribute_list_page","meliscommerce_attribute_list_page")})),e.on("click",".addAttributeValue",(function(){var e=activeTabId.split("_")[0];melisCoreTool.pending(this),zoneId="id_meliscommerce_attribute_value_modal_value_form",melisKey="meliscommerce_attribute_value_modal_value_form",modalUrl="/melis/MelisCommerce/MelisComAttribute/renderAttributeModal",melisHelper.createModal(zoneId,melisKey,!1,{attributeId:e},modalUrl,(function(){})),melisCoreTool.done(this)})),e.on("click",".attributeValueInfo",(function(){var e=$(this),t=activeTabId.split("_")[0],i=e.closest("tr").attr("id");melisCoreTool.pending(this),zoneId="id_meliscommerce_attribute_value_modal_value_form",melisKey="meliscommerce_attribute_value_modal_value_form",modalUrl="/melis/MelisCommerce/MelisComAttribute/renderAttributeModal",melisHelper.createModal(zoneId,melisKey,!1,{attributeId:t,attributeValueId:i},modalUrl,(function(){})),melisCoreTool.done(this)})),e.on("click",".attributeValueDelete",(function(){var e=$(this),t=activeTabId.split("_")[0],i=e.closest("tr").attr("id"),o=[];o.push({name:"attributeValueId",value:i}),melisCoreTool.pending(this),melisCoreTool.confirm(translations.tr_meliscommerce_documents_common_label_yes,translations.tr_meliscommerce_documents_common_label_no,translations.tr_meliscommerce_attribute_value_delete_title,translations.tr_meliscommerce_attribute_value_delete_confirm,(function(){melisCommerce.postSave("melis/MelisCommerce/MelisComAttribute/deleteAttributeValue",o,(function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload(t+"_id_meliscommerce_attributes_tabs_content_values_details_table","meliscommerce_attributes_tabs_content_values_details_table",{attributeId:t})):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCore.flashMessenger()}),(function(e){console.log(e)}))})),melisCoreTool.done(this)})),e.on("click","#saveAttributeValue",(function(){var e,t=$(this),i=activeTabId.split("_")[0],o=t.closest("#"+i+"_id_meliscommerce_attribute_value_modal_value_form").find("form"),a=[],s=0;o.each((function(){var t=$(this),i=t.attr("name"),o=t.serializeArray();for(e=o.length,j=0;j<e;j++)a.push({name:i+"["+s+"]["+o[j].name+"]",value:o[j].value});s++})),a.push({name:"attributeId",value:i}),melisCoreTool.pending(this),melisCommerce.postSave("melis/MelisCommerce/MelisComAttribute/saveAttributeValues",a,(function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload(i+"_id_meliscommerce_attributes_tabs_content_values_details_table","meliscommerce_attributes_tabs_content_values_details_table",{attributeId:i}),$("#id_meliscommerce_attribute_value_modal_value_form_container").modal("hide")):(melisCoreTool.highlightErrors(e.success,e.errors,i+"_id_meliscommerce_attribute_value_modal_value_form"),melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors)),melisCore.flashMessenger()}),(function(e){console.log(e)})),melisCoreTool.done(this)})),e.on("click",".attributeSave",(function(){melisCoreTool.pending(this);var e,i=$(this),o=activeTabId.split("_")[0],a=i.closest(".container-level-a").find("form"),s=[];ctr=0,a.each((function(){var t=$(this),i=t.find(":input:disabled").removeAttr("disabled"),o=t.attr("name"),a=t.serializeArray();for(e=a.length,j=0;j<e;j++)s.push({name:o+"["+ctr+"]["+a[j].name+"]",value:a[j].value});i.attr("disabled","disabled"),ctr++})),s.push({name:"attributeId",value:o}),$("#"+activeTabId+" .make-switch div").each((function(){var e=$(this),t="switch["+e.find("input").attr("name")+"]",i=0;e.hasClass("switch-on")&&(i=1),s.push({name:t,value:i})})),melisCommerce.postSave("melis/MelisCommerce/MelisComAttribute/saveAttribute",s,(function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.tabClose(o+"_id_meliscommerce_attribute_page"),t(translations.tr_meliscommerce_attribute_page+" "+e.chunk.tabName,e.chunk.attributeId),melisHelper.zoneReload("id_meliscommerce_attribute_list_content_table","meliscommerce_attribute_list_content_table")):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,o+"_id_meliscommerce_attribute_page")),melisCore.flashMessenger()}),(function(e){console.log(e)})),melisCoreTool.done(this)})),e.on("click",".attributeDelete",(function(){var e=$(this).closest("tr").attr("id"),t=[];t.push({name:"attributeId",value:e}),melisCoreTool.pending(this),melisCoreTool.confirm(translations.tr_meliscommerce_documents_common_label_yes,translations.tr_meliscommerce_documents_common_label_no,translations.tr_meliscommerce_attribute_delete_title,translations.tr_meliscommerce_attribute_delete_confirm,(function(){melisCommerce.postSave("melis/MelisCommerce/MelisComAttributeList/deleteAttribute",t,(function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage,"#72af46"),melisHelper.zoneReload("id_meliscommerce_attribute_list_content_table","meliscommerce_attribute_list_content_table")):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,"closeByButtonOnly"),melisCore.flashMessenger()}),(function(e){console.log(e)}))})),melisCoreTool.done(this)}))})),window.initAttributeValue=function(e,t){var i=$("#"+t.sTableId).data("attributeid");e.attributeId=i},$((function(){var e=$("body"),t="id_meliscommerce_language_list_page_content_modal_form",i="meliscommerce_language_list_page_content_modal_form",o="/melis/MelisCommerce/MelisComLanguage/renderLanguageListPageModalContainer";e.on("click",(function(e){$(e.target).hasClass("modal")&&$("#id_meliscommerce_language_list_page_content_modal_form_container").modal("hide")})),$(document).on("submit","form#ecomlanguageform",(function(e){var t=$(this),i=new FormData(t[0]),o=$("#elang_status").parent().hasClass("switch-on"),a=0;saveType=t.data("savetype"),o&&(a=1),i.append("elang_status",a),i.append("saveType",saveType),melisCoreTool.pending("#btnComSaveLang"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComLanguage/save",data:i,processData:!1,cache:!1,contentType:!1,dataType:"json"}).done((function(e){e.success?($("div.modal").modal("hide"),$("#"+activeTabId+" .melis-refreshTable").trigger("click"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"id_meliscommerce_language_list_page_content_modal_form form#ecomlanguageform")),melisCore.flashMessenger(),melisCoreTool.done("#btnComSaveLang")})).fail((function(e){melisCoreTool.done("#btnComSaveLang"),alert(translations.tr_meliscore_error_message)})),e.preventDefault()})),e.on("click",".btnEcomLangDelete",(function(){var e=$(this).parents("tr").attr("id");melisCoreTool.pending(".btnEcomLangDelete"),melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_meliscommerce_language_delete,translations.tr_meliscore_tool_language_delete_confirm,(function(){$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComLanguage/delete",data:{id:e},dataType:"json",encode:!0}).done((function(e){melisCoreTool.pending(".btnEcomLangDelete"),e.success?($("#"+activeTabId+" .melis-refreshTable").trigger("click"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.done(".btnEcomLangDelete"),melisCore.flashMessenger()})).fail((function(){alert(translations.tr_meliscore_error_message)}))})),melisCoreTool.done(".btnEcomLangDelete")})),e.on("click",".btnEditComLang",(function(){var e=$(this).parents("tr").attr("id");melisCoreTool.pending(".btnEditComLang"),melisHelper.createModal(t,i,!1,{langId:e,saveType:"edit"},o,(function(){melisCoreTool.done(".btnEditComLang")}))})),e.on("click","#btnComAddLang",(function(){melisCoreTool.pending("#btnComAddLang"),melisHelper.createModal(t,i,!1,{langId:null,saveType:"new"},o,(function(){melisCoreTool.done("#btnComAddLang")}))}))})),$((function(){var e=$("body"),t="id_meliscommerce_country_list_page_content_modal_form",i="meliscommerce_country_list_page_content_modal_form",o="/melis/MelisCommerce/MelisComCountry/renderCountryListPageModalContainer";e.on("click","#btnComAddCountry",(function(){melisCoreTool.pending("#btnComAddCountry"),melisHelper.createModal(t,i,!1,{ctryId:null,saveType:"new"},o,(function(){melisCoreTool.done("#btnComAddCountry")}))})),e.on("click",(function(e){$(e.target).hasClass("modal")&&$("#id_meliscommerce_country_list_page_content_modal_form_container").modal("hide")})),e.on("click",".btnEditComCountry",(function(){var e=$(this).parents("tr").attr("id");melisCoreTool.pending(".btnEditComCountry"),melisHelper.createModal(t,i,!1,{ctryId:e,saveType:"edit"},o,(function(){melisCoreTool.done(".btnEditComCountry")}))})),$(document).on("submit","form#ecomCountryform",(function(e){var t=$(this),i=new FormData(t[0]),o=$("#ctry_status").parent().hasClass("switch-on"),a=0;saveType=t.data("savetype"),o&&(a=1),i.append("ctry_status",a),i.append("saveType",saveType),melisCoreTool.pending("#btnComSaveCountry"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComCountry/save",data:i,processData:!1,cache:!1,contentType:!1,dataType:"json"}).done((function(e){e.success?($("div.modal").modal("hide"),$("#"+activeTabId+" .melis-refreshTable").trigger("click"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"id_meliscommerce_country_list_page_content_modal_form form#ecomCountryform")),melisCore.flashMessenger(),melisCoreTool.done("#btnComSaveCountry")})).fail((function(e){melisCoreTool.done("#btnComSaveCountry"),alert(translations.tr_meliscore_error_message)})),e.preventDefault()})),e.on("click",".btnComCountryDelete",(function(){var e=$(this).parents("tr").attr("id");melisCoreTool.pending(".btnComCountryDelete"),melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_meliscommerce_country_delete_country,translations.tr_meliscommerce_country_delete_confirm,(function(){$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComCountry/delete",data:{id:e},dataType:"json",encode:!0}).done((function(e){melisCoreTool.pending(".btnComCountryDelete"),e.success?($("#"+activeTabId+" .melis-refreshTable").trigger("click"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.done(".btnComCountryDelete"),melisCore.flashMessenger()})).fail((function(){alert(translations.tr_meliscore_error_message)}))})),melisCoreTool.done(".btnComCountryDelete")}))})),window.loadAssocVariantList=function(e,t){var i=$("#"+t.sTableId).data("variantid");e.variantId=i},$((function(){var e=$("body");e.on("click",".btnAssocVAssign",(function(){var e=$(this),t=e.data("variantid"),i=e.data("productid"),o=e.parents(".tableAssocVariantList2"),a=o.attr("id"),s=o.data("variantid"),r=e.parents(".variant-assoc-product-variant-list");melisCommerce.disableAllTabs(),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComAssociateVariant/assignVariant",data:{assignVariantid:t,assignToVariantId:s},dataType:"json",encode:!0}).done((function(e){if(e.success){if(melisHelper.zoneReload(s+"_id_meliscommerce_avar_tab_assoc_vars_list","meliscommerce_avar_tab_assoc_vars_list",{variantId:s}),r.length){var t=r.attr("id"),o=r.attr("data-melisKey"),n=$("#"+a+"_filter input[type='search']").val();melisHelper.zoneReload(t,o,{productId:i,variantId:s,search:n})}melisHelper.melisOkNotification(e.textTitle,e.textMessage)}else melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors);melisCommerce.enableAllTabs(),melisCore.flashMessenger()})).fail((function(){melisCommerce.enableAllTabs(),alert(translations.tr_meliscore_error_message)}))})),e.on("click",".removeAssoc",(function(){var e=$(this),t=e.closest("tr").attr("id"),i=e.parents(".tableAssocVariantList1").data("variantid"),o=e.closest("tr").attr("data-productid");melisCoreTool.pending(".removeAssociation"),melisCommerce.disableAllTabs(),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComAssociateVariant/removeAssociation",data:{assignedVariantId:t,variantId:i},dataType:"json",encode:!0}).done((function(e){if(e.success){melisHelper.zoneReload(i+"_id_meliscommerce_avar_tab_assoc_vars_list","meliscommerce_avar_tab_assoc_vars_list",{variantId:i});var t=$("#"+o+"_"+i+"_id_meliscommerce_avar_product_variants");if(t.length){var a=$(this),s=t.attr("id"),r=t.attr("data-melisKey"),n=a.parents(".tableAssocVariantList2").attr("id"),l=$("#"+n+"_filter input[type='search']").val();melisHelper.zoneReload(s,r,{productId:o,variantId:i,search:l})}melisHelper.melisOkNotification(e.textTitle,e.textMessage)}else melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors);melisCoreTool.done(".removeAssociation"),melisCore.flashMessenger(),melisCommerce.enableAllTabs()})).fail((function(){alert(translations.tr_meliscore_error_message)}))})),e.on("click",".refreshVarList",(function(){var e=$(this).closest(".container-level-a").attr("id").replace(/[^0-9]/g,"");melisHelper.zoneReload(e+"_id_meliscommerce_avar_tab_var_lists","meliscommerce_avar_tab_var_lists",{variantId:e})})),e.on("click",".refreshAssocVarList",(function(){var e=$(this).closest(".container-level-a").attr("id").replace(/[^0-9]/g,"");melisHelper.zoneReload(e+"_id_meliscommerce_avar_tab_assoc_vars_list","meliscommerce_avar_tab_assoc_vars_list",{variantId:e})})),e.on("click",".btnAVVV1",(function(){var e=$(this),t=e.parents("tr").children().eq(2).find("span").data().prodId,i=e.parents("tr").children().eq(3).find("span").data().sku,o=e.closest("tr").attr("id");melisCommerce.disableAllTabs(),melisHelper.tabOpen(i,"icon-tag-2",o+"_id_meliscommerce_variants_page","meliscommerce_variants_page",{variantId:o,productId:t}),melisCommerce.enableAllTabs()})),e.on("click",".btnAVVV2",(function(){var e=$(this),t=e.data("variantsku"),i=e.data("productid"),o=e.closest("tr").prev("tr").find("td:nth-child(3)").text(),a=i+"_id_meliscommerce_products_page",s="id_meliscommerce_product_list_container",r=e.data("variantid");$("body #melis-id-nav-bar-tabs li a.tab-element[data-id='id_meliscommerce_product_list_container']").length>0?(melisCommerce.disableAllTabs(),melisCommerce.openProductPage(i,o,s,(function(){melisHelper.tabOpen(t,"icon-tag-2",r+"_id_meliscommerce_variants_page","meliscommerce_variants_page",{variantId:r,productId:i},a),melisCommerce.setUniqueId(r),melisCommerce.enableAllTabs()}))):melisHelper.tabOpen("Products","icon-shippment","id_meliscommerce_product_list_container","meliscommerce_product_list_container","",s,(function(){melisCommerce.disableAllTabs(),melisCommerce.openProductPage(i,o,s,(function(){melisCommerce.setUniqueId(i),melisHelper.tabOpen(t,"icon-tag-2",r+"_id_meliscommerce_variants_page","meliscommerce_variants_page",{variantId:r,productId:i},a),melisCommerce.setUniqueId(r),melisCommerce.enableAllTabs()}))}))})),e.on("click",".showPrdVariants .dtActionCls",(function(){var e=$(this),t=e.parents(".tableAssocVariantList2"),i=t.attr("id"),o=$("#"+i).DataTable(),a=t.data("variantid"),s=e.closest("tr"),r=o.row(s),n=s.attr("id");if(r.child.isShown())r.child.hide(),s.removeClass("shown");else{var l=n+"_"+a+"_id_meliscommerce_avar_product_variants",c="meliscommerce_avar_product_variants",d='<div class="variant-assoc-product-variant-list" id="'+l+'" melisKey="'+c+'" style="height:50px"></div>',h=$("#"+i+"_filter input[type='search']").val();r.child(d).show(),s.addClass("shown"),$(".checkout-product-variant-list").attr("style","margin-bottom: 10px;"),melisHelper.zoneReload(l,c,{productId:n,variantId:a,search:h})}})),e.on("click",".tabs-label li a",(function(){var e=$(this),t=e.attr("href");"meliscommerce_avar_tab"===e.closest("li").data("meliskey")&&($(t).find(".refreshAssocVarList").trigger("click"),$(t).find(".refreshVarList").trigger("click"))}))})),$((function(){var e=$("body");e.on("click",".melisComDuplicateVariant",(function(){var e=$(this),t=e.parents("tr").attr("id");e.attr("disabled",!0),zoneId="id_meliscommerce_variant_duplication",melisKey="meliscommerce_variant_duplication",modalUrl="/melis/MelisCommerce/MelisComPrdVarDuplication/renderDuplicateModal",melisHelper.createModal(zoneId,melisKey,!1,{variantId:t},modalUrl,(function(){e.attr("disabled",!1)}))})),e.on("click",".melisComDuplicateProduct",(function(){var e=$(this),t=e.parents("tr").attr("id");e.attr("disabled",!0),zoneId="id_meliscommerce_product_duplication",melisKey="meliscommerce_product_duplication",modalUrl="/melis/MelisCommerce/MelisComPrdVarDuplication/renderDuplicateModal",melisHelper.createModal(zoneId,melisKey,!1,{productId:t},modalUrl,(function(){e.attr("disabled",!1)}))})),e.on("click","#melisComStartDuplicateVariant",(function(){var e=$(this),t=new Array;$("#id_meliscommerce_variant_duplication form").each((function(){var e=$(this),i=e.find("input[name='var_id']").val(),o=e.serializeArray();$.each(o,(function(){"var_id"!==this.name&&t.push({name:"variantSku["+i+"]["+this.name+"]",value:this.value})}))}));var i=0;$("#duplicate_images").is(":checked")&&(i=1),t.push({name:"duplicate_images",value:i});var o=0;$("#duplicate_documents").is(":checked")&&(o=1),t.push({name:"duplicate_documents",value:o});var a=0;$("#put_online").is(":checked")&&(a=1),t.push({name:"var_status",value:a}),t.push({name:"duplication_type",value:"variant"}),e.attr("disabled",!0),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComPrdVarDuplication/duplicateVariant",data:t,dataType:"json",encode:!0}).done((function(t){e.attr("disabled",!1),t.success?($("#id_meliscommerce_variant_duplication_container").modal("hide"),melisHelper.melisOkNotification(t.textTitle,t.textMessage,"#72af46"),melisHelper.zoneReload(melisCommerce.getCurrentProductId()+"_id_meliscommerce_products_page_content_tab_variant_content_container","meliscommerce_products_page_content_tab_variant_content_container",{productId:melisCommerce.getCurrentProductId()})):melisSKUKoNotification(t.textTitle,t.textMessage,t.errors,"closeByButtonOnly"),highlightSKUErrors(t.success,t.errors),melisCore.flashMessenger()})).fail((function(){e.attr("disabled",!1),alert(translations.tr_meliscore_error_message)}))})),e.on("click",".main-variant-radio i",(function(){var e=$(this),t=$(".main-variant-radio i");e.addClass("fa-dot-circle-o"),e.addClass("text-success"),t.not(this).addClass("fa-circle-o"),t.not(this).removeClass("fa-dot-circle-o"),t.not(this).removeClass("text-success")})),e.on("click","#melisComStartDuplicateProduct",(function(){var e=$(this),t=new Array;$("#id_meliscommerce_product_duplication form").each((function(){var e=$(this),i=e.find("input[name='var_id']").val(),o=e.serializeArray();$.each(o,(function(){"var_id"!==this.name&&t.push({name:"variantSku["+i+"]["+this.name+"]",value:this.value})}))})),t.push({name:"product_id",value:e.data("productid")});var i=0;$("#duplicate_images").is(":checked")&&(i=1),t.push({name:"duplicate_images",value:i});var o=0;$("#duplicate_documents").is(":checked")&&(o=1),t.push({name:"duplicate_documents",value:o});var a=0;$("#put_online").is(":checked")&&(a=1),t.push({name:"prd_status",value:a}),t.push({name:"main_variant_id",value:$(".main-variant-radio i.fa-dot-circle-o").data("variantid")}),t.push({name:"duplication_type",value:"product"}),e.attr("disabled",!0),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComPrdVarDuplication/duplicateProduct",data:t,dataType:"json",encode:!0}).done((function(t){e.attr("disabled",!1),t.success?($("#id_meliscommerce_product_duplication_container").modal("hide"),melisHelper.melisOkNotification(t.textTitle,t.textMessage,"#72af46"),melisHelper.zoneReload("id_meliscommerce_product_list_container","meliscommerce_product_list_container")):melisSKUKoNotification(t.textTitle,t.textMessage,t.errors),highlightSKUErrors(t.success,t.errors),melisCore.flashMessenger()})).fail((function(){e.attr("disabled",!1),alert(translations.tr_meliscore_error_message)}))}))})),$((function(){var e=$("body");e.on("click","#btnAddClientGroup",(function(){melisHelper.createModal("id_meliscommerce_clients_group_tool_content_modal","meliscommerce_clients_group_tool_content_modal",!1,{},"/melis/MelisCore/MelisGenericModal/emptyGenericModal")})),e.on("click",".btnEditClientGroup",(function(){var e=$(this).parents("tr");e.hasClass("child")&&(e=e.prev());var t=e.data("cgroup-id");melisHelper.createModal("id_meliscommerce_clients_group_tool_content_modal","meliscommerce_clients_group_tool_content_modal",!1,{groupId:t},"/melis/MelisCore/MelisGenericModal/emptyGenericModal")})),e.on("click",".btnSaveClientsGroup",(function(){var e=$(this).data("group-id");melisCoreTool.pending(".btnSaveClientsGroup");var t=$("form#clientsGroupForm").serializeArray();t.push({name:"groupId",value:e}),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComClientsGroupController/saveClientsGroup",data:t}).done((function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),$("#tableClientsGroupsList").DataTable().ajax.reload(),$("#id_meliscommerce_clients_group_tool_content_modal_container").modal("hide")):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisHelper.highlightMultiErrors(e.success,e.errors,"#clientsGroupForm")),melisCore.flashMessenger(),melisCoreTool.done(".btnSaveClientsGroup")})).fail((function(e){melisCoreTool.pending(".btnSaveClientsGroup"),alert(translations.tr_meliscore_error_message)}))})),e.on("click",".btnDeleteClientGroup",(function(){var e=$(this).parents("tr");e.hasClass("child")&&(e=e.prev());var t=e.data("cgroup-id");melisCoreTool.pending(".btnSaveClientsGroup"),melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_meliscommerce_clients_group_delete_confirm_title,translations.tr_meliscommerce_clients_group_delete_confirm_msg,(function(){$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComClientsGroupController/deleteClientsGroup",data:{groupId:t}}).done((function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),$("#tableClientsGroupsList").DataTable().ajax.reload()):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCore.flashMessenger(),melisCoreTool.pending(".btnDeleteClientGroup")})).fail((function(e){melisCoreTool.pending(".btnDeleteClientGroup"),alert(translations.tr_meliscore_error_message)}))}))}))})),window.clientsGroupTableCallBack=function(){$("#tableClientsGroupsList tbody").find("tr[data-cgroup-id='1']").find("a.btnDeleteClientGroup").addClass("hidden")},$((function(){var e=$("body");e.on("click",".addStockAlertEmail",(function(){var e=$(this),t=e.closest("div").find(".stockAlertSelect").val(),i=e.closest("div").find(".stockAlertSelect option:selected"),o=e.closest(".email-alert-area").find(".email_area"),a="";a+='<span class="alert-email-values" data-seaid="" data-userid="'+t+'" data-alertemail="'+i.text()+'">',a+='<span class="ab-attr">',a+='<span class="alert-email-value-email">',a+=i.text(),a+="</span>",a+='<i class="alert-email-remove fa fa-times"></i>',a+="</span>",a+="</span>",""!=t&&(i.remove(),o.append(a),e.closest(".email-alert-area").find(".noAlertRecipients").hide())})),e.on("click",".alert-email-values .alert-email-remove",(function(){var e=$(this),t=e.closest(".alert-email-values"),i=t.data("userid"),o=t.data("alertemail"),a=e.closest(".email-alert-area").find(".stockAlertSelect"),s=a.val();a.append($("<option>",{value:i,text:o}));var r=e.closest(".email-alert-area").find(".stockAlertSelect option");r.sort((function(e,t){return e.value>t.value?1:e.value<t.value?-1:0})),a.empty().append(r),a.val(s),t.remove()})),e.on("click",".saveSettings",(function(){var e=$(this).closest(".container-level-a");melisCommerceSettings.submitStockAlertSettings(e)})),e.on("click","#lock_settings",(function(){$(this).is(":checked")?$("#settingsAccountForm").find("input[name='sa_type']").attr("disabled",!1):$("#settingsAccountForm").find("input[name='sa_type']").attr("disabled",!0)}))}));var melisCommerceSettings=(window,{submitStockAlertSettings:function(e){var t=$(e).find("#id_meliscommerce_settings_tabs_content_main_details_left form"),i=$(e).find("#id_meliscommerce_settings_page_tabs_accounts_content form"),o=[],a=$(e).find(".alert-email-values"),s=0,r="",n="",l="";$("#settingsAccountForm").find("input[name='sa_type']").attr("disabled",!1),Array.prototype.push.apply(o,$(t).serializeArray()),Array.prototype.push.apply(o,$(i).serializeArray()),a.each((function(){var e=$(this);r=e.data("seaid"),n=e.data("alertemail"),l=e.data("userid"),o.push({name:"recipients["+s+"][sea_id]",value:r}),o.push({name:"recipients["+s+"][sea_email]",value:n}),o.push({name:"recipients["+s+"][sea_user_id]",value:l}),s++})),melisCommerce.postSave("melis/MelisCommerce/MelisComSettings/saveSettings",o,(function(e){e.success?(melisHelper.tabClose("id_meliscommerce_settings_page"),melisHelper.tabOpen(translations.tr_meliscommerce_settings,"fa fa-wrench","id_meliscommerce_settings_page","meliscommerce_settings_page",{}),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"id_meliscommerce_settings_page")),melisCore.flashMessenger()}),(function(e){alert(translations.tr_meliscore_error_message)}))}});$((function(){var e=$("body");function t(e,t,o){var a=$(".test-results .results ul").empty(),s=$(".test-results .results p").empty();i(0),$("#contact-list-import-contacts").hide(),$.ajax({type:"POST",url:t,data:e,cache:!1,contentType:!1,processData:!1,beforeSend:function(){i(20),$("#importContacts").attr("disabled",!0)}}).done((function(e){i(90),setTimeout((function(){i(100),e.success?(s.text(e.textMessage),"import"==o?($("#contactList").DataTable().ajax.reload(),$("#id_meliscommerce_contact_list_import_contacts_form_container").modal("hide"),melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisCore.flashMessenger()):$("#importContacts").attr("disabled",!1)):("test"==o&&$("#contact-list-import-contacts").show(),s.text(e.textMessage),e.errors&&$.each(e.errors,(function(e,t){a.append("<li>"+t+"</li>")})))}),500)})).fail((function(){alert(translations.tr_meliscore_error_message)}))}function i(e){$(".contacts-import-progress prog_percent").text(e),$("div#contactsImportProgressBar").attr("arial-valuenow",e).css("width",e+"%").parent().parent().parent().removeClass("hidden")}e.on("click",".addNewClient",(function(){melisHelper.tabOpen(translations.tr_meliscommerce_clients_add_client,"fa fa-user-plus","0_id_meliscommerce_client_page","meliscommerce_client_page",{clientId:0},"id_meliscommerce_clients_list_page")})),e.on("click","#saveClientContact",(function(){var e=$(this).data("clientid"),t=$("#melisCommerceClientContactFormModal").serializeArray();t.push({name:"clientId",value:e}),t=$.param(t),$("#saveClientContact").attr("disabled","disabled"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComContact/saveContact",data:t,dataType:"json",encode:!0,cache:!1}).done((function(e){$("#saveClientContact").removeAttr("disabled"),e.success?($("#id_meliscommerce_client_modal_contact_form_container").modal("hide"),$("#contactList").DataTable().ajax.reload(),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"melisCommerceClientContactFormModal")),melisCore.flashMessenger()})).fail((function(){$("#saveClientContact").removeAttr("disabled"),alert(translations.tr_meliscore_error_message)}))})),e.on("click",".contactEdit",(function(){var e=$(this).parents("tr").attr("id"),t=new Array;t.push({name:"contactId",value:e}),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComContact/getContactName",data:t,dataType:"json",encode:!0,cache:!1}).done((function(t){if($("#saveClientContact").removeAttr("disabled"),t.success){var i="id_meliscommerce_contact_list_page";$("#id_meliscommerce_contact_list_page").length>0?melisHelper.tabOpen(t.clientContactName,"fa fa-user",e+"_id_meliscommerce_contact_page","meliscommerce_contact_page",{contactId:e},i):melisHelper.tabOpen(translations.tr_meliscommerce_contact,"fa fa-user fa-2x","id_meliscommerce_contact_list_page","meliscommerce_contact_list_page",{},null,(function(){melisHelper.tabOpen(t.clientContactName,"fa fa-user",e+"_id_meliscommerce_contact_page","meliscommerce_contact_page",{contactId:e},i)}))}else melisHelper.melisKoNotification(t.textTitle,t.textMessage,t.errors)})).fail((function(){$("#saveClientContact").removeAttr("disabled"),alert(translations.tr_meliscore_error_message)}))})),e.on("click",".cper_type",(function(){var e=activeTabId.split("_")[0],t=$(this).closest("#"+e+"_contactForm");"company"==$(this).val()?(t.find("#cper_civility").closest(".form-group").addClass("d-none"),t.find("#cper_name").closest(".form-group").addClass("d-none"),t.find("#cper_middle_name").closest(".form-group").addClass("d-none"),t.find("#cper_job_service").closest(".form-group").addClass("d-none"),t.find("#cper_job_title").closest(".form-group").addClass("d-none"),t.find("#cper_firstname").closest(".form-group").find("label").html(translations.tr_meliscommerce_contact_common_company+" <sup>*</sup>")):(t.find("#cper_civility").closest(".form-group").removeClass("d-none"),t.find("#cper_name").closest(".form-group").removeClass("d-none"),t.find("#cper_middle_name").closest(".form-group").removeClass("d-none"),t.find("#cper_job_service").closest(".form-group").removeClass("d-none"),t.find("#cper_job_title").closest(".form-group").removeClass("d-none"),t.find("#cper_firstname").closest(".form-group").find("label").html(translations.tr_meliscommerce_contact_firstname+" <sup>*</sup>"))})),e.on("click","#melisCommerceClientContactFormModal .cper_type",(function(){var e=$("#melisCommerceClientContactFormModal");"company"==$(this).val()?(e.find("#cper_civility").closest(".form-group").addClass("d-none"),e.find("#cper_name").closest(".form-group").addClass("d-none"),e.find("#cper_middle_name").closest(".form-group").addClass("d-none"),e.find("#cper_job_service").closest(".form-group").addClass("d-none"),e.find("#cper_job_title").closest(".form-group").addClass("d-none"),e.find("#cper_firstname").closest(".form-group").find("label").html(translations.tr_meliscommerce_contact_common_company+" <sup>*</sup>")):(e.find("#cper_civility").closest(".form-group").removeClass("d-none"),e.find("#cper_name").closest(".form-group").removeClass("d-none"),e.find("#cper_middle_name").closest(".form-group").removeClass("d-none"),e.find("#cper_job_service").closest(".form-group").removeClass("d-none"),e.find("#cper_job_title").closest(".form-group").removeClass("d-none"),e.find("#cper_firstname").closest(".form-group").find("label").html(translations.tr_meliscommerce_contact_firstname+" <sup>*</sup>"))})),e.on("click",".accountContactListRefresh",(function(){var e=$(this).data("accountid");melisHelper.zoneReload(e+"_id_meliscommerce_client_page_tab_contact","meliscommerce_client_page_tab_contact",{clientId:e,activateTab:!0})})),e.on("click",".addContactAddress",(function(){var e=$(this),t=e.data("contactid"),i=e.data("tabid");$(".addNewContactAddress").attr("disabled","disabled"),zoneId="id_meliscommerce_client_modal_contact_address_form",melisKey="meliscommerce_client_modal_contact_address_form",modalUrl="/melis/MelisCommerce/MelisComClient/renderClientModal",melisHelper.createModal(zoneId,melisKey,!1,{contactId:t,tabId:i},modalUrl,(function(){$(".addNewContactAddress").removeAttr("disabled")}))})),e.on("click","#saveClientContactAddress",(function(){var e=$(this),t=e.data("contactid"),i=e.data("tabid"),o=$("#melisCommerceClientContactAddressFormModal").serializeArray();o.push({name:"contactId",value:t}),o.push({name:"tabId",value:i}),o=$.param(o),$("#saveClientContactAddress").attr("disabled","disabled"),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComContact/addContactAddress",data:o,dataType:"json",encode:!0,cache:!1}).done((function(e){$("#saveClientContactAddress").removeAttr("disabled"),e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),$("#id_meliscommerce_client_modal_contact_address_form_container").modal("hide"),melisHelper.zoneReload(t+"_id_meliscommerce_contact_page_content_tab_address","meliscommerce_contact_page_content_tab_address",{contactId:t,reload:!0})):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors),melisCoreTool.highlightErrors(e.success,e.errors,"melisCommerceClientContactAddressFormModal"))})).fail((function(){$("#saveClientContactAddress").removeAttr("disabled"),alert(translations.tr_meliscore_error_message)}))})),e.on("click",".deleteContactAddress",(function(){var e=$(this),t=e.data("addressid"),i=e.data("contactid");melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_meliscommerce_contact_page_content_tab_address_delete,translations.tr_meliscommerce_contact_page_content_tab_address_delete_msg,(function(){$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComContact/deleteContactAddress",data:{addressId:t},dataType:"json",encode:!0,cache:!1}).done((function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload(i+"_id_meliscommerce_contact_page_content_tab_address","meliscommerce_contact_page_content_tab_address",{contactId:i,reload:!0})):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors)}))}))})),e.on("click",".refreshAsocc",(function(){var e=$(this).data("contactid");melisHelper.zoneReload(e+"_id_meliscommerce_contact_page_content_tab_association","meliscommerce_contact_page_content_tab_association",{contactId:e,activateTab:!0})})),e.on("click",".contactAccountLink",(function(){var e=$("#"+activeTabId+" input.link-account-data"),t=e.data("contactid"),i=e.data("accountid");$(this).attr("disabled",!0),$.ajax({url:"/melis/MelisCommerce/MelisComContact/linkContactAccount",data:{accountId:i,contactId:t},type:"POST"}).done((function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),melisHelper.zoneReload(t+"_id_meliscommerce_contact_page_content_tab_association","meliscommerce_contact_page_content_tab_association",{contactId:t,activateTab:!0}),$("#id_meliscommerce_clients_list_page").length>0&&$("#"+i+"_id_meliscommerce_client_page_tab_contact").length>0&&(melisHelper.zoneReload(i+"_id_meliscommerce_client_page_tab_contact","meliscommerce_client_page_tab_contact",{clientId:i,activateTab:!0}),contactToolSelectedAccount=i,contactToolInitAccountAutoSuggest=!0)):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.error),$(this).attr("disabled",!1)}))})),e.on("click",".updateDefaultAccount",(function(){var e=$(this).parents("tr");e.hasClass("child")&&(e=e.prev());var t=$(this),i=e.attr("data-cprid"),o=t.data("contactid"),a=t.data("vdata");e.attr("id");$.ajax({url:"/melis/MelisCommerce/MelisComContact/updateDefaultAccount",data:{contactId:o,cprId:i,cpr_default_client:a},type:"POST"}).done((function(e){e.success?($("#"+o+"_contactAssocAccountList").DataTable().ajax.reload(),melisHelper.melisOkNotification(e.textTitle,e.textMessage),$("#id_meliscommerce_clients_list_page").length>0&&$("li[data-tool-id='id_meliscommerce_clients_list_page'] .nav-group-dropdown li").each((function(){var e=$(this).data("tool-id").replace("_id_meliscommerce_client_page","");melisHelper.zoneReload(e+"_id_meliscommerce_client_page_tab_contact","meliscommerce_client_page_tab_contact",{clientId:e,activateTab:!0},(function(){contactToolSelectedAccount=e,contactToolInitAccountAutoSuggest=!0}))})),$("#contactList").DataTable().ajax.reload()):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.error)}))})),e.on("click",".contactAccountUnlink",(function(){var e=$(this).parents("tr");e.hasClass("child")&&(e=e.prev());var t=e.attr("data-contactid"),i=e.attr("id");melisCoreTool.confirm(translations.tr_meliscommerce_clients_common_label_yes,translations.tr_meliscommerce_clients_common_label_no,translations.tr_meliscommerce_contact_unlink_account,translations.tr_meliscommerce_contact_unlink_account_msg,(function(){$.ajax({url:"/melis/MelisCommerce/MelisComContact/unlinkAccountContact",data:{accountId:i,contactId:t},type:"POST"}).done((function(e){e.success?($("#"+t+"_contactAssocAccountList").DataTable().ajax.reload(),melisHelper.melisOkNotification(e.textTitle,e.textMessage),$("#id_meliscommerce_clients_list_page").length>0&&(melisHelper.zoneReload(i+"_id_meliscommerce_client_page_tab_contact","meliscommerce_client_page_tab_contact",{clientId:i,activateTab:!0}),contactToolSelectedAccount=i,contactToolInitAccountAutoSuggest=!0)):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.error)}))}))})),e.on("click",".saveContactPage",(function(){var e=$(this).data("contactid"),t=$("#"+e+"_id_meliscommerce_contact_page_content_tab_information form").serializeArray();$("#"+e+"_id_meliscommerce_contact_page_content_tab_address form").each((function(){var e=$(this),i=e.data("contactaddressid"),o=e.serializeArray();$.each(o,(function(){t.push({name:"contactAddress["+i+"]["+this.name+"]",value:this.value})}))}));var i=0;$("#"+e+"_cper_status input").is(":checked")&&(i=1),t.push({name:"cper_status",value:i}),$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComContact/saveContact",data:t,dataType:"json",encode:!0,cache:!1}).done((function(t){$(".saveContactPage").removeAttr("disabled"),t.success?($("#contactList").DataTable().ajax.reload(),melisHelper.melisOkNotification(t.textTitle,t.textMessage),melisHelper.tabClose(e+"_id_meliscommerce_contact_page"),melisHelper.tabOpen(t.clientContactName,"fa fa-user",e+"_id_meliscommerce_contact_page","meliscommerce_contact_page",{contactId:e},"id_meliscommerce_contact_list_page")):(melisHelper.melisKoNotification(t.textTitle,t.textMessage,t.errors),melisHelper.highlightMultiErrors(t.success,t.errors,"#"+e+"_contactForm")),melisCore.flashMessenger()})).fail((function(){$("#saveClientContact").removeAttr("disabled"),alert(translations.tr_meliscore_error_message)}))})),e.on("change","#contactAccountSelect",(function(){$("#contactList").DataTable().ajax.reload()})),e.on("change","#contactTypeSelect, #contactStatusSelect",(function(){$("#contactList").DataTable().ajax.reload()})),e.on("click",".contactsExport",(function(){melisCoreTool.isTableEmpty("contactList")||(zoneId="id_meliscommerce_contact_list_export_contacts_form",melisKey="meliscommerce_contact_list_export_contacts_form",modalUrl="/melis/MelisCommerce/MelisComContact/renderContactListModal",melisHelper.createModal(zoneId,melisKey,!1,{},modalUrl,(function(){melisCoreTool.done(this)})))})),e.on("click","#exportContacts",(function(e){e.preventDefault();var t=$(this),i={},o=$("form#contact-list-export-contacts").serializeArray();i.accountId=$("#contactAccountSelect").val(),i.type=$("#contactTypeSelect").val(),i.status=$("#contactStatusSelect").val(),i.search=$("#contactList_filter input[type='search']").val(),$.each(o,(function(e,t){i[t.name]=t.value})),$.ajax({url:"/melis/MelisCommerce/MelisComContact/exportContacts",data:$.param(i),type:"GET",beforeSend:function(){t.attr("disabled",!0)}}).done((function(e,i,o){var a=o.getResponseHeader("fileName");a=decodeURIComponent(escape(a));for(var s=o.getResponseHeader("Content-Type"),r="",n=0;n<e.length;n++)r+=String.fromCharCode(255&e.charCodeAt(n));var l=new Uint8Array(r.length);for(n=0;n<r.length;n++)l[n]=r.charCodeAt(n);var c=new Blob([l],{type:s});saveAs(c,a),t.attr("disabled",!1),$("#id_meliscommerce_contact_list_export_contacts_form_container").modal("hide")})).fail((function(){alert(translations.tr_meliscore_error_message)}))})),e.on("click",".contactsImport",(function(){zoneId="id_meliscommerce_contact_list_import_contacts_form",melisKey="meliscommerce_contact_list_import_contacts_form",modalUrl="/melis/MelisCommerce/MelisComContact/renderContactListModal",melisHelper.createModal(zoneId,melisKey,!1,{},modalUrl,(function(){melisCoreTool.done(this)}))})),e.on("click","#testImportContacts, #importContacts",(function(e){var i=$("#contact-list-import-contacts"),o=new FormData(i[0]),a=$(this).attr("data-action");$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComContact/validateContactImportsForm",data:o,cache:!1,contentType:!1,processData:!1,beforeSend:function(){}}).done((function(e){e.success?t(o,"import"==a?"/melis/MelisCommerce/MelisComContact/importContacts":"/melis/MelisCommerce/MelisComContact/testImportContacts",a):(melisHelper.melisKoNotification(e.title,e.message,e.errors),melisHelper.highlightMultiErrors(e.success,e.errors,"#contact-list-import-contacts"))})).fail((function(){alert(translations.tr_meliscore_error_message)})),e.preventDefault()})),e.on("mouseover","#contactList tbody td",(function(){null!=$(this).find("span.td-tooltip")&&$(this).find("span.td-tooltip").removeClass("d-none").css("left",$(this).position().left+87)})),e.on("mouseout","#contactList tbody td",(function(){$(this).find("span.td-tooltip").addClass("d-none")})),e.on("click","#downloadImportTemplate",(function(e){e.preventDefault(),$.ajax({url:"/melis/download-contact-template",data:{},type:"GET",beforeSend:function(){}}).done((function(e,t,i){var o=i.getResponseHeader("fileName");o=decodeURIComponent(escape(o));for(var a=i.getResponseHeader("Content-Type"),s="",r=0;r<e.length;r++)s+=String.fromCharCode(255&e.charCodeAt(r));var n=new Uint8Array(s.length);for(r=0;r<s.length;r++)n[r]=s.charCodeAt(r);var l=new Blob([n],{type:a});saveAs(l,o)})).fail((function(){alert(translations.tr_meliscore_error_message)}))})),e.on("click",".contactDelete",(function(){var e=$(this).parents("tr").attr("id");melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_meliscommerce_contact_delete_contact_title,translations.tr_meliscommerce_contact_delete_contact_message,(function(){$.ajax({type:"POST",url:"/melis/MelisCommerce/MelisComContact/deleteContact",data:{contactId:e},dataType:"json",encode:!0,cache:!1}).done((function(e){e.success?(melisHelper.melisOkNotification(e.textTitle,e.textMessage),$("#contactList").DataTable().ajax.reload()):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors)}))}))})),e.on("click",".link",(function(){var e=$(this).attr("href");$(e).find(".refreshAsocc").trigger("click")})),e.on("click",".parents",(function(){var e=$(this).attr("href");$(e).find(".accountContactListRefresh").trigger("click")}))})),window.setContactId=function(e){e.contactId=""!=accountToolSelectedContact?accountToolSelectedContact:activeTabId.replace("_id_meliscommerce_contact_page","")},window.initAccountAutoSuggest=function(e){let t={url:function(t){return"/melis/MelisCommerce/MelisComContact/fetchAllAccount?phrase="+t+"&contactId="+$(e).attr("data-contactid")},getValue:function(e){return e.cli_name},ajaxSettings:{dataType:"json",method:"GET",data:{dataType:"json"}},requestDelay:300,list:{maxNumberOfElements:20,onChooseEvent:function(){var t=$(e).getSelectedItemData();$(e).attr("data-accountid",t.cli_id),$("#"+activeTabId+" button.contactAccountLink").attr("disabled",!1)}}};$(e).easyAutocomplete(t)},window.contactTableCallback=function(){$("#contactList tbody tr").each((function(){var e=$(this);1==e.data("has_assoc_accounts")&&e.find("button.contactDelete").addClass("d-none")}))},window.contactAssociatedAccountCallback=function(){var e=activeTabId.replace("_id_meliscommerce_contact_page","");$("#"+e+"_contactAssocAccountList tbody tr").each((function(){var e=$(this),t=e.data("isdefault");e.data("isdefaultcontact"),e.data("showunlink");1==t&&(e.find("button.updateDefaultAccount").removeClass("btn-info"),e.find("button.updateDefaultAccount").addClass("btn-danger"),e.find("button.updateDefaultAccount").attr("title",translations.tr_meliscommerce_contact_remove_default),e.find("button.updateDefaultAccount").data("vdata",0),e.find(".ico-set-default").removeClass("fa-check"),e.find(".ico-set-default").addClass("fa-times"),e.find("button.updateDefaultAccount ").addClass("d-none"))})),accountToolSelectedContact="",accountToolInitContactAutoSuggest=!1},window.contactListTableDataFunction=function(e){e.accountId=$("#contactAccountSelect").val(),e.type=$("#contactTypeSelect").val(),$("#contactStatusSelect").length?e.status=$("#contactStatusSelect").val():e.status=1},$((function(){var e=0,t=$("body");t.on("change",".com-orders-dash-chart-line",(function(){var e=$(this);commerceDashboardOrdersLineGraphInit(e);var t=e.closest(".grid-stack-item").find(".grid-stack-item-content .widget .widget-parent .widget-body .dashboard-plugin-json-config"),i=JSON.parse(t.text());i.activeFilter=e.val(),$(t).text(JSON.stringify(i)),melisDashBoardDragnDrop.saveCurrentDashboard(e)})),t.on("click",".melis-commerce-dashboard-plugin-orders-number-item",(function(){var e=$(this),t=e.find(".melis-commerce-dashboard-plugin-orders-number-item-id").text(),i=e.find(".melis-commerce-dashboard-plugin-orders-number-item-ref").text();melisHelper.tabOpen(translations.tr_meliscommerce_orders_Orders,"fa fa fa-cart-plus fa-2x","id_meliscommerce_order_list_page","meliscommerce_order_list_page");var o=$("body #melis-id-nav-bar-tabs li a.tab-element[data-id='id_meliscommerce_order_list_page']"),a=setInterval((function(){if(o.length){melisHelper.tabOpen(translations.tr_meliscommerce_orders_Order+" "+i,"fa fa fa-cart-plus fa-2x",t+"_id_meliscommerce_orders_page","meliscommerce_orders_page",{orderId:t},"id_meliscommerce_order_list_page"),clearInterval(a)}}),500)})),charts.commerceDashboardOrdersLineGraph={data:{d1:[]},plot:null,options:{grid:{color:"#dedede",borderWidth:1,borderColor:"#eee",clickable:!0,hoverable:!0,labelMargin:20},series:{lines:{show:!0,fill:!1,lineWidth:2,steps:!1},points:{show:!0,radius:5,lineWidth:3,fill:!0,fillColor:"#000"}},xaxis:{tickColor:"#eee"},yaxis:{show:!0,tickColor:"#eee",min:0,tickDecimals:0},legend:{position:"nw",noColumns:2,backgroundColor:null,backgroundOpacity:0},shadowSize:0,tooltip:!0,tooltipOpts:{content:"%y %s - %x",shifts:{x:-30,y:-50},defaultTheme:!1}},placeholder:"#"+activeTabId+" .commerce-dashboard-orders-chart-linegraph-placeholder",init:function(){null==this.plot&&commerceDashboardOrdersLineGraphInit()}},window.commerceDashboardOrdersLineGraphInit=function(i,o){o=o||null;var a="";if(null===(i=i||null)){var s=t.find(".commerce-dashboard-orders-chart-linegraph-placeholder"),r=0;if(t.find(".commerce-dashboard-orders-chart-linegraph-placeholder").each((function(e,t){""===$(this).text()&&r++})),r===t.find(".commerce-dashboard-orders-chart-linegraph-placeholder").length){var n=$(s[e]).closest(".grid-stack-item").find(".grid-stack-item-content .widget .widget-parent .widget-body .dashboard-plugin-json-config").text();++e===s.length&&(e=0),a=JSON.parse(n).activeFilter,o="#commerce-dashboard-orders-chart-linegraph-placeholder-"+JSON.parse(n).plugin_id}else{var l=body.find(".commerce-dashboard-orders-chart-linegraph-placeholder").length-1;n=$(s[l]).closest(".grid-stack-item").find(".grid-stack-item-content .widget .widget-parent .widget-body .dashboard-plugin-json-config").text();a=JSON.parse(n).activeFilter,o="#commerce-dashboard-orders-chart-linegraph-placeholder-"+JSON.parse(n).plugin_id}}else"string"==typeof i?(a=i,o="#commerce-dashboard-orders-chart-linegraph-placeholder-"+o):(a=i.val(),o="#"+i.closest(".tab-pane").find(".commerce-dashboard-orders-chart-linegraph-placeholder").attr("id"));$.ajax({type:"POST",url:"/melis/dashboard-plugin/MelisCommerceDashboardPluginOrdersNumber/getDashboardOrdersData",data:{chartFor:a},dataType:"json",encode:!0}).done((function(e){for(var t=[],i=[],s=e.values.length,r=($(window).width(),""),n=[translations.tr_meliscommerce_dashboardplugin_jan,translations.tr_meliscommerce_dashboardplugin_feb,translations.tr_meliscommerce_dashboardplugin_mar,translations.tr_meliscommerce_dashboardplugin_apr,translations.tr_meliscommerce_dashboardplugin_may,translations.tr_meliscommerce_dashboardplugin_jun,translations.tr_meliscommerce_dashboardplugin_jul,translations.tr_meliscommerce_dashboardplugin_aug,translations.tr_meliscommerce_dashboardplugin_sep,translations.tr_meliscommerce_dashboardplugin_oct,translations.tr_meliscommerce_dashboardplugin_nov,translations.tr_meliscommerce_dashboardplugin_dec],l=0;l<e.values.length;l++){if("hourly"===a){r="fr_FR"===melisLangId?moment(e.values[l][0],"YYYY-MM-DD HH").format("HH")+"h":moment(e.values[l][0],"YYYY-MM-DD HH").format("h A")}else if("daily"===a){var c=moment(e.values[l][0],"YYYY-MM-DD"),d=c.format("DD");r=(u=n[parseInt(c.format("M"))-1]).replace("%day",d)}else if("weekly"===a){var h=moment(e.values[l][0],"YYYY-MM-DD").format("W"),m=moment().day("Monday").week(h),u=n[parseInt(m.format("M"))-1];d=m.format("DD");r=u.replace("%day",d)}else if("monthly"===a){var _=moment(e.values[l][0],"YYYY-MM-DD").format("M");r=(u=n[parseInt(parseInt(_))-1]).replace("%day","")}t.push([s,e.values[l][1]]),i.push([s,r]),s--}charts.commerceDashboardOrdersLineGraph.options.xaxis.ticks=i,charts.commerceDashboardOrdersLineGraph.options.tooltipOpts.content="%y %s",charts.commerceDashboardOrdersLineGraph.plot=$.plot($(o),[{label:translations.tr_melis_commerce_dashboard_plugin_orders_number,data:t,color:"#3997d4",lines:{fill:.2},points:{fillColor:"#fff"}}],charts.commerceDashboardOrdersLineGraph.options)})).fail((function(e,t,i){console.log("ERROR !! Status = "+t+"\n Error = "+i+"\n xhr = "+e.statusText),alert(translations.tr_meliscore_error_message)}))},t.find(".commerce-dashboard-orders-chart-linegraph-placeholder").each((function(e,t){var i=$(t).closest(".grid-stack-item").find(".grid-stack-item-content .widget .widget-parent .widget-body .dashboard-plugin-json-config").text(),o=JSON.parse(i).activeFilter,a=JSON.parse(i).plugin_id;commerceDashboardOrdersLineGraphInit(o,a)}))}));var commerceDashboardPluginSalesRevenue=function(e,t){var i=e("body");function o(){charts.commerceDashboardPluginSalesRevenueChartStackedBars={data:null,plot:null,options:{grid:{color:"#dedede",borderWidth:1,borderColor:"transparent",clickable:!0,hoverable:!0,backgroundColor:{colors:["#fff","#fff"]}},series:{stack:!0,grow:{active:!1},bars:{show:!0,barWidth:.5,fill:1,align:"center"}},xaxis:{mode:"time"},yaxis:{min:0,tickDecimals:2},legend:{position:"ne",backgroundColor:null,backgroundOpacity:0,noColumns:2},colors:["#7acc66","#66cccc"],shadowSize:0,tooltip:!0,tooltipOpts:{content:"%s : %y",shifts:{x:-30,y:-50},defaultTheme:!1}},placeholder:".commerce-dashboard-plugin-sales-revenue-placeholder",init:function(){null==this.plot&&a()}}}function a(i){var a=e(i).attr("data-activefilter");o(),e.ajax({type:"POST",url:"/melis/dashboard-plugin/MelisCommerceDashboardPluginSalesRevenue/getDashboardSalesRevenueData",data:{chartFor:a},dataType:"json",encode:!0}).done((function(o){for(var s=[],r=[],n=[],l=o.values.length,c=(e(t).width(),""),d=[translations.tr_meliscommerce_dashboardplugin_jan,translations.tr_meliscommerce_dashboardplugin_feb,translations.tr_meliscommerce_dashboardplugin_mar,translations.tr_meliscommerce_dashboardplugin_apr,translations.tr_meliscommerce_dashboardplugin_may,translations.tr_meliscommerce_dashboardplugin_jun,translations.tr_meliscommerce_dashboardplugin_jul,translations.tr_meliscommerce_dashboardplugin_aug,translations.tr_meliscommerce_dashboardplugin_sep,translations.tr_meliscommerce_dashboardplugin_oct,translations.tr_meliscommerce_dashboardplugin_nov,translations.tr_meliscommerce_dashboardplugin_dec],h=0;h<o.values.length;h++){if("hourly"===a){c="fr_FR"===melisLangId?moment(o.values[h][0],"YYYY-MM-DD HH").format("HH")+"h":moment(o.values[h][0],"YYYY-MM-DD HH").format("h A")}else if("daily"===a){var m=moment(o.values[h][0],"YYYY-MM-DD"),u=m.format("DD");c=(f=d[parseInt(m.format("M"))-1]).replace("%day",u)}else if("weekly"===a){var _=moment(o.values[h][0],"YYYY-MM-DD").format("W"),p=moment().day("Monday").week(_),f=d[parseInt(p.format("M"))-1];u=p.format("DD");c=f.replace("%day",u)}else if("monthly"===a){var g=moment(o.values[h][0],"YYYY-MM-DD").format("M");c=(f=d[parseInt(parseInt(g))-1]).replace("%day","")}s.push([l,o.values[h][1]]),r.push([l,o.values[h][2]]),n.push([l,c]),l--}charts.commerceDashboardPluginSalesRevenueChartStackedBars.options.xaxis.ticks=n,charts.commerceDashboardPluginSalesRevenueChartStackedBars.data=[],charts.commerceDashboardPluginSalesRevenueChartStackedBars.data.push({label:translations.tr_melis_commerce_dashboard_plugin_sales_revenue_order_price,data:s}),charts.commerceDashboardPluginSalesRevenueChartStackedBars.data.push({label:translations.tr_melis_commerce_dashboard_plugin_sales_revenue_shipping_price,data:r}),charts.commerceDashboardPluginSalesRevenueChartStackedBars.plot=e.plot(e("#"+activeTabId).find(i),charts.commerceDashboardPluginSalesRevenueChartStackedBars.data,charts.commerceDashboardPluginSalesRevenueChartStackedBars.options)})).fail((function(e,t,i){console.log("ERROR !! Status = "+t+"\n Error = "+i+"\n xhr = "+e.statusText)}))}return{loadChart:function(){i.find(".commerce-dashboard-plugin-sales-revenue-placeholder").each((function(){var t=e(this).attr("id");commerceDashboardPluginSalesRevenue.commerceDashboardPluginSalesRevenueChartStackedBarsInit("#"+t)}))},setUpChart:o,commerceDashboardPluginSalesRevenueChartStackedBarsInit:a}}($,window);$((function(){var e=$("body"),t=$("#"+activeTabId+'[data-meliskey="meliscore_dashboard"]'),i=t.find(".commerce-dashboard-plugin-sales-revenue-placeholder");e.on("change",".commerce-dashboard-plugin-sales-revenue",(function(){var e=$(this).closest(".tab-pane.active").find(".flotchart-holder").attr("id");$(this).closest(".tab-pane.active").find(".flotchart-holder").attr("data-activefilter",$(this).val()),commerceDashboardPluginSalesRevenue.commerceDashboardPluginSalesRevenueChartStackedBarsInit("#"+e)})),e.on("shown.bs.tab",".tab-element",(function(){var e=$(this),i=e.parent().data("tool-meliskey"),o=(e.data("id"),t.find(".flotchart-holder.commerce-dashboard-plugin-sales-revenue-placeholder").attr("id"));if("meliscore_dashboard"===i){var a=t.find(".flotchart-holder.commerce-dashboard-plugin-sales-revenue-placeholder"),s=t.find(".commerce-dashboard-plugin-sales-revenue-button-header");a.length?commerceDashboardPluginSalesRevenue.commerceDashboardPluginSalesRevenueChartStackedBarsInit("#"+o):s.length&&s.find(".btn.focus").trigger("click")}})),i.length&&"undefined"==typeof melisUserTabs&&i.each((function(){var e=$(this).attr("id");commerceDashboardPluginSalesRevenue.commerceDashboardPluginSalesRevenueChartStackedBarsInit("#"+e)}))}));var commerceDashPluginOrderMessagesAllMessagesInterval="",commerceDashPluginOrderMessagesUnseenMessagesInterval="",commerceDashPluginorderMessagesInstanceCount=0,commDashPluginOrderMessagesWithUnansweredFilterInstance=0;function commerceDasboardPluginOrderMessagesDelete(e){1===e.find(".melis-commerce-dashboard-plugin-order-messages-parent").length&&(e.find(".melis-commerce-dashboard-plugin-order-messages-parent label.active input[value='all']").length>0?0===--commerceDashPluginorderMessagesInstanceCount&&(clearInterval(commerceDashPluginOrderMessagesAllMessagesInterval),commerceDashPluginOrderMessagesAllMessagesInterval=""):0===--commDashPluginOrderMessagesWithUnansweredFilterInstance&&(clearInterval(commerceDashPluginOrderMessagesUnseenMessagesInterval),commerceDashPluginOrderMessagesUnseenMessagesInterval=""))}$((function(){var e=$("body"),t="",i="";function o(e){$.ajax({type:"POST",url:"/melis/dashboard-plugin/MelisCommerceDashboardPluginOrderMessages/getMessages",data:{filter:e},dataType:"json",encode:!0}).done((function(i){i&&($(".melis-commerce-dashboard-plugin-order-messages-parent").find('label.active input[value="'+e+'"]').each((function(e,t){a.clear(t),a.setUnansweredMessages(i.unansweredMessages,t)})),$.each(i.messages,(function(i,o){a.setMessages(t,o,e)})))})).fail((function(e,t,i){console.log("ERROR !! Status = "+t+"\n Error = "+i+"\n xhr = "+e+"\n xhr.statusText = "+e.statusText),alert(translations.tr_meliscore_error_message)}))}e.on("change",".commerce-dashboard-plugin-order-messages",(function(){commerceDashboardPluginOrderMessagesInit($(this))})),e.on("click",".commerce-dashboard-plugin-order-messages",(function(e){a.openOrderMessages(this)})),window.commerceDashboardPluginOrderMessagesInit=function(e){var a="";i=".message-count",void 0===e?(a="all",t=".commerce-dashboard-plugin-order-messages-list"):(a=e.val(),t="#"+e.closest(".melis-commerce-dashboard-plugin-order-messages-parent").find(".commerce-dashboard-plugin-order-messages-list").attr("id")),commDashPluginOrderMessagesWithUnansweredFilterInstance=$(".melis-commerce-dashboard-plugin-order-messages-parent").find('label.active input[value="unseen"]').length,commerceDashPluginorderMessagesInstanceCount=$(".melis-commerce-dashboard-plugin-order-messages-parent").find('label.active input[value="all"]').length,o(a),0===commDashPluginOrderMessagesWithUnansweredFilterInstance&&(clearInterval(commerceDashPluginOrderMessagesUnseenMessagesInterval),commerceDashPluginOrderMessagesUnseenMessagesInterval=""),0===commerceDashPluginorderMessagesInstanceCount&&(clearInterval(commerceDashPluginOrderMessagesAllMessagesInterval),commerceDashPluginOrderMessagesAllMessagesInterval=""),"all"===a?""===commerceDashPluginOrderMessagesAllMessagesInterval&&(commerceDashPluginOrderMessagesAllMessagesInterval=setInterval(o,6e4,a)):""===commerceDashPluginOrderMessagesUnseenMessagesInterval&&(commerceDashPluginOrderMessagesUnseenMessagesInterval=setInterval(o,6e4,a))},$("#"+activeTabId+'[data-meliskey="meliscore_dashboard"]').find(".commerce-dashboard-plugin-order-messages-list").length>0&&commerceDashboardPluginOrderMessagesInit();var a={openOrderMessages:function(e){var t=$(e).find(".order-message-id").val(),i=$(e).find(".order-message-reference").val();melisHelper.tabOpen(translations.tr_meliscommerce_orders_Orders,"fa fa fa-cart-plus fa-2x","id_meliscommerce_order_list_page","meliscommerce_order_list_page");var o=$("body #melis-id-nav-bar-tabs li a.tab-element[data-id='id_meliscommerce_order_list_page']"),a=$("body a.tab-element[data-id='"+t+"_id_meliscommerce_orders_page']"),s=($("body #"+t+"_id_meliscommerce_orders_page"),setInterval((function(){if(o.length)if(a.length)a[0].trigger("click"),melisHelper.zoneReload(t+"_id_meliscommerce_orders_content_tabs_content_messages_details","meliscommerce_orders_content_tabs_content_messages_details",{orderId:t},(function(){$("#"+(t+"_id_meliscommerce_orders_content_tabs")).find("a[href='#"+t+"_id_meliscommerce_orders_content_tabs_content_messages']")[0].trigger("click")}));else{melisHelper.tabOpen(translations.tr_meliscommerce_orders_Order+" "+i,"fa fa fa-cart-plus fa-2x",t+"_id_meliscommerce_orders_page","meliscommerce_orders_page",{orderId:t},"id_meliscommerce_order_list_page",(function(){$("#"+(t+"_id_meliscommerce_orders_content_tabs")).find("a[href='#"+t+"_id_meliscommerce_orders_content_tabs_content_messages']")[0].trigger("click")}))}clearInterval(s)}),500))},clear:function(e){$(e).closest(".melis-commerce-dashboard-plugin-order-messages-parent").find(".commerce-dashboard-plugin-order-messages-list").empty(),$(e).closest(".melis-commerce-dashboard-plugin-order-messages-parent").find(".message-count").empty()},setUnansweredMessages:function(e,t){var o="";o=e>1?translations.tr_melis_commerce_dashboard_plugin_order_messages_unanswered_messages.replace("%d",e):translations.tr_melis_commerce_dashboard_plugin_order_messages_unanswered_messages.replace("messages","message").replace("%d",e),$(t).closest(".melis-commerce-dashboard-plugin-order-messages-parent").find(i).append(o)},setMessages:function(e,t,i){var o=t.omsg_message.length>70?t.omsg_message.substring(0,70)+"...":t.omsg_message,a=moment(t.omsg_date_creation,"YYYY-MM-DD HH:mm:ss"),s="answered";t.noReply&&(s="unanswered");var r=[translations.tr_meliscommerce_dashboardplugin_jan,translations.tr_meliscommerce_dashboardplugin_feb,translations.tr_meliscommerce_dashboardplugin_mar,translations.tr_meliscommerce_dashboardplugin_apr,translations.tr_meliscommerce_dashboardplugin_may,translations.tr_meliscommerce_dashboardplugin_jun,translations.tr_meliscommerce_dashboardplugin_jul,translations.tr_meliscommerce_dashboardplugin_aug,translations.tr_meliscommerce_dashboardplugin_sep,translations.tr_meliscommerce_dashboardplugin_oct,translations.tr_meliscommerce_dashboardplugin_nov,translations.tr_meliscommerce_dashboardplugin_dec][parseInt(a.format("M"))-1],n='<span class="label label-inverse float-right">'+a.format("HH:mm:ss")+" "+r.replace("%day",a.format("DD"))+"</span>",l='<i class="fa fa-angle-double-right"<i/>',c="<span>"+t.clientFirstName+" "+t.clientLastName+"</span> "+l+" <small>"+translations.tr_melis_commerce_dashboard_plugin_order_messages_message_order_amount+t.totalOrderAmount+"</small> "+l+" <small>"+translations.tr_melis_commerce_dashboard_plugin_order_messages_message_placed_on+t.orderDate+"</small>",d='<a href="#" class="list-group-item commerce-dashboard-plugin-order-messages '+s+'">  <input class="order-message-id" type="text" value="'+t.omsg_order_id+'" hidden="hidden">  <input class="order-message-reference" type="text" value="'+t.reference+'" hidden="hidden">  <span class="media">    <span class="media-body media-body-inline">'+n+c+'    <p class="list-group-item-text"> '+o+"     </p>    </span>  </span></a>";$(".melis-commerce-dashboard-plugin-order-messages-parent").find('label.active input[value="'+i+'"]').each((function(e,t){$(t).closest(".melis-commerce-dashboard-plugin-order-messages-parent").find(".commerce-dashboard-plugin-order-messages-list").append(d)}))}}}));
